[{"text": ["How do I filter ForeignKey choices in a Django ModelForm?"], "childNum": 0, "tag": "h2", "senID": 0, "childList": []}, {"text": ["Say I have the following in my models.py:"], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "models.py", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n class Company(models.Model):\n   name = ...\n\nclass Rate(models.Model):\n   company = models.ForeignKey(Company)\n   name = ...\n\nclass Client(models.Model):\n   name = ...\n   company = models.ForeignKey(Company)\n   base_rate = models.ForeignKey(Rate)\n</code>\n</pre>\n", "senID": 2}, {"text": ["I.e.", "there are multiple Companies, each having a range of Rates and Clients.", "Each Client should have a base Rate that is chosen from it's parent Company's Rates, not another Company's Rates."], "childNum": 7, "tag": "p", "senID": 3, "childList": [{"text": "Companies", "childNum": 0, "tag": "code", "pos": 1, "childList": []}, {"text": "Rates", "childNum": 0, "tag": "code", "pos": 2, "childList": []}, {"text": "Clients", "childNum": 0, "tag": "code", "childList": []}, {"text": "Client", "childNum": 0, "tag": "code", "childList": []}, {"text": "Rate", "childNum": 0, "tag": "code", "childList": []}, {"text": "Company's Rates", "childNum": 0, "tag": "code", "childList": []}, {"text": "Company's Rates", "childNum": 0, "tag": "code", "childList": []}]}, {"text": ["When creating a form for adding a Client, I would like to remove the Company choices (as that has already been selected via an \"Add Client\" button on the Company page) and limit the Rate choices to that Company as well."], "childNum": 5, "tag": "p", "senID": 4, "childList": [{"text": "Client", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "Company", "childNum": 0, "tag": "code", "childList": []}, {"text": "Company", "childNum": 0, "tag": "code", "childList": []}, {"text": "Rate", "childNum": 0, "tag": "code", "childList": []}, {"text": "Company", "childNum": 0, "tag": "code", "childList": []}]}, {"text": ["How do I go about this in Django 1.0?  "], "childNum": 0, "tag": "p", "senID": 5, "childList": []}, {"text": ["My current forms.py file is just boilerplate at the moment:"], "childNum": 1, "tag": "p", "senID": 6, "childList": [{"text": "forms.py", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n from models import *\nfrom django.forms import ModelForm\n\nclass ClientForm(ModelForm):\n    class Meta:\n        model = Client\n</code>\n</pre>\n", "senID": 7}, {"text": ["And the views.py is also basic:"], "childNum": 1, "tag": "p", "senID": 8, "childList": [{"text": "views.py", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n from django.shortcuts import render_to_response, get_object_or_404\nfrom models import *\nfrom forms import *\n\ndef addclient(request, company_id):\n    the_company = get_object_or_404(Company, id=company_id)\n\n    if request.POST:\n    \tform = ClientForm(request.POST)\n    \tif form.is_valid():\n    \t\tform.save()\n    \t\treturn HttpResponseRedirect(the_company.get_clients_url())\n    else:\n    \tform = ClientForm()\n\n    return render_to_response('addclient.html', {'form': form, 'the_company':the_company})\n</code>\n</pre>\n", "senID": 9}, {"text": ["In Django 0.96 I was able to hack this in by doing something like the following before rendering the template:"], "childNum": 0, "tag": "p", "senID": 10, "childList": []}, {"code": "<pre>\n<code>\n manipulator.fields[0].choices = [(r.id,r.name) for r in Rate.objects.filter(company_id=the_company.id)]\n</code>\n</pre>\n", "senID": 11}, {"text": ["ForeignKey.limit_choices_to seems promising but I don't know how to pass in the_company.id and I'm not clear if that will work outside the Admin interface anyway."], "childNum": 3, "tag": "p", "senID": 12, "childList": [{"text": "ForeignKey.limit_choices_to", "tag": "a", "pos": 0, "childList": [{"text": "ForeignKey.limit_choices_to", "tag": "code"}], "childNum": 1, "href": "http://docs.djangoproject.com/en/dev/ref/models/fields/#django.db.models.ForeignKey.limit_choices_to"}, {"text": "ForeignKey.limit_choices_to", "childNum": 0, "tag": "code", "childList": []}, {"text": "the_company.id", "childNum": 0, "tag": "code", "childList": []}]}, {"text": ["Thanks.", "(This seems like a pretty basic request but if I should redesign something I'm open to suggestions."], "childNum": 0, "tag": "p", "senID": 13, "childList": []}]