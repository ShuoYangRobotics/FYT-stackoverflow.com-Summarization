[{"text": ["Activate a virtualenv via fabric as deploy user"], "childNum": 0, "tag": "h2", "senID": 0, "childList": []}, {"text": ["I want to run my fabric script locally, which will in turn, log into my server, switch user to deploy, activate the projects .virtualenv, which will change dir to the project and issue a git pull."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n def git_pull():\n    sudo('su deploy')\n    # here i need to switch to the virtualenv\n    run('git pull')\n</code>\n</pre>\n", "senID": 2}, {"text": ["I typically use the workon command from virtualenvwrapper which sources the activate file and the postactivate file will put me in the project folder.", "In this case, it seems that because fabric runs from within shell, control is give over to fabric, so I can't use bash's source built-in to '$source ~/.virtualenv/myvenv/bin/activate'"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"text": ["Anybody have an example and explanation of how they have done this?"], "childNum": 0, "tag": "p", "senID": 4, "childList": []}, {"text": ["Thanks bitprophet, that led down the right track.", "Using fabric 1.0 we ended up going with the following fabfile recipe which includes a call to pip requirements file:"], "childNum": 0, "tag": "p", "senID": 5, "childList": []}, {"code": "<pre>\n<code>\n def production():\n    env.hosts = ['servername']\n    env.directory = '/path/to/virtualenvs/project'\n    env.activate = 'source /home/deploy/.virtualenvs/project/bin/activate'\n    env.deploy_user = 'deploy'\n\ndef virtualenv(command):\n    with cd(env.directory):\n        sudo(env.activate + '&amp;&amp;' + command, user=env.deploy_user)\n\ndef git_pull():\n    'Updates the repository.'\n    with cd(env.directory):    \n        sudo('git pull', user=env.deploy_user)\n\ndef pip_install_req():\n    virtualenv('pip install -U -r ../../../requirements/external_apps.txt') \n\ndef reload():\n    sudo('/etc/init.d/apache2 reload')\n\ndef deploy_pip():\n    local('git push')\n    git_pull()\n    pip_install_req()\n    reload()\n</code>\n</pre>\n", "senID": 6}]