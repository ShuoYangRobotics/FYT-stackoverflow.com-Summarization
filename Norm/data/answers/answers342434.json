[[{"text": ["Allow me to answer my own question.", "The underlying problem here is that settings.py gets imported twice, or maybe even more (See here).", "(I still don't understand why this is.", "Maybe some Django expert could explain that to me.", ")  This seems to be true of some other modules as well.", "At this point I don't think it's wise to make assumptions about how many times settings.py will be imported.", "For that matter, such assumptions aren't safe in general.", "I've had this code in places other than settings.py, and the results are similar."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "here", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://www.mail-archive.com/django-users@googlegroups.com/msg39059.html"}]}, {"text": ["You have to code around this.", "That is, you have to check your logger for existing handlers before adding additional handlers to it.", "This is a bit ugly because it's perfectly reasonable to have multiple handlers -- even of the same type -- attached to one logger.", "There are a few solutions to dealing with this.", "One is check the handlers property of your logger object.", "If you only want one handler and your length > 0, then don't add it.", "Personally I don't love this solution, because it gets messy with more handlers."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["I prefer something like this (thanks to Thomas Guettler):"], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"code": "<pre>\n<code>\n # file logconfig.py\nif not hasattr(logging, \"set_up_done\"):\n    logging.set_up_done=False\n\ndef set_up(myhome):\n    if logging.set_up_done:\n        return\n    # set up your logging here\n    # ...\n    logging.set_up_done=True\n</code>\n</pre>\n", "senID": 3}, {"text": ["I must say, I wish the fact that Django imports settings.py multiple times were better documented.", "And I would imagine that my configuration is somehow cause this multiple import, but I'm having trouble finding out what is causing the problem and why.", "Maybe I just couldn't find that in their documents, but I would think that's the sort of thing you need to warn your users about."], "childNum": 0, "tag": "p", "senID": 4, "childList": []}], [{"text": ["As of version 1.3, Django uses standard python logging, configured with the LOGGING setting (documented here: 1.3, dev)."], "childNum": 3, "tag": "p", "senID": 0, "childList": [{"text": "LOGGING", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"href": "http://docs.djangoproject.com/en/1.3/ref/settings/#std%3asetting-LOGGING", "text": "1.3", "childNum": 0, "tag": "a", "childList": []}, {"href": "http://docs.djangoproject.com/en/dev/ref/settings/#std%3asetting-LOGGING", "text": "dev", "childNum": 0, "tag": "a", "childList": []}]}, {"text": ["Django logging reference: 1.3, dev."], "childNum": 2, "tag": "p", "senID": 1, "childList": [{"text": "1.3", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://docs.djangoproject.com/en/1.3/topics/logging/"}, {"href": "http://docs.djangoproject.com/en/dev/topics/logging/", "text": "dev", "childNum": 0, "tag": "a", "childList": []}]}], [{"text": ["Difficult to comment on your specific case.", "If settings.py is executed twice, then it's normal that you get two lines for every log sent."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["The way we set it up in our projects is to have one module dedicated to logging.", "That modules has a \"module singleton\" pattern, so that we only execute the interesting code once."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["It looks like this:"], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"code": "<pre>\n<code>\n def init_logging():\n    stdoutHandler = logging.StreamHandler( sys.stdout )\n    stdoutHandler.setLevel( DEBUG )\n    stdoutHandler.setFormatter( logging.Formatter( LOG_FORMAT_WITH_TIME ) )\n    logging.getLogger( LOG_AREA1 ).addHandler( stdoutHandler )\n\nlogInitDone=False\nif not logInitDone:\n    logInitDone = True\n   init_logging()\n</code>\n</pre>\n", "senID": 3}, {"text": ["Importing the log.py the first time will configure the logging correctly."], "childNum": 0, "tag": "p", "senID": 4, "childList": []}], [{"text": ["``To answer the question about why does \"Django imports settings.py multiple times\": it does not.", "''"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["Actually, it does get imported twice (skip past the first code chunk to get right into it but a good read if you've got the time):"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["http://blog.dscpl.com.au/2010/03/improved-wsgi-script-for-use-with.html"], "childNum": 1, "tag": "p", "senID": 2, "childList": [{"text": "http://blog.dscpl.com.au/2010/03/improved-wsgi-script-for-use-with.html", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://blog.dscpl.com.au/2010/03/improved-wsgi-script-for-use-with.html"}]}, {"text": ["PS-- Sorry to revive an old thread."], "childNum": 0, "tag": "p", "senID": 3, "childList": []}], [{"text": ["You could get around your problem by checking for the number of handlers when you are doing your init."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n def init_logging():\n    stdoutHandler = logging.StreamHandler( sys.stdout )\n    stdoutHandler.setLevel( DEBUG )\n    stdoutHandler.setFormatter( logging.Formatter( LOG_FORMAT_WITH_TIME ) )\n    logger = logging.getLogger( LOG_AREA1 )\n    if len(logger.handlers) &lt; 1:\n        logger.addHandler( stdoutHandler )\n</code>\n</pre>\n", "senID": 1}, {"text": ["I don't think this is a great way to handle it.", "Personally, for logging in django with the python logging module, I create a logger in views.py for each application I'm interested in, then grab the logger in each view function."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"code": "<pre>\n<code>\n from django.http import HttpResponse\nfrom magic import makeLogger\nfrom magic import getLogger\n\nmakeLogger('myLogName', '/path/to/myLogName.log')\ndef testLogger(request):\n    logger = getLogger('myLogName')\n    logger.debug('this worked')\n    return HttpResponse('TEXT, HTML or WHATEVER')\n</code>\n</pre>\n", "senID": 3}, {"text": ["This is a pretty good article about debugging django and covers some logging:\nhttp://simonwillison.net/2008/May/22/debugging/"], "childNum": 1, "tag": "p", "senID": 4, "childList": [{"text": "http://simonwillison.net/2008/May/22/debugging/", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://simonwillison.net/2008/May/22/debugging/"}]}], [{"text": ["To answer the question about why does \"Django imports settings.py multiple times\": it does not. "], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["You are probably running a multiprocess/multithread web server which creates several python sub-interpreters, where each of those imports the code from your django app once."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["Test that on the django test server and you should see that settings are not imported many times."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"text": ["Some time ago, I had designed a nice singleton (python borg idiom version to be more precise) with my first django/apache app, before I quickly realised that yes, I had more than one instances of my singleton created..."], "childNum": 0, "tag": "p", "senID": 3, "childList": []}], [{"text": ["You can also use a run-once Middleware to get a similar effect, without the private variables.", "Note that this will only configure the logging for web-requests - you'll need to find a different solution if you want logging in your shell or command runs."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n from django.conf import settings\nfrom django.core.exceptions import MiddlewareNotUsed\nimport logging\nimport logging.handlers\nimport logging.config\n\n__all__ = ('LoggingConfigMiddleware',)\n\n\nclass LoggingConfigMiddleware:\n    def __init__(self):\n        '''Initialise the logging setup from settings, called on first request.'''\n        if hasattr(settings, 'LOGGING'):\n            logging.config.dictConfig(settings.LOGGING)\n        elif getattr(settings, 'DEBUG', False):\n            print 'No logging configured.'\n        raise MiddlewareNotUsed('Logging setup only.')\n</code>\n</pre>\n", "senID": 1}], [{"text": ["Why using python logger instead of django-logging?", "Give it a try it might just solve your problem. "], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["http://code.google.com/p/django-logging/wiki/Overview "], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "http://code.google.com/p/django-logging/wiki/Overview", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://code.google.com/p/django-logging/wiki/Overview"}]}, {"text": ["At the moment it would only allow to view the root logger, but you can sure write to multiple loggers."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}], [{"text": ["Reviving an old thread, but I was experiencing duplicate messages while using Django 1.3 Python logging with the dictConfig format.  "], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "dictConfig format", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://docs.python.org/library/logging.config.html#configuration-dictionary-schema"}]}, {"text": ["The disable_existing_loggers gets rid of the duplicate handler/logging problem with multiple settings.py loads, but you can still get duplicate log messages if you don't specify the propagate boolean appropriately on the specific logger.", "Namely, make sure you set propagate=False for child loggers.", "E.g.,"], "childNum": 4, "tag": "p", "senID": 1, "childList": [{"text": "disable_existing_loggers", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "propagate", "childNum": 0, "tag": "code", "pos": 1, "childList": []}, {"text": "logger", "childNum": 0, "tag": "code", "pos": -1, "childList": []}, {"text": "propagate=False", "childNum": 0, "tag": "code", "pos": -1, "childList": []}]}, {"code": "<pre>\n<code>\n 'loggers': {\n    'django': {\n        'handlers':['null'],\n        'propagate': True,\n        'level':'INFO',\n    },\n    'django.request': {\n        'handlers': ['console'],\n        'level': 'ERROR',\n        'propagate': False,\n    },\n    'project': {\n        'handlers': ['console', 'project-log-file'],\n        'level': 'DEBUG',\n        'propagate': True,\n    },\n    'project.customapp': {\n        'handlers': ['console', 'customapp-log-file'],\n        'level': 'DEBUG',\n        'propagate': False,\n    },\n}\n</code>\n</pre>\n", "senID": 2}, {"text": ["Here, project.customapp sets propagate=False so that it won't be caught by the project logger as well.", "The Django logging docs are excellent, as always."], "childNum": 4, "tag": "p", "senID": 3, "childList": [{"text": "project.customapp", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "propagate=False", "childNum": 0, "tag": "code", "pos": -1, "childList": []}, {"text": "project", "childNum": 0, "tag": "code", "pos": -1, "childList": []}, {"text": "Django logging docs", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://docs.djangoproject.com/en/dev/topics/logging/"}]}], [{"text": ["A hackish way, but you can try to put the logging code inside an admin.py.", "It is supposed to be imported only once."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["Alternatively; can you first check if MyApp.views.scans log exists?", "If it exists (maybe an error is raised) you can simply skip creation (and therefore not add the handler again).", "A cleaner way but I haven't tried this though."], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "MyApp.views.scans", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"text": ["Also there must be a more appropriate place to put this code (__init__.py?).", "settings.py is for settings."], "childNum": 2, "tag": "p", "senID": 2, "childList": [{"text": "__init__.py", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "settings.py", "childNum": 0, "tag": "code", "pos": 1, "childList": []}]}], [{"text": ["To add to A Lee post, python logging documentation states this about propagate:"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "A Lee", "childNum": 0, "tag": "strong", "pos": 0, "childList": []}]}, {"text": ["This means that if propagate == False then child logger will NOT pass logging message to its parent logger"], "childNum": 3, "tag": "p", "senID": 1, "childList": [{"text": "propagate == False", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "child logger", "childNum": 0, "tag": "strong", "childList": []}, {"text": "parent logger", "childNum": 0, "tag": "strong", "childList": []}]}]]