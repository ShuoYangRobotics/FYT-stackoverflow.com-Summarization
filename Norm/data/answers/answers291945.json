[[{"text": ["ForeignKey is represented by django.forms.ModelChoiceField, which is a ChoiceField whose choices are a model QuerySet.", "See the reference for ModelChoiceField."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "ModelChoiceField", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://docs.djangoproject.com/en/dev/ref/forms/fields/#modelchoicefield"}]}, {"text": ["So, provide a QuerySet to the field's queryset attribute.", "Depends on how your form is built.", "If you build an explicit form, you'll have fields named directly. "], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "queryset", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n form.rate.queryset = Rate.objects.filter(company_id=the_company.id)\n</code>\n</pre>\n", "senID": 2}, {"text": ["If you take the default ModelForm object, form.fields[\"rate\"].queryset = ..."], "childNum": 1, "tag": "p", "senID": 3, "childList": [{"text": "form.fields[\"rate\"].queryset = ...", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"text": ["This is done explicitly in the view.", "No hacking around."], "childNum": 0, "tag": "p", "senID": 4, "childList": []}], [{"text": ["In addition to S.Lott's answer and as becomingGuru mentioned in comments, its possible to add the queryset filters by overriding the ModelForm.__init__ function.", "(This could easily apply to regular forms) it can help with reuse and keeps the view function tidy. "], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "ModelForm.__init__", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n class ClientForm(forms.ModelForm):\n    def __init__(self,company,*args,**kwargs):\n        super (ClientForm,self ).__init__(*args,**kwargs) # populates the post\n        self.fields['rate'].queryset = Rate.objects.filter(company=company)\n        self.fields['client'].queryset = Client.objects.filter(company=company)\n\n    class Meta:\n        model = Client\n\ndef addclient(request, company_id):\n        the_company = get_object_or_404(Company, id=company_id)\n\n        if request.POST:\n            form = ClientForm(the_company,request.POST)  #&lt;-- Note the extra arg\n            if form.is_valid():\n                form.save()\n                return HttpResponseRedirect(the_company.get_clients_url())\n        else:\n            form = ClientForm(the_company)\n\n        return render_to_response('addclient.html', \n                                  {'form': form, 'the_company':the_company})\n</code>\n</pre>\n", "senID": 1}, {"text": ["This can be useful for reuse say if you have common filters needed on many models (normally I declare an abstract Form class).", "E.g."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"code": "<pre>\n<code>\n class UberClientForm(ClientForm):\n    class Meta:\n        model = UberClient\n\ndef view(request):\n    ...\n    form = UberClientForm(company)\n    ...\n\n#or even extend the existing custom init\nclass PITAClient(ClientForm):\n    def __init__(company, *args, **args):\n        super (PITAClient,self ).__init__(company,*args,**kwargs)\n        self.fields['support_staff'].queryset = User.objects.exclude(user='michael')\n</code>\n</pre>\n", "senID": 3}, {"text": ["Other than that I'm just restating Django blog material of which there are many good ones out there. "], "childNum": 0, "tag": "p", "senID": 4, "childList": []}], [{"text": ["So, I've really tried to understand this, but it seems that Django still doesn't make this very straightforward.", "I'm not all that dumb, but I just can't see any (somewhat) simple solution."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["I find it generally pretty ugly to have to override the Admin views for this sort of thing, and every example I find never fully applies to the Admin views."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["This is such a common circumstance with the models I make that I find it appalling that there's no obvious solution to this..."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"text": ["I've got these classes:"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"code": "<pre>\n<code>\n # models.py\nclass Company(models.Model):\n    # ...\nclass Contract(models.Model):\n    company = models.ForeignKey(Company)\n    locations = models.ManyToManyField('Location')\nclass Location(models.Model):\n    company = models.ForeignKey(Company)\n</code>\n</pre>\n", "senID": 4}, {"text": ["This creates a problem when setting up the Admin for Company, because it has inlines for both Contract and Location, and Contract's m2m options for Location are not properly filtered according to the Company that you're currently editing."], "childNum": 0, "tag": "p", "senID": 5, "childList": []}, {"text": ["In short, I would need some admin option to do something like this:"], "childNum": 0, "tag": "p", "senID": 6, "childList": []}, {"code": "<pre>\n<code>\n # admin.py\nclass LocationInline(admin.TabularInline):\n    model = Location\nclass ContractInline(admin.TabularInline):\n    model = Contract\nclass CompanyAdmin(admin.ModelAdmin):\n    inlines = (ContractInline, LocationInline)\n    inline_filter = dict(Location__company='self')\n</code>\n</pre>\n", "senID": 7}, {"text": ["Ultimately I wouldn't care if the filtering process was placed on the base CompanyAdmin, or if it was placed on the ContractInline.", "(Placing it on the inline makes more sense, but it makes it hard to reference the base Contract as 'self'."], "childNum": 0, "tag": "p", "senID": 8, "childList": []}, {"text": ["Is there anyone out there who knows of something as straightforward as this badly needed shortcut?", "Back when I made PHP admins for this sort of thing, this was considered basic functionality!", "In fact, it was always automatic, and had to be disabled if you really didn't want it!"], "childNum": 0, "tag": "p", "senID": 9, "childList": []}], [{"text": ["If you haven't created the form and want to change the queryset you can do:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["formmodel.base_fields['myfield'].queryset = MyModel.objects.filter(...)"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["This is pretty useful when you are using generic views!"], "childNum": 0, "tag": "p", "senID": 2, "childList": []}]]