<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-4970426</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">HTML</span> <span style="background-color:yellow;">Truncating</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> </h2><p><span style="background-color:yellow;">Is</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">pure-Python</span> <span style="background-color:yellow;">tool</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">take</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">HTML</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">truncate</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">close</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">given</span> <span style="background-color:yellow;">length</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">possible</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">sure</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">resulting</span> <span style="background-color:yellow;">snippet</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">well-formed</span> ? <span style="background-color:yellow;">For</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">given</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">HTML</span> <span style="background-color:yellow;">:</span> </p>
<pre><code><h1>This is a header</h1>
<p>This is a paragraph</p>
</code></pre>
<p><span style="background-color:yellow;">it</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">produce</span> <span style="background-color:yellow;">:</span> </p>
<pre><code><h1>This is a hea
</code></pre>
<p><span style="background-color:yellow;">but</span> <span style="background-color:yellow;">:</span> </p>
<pre><code><h1>This is a header</h1>
</code></pre>
<p><span style="background-color:yellow;">or</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">least</span> <span style="background-color:yellow;">:</span> </p>
<pre><code><h1>This is a hea</h1>
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">ca</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">relies</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">pullparser</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">both</span> <span style="background-color:yellow;">obsolete</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">dead</span> . </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-8</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">DJANGO</span> <span style="background-color:yellow;">lib</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">simply</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>from django.utils import text, html

    class class_name():


        def trim_string(self, stringf, limit, offset = 0):
            return stringf[offset:limit]

        def trim_html_words(self, html, limit, offset = 0):
            return text.truncate_html_words(html, limit)


        def remove_html(self, htmls, tag, limit = 'all', offset = 0):
            return html.strip_tags(htmls)
</code></pre>
<p><span style="background-color:yellow;">Anyways</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">truncate_html_words</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">django</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import re

def truncate_html_words(s, num):
    """
    Truncates html to a certain number of words (not counting tags and comments).
    Closes opened tags if they were correctly closed in the given html.
    """
    length = int(num)
    if length <= 0:
        return ''
    html4_singlets = ('br', 'col', 'link', 'base', 'img', 'param', 'area', 'hr', 'input')
    # Set up regular expressions
    re_words = re.compile(r'&.*?;|<.*?>|([A-Za-z0-9][\w-]*)')
    re_tag = re.compile(r'<(/)?([^ ]+?)(?: (/)| .*?)?>')
    # Count non-HTML words and keep note of open tags
    pos = 0
    ellipsis_pos = 0
    words = 0
    open_tags = []
    while words <= length:
        m = re_words.search(s, pos)
        if not m:
            # Checked through whole string
            break
        pos = m.end(0)
        if m.group(1):
            # It's an actual non-HTML word
            words += 1
            if words == length:
                ellipsis_pos = pos
            continue
        # Check for tag
        tag = re_tag.match(m.group(0))
        if not tag or ellipsis_pos:
            # Don't worry about non tags or tags after our truncate point
            continue
        closing_tag, tagname, self_closing = tag.groups()
        tagname = tagname.lower()  # Element names are always case-insensitive
        if self_closing or tagname in html4_singlets:
            pass
        elif closing_tag:
            # Check for match in open tags list
            try:
                i = open_tags.index(tagname)
            except ValueError:
                pass
            else:
                # SGML: An end tag closes, back to the matching start tag, all unclosed intervening start tags with omitted end tags
                open_tags = open_tags[i+1:]
        else:
            # Add it to the start of the open tags list
            open_tags.insert(0, tagname)
    if words <= length:
        # Don't try to close tags if we don't need to truncate
        return s
    out = s[:ellipsis_pos] + ' ...'
    # Close any tags still open
    for tag in open_tags:
        out += '</%s>' % tag
    # Return string
    return out
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">serve</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">requirement.An</span> <span style="background-color:yellow;">easy</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">HTML</span> <span style="background-color:yellow;">parser</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">bad</span> <span style="background-color:yellow;">markup</span> <span style="background-color:yellow;">corrector</span> </p>
<p><span style="background-color:yellow;">http</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">//www.crummy.com/software/BeautifulSoup/</span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">full-fledged</span> <span style="background-color:yellow;">parser</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">tokenize</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">input</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">:</span> </p>
<ul><span style="background-color:yellow;">text</span> <span style="background-color:yellow;">open</span> <span style="background-color:yellow;">tag</span> <span style="background-color:yellow;">close</span> <span style="background-color:yellow;">tag</span> <span style="background-color:yellow;">self-closing</span> <span style="background-color:yellow;">tag</span> <span style="background-color:yellow;">character</span> <span style="background-color:yellow;">entity</span> </ul>
<p><span style="background-color:yellow;">Once</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">stream</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">tokens</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">easy</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">stack</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">keep</span> <span style="background-color:yellow;">track</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">tags</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">closing.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">actually</span> <span style="background-color:yellow;">ran</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">problem</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">ago</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">wrote</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">small</span> <span style="background-color:yellow;">library</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<p><span style="background-color:yellow;">https</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">//github.com/eentzel/htmltruncate.py</span> </p>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">worked</span> <span style="background-color:yellow;">well</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">handles</span> <span style="background-color:yellow;">most</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">corner</span> <span style="background-color:yellow;">cases</span> <span style="background-color:yellow;">well</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">including</span> <span style="background-color:yellow;">arbitrarily</span> <span style="background-color:yellow;">nested</span> <span style="background-color:yellow;">markup</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">counting</span> <span style="background-color:yellow;">character</span> <span style="background-color:yellow;">entities</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">character</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">returning</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">error</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">malformed</span> <span style="background-color:yellow;">markup</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">etc</span> . </p>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">produce</span> <span style="background-color:yellow;">:</span> </p>
<pre><code><h1>This is a hea</h1>
</code></pre>
<p><span style="background-color:yellow;">on</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">example.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">perhaps</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">changed</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">hard</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">general</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">trying</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">truncate</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">10</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">h1&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">tag</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">closed</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">another</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">say</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">300</span> <span style="background-color:yellow;">characters</span> ? </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">slacy</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">helpful</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">upvote</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">had</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">reputation</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">however</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">extra</span> <span style="background-color:yellow;">thing</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">note.</span> <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">environment</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">had</span> <span style="background-color:yellow;">html5lib</span> <span style="background-color:yellow;">installed</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">well</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">BeautifulSoup4.</span> <span style="background-color:yellow;">BeautifulSoup</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">html5lib</span> <span style="background-color:yellow;">parser</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">resulted</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">html</span> <span style="background-color:yellow;">snippet</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">wrapped</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">html</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">body</span> <span style="background-color:yellow;">tags</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wanted</span> . </p>
<pre><code>>>> truncate_html("<p>sdfsdaf</p>", 4)
u'<html><head></head><body><p>s</p></body></html>'
</code></pre>
<p><span style="background-color:yellow;">To</span> <span style="background-color:yellow;">resolve</span> <span style="background-color:yellow;">these</span> <span style="background-color:yellow;">issues</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">told</span> <span style="background-color:yellow;">BeautifulSoup</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">parser</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>from bs4 import BeautifulSoup
def truncate_html(html, length): 
    return unicode(BeautifulSoup(html[:length], "html.parser"))

>>> truncate_html("<p>sdfsdaf</p>", 4)
u'<p>s</p>'
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">My</span> <span style="background-color:yellow;">initial</span> <span style="background-color:yellow;">thought</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">parser</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">maybe</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">sax</span> <span style="background-color:yellow;">parser</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">probably</span> <span style="background-color:yellow;">count</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">xml</span> <span style="background-color:yellow;">element.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">ignore</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tags</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">count</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">consistent</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">well</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">simpler</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">either</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">possible</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'d</span> <span style="background-color:yellow;">recommend</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">completely</span> <span style="background-color:yellow;">parsing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">HTML</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">truncate.</span> <span style="background-color:yellow;">A</span> <span style="background-color:yellow;">great</span> <span style="background-color:yellow;">HTML</span> <span style="background-color:yellow;">parser</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">lxml</span> . <span style="background-color:yellow;">After</span> <span style="background-color:yellow;">parsing</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">truncating</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">print</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">back</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">HTML</span> <span style="background-color:yellow;">format</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">Look</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">HTML</span> <span style="background-color:yellow;">Tidy</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">cleanup/reformat/reindent</span> <span style="background-color:yellow;">HTML</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">7</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">BeautifulSoup</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">assuming</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">truncate</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">certain</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">source</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">content</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<pre><code>from BeautifulSoup import BeautifulSoup

def truncate_html(html, length): 
    return unicode(BeautifulSoup(html[:length]))
</code></pre>
<br />