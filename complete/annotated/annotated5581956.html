<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-5581956</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Regular</span> <span style="background-color:yellow;">Expression</span> <span style="background-color:yellow;">help</span> </h2><p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>A!
B!
C!
<tag>
D!
E!
</tag>
F!
<tag>
G!
</tag>
</code></pre>
<p><span style="background-color:yellow;">Is</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">possible</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">parse</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">output</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<pre><code>[A, B, C, [D, E], F, [G]]
</code></pre>
<p><span style="background-color:yellow;">Basically</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">looking</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">split</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">!</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tag</span> <span style="background-color:yellow;">...and</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tag</span> <span style="background-color:yellow;">part</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">happen</span> <span style="background-color:yellow;">anywhere...and</span> <span style="background-color:yellow;">multiple</span> <span style="background-color:yellow;">times</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">recursively...meaning</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">tag</span> <span style="background-color:yellow;">within</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">tag...this</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">happen</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">whole</span> <span style="background-color:yellow;">thing</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">regular...is</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">possible</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">regex</span> ? </p>
<p><span style="background-color:yellow;">EDIT</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">Python</span> </p>
<p><span style="background-color:yellow;">EDIT2</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">A</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">B</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">C...</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">representation...those</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">made</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">letters</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">numbers</span> </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-6</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">three</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">regex-replaces</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">possibly</span> <span style="background-color:yellow;">doable</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">fine</span> <span style="background-color:yellow;"></span> . </p>
<p><span style="background-color:yellow;">Javascript</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>str = '[' + str.replace(/!\n/, ', ').replace(/<[^\/>]*>/, '[').replace(/<\/[^>]*>/, ']') + ']';
</code></pre>
<p><span style="background-color:yellow;">Hopefully</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">understandable</span> <span style="background-color:yellow;">enough</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">translate</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">Python</span> . </p>
<p><span style="background-color:yellow;">Edit</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">Are</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">looking</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">output</span> ? <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">thought</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">sample</span> <span style="background-color:yellow;">output</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">literal</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">now</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">meant</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">represent</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">nested</span> <span style="background-color:yellow;">array</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">Would</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">easier</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">replace</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">tag&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">/tag&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">!</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">end</span> <span style="background-color:yellow;">embrace</span> <span style="background-color:yellow;">everything</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">pair</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">]</span> ? </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">Yes</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">possible</span> . </p>
<p><span style="background-color:yellow;">To</span> <span style="background-color:yellow;">generate</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">flat</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">quite</span> <span style="background-color:yellow;">hairy</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">involving</span> <span style="background-color:yellow;">backtracking.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">similar</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">splitting</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">CSV</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">allowing</span> <span style="background-color:yellow;">quoted</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">where</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">tag&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">/</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">/tag&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">markers</span> <span style="background-color:yellow;">take</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">place</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">quote</span> <span style="background-color:yellow;">marks</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">!</span> <span style="background-color:yellow;">takes</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">place</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">comma</span> . </p>
<p><span style="background-color:yellow;">But</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">asked</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">nested</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">structure</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">fact</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">makes</span> <span style="background-color:yellow;">things</span> <span style="background-color:yellow;">easier</span> . </p>
<p><span style="background-color:yellow;">In</span> <span style="background-color:yellow;">order</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">nested</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">structure</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">going</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">separate</span> <span style="background-color:yellow;">split</span> <span style="background-color:yellow;">operations</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">means</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">separate</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">operations.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">described</span> <span style="background-color:yellow;">above</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">fact</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">having</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">separate</span> <span style="background-color:yellow;">operations</span> <span style="background-color:yellow;">actually</span> <span style="background-color:yellow;">makes</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">easier</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">split</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">sections</span> <span style="background-color:yellow;">embedded</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">tag&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">s</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">pass</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">say</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">nested</span> <span style="background-color:yellow;">tags</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">means</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">complex</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">back-tracking</span> . </p>
<p><span style="background-color:yellow;">Hope</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">helps</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><pre><code>from collections import deque
from types import StringTypes

s = "A!\nB!\nC!\n<tag>\nD!\nE!\n</tag>\nF!\n<tag>\nG!\n</tag>"

def parse(parts):
    if type(parts) in StringTypes:
        parts = deque(parts.split("\n"))
    ret = []
    while parts:
        part = parts.popleft()
        if part[-1] == "!":
            ret.append(part[:-1])
        elif part == "<tag>":
            ret.append(parse(parts))
        elif part == "</tag>":
            return ret
    return ret

print parse(s)
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">deque</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">pop</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">0</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">slow</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">reversing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">pop</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">harder</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">understand</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">dare</span> <span style="background-color:yellow;">anyone</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">create</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">regexp</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">improving</span> <span style="background-color:yellow;">clarity</span> <span style="background-color:yellow;">!</span> </p>
<p><span style="background-color:yellow;"></span> <span style="background-color:yellow;">BTW</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">pyparsing</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">solve</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">problem</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">supports</span> <span style="background-color:yellow;">recursion.</span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">EDIT</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">Changed</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">expect</span> <span style="background-color:yellow;">either</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">deque</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">argument</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">simplifying</span> <span style="background-color:yellow;">invocation</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">problem.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">uses</span> <span style="background-color:yellow;">regexp</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">operations</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> . </p>
<pre><code>import re
my_str = "A!\nB!\n<tag>\nC!\n</tag>\nD!\nE!\n<tag>\nF!\nG!\n</tag>\nH!\n"

x = re.findall("^(?:.|\n)+?(?=\n<tag>)",str) + re.findall("(?<=</tag>\n)(?:.|\n)+?(?=\n<tag>\n)",str) + re.findall("(?<=>\n)(?:[^>]|\n)+(?=\n)$",my_str)


y =[]
for elem in x:
    y += elem.split('\n')
x = re.findall("((?<=<tag>\n)(?:.|\n)+?(?=\n</tag>\n))",my_str)
for elem in x:
    y.append(elem.split('\n'))   

print y 
</code></pre>
<p><span style="background-color:yellow;">it</span> <span style="background-color:yellow;">produces</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">output</span> </p>
<pre><code>['A!', 'B!', 'D!', 'E!', 'H!', ['C!'], ['F!', 'G!']]
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">did</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">though</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">easier</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">recursive</span> <span style="background-color:yellow;">regexp</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">SO</span> <span style="background-color:yellow;">thread</span> . </p>
<p><span style="background-color:yellow;">Have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">good</span> <span style="background-color:yellow;">night</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">time-zone</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">;</span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">Note</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">probably</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">been</span> <span style="background-color:yellow;">made</span> <span style="background-color:yellow;">nicer</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">including</span> <span style="background-color:yellow;">everything</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">regexp</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">xor</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">XOR</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Regexp</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">loose</span> <span style="background-color:yellow;">readability</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">conditions</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">understood</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">verified</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">exemple</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">character</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">before</span> <span style="background-color:yellow;">'&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">tag&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">before</span> <span style="background-color:yellow;">'&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">/tag&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">right</span> ? <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">job</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import re

RE = ('(\A\n*<tag>\n+)',
      '(\A\n*)',
      '(!\n*</tag>(?!\n*\Z)\n*)',
      '(!\n*</tag>\n*\Z)',
      '(!\n*<tag>\n+)',
      '(!\n*\Z)',
      '(!\n+)')

pat = re.compile('|'.join(RE))

def repl(mat, d = {1:"[['", 2:"['", 3:"'],'", 4:"']]", 5:"',['", 6:"']", 7:"','"}):
    return d[mat.lastindex]

ch =  .... # a string to parse
dh = eval(pat.sub(repl,ch))
</code></pre>
<p><span style="background-color:yellow;">applying</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>ch1 = '''

A!
B!
C!
<tag>
D!


E!
</tag>
F!
<tag>
G!
</tag>


'''

ch2 = '''A!
B!
C!



<tag>
D!
E!
</tag>
F!
<tag>
G!
</tag>

H!

'''

ch3 = '''


A!
B!
C!
<tag>
D!
E!
</tag>
Fududu!gutuyu!!
<tag>
G!

</tag>

H!'''

ch4 = '''<tag>
A!
B!

</tag>
C!
<tag>
D!
E!
</tag>
F!
<tag>
G!

</tag>

H!'''

import re

RE = ('(\A\n*<tag>\n+)',
      '(\A\n*)',
      '(!\n*</tag>(?!\n*\Z)\n*)',
      '(!\n*</tag>\n*\Z)',
      '(!\n*<tag>\n+)',
      '(!\n*\Z)',
      '(!\n+)')

pat = re.compile('|'.join(RE))

def repl(mat, d = {1:"[['", 2:"['", 3:"'],'", 4:"']]", 5:"',['", 6:"']", 7:"','"}):
    return d[mat.lastindex]


for ch in (ch1,ch2,ch3,ch4):
    print ch
    dh = eval(pat.sub(repl,ch))
    print dh,'\n',type(dh)
    print '\n\n============================='
</code></pre>
<p><span style="background-color:yellow;">result</span> </p>
<pre><code>>>> 


A!
B!
C!
<tag>
D!


E!
</tag>
F!
<tag>
G!
</tag>



['A', 'B', 'C', ['D', 'E'], 'F', ['G']] 
<type 'list'>


=============================
A!
B!
C!



<tag>
D!
E!
</tag>
F!
<tag>
G!
</tag>

H!


['A', 'B', 'C', ['D', 'E'], 'F', ['G'], 'H'] 
<type 'list'>


=============================



A!
B!
C!
<tag>
D!
E!
</tag>
Fududu!gutuyu!!
<tag>
G!

</tag>

H!
['A', 'B', 'C', ['D', 'E'], 'Fududu!gutuyu!', ['G'], 'H'] 
<type 'list'>


=============================
<tag>
A!
B!

</tag>
C!
<tag>
D!
E!
</tag>
F!
<tag>
G!

</tag>

H!
[['A', 'B'], 'C', ['D', 'E'], 'F', ['G'], 'H'] 
<type 'list'>


=============================
>>> 
</code></pre>
<br />