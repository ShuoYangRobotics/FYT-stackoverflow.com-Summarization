<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-327223</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Memory</span> <span style="background-color:yellow;">Efficient</span> <span style="background-color:yellow;">Alternatives</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">Dictionaries</span> </h2><p><span style="background-color:yellow;">In</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">current</span> <span style="background-color:yellow;">side</span> <span style="background-color:yellow;">projects</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">scanning</span> <span style="background-color:yellow;">through</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">looking</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">frequency</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">word</span> <span style="background-color:yellow;">triplets.</span> <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">go</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">default</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">three</span> <span style="background-color:yellow;">levels</span> <span style="background-color:yellow;">deep.</span> <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">topDictionary</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">word1</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">word2</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">word3</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">returns</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">times</span> <span style="background-color:yellow;">these</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">appear</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">topdictionary</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">word1</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">word2</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">returns</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">appeared</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">etc</span> . </p>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">functions</span> <span style="background-color:yellow;">correctly</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">intensive.</span> <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">initial</span> <span style="background-color:yellow;">tests</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">20</span> <span style="background-color:yellow;">times</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">storing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">triplets</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">overly</span> <span style="background-color:yellow;">large</span> <span style="background-color:yellow;">amount</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">overhead</span> . </p>
<p><span style="background-color:yellow;">My</span> <span style="background-color:yellow;">suspicion</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">many</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">these</span> <span style="background-color:yellow;">dictionaries</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">created</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">many</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">slots</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">actually</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">replace</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">dictionaries</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">else</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">efficient</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">manner.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">strongly</span> <span style="background-color:yellow;">prefer</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">allows</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">lookups</span> <span style="background-color:yellow;">along</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">dictionaries</span> . </p>
<p><span style="background-color:yellow;">From</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">structures</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">balanced</span> <span style="background-color:yellow;">binary</span> <span style="background-color:yellow;">search</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">red-black</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">AVL</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">probably</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">ideal</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">prefer</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">implement</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">myself.</span> <span style="background-color:yellow;">If</span> <span style="background-color:yellow;">possible</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'d</span> <span style="background-color:yellow;">prefer</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">stick</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">standard</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">libraries</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">definitely</span> <span style="background-color:yellow;">open</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">alternatives</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">best</span> . </p>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">anyone</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">suggestions</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">me</span> ? </p>
<p><span style="background-color:yellow;">Edited</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">:</span> </p>
<p><span style="background-color:yellow;">Thanks</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">responses</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">far.</span> <span style="background-color:yellow;">A</span> <span style="background-color:yellow;">few</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">answers</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">suggested</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">tuples</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">did</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">condensed</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">tuple.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">hesitant</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">three</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">easy</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">look</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">third</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">given</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">two.</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ie</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">result</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">topDict</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">word1,word2</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">.keys</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> . </p>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">current</span> <span style="background-color:yellow;">dataset</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">playing</span> <span style="background-color:yellow;">around</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">most</span> <span style="background-color:yellow;">recent</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">Wikipedia</span> <span style="background-color:yellow;">For</span> <span style="background-color:yellow;">Schools</span> . <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">results</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">parsing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">thousand</span> <span style="background-color:yellow;">pages</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">11MB</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">where</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">three</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">count</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">tab</span> <span style="background-color:yellow;">separated.</span> <span style="background-color:yellow;">Storing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">now</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">takes</span> <span style="background-color:yellow;">around</span> <span style="background-color:yellow;">185MB.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">additional</span> <span style="background-color:yellow;">overhead</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">pointers</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">whatnot</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">difference</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">excessive</span> . </p>
<p><span style="background-color:yellow;">Once</span> <span style="background-color:yellow;">again</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">thank</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">responses</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">far</span> . </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-12</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">Some</span> <span style="background-color:yellow;">measurements.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">took</span> <span style="background-color:yellow;">10MB</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">free</span> <span style="background-color:yellow;">e-book</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">computed</span> <span style="background-color:yellow;">trigram</span> <span style="background-color:yellow;">frequencies</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">producing</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">24MB</span> <span style="background-color:yellow;">file.</span> <span style="background-color:yellow;">Storing</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">different</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">structures</span> <span style="background-color:yellow;">took</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">space</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">kB</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">measured</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">RSS</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">running</span> <span style="background-color:yellow;">ps</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">where</span> <span style="background-color:yellow;">d</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">freqs</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">lists</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">a,b,c,freq</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fields</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">trigram</span> <span style="background-color:yellow;">record</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>295760     S. Lott's answer
237984     S. Lott's with keys interned before passing in
203172 [*] d[(a,b,c)] = int(freq)
203156     d[a][b][c] = int(freq)
189132     keys.append((a,b,c)); freqs.append(int(freq))
146132     d[intern(a),intern(b)][intern(c)] = int(freq)
145408     d[intern(a)][intern(b)][intern(c)] = int(freq)
 83888 [*] d[a+' '+b+' '+c] = int(freq)
 82776 [*] d[(intern(a),intern(b),intern(c))] = int(freq)
 68756     keys.append((intern(a),intern(b),intern(c))); freqs.append(int(freq))
 60320     keys.append(a+' '+b+' '+c); freqs.append(int(freq))
 50556     pair array
 48320     squeezed pair array
 33024     squeezed single array
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">entries</span> <span style="background-color:yellow;">marked</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">efficient</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">look</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">pair</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">a,b</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">listed</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">others</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">suggested</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">variants</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;"></span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">sort</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">irked</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">making</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">top-voted</span> <span style="background-color:yellow;">answers</span> <span style="background-color:yellow;">were</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">helpful</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">table</span> <span style="background-color:yellow;">shows.</span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">'Pair</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">scheme</span> <span style="background-color:yellow;">below</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">original</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'d</span> <span style="background-color:yellow;">start</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">words...</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">where</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">table</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">pair</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">represented</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">string.</span> <span style="background-color:yellow;">'Squeezed</span> <span style="background-color:yellow;">pair</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">leaving</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">frequency</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">equal</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">most</span> <span style="background-color:yellow;">common</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">'Squeezed</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">squeezed</span> <span style="background-color:yellow;">pair</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">gloms</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">together</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">separator</span> <span style="background-color:yellow;">character</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">squeezed</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import collections

def build(file):
    pairs = collections.defaultdict(list)
    for line in file:  # N.B. file assumed to be already sorted
        a, b, c, freq = line.split()
        key = ' '.join((a, b))
        pairs[key].append(c + ':' + freq if freq != '1' else c)
    out = open('squeezedsinglearrayfile', 'w')
    for key in sorted(pairs.keys()):
        out.write('%s|%s\n' % (key, ' '.join(pairs[key])))

def load():
    return open('squeezedsinglearrayfile').readlines()

if __name__ == '__main__':
    build(open('freqs'))
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">written</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">look</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">structure</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">bisect</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">mentioned</span> <span style="background-color:yellow;">below</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">implemented</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fancier</span> <span style="background-color:yellow;">compressed</span> <span style="background-color:yellow;">structures</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">described</span> <span style="background-color:yellow;">below</span> . </p>
<p><span style="background-color:yellow;">Original</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">A</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">sorted</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">space-separated</span> <span style="background-color:yellow;">concatenation</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">searched</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bisect</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">worth</span> <span style="background-color:yellow;">trying</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">start.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">saves</span> <span style="background-color:yellow;">space</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">pointers</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">etc.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">still</span> <span style="background-color:yellow;">wastes</span> <span style="background-color:yellow;">space</span> <span style="background-color:yellow;">due</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">repetition</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">standard</span> <span style="background-color:yellow;">trick</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">strip</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">common</span> <span style="background-color:yellow;">prefixes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">another</span> <span style="background-color:yellow;">level</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">index</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">back</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">rather</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">complex</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">slower.</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">idea</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">store</span> <span style="background-color:yellow;">successive</span> <span style="background-color:yellow;">chunks</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">compressed</span> <span style="background-color:yellow;">form</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">must</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">scanned</span> <span style="background-color:yellow;">sequentially</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">along</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">random-access</span> <span style="background-color:yellow;">index</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">chunk.</span> <span style="background-color:yellow;">Chunks</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">big</span> <span style="background-color:yellow;">enough</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">compress</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">small</span> <span style="background-color:yellow;">enough</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">reasonable</span> <span style="background-color:yellow;">access</span> <span style="background-color:yellow;">time.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">particular</span> <span style="background-color:yellow;">compression</span> <span style="background-color:yellow;">scheme</span> <span style="background-color:yellow;">applicable</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">successive</span> <span style="background-color:yellow;">entries</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">'hello</span> <span style="background-color:yellow;">george</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">'hello</span> <span style="background-color:yellow;">world</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">second</span> <span style="background-color:yellow;">entry</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">'6world</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">instead.</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">6</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">length</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">prefix</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">common.</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Or</span> <span style="background-color:yellow;">maybe</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">away</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">zlib</span> ? <span style="background-color:yellow;">Anyway</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">vein</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">looking</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">structures</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">full-text</span> <span style="background-color:yellow;">search.</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">So</span> <span style="background-color:yellow;">specifically</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'d</span> <span style="background-color:yellow;">start</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">parallel</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">whose</span> <span style="background-color:yellow;">entries</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">possible</span> <span style="background-color:yellow;">third</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">their</span> <span style="background-color:yellow;">frequencies.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">might</span> <span style="background-color:yellow;">still</span> <span style="background-color:yellow;">suck</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">luck</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">batteries-included</span> <span style="background-color:yellow;">memory-efficient</span> <span style="background-color:yellow;">options</span> . </p>
<p><span style="background-color:yellow;">Also</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">binary</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">structures</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">recommended</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">efficiency</span> <span style="background-color:yellow;">here.</span> <span style="background-color:yellow;">E.g.</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">paper</span> <span style="background-color:yellow;">tests</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">variety</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">structures</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">similar</span> <span style="background-color:yellow;">problem</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">unigrams</span> <span style="background-color:yellow;">instead</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">trigrams</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">finds</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">hashtable</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">beat</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">structures</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">measure</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">mentioned</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">someone</span> <span style="background-color:yellow;">else</span> <span style="background-color:yellow;">did</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">sorted</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">wordlist</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">bigrams</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">trigrams</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">'real</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">structure</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">whatever</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">integer</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">instead</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">indices</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">wordlist.</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">But</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">keeps</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">exploiting</span> <span style="background-color:yellow;">common</span> <span style="background-color:yellow;">prefixes</span> <span style="background-color:yellow;">except</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">wordlist</span> <span style="background-color:yellow;">itself.</span> <span style="background-color:yellow;">Maybe</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">suggest</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">after</span> <span style="background-color:yellow;">all.</span> <span style="background-color:yellow;"></span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">Use</span> <span style="background-color:yellow;">tuples</span> . <span style="background-color:yellow;">Tuples</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">dictionaries</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">nest</span> <span style="background-color:yellow;">dictionaries</span> . </p>
<pre><code>d = {}
d[ word1, word2, word3 ] = 1
</code></pre>
<p><span style="background-color:yellow;">Also</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">plus</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">defaultdict</span> </p>
<ul><span style="background-color:yellow;">so</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">elements</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">entries</span> <span style="background-color:yellow;">always</span> <span style="background-color:yellow;">return</span> <span style="background-color:yellow;">0</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">u</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">say</span> <span style="background-color:yellow;">d</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">w1,w2,w3</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">checking</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">already</span> <span style="background-color:yellow;">exists</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">not</span> </ul>
<p><span style="background-color:yellow;">example</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>from collections import defaultdict
d = defaultdict(int)
d["first","word","tuple"] += 1
</code></pre>
<p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">word3</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">tupled</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">word1,word2</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">search</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">dictionary.keys</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">comprehension</span> </p>
<p><span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">tuple</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">t</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">items</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">slices</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>> a = (1,2,3)
>>> a[:2]
(1, 2)
</code></pre>
<p><span style="background-color:yellow;">a</span> <span style="background-color:yellow;">small</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">searching</span> <span style="background-color:yellow;">tuples</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">comprehensions</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>> b = [(1,2,3),(1,2,5),(3,4,6)]
>>> search = (1,2)
>>> [a[2] for a in b if a[:2] == search]
[3, 5]
</code></pre>
<p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">we</span> <span style="background-color:yellow;">got</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">items</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">appear</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">third</span> <span style="background-color:yellow;">item</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tuples</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">start</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">1,2</span> <span style="background-color:yellow;"></span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">A</span> <span style="background-color:yellow;">couple</span> <span style="background-color:yellow;">attempts</span> <span style="background-color:yellow;">:</span> </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">figure</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">similar</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>from __future__ import with_statement

import time
from collections import deque, defaultdict

# Just used to generate some triples of words
def triplegen(words="/usr/share/dict/words"):
    d=deque()
    with open(words) as f:
        for i in range(3):
            d.append(f.readline().strip())

        while d[-1] != '':
            yield tuple(d)
            d.popleft()
            d.append(f.readline().strip())

if __name__ == '__main__':
    class D(dict):
        def __missing__(self, key):
            self[key] = D()
            return self[key]
    h=D()
    for a, b, c in triplegen():
        h[a][b][c] = 1
    time.sleep(60)
</code></pre>
<p><span style="background-color:yellow;">That</span> <span style="background-color:yellow;">gives</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">~</span> <span style="background-color:yellow;">88MB</span> . </p>
<p><span style="background-color:yellow;">Changing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">storage</span> <span style="background-color:yellow;">to</span> </p>
<pre><code>h[a, b, c] = 1
</code></pre>
<p><span style="background-color:yellow;">takes</span> <span style="background-color:yellow;">~</span> <span style="background-color:yellow;">25MB</span> </p>
<p><span style="background-color:yellow;">interning</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">b</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">c</span> <span style="background-color:yellow;">makes</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">take</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">31MB.</span> <span style="background-color:yellow;">My</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">special</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">never</span> <span style="background-color:yellow;">repeat</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">input.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">might</span> <span style="background-color:yellow;">try</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">variations</span> <span style="background-color:yellow;">yourself</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">these</span> <span style="background-color:yellow;">helps</span> <span style="background-color:yellow;">you</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">try</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">level</span> <span style="background-color:yellow;">deep</span> . </p>
<pre><code>topDictionary[word1+delimiter+word2+delimiter+word3]
</code></pre>
<p><span style="background-color:yellow;">delimiter</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">plain</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">"</span> . <span style="background-color:yellow;"></span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">word1,word2,word3</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">easiest</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">implement</span> . <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">believe</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">little</span> <span style="background-color:yellow;">improvement</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">enough..</span> . <span style="background-color:yellow;">...i</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">something..</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">Ok</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">basically</span> <span style="background-color:yellow;">trying</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">store</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">sparse</span> <span style="background-color:yellow;">3D</span> <span style="background-color:yellow;">space.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">kind</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">access</span> <span style="background-color:yellow;">patterns</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">space</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">crucial</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">choice</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">algorithm</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">structure.</span> <span style="background-color:yellow;">Considering</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">source</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">feed</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">grid</span> ? <span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">O</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">access</span> <span style="background-color:yellow;">:</span> </p>
<p><span style="background-color:yellow;">In</span> <span style="background-color:yellow;">order</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">efficiency</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">subdivide</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">space</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">subspaces</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">similar</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">entries.</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">BTree</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">So</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">structure</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">:</span> </p>
<ul><span style="background-color:yellow;">firstWordRange</span> <span style="background-color:yellow;">secondWordRange</span> <span style="background-color:yellow;">thirdWordRange</span> <span style="background-color:yellow;">numberOfEntries</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">sorted</span> <span style="background-color:yellow;">block</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">entries</span> . <span style="background-color:yellow;">next</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">previous</span> <span style="background-color:yellow;">blocks</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;">dimensions</span> </ul>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p>In this case, <a href="http://www.zope.org/Products/StandaloneZODB" rel="nofollow">ZODB</a>ยน BTrees might be helpful, since they are much less memory-hungry. Use a BTrees.OOBtree (Object keys to Object values) or BTrees.OIBTree (Object keys to Integer values), and use 3-word tuples as your key.</p>
<p><span style="background-color:yellow;">Something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>from BTrees.OOBTree import OOBTree as BTree
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">interface</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">less</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">dict-like</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">added</span> <span style="background-color:yellow;">bonus</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">.keys</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">.items</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">.iterkeys</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">.iteritems</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">min</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">max</span> <span style="background-color:yellow;">optional</span> <span style="background-color:yellow;">arguments</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>> t=BTree()
>>> t['a', 'b', 'c']= 10
>>> t['a', 'b', 'z']= 11
>>> t['a', 'a', 'z']= 12
>>> t['a', 'd', 'z']= 13
>>> print list(t.keys(('a', 'b'), ('a', 'c')))
[('a', 'b', 'c'), ('a', 'b', 'z')]
</code></pre>
<p>ยน Note that if you are on Windows and work with Python >2.4, I know there are packages for more recent python versions, but I can't recollect where.</p>
<p>PS They exist in the <a href="http://pypi.python.org/pypi/ZODB3" rel="nofollow">CheeseShop</a> โบ</p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">Are</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">implementing</span> <span style="background-color:yellow;">Markovian</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">generation</span> ? </p>
<p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">chains</span> <span style="background-color:yellow;">map</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">probabilities</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">third</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'d</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">mapping</span> <span style="background-color:yellow;">K-tuples</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">3rd-word</span> <span style="background-color:yellow;">histogram.</span> <span style="background-color:yellow;">A</span> <span style="background-color:yellow;">trivial</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">memory-hungry</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">implement</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">histogram</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">repeats</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">random.choice</span> <span style="background-color:yellow;">gives</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">word</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">proper</span> <span style="background-color:yellow;">probability</span> . </p>
<p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">K-tuple</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">parameter</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import random

# can change these functions to use a dict-based histogram
# instead of a list with repeats
def default_histogram():          return []
def add_to_histogram(item, hist): hist.append(item)
def choose_from_histogram(hist):  return random.choice(hist)

K=2 # look 2 words back
words = ...
d = {}

# build histograms
for i in xrange(len(words)-K-1):
  key = words[i:i+K]
  word = words[i+K]

  d.setdefault(key, default_histogram())
  add_to_histogram(word, d[key])

# generate text
start = random.randrange(len(words)-K-1)
key = words[start:start+K]
for i in NUM_WORDS_TO_GENERATE:
  word = choose_from_histogram(d[key])
  print word,
  key = key[1:] + (word,)
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">7</span> </b><br /><p><span style="background-color:yellow;">Scipy</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">sparse</span> <span style="background-color:yellow;">matrices</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">tuple</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import numpy as N
from scipy import sparse

word_index = {}
count = sparse.lil_matrix((word_count*word_count, word_count), dtype=N.int)

for word1, word2, word3 in triple_list:
    w1 = word_index.setdefault(word1, len(word_index))
    w2 = word_index.setdefault(word2, len(word_index))
    w3 = word_index.setdefault(word3, len(word_index))
    w1_w2 = w1 * word_count + w2
    count[w1_w2,w3] += 1
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">8</span> </b><br /><p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">simply</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">big</span> <span style="background-color:yellow;">enough</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">pybsddb</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">help</span> <span style="background-color:yellow;">store</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">disk-persistent</span> <span style="background-color:yellow;">map</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">9</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">multidimensional</span> <span style="background-color:yellow;">array.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">rather</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">index</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">solved</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">map</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">numbers</span> . </p>
<pre><code>import numpy
w = {'word1':1, 'word2':2, 'word3':3, 'word4':4}
a = numpy.zeros( (4,4,4) )
</code></pre>
<p><span style="background-color:yellow;">Then</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">index</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'d</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>a[w[word1], w[word2], w[word3]] += 1
</code></pre>
<p><span style="background-color:yellow;">That</span> <span style="background-color:yellow;">syntax</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">beautiful</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">arrays</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">efficient</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">anything</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">likely</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">find.</span> <span style="background-color:yellow;">Note</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">tried</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">off</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">details.</span> <span style="background-color:yellow;">Just</span> <span style="background-color:yellow;">going</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">here</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">10</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">structure</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">uses</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bisect</span> <span style="background-color:yellow;">library</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">maintain</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">sorted</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">words.</span> <span style="background-color:yellow;">Each</span> <span style="background-color:yellow;">lookup</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">O</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">log2</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> . </p>
<pre><code>import bisect

class WordList( object ):
    """Leaf-level is list of words and counts."""
    def __init__( self ):
        self.words= [ ('\xff-None-',0) ]
    def count( self, wordTuple ):
        assert len(wordTuple)==1
        word= wordTuple[0]
        loc= bisect.bisect_left( self.words, word )
        if self.words[loc][0] != word:
            self.words.insert( loc, (word,0) )        
        self.words[loc]= ( word, self.words[loc][1]+1 )
    def getWords( self ):
        return self.words[:-1]

class WordTree( object ):
    """Above non-leaf nodes are words and either trees or lists."""
    def __init__( self ):
        self.words= [ ('\xff-None-',None)  ]
    def count( self, wordTuple ):
        head, tail = wordTuple[0], wordTuple[1:]
        loc= bisect.bisect_left( self.words, head )
        if self.words[loc][0] != head:
            if len(tail) == 1:
                newList= WordList()
            else:
                newList= WordTree()
            self.words.insert( loc, (head,newList) )
        self.words[loc][1].count( tail )
    def getWords( self ):
        return self.words[:-1]

t = WordTree()
for a in ( ('the','quick','brown'), ('the','quick','fox') ):
    t.count(a)

for w1,wt1 in t.getWords():
    print w1
    for w2,wt2 in wt1.getWords():
        print " ", w2
        for w3 in wt2.getWords():
            print "  ", w3
</code></pre>
<p><span style="background-color:yellow;">For</span> <span style="background-color:yellow;">simplicity</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">uses</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dummy</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">list.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">saves</span> <span style="background-color:yellow;">endless</span> <span style="background-color:yellow;">if-statements</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">determine</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">actually</span> <span style="background-color:yellow;">empty</span> <span style="background-color:yellow;">before</span> <span style="background-color:yellow;">we</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">comparison.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">empty</span> <span style="background-color:yellow;">once</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">if-statements</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">wasted</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">-1</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">words</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">11</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">put</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dictionary</span> . <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">word</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">index</span> <span style="background-color:yellow;"></span> . </p>
<p><span style="background-color:yellow;">Then</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>Word1=indexDict[word1]
Word2=indexDict[word2]
Word3=indexDict[word3]

topDictionary[Word1][Word2][Word3]
</code></pre>
<p><span style="background-color:yellow;">Insert</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">indexDict</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>if word not in indexDict:
    indexDict[word]=len(indexDict)
</code></pre>
<br />