<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-9023078</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">custom</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">allows</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">during</span> <span style="background-color:yellow;">iteration</span> </h2><p><span style="background-color:yellow;">UPDATED</span> <span style="background-color:yellow;">based</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">Lennart</span> <span style="background-color:yellow;">Regebro</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">answer</span> </p>
<p><span style="background-color:yellow;">Suppose</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">iterate</span> <span style="background-color:yellow;">through</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">sometimes</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">element.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">efficient</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>remove = []
for k, v in dict_.items():
  if condition(k, v):
    remove.append(k)
    continue
  # do other things you need to do in this loop
for k in remove:
  del dict_[k]
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">overhead</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">building</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">remove</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">unless</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">grows</span> <span style="background-color:yellow;">large</span> <span style="background-color:yellow;">compared</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">issue.</span> <span style="background-color:yellow;">However</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">approach</span> <span style="background-color:yellow;">requires</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">extra</span> <span style="background-color:yellow;">coding</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">popular</span> . </p>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">popular</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;">comprehension</span> <span style="background-color:yellow;">approach</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>dict_ = {k : v for k, v in dict_ if not condition(k, v)}
for k, v in dict_.items():
  # do other things you need to do in this loop
</code></pre>
<p><span style="background-color:yellow;">results</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">full</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">copy</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">risk</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">silly</span> <span style="background-color:yellow;">performance</span> <span style="background-color:yellow;">hit</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">dictionaries</span> <span style="background-color:yellow;">grow</span> <span style="background-color:yellow;">large</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">containing</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">called</span> <span style="background-color:yellow;">often</span> . </p>
<p><span style="background-color:yellow;">A</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">better</span> <span style="background-color:yellow;">approach</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">copy</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">rather</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">whole</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>for k in list(dict_.keys()):
  if condition(k, dict_[k]):
    del dict_[k]
    continue
  # do other things you need to do in this loop       
</code></pre>
<p><span style="background-color:yellow;"></span> <span style="background-color:yellow;">Note</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">examples</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">items</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">returns</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">view</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">copy.</span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">In</span> <span style="background-color:yellow;">most</span> <span style="background-color:yellow;">cases</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">wo</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">hurt</span> <span style="background-color:yellow;">performance</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">check</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">simplest</span> <span style="background-color:yellow;">condition</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">mention</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">stuff</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">loop</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">usually</span> <span style="background-color:yellow;">greater</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> . </p>
<p><span style="background-color:yellow;">Still</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">wondering</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">possible</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">avoid</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">custom</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">allows</span> <span style="background-color:yellow;">deletions</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">iterating</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>for k, v in dict_.items():
  if condition(k, v):
    del dict_[k]
    continue
  # do other things you need to do in this loop
</code></pre>
<p><span style="background-color:yellow;">Perhaps</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">iterator</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">always</span> <span style="background-color:yellow;">look</span> <span style="background-color:yellow;">ahead</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">__next__</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">called</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">iterator</span> <span style="background-color:yellow;">knows</span> <span style="background-color:yellow;">where</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">go</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">looking</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">current</span> <span style="background-color:yellow;">element</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">look</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">element</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">gets</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">And</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">next</span> <span style="background-color:yellow;">element</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">iterator</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">set</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">flag</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">cause</span> <span style="background-color:yellow;">StopIteration</span> <span style="background-color:yellow;">exception</span> <span style="background-color:yellow;">raised</span> <span style="background-color:yellow;">whenever</span> <span style="background-color:yellow;">__next__</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">called</span> <span style="background-color:yellow;">again</span> . </p>
<p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">element</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">iterator</span> <span style="background-color:yellow;">tries</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">advance</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">turns</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">deleted</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">fine</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">raise</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">exception</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">support</span> <span style="background-color:yellow;">deletions</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">multiple</span> <span style="background-color:yellow;">iterations</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">going</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">simultaneously</span> . </p>
<p><span style="background-color:yellow;">Are</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">problems</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">approach</span> ? </p>
<p><span style="background-color:yellow;">One</span> <span style="background-color:yellow;">problem</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">sure</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">done</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">material</span> <span style="background-color:yellow;">overhead</span> <span style="background-color:yellow;">compared</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">existing</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">otherwise</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">dict_</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">approach</span> <span style="background-color:yellow;">!</span> </p>
<p><span style="background-color:yellow;">UPDATE</span> <span style="background-color:yellow;">:</span> </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">tried</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">versions.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">report</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">timing</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">clearly</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">dependent</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">exact</span> <span style="background-color:yellow;">situation.</span> <span style="background-color:yellow;">But</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">safe</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">say</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">many</span> <span style="background-color:yellow;">cases</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">approach</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">likely</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">dict_</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">After</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">copy</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">operation</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">grows</span> <span style="background-color:yellow;">linearly</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">almost</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">overhead</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">long</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">proportional</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">likely</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">bigger</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">ideas</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">select</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">accepting</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">context</span> <span style="background-color:yellow;">manager</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">allows</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">either</span> <span style="background-color:yellow;">normal</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">enhanced</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">small</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">changes</span> . </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-7</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">As</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">note</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">store</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">items</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">somewhere</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">defer</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">deletion</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">until</span> <span style="background-color:yellow;">later.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">problem</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">becomes</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">purge</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">sure</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">purge</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">eventually</span> <span style="background-color:yellow;">gets</span> <span style="background-color:yellow;">called.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">context</span> <span style="background-color:yellow;">manager</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">subclass</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">dict</span> . </p>
<pre><code>class dd_dict(dict):    # the dd is for "deferred delete"
    _defer   = False
    _deletes = set()
    def __delitem__(self, key):
        self._deletes.add(key) if self._defer else dict.__delitem__(self, key)
    def __enter__(self):
        self._defer = True
    def __exit__(self, type, value, tb):
        self._defer = False
        for key in self._deletes:
            dict.__delitem__(self, key)
</code></pre>
<p><span style="background-color:yellow;">Usage</span> <span style="background-color:yellow;">:</span> </p>
<pre><code># make the dict and do whatever to it
ddd = dd_dict(a=1, b=2, c=3)

# now iterate over it, deferring deletes
with ddd:
    for k, v in ddd.iteritems():
        if k is "a":
            del ddd[k]

print ddd
</code></pre>
<p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">block</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">course</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">deletes</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">immediate</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;">subclass</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">regular</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;">outside</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">context</span> <span style="background-color:yellow;">manager</span> . </p>
<p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">implement</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">wrapper</span> <span style="background-color:yellow;">class</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>class deferring_delete(object):
    def __init__(self, d):
        self._dict = d
    def __enter__(self):
        self._deletes = set()
        return self
    def __exit__(self, type, value, tb):
        for key in self._deletes:
            del self._dict[key]
        self._deletes = None
    def __delitem__(self, key):
        self._deletes.add(key)

d = dict(a=1, b=2, c=3)

with deferring_delete(d) as dd:
    for k, v in d.iteritems():
        if k is "a":
            del dd[k]    # delete through wrapper

print d
</code></pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">possible</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">wrapper</span> <span style="background-color:yellow;">class</span> <span style="background-color:yellow;">fully</span> <span style="background-color:yellow;">functional</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">fair</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">code</span> . </p>
<p><span style="background-color:yellow;">Performance-wise</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">admittedly</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">such</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">win</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">programmer-friendliness</span> <span style="background-color:yellow;">standpoint</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">accomplish</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">iterating</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">static</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">key/value</span> <span style="background-color:yellow;">pairs</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">instead</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">iterating</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">view</span> . </p>
<p><span style="background-color:yellow;">Basically</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">iterating</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">dict_.items</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">instead</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">dict_.items</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>for k, v in list(dict_.items()):
  if condition(k, v):
    del dict_[k]
    continue
  # do other things you need to do in this loop
</code></pre>
<p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ideone</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<pre><code>dict_ = {0: 'a', 1: 'b', 2: 'c', 3: 'd', 4: 'e', 5: 'f', 6: 'g'}
for k, v in list(dict_.items()):
    if k % 2 == 0:
        print("Deleting  ", (k, v))
        del dict_[k]
        continue
    print("Processing", (k, v))
</code></pre>
<p><span style="background-color:yellow;">and</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">output</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>Deleting   (0, 'a')
Processing (1, 'b')
Deleting   (2, 'c')
Processing (3, 'd')
Deleting   (4, 'e')
Processing (5, 'f')
Deleting   (6, 'g')
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">What</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">modify</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">iterating</span> <span style="background-color:yellow;">over.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">three</span> <span style="background-color:yellow;">ways</span> <span style="background-color:yellow;">:</span> </p>
<ol><span style="background-color:yellow;">Make</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">copy</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">separate</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">iterate</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">that.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">safely</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">during</span> <span style="background-color:yellow;">iteration.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">easiest</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">unless</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">huge</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">start</span> <span style="background-color:yellow;">thinking</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">database</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">case.</span> <span style="background-color:yellow;">Code</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">dict_</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">condition</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">dict_</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">del</span> <span style="background-color:yellow;">dict_</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">continue</span> <span style="background-color:yellow;">#</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">things</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">loop</span> <span style="background-color:yellow;">Make</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">copy</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">iterating</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">copy</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete.</span> <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">these</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">iterating</span> <span style="background-color:yellow;">instead</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">once</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">finished</span> <span style="background-color:yellow;">iterating.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">slightly</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">complicated</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">1.</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">less</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">3.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">fast.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">example</span> . <span style="background-color:yellow;">delete_these</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">dict_</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">condition</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">dict_</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">delete_these.append</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">continue</span> <span style="background-color:yellow;">#</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">things</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">loop</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">delete_these</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">del</span> <span style="background-color:yellow;">dict_</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">avoid</span> <span style="background-color:yellow;">making</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">sort</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">new</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">suggest</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">special</span> <span style="background-color:yellow;">dictionary.</span> <span style="background-color:yellow;">But</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">requires</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">actually</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">mark</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">deleted</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">real</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">once</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">call</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">purge</span> <span style="background-color:yellow;">method.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">requires</span> <span style="background-color:yellow;">quite</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">edge-cases</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">fudge</span> <span style="background-color:yellow;">yourself</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">forgetting</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">purge</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">etc.</span> <span style="background-color:yellow;">And</span> <span style="background-color:yellow;">iterating</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">must</span> <span style="background-color:yellow;">still</span> <span style="background-color:yellow;">include</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">deleted</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">bite</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">point.</span> <span style="background-color:yellow;">So</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">recommend</span> <span style="background-color:yellow;">this.</span> <span style="background-color:yellow;">Also</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">however</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">implement</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">likely</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">once</span> <span style="background-color:yellow;">again</span> <span style="background-color:yellow;">end</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">things</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">likely</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">complicated</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">error</span> <span style="background-color:yellow;">prone</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">2.</span> <span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">implement</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">C</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">probably</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">away</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">copying</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">adding</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">flags</span> <span style="background-color:yellow;">directly</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">hash-key</span> <span style="background-color:yellow;">structure.</span> <span style="background-color:yellow;">But</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">mentioned</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">problems</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">overshadow</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">benefits</span> . </ol>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">Naive</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2.x</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">3.x</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import sys
from collections import deque


def _protect_from_delete(func):
    def wrapper(self, *args, **kwargs):
        try:
            self._iterating += 1
            for item in func(self, *args, **kwargs):
                yield item
        finally:
            self._iterating -= 1
            self._delete_pending()
    return wrapper

class DeletableDict(dict):
    def __init__(self, *args, **kwargs):
        super(DeletableDict, self).__init__(*args, **kwargs)
        self._keys_to_delete = deque()
        self._iterating = 0

    if sys.version_info[0] != 3:
        iterkeys = _protect_from_delete(dict.iterkeys)
        itervalues = _protect_from_delete(dict.itervalues)
        iteritems = _protect_from_delete(dict.iteritems)
    else:
        keys = _protect_from_delete(dict.keys)
        values = _protect_from_delete(dict.values)
        items = _protect_from_delete(dict.items)  
    __iter__ = _protect_from_delete(dict.__iter__)

    def __delitem__(self, key):
        if not self._iterating:
            return super(DeletableDict, self).__delitem__(key)
        self._keys_to_delete.append(key)

    def _delete_pending(self):
        for key in self._keys_to_delete:
            super(DeletableDict, self).__delitem__(key)
        self._keys_to_delete.clear()

if __name__ == '__main__':
    dct = DeletableDict((i, i*2) for i in range(15))
    if sys.version_info[0] != 3:
        for k, v in dct.iteritems():
            if k < 5:
                del dct[k]
        print(dct)
        for k in dct.iterkeys():
            if k > 8:
                del dct[k]
        print(dct)
        for k in dct:
            if k < 8:
                del dct[k]
        print(dct)
    else:
        for k, v in dct.items():
            if k < 5:
                del dct[k]
        print(dct)
</code></pre>
<p><span style="background-color:yellow;">When</span> <span style="background-color:yellow;">iterating</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">items</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">sets</span> <span style="background-color:yellow;">flag</span> <span style="background-color:yellow;">self._iterating</span> . <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">__delitem__</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">checks</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">ability</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">item</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">stores</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">temporary</span> <span style="background-color:yellow;">queue.</span> <span style="background-color:yellow;">At</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">end</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">iterations</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">deletes</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">pending</span> <span style="background-color:yellow;">keys</span> . </p>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">naive</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">recommend</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">production</span> <span style="background-color:yellow;">code</span> . </p>
<p><span style="background-color:yellow;">EDIT</span> </p>
<p><span style="background-color:yellow;">Added</span> <span style="background-color:yellow;">support</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">improvements</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">jsbueno</span> <span style="background-color:yellow;">comments</span> . </p>
<p><span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;">run</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">Ideone.com</span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">3.2</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">such</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">stdlib</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>#!/usr/bin/env python3
from collections import OrderedDict as odict

d = odict(zip(range(3), "abc"))
print(d)
for k in d:
    if k == 2:
       del d[k]
print(d)
</code></pre>
<h3><span style="background-color:yellow;">Output</span> </h3>
<pre><code>OrderedDict([(0, 'a'), (1, 'b'), (2, 'c')])
OrderedDict([(0, 'a'), (1, 'b')])
</code></pre>
<p><span style="background-color:yellow;">Iteration</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">performed</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">linked</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">__iter__</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">implementation</span> . <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">deletion</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">safe</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">3.2</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">items</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">weak</span> <span style="background-color:yellow;">references</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><ol><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">copy</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">copy</span> <span style="background-color:yellow;">te</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">beginning</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">iteration</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">iterate</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">those</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">checking</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">inefficient</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">ar</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">keys</span> . <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">arrange</span> <span style="background-color:yellow;">embed</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">inside</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">class.</span> <span style="background-color:yellow;">__iter__</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">__delitem__</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">special</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">collaborate</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">keep</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">items</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">removed</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">iteration</span> <span style="background-color:yellow;">happens.</span> <span style="background-color:yellow;">When</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">current</span> <span style="background-color:yellow;">iterations</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">__delitem__</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">item</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">least</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">iteration</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">happening</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">deleted</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list.</span> <span style="background-color:yellow;">When</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">last</span> <span style="background-color:yellow;">active</span> <span style="background-color:yellow;">iteration</span> <span style="background-color:yellow;">finishes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">actually</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">things.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">somewhat</span> <span style="background-color:yellow;">inefficient</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">remove</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">course</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">blow</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">always</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">least</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">iteration</span> <span style="background-color:yellow;">going</span> <span style="background-color:yellow;">on</span> . </ol>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">compromise</span> <span style="background-color:yellow;">between</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">examples</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">longer</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">second</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">shorter</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">slightly</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first.</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>dict_ = {k : random.randint(0, 40000) for k in range(0,200000)}

dict_remove = [k for k,v in dict_.iteritems() if v < 3000]
for k in dict_remove:
    del dict_[k]
</code></pre>
<p><span style="background-color:yellow;">Split</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">down</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">call</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">whether</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">readable</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">call</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def dict_remove(dict_, keys):
    for k in keys:
        del dict_[k]

dict_remove(dict_, [k for k,v in dict_.iteritems() if v < 3000])
</code></pre>
<p><span style="background-color:yellow;">Regardless</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">where</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">stored</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">store</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">needing</span> <span style="background-color:yellow;">deletion</span> <span style="background-color:yellow;">somewhere.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">around</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">generator</span> <span style="background-color:yellow;">expressions</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">explode</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">moment</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">time</span> . </p>
<br />