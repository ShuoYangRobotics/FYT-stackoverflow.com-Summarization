<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-301134</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Dynamic</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">import</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> </h2><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">writing</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">application</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">takes</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">command</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">argument</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>$ python myapp.py command1
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">application</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">extensible</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">able</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">new</span> <span style="background-color:yellow;">modules</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">implement</span> <span style="background-color:yellow;">new</span> <span style="background-color:yellow;">commands</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">having</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">change</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">main</span> <span style="background-color:yellow;">application</span> <span style="background-color:yellow;">source.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">looks</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>myapp/
    __init__.py
    commands/
        __init__.py
        command1.py
        command2.py
    foo.py
    bar.py
</code></pre>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">application</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">available</span> <span style="background-color:yellow;">command</span> <span style="background-color:yellow;">modules</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">runtime</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">execute</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">appropriate</span> <span style="background-color:yellow;">one</span> . </p>
<p><span style="background-color:yellow;">Currently</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">implemented</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>command = sys.argv[1]
try:
    command_module = __import__("myapp.commands.%s" % command, fromlist=["myapp.commands"])
except ImportError:
    # Display error message

command_module.run()
</code></pre>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">fine</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">wondering</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">possibly</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">idiomatic</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">accomplish</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">we</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">code</span> . </p>
<p><span style="background-color:yellow;">Note</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">specifically</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">eggs</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">extension</span> <span style="background-color:yellow;">points.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">open-source</span> <span style="background-color:yellow;">project</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">expect</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">plugins</span> <span style="background-color:yellow;">"</span> . <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">point</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">simplify</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">main</span> <span style="background-color:yellow;">application</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">remove</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">modify</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">new</span> <span style="background-color:yellow;">command</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">added</span> . </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-8</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">Nope</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">pretty</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">it.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">exec</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">well</span> . </p>
<p><span style="background-color:yellow;">Note</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">import</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">modules</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>> moduleNames = ['sys', 'os', 're', 'unittest'] 
>>> moduleNames
['sys', 'os', 're', 'unittest']
>>> modules = map(__import__, moduleNames)
</code></pre>
<p><span style="background-color:yellow;">Ripped</span> <span style="background-color:yellow;">straight</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">Dive</span> <span style="background-color:yellow;">Into</span> <span style="background-color:yellow;">Python</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">As</span> <span style="background-color:yellow;">mentioned</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">imp</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">provides</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">loading</span> <span style="background-color:yellow;">functions</span> . </p>
<p><span style="background-color:yellow;">imp.load_source</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">path</span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">imp.load_compiled</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">path</span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">these</span> <span style="background-color:yellow;">before</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">perform</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">similar</span> . <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">defined</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">specific</span> <span style="background-color:yellow;">class</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">defined</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">were</span> <span style="background-color:yellow;">required</span> . <span style="background-color:yellow;">So</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">once</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">loaded</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">check</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">class</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">create</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">instance</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">class</span> . </p>
<p><span style="background-color:yellow;">Something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import imp


def load_from_file(filepath):
    class_inst = None
    expected_class = 'MyClass'

    mod_name,file_ext = os.path.splitext(os.path.split(filepath)[-1])

    if file_ext.lower() == '.py':
        py_mod = imp.load_source(mod_name, filepath)

    elif file_ext.lower() == '.pyc'
        py_mod = imp.load_compiled(mod_name, filepath)

    if expected_class in dir(py_mod):
        class_inst = py_mod.MyClass() 

    return class_inst
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">Use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">imp</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">direct</span> <span style="background-color:yellow;">__import__</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">function</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">sounds</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">plugin</span> <span style="background-color:yellow;">architecture</span> . </p>
<p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">look</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">entry</span> <span style="background-color:yellow;">points</span> <span style="background-color:yellow;">functionality</span> <span style="background-color:yellow;">provided</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">setuptools</span> <span style="background-color:yellow;">package.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">offers</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">great</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">discover</span> <span style="background-color:yellow;">plugins</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">loaded</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">application</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">exec</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>exec "import myapp.commands.%s" % command
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">Check</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">post</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">importing</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">dynamically</span> </p>
<p><span style="background-color:yellow;">Dynamically</span> <span style="background-color:yellow;">executing</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">importing</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">code</span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">locals</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>> mod = 'sys'
>>> locals()['my_module'] = __import__(mod)
>>> my_module.version
'2.6.6 (r266:84297, Aug 24 2010, 18:46:32) [MSC v.1500 32 bit (Intel)]'
</code></pre>
<p><span style="background-color:yellow;">same</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">globals</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">7</span> </b><br /><p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">worked</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import sys, glob
sys.path.append('/home/marc/python/importtest/modus')
fl = glob.glob('modus/*.py')
modulist = []
adapters=[]
for i in range(len(fl)):
    fl[i] = fl[i].split('/')[1]
    fl[i] = fl[i][0:(len(fl[i])-3)]
    modulist.append(getattr(__import__(fl[i]),fl[i]))
    adapters.append(modulist[i]())
</code></pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">loads</span> <span style="background-color:yellow;">modules</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">folder</span> <span style="background-color:yellow;">'modus'.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">modules</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">class</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">name</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">name.</span> <span style="background-color:yellow;">E.g.</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">modus/modu1.py</span> <span style="background-color:yellow;">contains</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>class modu1():
    def __init__(self):
        self.x=1
        print self.x
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">result</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">dynamically</span> <span style="background-color:yellow;">loaded</span> <span style="background-color:yellow;">classes</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">adapters</span> <span style="background-color:yellow;">"</span> . </p>
<br />