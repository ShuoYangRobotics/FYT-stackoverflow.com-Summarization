<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-455580</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">JSON</span> <span style="background-color:yellow;">datetime</span> <span style="background-color:yellow;">between</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">JavaScript</span> </h2><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">send</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">datetime.datetime</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">serialized</span> <span style="background-color:yellow;">form</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">JSON</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">de-serialize</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">JavaScript</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">JSON.</span> <span style="background-color:yellow;">What</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">best</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">this</span> ? </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-7</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">'default</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">parameter</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">json.dumps</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">handle</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>> dthandler = lambda obj: obj.isoformat() if isinstance(obj, datetime.datetime) else None
>>> json.dumps(datetime.datetime.now(), default=dthandler)
'"2010-04-20T20:08:21.634121"'
</code></pre>
<p><span style="background-color:yellow;">A</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">comprehensive</span> <span style="background-color:yellow;">default</span> <span style="background-color:yellow;">handler</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def handler(obj):
    if hasattr(obj, 'isoformat'):
        return obj.isoformat()
    elif isinstance(obj, ...):
        return ...
    else:
        raise TypeError, 'Object of type %s with value of %s is not JSON serializable' % (type(obj), repr(obj))
</code></pre>
<p><span style="background-color:yellow;">Update</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">Added</span> <span style="background-color:yellow;">output</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">type</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">well</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">value</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">For</span> <span style="background-color:yellow;">cross</span> <span style="background-color:yellow;">language</span> <span style="background-color:yellow;">projects</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;">containing</span> <span style="background-color:yellow;">RfC</span> <span style="background-color:yellow;">3339</span> <span style="background-color:yellow;">dates</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">best</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">go.</span> <span style="background-color:yellow;">A</span> <span style="background-color:yellow;">RfC</span> <span style="background-color:yellow;">3339</span> <span style="background-color:yellow;">date</span> <span style="background-color:yellow;">looks</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>  1985-04-12T23:20:50.52Z
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">most</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">obvious.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">somewhat</span> <span style="background-color:yellow;">unusual</span> <span style="background-color:yellow;">thing</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">Z</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">end.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">stands</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">GMT/UTC.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">timezone</span> <span style="background-color:yellow;">offset</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">02</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">00</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">CEST</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Germany</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">summer</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">personally</span> <span style="background-color:yellow;">prefer</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">keep</span> <span style="background-color:yellow;">everything</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">UTC</span> <span style="background-color:yellow;">until</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">displayed</span> . </p>
<p><span style="background-color:yellow;">For</span> <span style="background-color:yellow;">displaying</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">comparisons</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">storage</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">leave</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">across</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">languages.</span> <span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">date</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">calculations</span> <span style="background-color:yellow;">easy</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">convert</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">back</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">native</span> <span style="background-color:yellow;">date</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">most</span> <span style="background-color:yellow;">language</span> . </p>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">generate</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">JSON</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>  json.dump(datetime.now().strftime('%Y-%m-%dT%H:%M:%S'))
</code></pre>
<p><span style="background-color:yellow;">Unfortunately</span> <span style="background-color:yellow;">Javascripts</span> <span style="background-color:yellow;">Date</span> <span style="background-color:yellow;">constructor</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">accept</span> <span style="background-color:yellow;">RfC</span> <span style="background-color:yellow;">3339</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">many</span> <span style="background-color:yellow;">parsers</span> <span style="background-color:yellow;">available</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">Internet</span> . </p>
<p><span style="background-color:yellow;">huTools.hujson</span> <span style="background-color:yellow;">tries</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">handle</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">most</span> <span style="background-color:yellow;">common</span> <span style="background-color:yellow;">encoding</span> <span style="background-color:yellow;">issues</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">might</span> <span style="background-color:yellow;">come</span> <span style="background-color:yellow;">across</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">including</span> <span style="background-color:yellow;">date/datetime</span> <span style="background-color:yellow;">objects</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">handling</span> <span style="background-color:yellow;">timezones</span> <span style="background-color:yellow;">correctly</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">certain</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">Javascript</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">consuming</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">JSON</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">prefer</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">pass</span> <span style="background-color:yellow;">Javascript</span> <span style="background-color:yellow;">Date</span> <span style="background-color:yellow;">objects</span> <span style="background-color:yellow;">directly</span> . </p>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">ctime</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">datetime</span> <span style="background-color:yellow;">objects</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">return</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">Javascript</span> <span style="background-color:yellow;">Date</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">understand</span> . </p>
<pre><code>import datetime
date = datetime.datetime.today()
json = '{"mydate":new Date("%s")}' % date.ctime()
</code></pre>
<p><span style="background-color:yellow;">Javascript</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">happily</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">literal</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">got</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">Date</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">built</span> <span style="background-color:yellow;">right</span> <span style="background-color:yellow;">in</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">simplejson</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">subclass</span> <span style="background-color:yellow;">JSONEncoder</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">override</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">default</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">provide</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">own</span> <span style="background-color:yellow;">custom</span> <span style="background-color:yellow;">serializers</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>class JSONEncoder(simplejson.JSONEncoder):
    def default(self, obj):
        if isinstance(obj, datetime.datetime):
            return obj.strftime('%Y-%m-%dT%H:%M:%S')
        else:
            return simplejson.JSONEncoder.default(self, obj)
</code></pre>
<p><span style="background-color:yellow;">Then</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">call</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>> JSONEncoder().encode([datetime.datetime.now()])
'["2010-06-15T14:42:28"]'
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">fairly</span> <span style="background-color:yellow;">complete</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">recursively</span> <span style="background-color:yellow;">encoding</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">decoding</span> <span style="background-color:yellow;">datetime.datetime</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">datetime.date</span> <span style="background-color:yellow;">objects</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">standard</span> <span style="background-color:yellow;">library</span> <span style="background-color:yellow;">json</span> <span style="background-color:yellow;">module.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">needs</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">2.6</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">%</span> <span style="background-color:yellow;">f</span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">datetime.datetime.strptime</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">supported</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">then.</span> <span style="background-color:yellow;">For</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2.5</span> <span style="background-color:yellow;">support</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">drop</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">%</span> <span style="background-color:yellow;">f</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">strip</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">microseconds</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">ISO</span> <span style="background-color:yellow;">date</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">before</span> <span style="background-color:yellow;">trying</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">convert</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">loose</span> <span style="background-color:yellow;">microseconds</span> <span style="background-color:yellow;">precision</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">course.</span> <span style="background-color:yellow;">For</span> <span style="background-color:yellow;">interoperability</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">ISO</span> <span style="background-color:yellow;">date</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">sources</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">include</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">zone</span> <span style="background-color:yellow;">name</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">UTC</span> <span style="background-color:yellow;">offset</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">strip</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">parts</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">date</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">before</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">conversion.</span> <span style="background-color:yellow;">For</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">complete</span> <span style="background-color:yellow;">parser</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">ISO</span> <span style="background-color:yellow;">date</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">many</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">date</span> <span style="background-color:yellow;">formats</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">third-party</span> <span style="background-color:yellow;">dateutil</span> <span style="background-color:yellow;">module</span> . </p>
<p><span style="background-color:yellow;">Decoding</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">ISO</span> <span style="background-color:yellow;">date</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">JavaScript</span> <span style="background-color:yellow;">literal</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">notation</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">nested</span> <span style="background-color:yellow;">structures</span> <span style="background-color:yellow;">within</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">object.</span> <span style="background-color:yellow;">ISO</span> <span style="background-color:yellow;">date</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">items</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">top-level</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">decoded</span> . </p>
<p><span style="background-color:yellow;">I.e.</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>date = datetime.datetime.now()
>>> json = dumps(dict(foo='bar', innerdict=dict(date=date)))
>>> json
'{"innerdict": {"date": "2010-07-15T13:16:38.365579"}, "foo": "bar"}'
>>> loads(json)
{u'innerdict': {u'date': datetime.datetime(2010, 7, 15, 13, 16, 38, 365579)},
u'foo': u'bar'}
</code></pre>
<p><span style="background-color:yellow;">And</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">too</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>> json = dumps(['foo', 'bar', dict(date=date)])
>>> json
'["foo", "bar", {"date": "2010-07-15T13:16:38.365579"}]'
>>> loads(json)
[u'foo', u'bar', {u'date': datetime.datetime(2010, 7, 15, 13, 16, 38, 365579)}]
</code></pre>
<p><span style="background-color:yellow;">But</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">expected</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>> json = dumps(['foo', 'bar', date])
>>> json
'["foo", "bar", "2010-07-15T13:16:38.365579"]'
>>> loads(json)
[u'foo', u'bar', u'2010-07-15T13:16:38.365579']
</code></pre>
<p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>__all__ = ['dumps', 'loads']

import datetime

try:
    import json
except ImportError:
    import simplejson as json

class JSONDateTimeEncoder(json.JSONEncoder):
    def default(self, obj):
        if isinstance(obj, (datetime.date, datetime.datetime)):
            return obj.isoformat()
        else:
            return json.JSONEncoder.default(self, obj)

def datetime_decoder(d):
    if isinstance(d, list):
        pairs = enumerate(d)
    elif isinstance(d, dict):
        pairs = d.items()
    result = []
    for k,v in pairs:
        if isinstance(v, basestring):
            try:
                # The %f format code is only supported in Python >= 2.6.
                # For Python <= 2.5 strip off microseconds
                # v = datetime.datetime.strptime(v.rsplit('.', 1)[0],
                #     '%Y-%m-%dT%H:%M:%S')
                v = datetime.datetime.strptime(v, '%Y-%m-%dT%H:%M:%S.%f')
            except ValueError:
                try:
                    v = datetime.datetime.strptime(v, '%Y-%m-%d').date()
                except ValueError:
                    pass
        elif isinstance(v, (dict, list)):
            v = datetime_decoder(v)
        result.append((k, v))
    if isinstance(d, list):
        return [x[1] for x in result]
    elif isinstance(d, dict):
        return dict(result)

def dumps(obj):
    return json.dumps(obj, cls=JSONDateTimeEncoder)

def loads(obj):
    return json.loads(obj, object_hook=datetime_decoder)

if __name__ == '__main__':
    mytimestamp = datetime.datetime.utcnow()
    mydate = datetime.date.today()
    data = dict(
        foo = 42,
        bar = [mytimestamp, mydate],
        date = mydate,
        timestamp = mytimestamp,
        struct = dict(
            date2 = mydate,
            timestamp2 = mytimestamp
        )
    )

    print repr(data)
    jsonstring = dumps(data)
    print jsonstring
    print repr(loads(jsonstring))
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">worked</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">out</span> . </p>
<p><span style="background-color:yellow;">Let</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">say</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">datetime</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">d</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">created</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">datetime.now</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">Its</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>datetime.datetime(2011, 5, 25, 13, 34, 5, 787000)
</code></pre>
<p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">serialize</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">JSON</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">ISO</span> <span style="background-color:yellow;">8601</span> <span style="background-color:yellow;">datetime</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import json    
json.dumps(d.isoformat())
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">datetime</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">serialized</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>'"2011-05-25T13:34:05.787000"'
</code></pre>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">once</span> <span style="background-color:yellow;">received</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">Javascript</span> <span style="background-color:yellow;">layer</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">construct</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">Date</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>var d = new Date("2011-05-25T13:34:05.787000");
</code></pre>
<p><span style="background-color:yellow;">As</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">Javascript</span> <span style="background-color:yellow;">1.8.5</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">Date</span> <span style="background-color:yellow;">objects</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">toJSON</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">returns</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">standard</span> <span style="background-color:yellow;">format.</span> <span style="background-color:yellow;">To</span> <span style="background-color:yellow;">serialize</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">above</span> <span style="background-color:yellow;">Javascript</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">back</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">JSON</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">therefore</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">command</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>d.toJSON()
</code></pre>
<p><span style="background-color:yellow;">Which</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">give</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>'2011-05-25T20:34:05.787Z'
</code></pre>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">once</span> <span style="background-color:yellow;">received</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">deserialized</span> <span style="background-color:yellow;">back</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">datetime</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>datetime.strptime('2011-05-25T20:34:05.787Z', '%Y-%m-%dT%H:%M:%S.%fZ')
</code></pre>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">results</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">datetime</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">started</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">therefore</span> <span style="background-color:yellow;">correct</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>datetime.datetime(2011, 5, 25, 20, 34, 5, 787000)
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">address</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">eGenix</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">extension</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">containing</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">functions</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">handling</span> <span style="background-color:yellow;">date</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">time</span> . <span style="background-color:yellow;">Plus</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">article</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">deal</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">Javascript</span> <span style="background-color:yellow;">marshaling</span> . </p>
<br />