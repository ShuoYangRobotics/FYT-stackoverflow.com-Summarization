<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-5160965</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">How</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">obtain</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">root</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">parsing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">entire</span> <span style="background-color:yellow;">file</span> ? </h2><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">making</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">xml</span> <span style="background-color:yellow;">parser</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">parse</span> <span style="background-color:yellow;">xml</span> <span style="background-color:yellow;">reports</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">different</span> <span style="background-color:yellow;">tools</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">tool</span> <span style="background-color:yellow;">generates</span> <span style="background-color:yellow;">different</span> <span style="background-color:yellow;">reports</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">different</span> <span style="background-color:yellow;">tags</span> . </p>
<p><span style="background-color:yellow;">For</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">:</span> </p>
<p><span style="background-color:yellow;">Arachni</span> <span style="background-color:yellow;">generates</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">xml</span> <span style="background-color:yellow;">report</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">arachni_report&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">/arachni_report&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">root</span> <span style="background-color:yellow;">tag</span> . </p>
<p><span style="background-color:yellow;">nmap</span> <span style="background-color:yellow;">generates</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">xml</span> <span style="background-color:yellow;">report</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">nmaprun&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">/nmaprun&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">root</span> <span style="background-color:yellow;">tag</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">trying</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">parse</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">entire</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">unless</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">valid</span> <span style="background-color:yellow;">report</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tools</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">want</span> . </p>
<p><span style="background-color:yellow;">First</span> <span style="background-color:yellow;">thing</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">thought</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">ElementTree</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">parse</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">entire</span> <span style="background-color:yellow;">xml</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">supposing</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">contains</span> <span style="background-color:yellow;">valid</span> <span style="background-color:yellow;">xml</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">check</span> <span style="background-color:yellow;">based</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">root</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">report</span> <span style="background-color:yellow;">belongs</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">Arachni</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">nmap</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">currently</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">cElementTree</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">getroot</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">option</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">goal</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">parser</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">operate</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">recognized</span> <span style="background-color:yellow;">files</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">parsing</span> <span style="background-color:yellow;">unnecessary</span> <span style="background-color:yellow;">files</span> . </p>
<p><span style="background-color:yellow;">By</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">Still</span> <span style="background-color:yellow;">learning</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">xml</span> <span style="background-color:yellow;">parsing</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">thanks</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">advance</span> . </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-6</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">"</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">root</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">pun</span> <span style="background-color:yellow;">intended</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">evil</span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">examples</span> <span style="background-color:yellow;">below</span> . </p>
<p><span style="background-color:yellow;">Update</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">Code</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">output</span> <span style="background-color:yellow;">now</span> <span style="background-color:yellow;">show</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">proposed</span> <span style="background-color:yellow;">regexes</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">well</span> . </p>
<p><span style="background-color:yellow;">Use</span> <span style="background-color:yellow;">ElementTree.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">looking</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">iterparse</span> . <span style="background-color:yellow;">Enable</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">start</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">events.</span> <span style="background-color:yellow;">Bale</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">iteration</span> . </p>
<p><span style="background-color:yellow;">Code</span> <span style="background-color:yellow;">:</span> </p>
<pre><code># coding: ascii
import xml.etree.cElementTree as et
# import xml.etree.ElementTree as et
# import lxml.etree as et
from cStringIO import StringIO
import re

xml_text_1 = """\
<?xml version="1.0" ?> 
<!--  this is a comment --> 
<root
><foo>bar</foo></root
>
"""

xml_text_2 = """\
<?xml version="1.0" ?> 
<!--  this is a comment --> 
<root
><foo>bar</foo></root
>
<!--
That's all, folks! 
-->
"""

xml_text_3 = '''<?xml version="1.0" ?>
<!-- <mole1> -->
<root><foo /></root>
<!-- </mole2> -->'''

xml_text_4 = '''<?xml version="1.0" ?><!-- <mole1> --><root><foo /></root><!-- </mole2> -->'''

for xml_text in (xml_text_1, xml_text_2, xml_text_3, xml_text_4):
    print
    chrstr = xml_text.strip()
    x = max(chrstr.rfind('\r'),chrstr.rfind('\n'))
    lastline = chrstr[x:]
    print "*** eyquem 1:", repr(lastline.strip())

    chrstr = xml_text.strip()
    x = max(chrstr.rfind('\r'),chrstr.rfind('\n'))
    lastline = chrstr[x+1:]
    if lastline[0:5]=='<!-- ':
        chrstr = xml_text[0:x].rstrip()
        x = max(chrstr.rfind('\r'),chrstr.rfind('\n'))
        print "*** eyquem 2:", repr(chrstr[x+1:])
    else:
        print "*** eyquem 2:", repr(lastline)

    m = None
    for m in re.finditer('^</[^>]+>', xml_text, re.MULTILINE):
        pass
    if m: print "*** eyquem 3:", repr(m.group())
    else: print "*** eyquem 3:", "FAIL"

    m = None
    for m in re.finditer('</[^>]+>', xml_text):
        pass
    if m: print "*** eyquem 4:", repr(m.group())
    else: print "*** eyquem 4:", "FAIL"

    m = re.search('^<(?![?!])[^>]+>', xml_text, re.MULTILINE)
    if m: print "*** eyquem 5:", repr(m.group())
    else: print "*** eyquem 5:", "FAIL"

    m = re.search('<(?![?!])[^>]+>', xml_text)
    if m: print "*** eyquem 6:", repr(m.group())
    else: print "*** eyquem 6:", "FAIL"

    filelike_obj = StringIO(xml_text)
    tree = et.parse(filelike_obj)
    print "*** parse:", tree.getroot().tag

    filelike_obj = StringIO(xml_text)
    for event, elem in et.iterparse(filelike_obj, ('start', 'end')):
        print "*** iterparse:", elem.tag
        break
</code></pre>
<p><span style="background-color:yellow;">Above</span> <span style="background-color:yellow;">ElementTree-related</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2.5</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">2.7.</span> <span style="background-color:yellow;">Will</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2.2</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">2.4</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">ElementTree</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">cElementTree</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">effbot.org</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">conditional</span> <span style="background-color:yellow;">importing.</span> <span style="background-color:yellow;">Should</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">lxml</span> <span style="background-color:yellow;">version</span> . </p>
<p><span style="background-color:yellow;">Output</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>*** eyquem 1: '>'
*** eyquem 2: '>'
*** eyquem 3: FAIL
*** eyquem 4: '</root\n>'
*** eyquem 5: '<root\n>'
*** eyquem 6: '<root\n>'
*** parse: root
*** iterparse: root

*** eyquem 1: '-->'
*** eyquem 2: '-->'
*** eyquem 3: FAIL
*** eyquem 4: '</root\n>'
*** eyquem 5: '<root\n>'
*** eyquem 6: '<root\n>'
*** parse: root
*** iterparse: root

*** eyquem 1: '<!-- </mole2> -->'
*** eyquem 2: '<root><foo /></root>'
*** eyquem 3: FAIL
*** eyquem 4: '</mole2>'
*** eyquem 5: '<root>'
*** eyquem 6: '<mole1>'
*** parse: root
*** iterparse: root

*** eyquem 1: '>'
*** eyquem 2: '<?xml version="1.0" ?><!-- <mole1> --><root><foo /></root><!-- </mole2> -->'
*** eyquem 3: FAIL
*** eyquem 4: '</mole2>'
*** eyquem 5: FAIL
*** eyquem 6: '<mole1>'
*** parse: root
*** iterparse: root
</code></pre>
<p><span style="background-color:yellow;">Update</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">above</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">demonstration</span> <span style="background-color:yellow;">code.</span> <span style="background-color:yellow;">Below</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">code...</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">exception</span> <span style="background-color:yellow;">handling.</span> <span style="background-color:yellow;">Tested</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2.7</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">2.2</span> . </p>
<pre><code>try:
    import xml.etree.cElementTree as ET
except ImportError:
    import cElementTree as ET

def get_root_tag_from_xml_file(xml_file_path):
    result = f = None
    try:
        f = open(xml_file_path, 'rb')
        for event, elem in ET.iterparse(f, ('start', )):
            result = elem.tag
            break
    finally:
        if f: f.close()
    return result

if __name__ == "__main__":
    import sys, glob
    for pattern in sys.argv[1:]:
        for filename in glob.glob(pattern):
            print filename, get_root_tag_from_xml_file(filename)
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">Does</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">seem</span> <span style="background-color:yellow;">interesting</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">connoisseur</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">XML</span> ? <span style="background-color:yellow;">:</span> </p>
<pre><code>ch = """\
<?xml version="1.0" encoding="ISO-8859-1" ?> 
<!--  Edited by XMLSpy® --> 
<CATALOG>
 <CD>
  <TITLE>Empire Burlesque</TITLE> 
  <ARTIST>Bob Dylan</ARTIST> 
  <COUNTRY>USA</COUNTRY> 
  <COMPANY>Columbia</COMPANY> 
  <PRICE>10.90</PRICE> 
  <YEAR>1985</YEAR> 
 </CD>
 <CD>
  <TITLE>Hide your heart</TITLE> 
  <ARTIST>Bonnie Tyler</ARTIST> 
  <COUNTRY>UK</COUNTRY> 
  <COMPANY>CBS Records</COMPANY> 
  <PRICE>9.90</PRICE> 
  <YEAR>1988</YEAR> 
 </CD>
</CATALOG>
<!-- This is the end of arachni report --> 

"""

chrstr = ch.strip()
x = max(chrstr.rfind('\r'),chrstr.rfind('\n'))
lastline = chrstr[x+1:]
if lastline[0:5]=='<!-- ':
    chrstr = ch[0:x].rstrip()
    x = max(chrstr.rfind('\r'),chrstr.rfind('\n'))
    print chrstr[x+1:]
else:
    print lastline
</code></pre>
<p><span style="background-color:yellow;">result</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">still</span> </p>
<pre><code></CATALOG>
</code></pre>
<p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">necessary</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">verification</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">start-tag</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">root</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">around</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">beginning</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> </p>
<p>. </p>
<p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">big</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">treatment</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">we</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">move</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">pointeur</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">near</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">end</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">say</span> <span style="background-color:yellow;">200</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">600</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">ante</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">end</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">search</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">200</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">600</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">long</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">end-tag</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">root</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">XL</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">greater</span> <span style="background-color:yellow;">length</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">it</span> ? <span style="background-color:yellow;"></span> </p>
<pre><code>from os.path import getsize

with open('I:\\uuu.txt') as f:

    L = getsize('I:\\uuu.txt')
    print 'L==',L

    f.seek( -min(600,L) , 2)
    ch = f.read()
    if '\r' not in ch and '\n' not in ch:
        f.seek(0,0)
        ch = f.read()        

    chrstr = ch.strip()
    x = max(chrstr.rfind('\r'),chrstr.rfind('\n'))
    lastline = chrstr[x+1:]
    if lastline[0:5]=='<!-- ':
        chrstr = ch[0:x].rstrip()
        x = max(chrstr.rfind('\r'),chrstr.rfind('\n'))
        print chrstr[x+1:]
    else:
        print lastline
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">My</span> <span style="background-color:yellow;">understanding</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">problem</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">examine</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">determine</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">recognized</span> <span style="background-color:yellow;">formats</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">parse</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">recognized</span> <span style="background-color:yellow;">formats.</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">eyquem</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">right</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">methods</span> . </p>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">simplest</span> <span style="background-color:yellow;">thing</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">small</span> <span style="background-color:yellow;">amount</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">beginning</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">root</span> <span style="background-color:yellow;">element</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">recognize</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>f = open(the_file)
head = f.read(200)
f.close()
if "<arachni_report" in head:
    #.. re-open and parse as arachni ..
elif "<nmaprun" in head:
    #.. re-open and parse as nmaprun ..
</code></pre>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">advantage</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">small</span> <span style="background-color:yellow;">amount</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">before</span> <span style="background-color:yellow;">determining</span> <span style="background-color:yellow;">whether</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">interesting</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">not</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">Final</span> <span style="background-color:yellow;">edit</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">Thanks</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">John</span> <span style="background-color:yellow;">Machin</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">draft</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">based</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">his</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">selected</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">correct</span> <span style="background-color:yellow;"></span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'d</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">thank</span> <span style="background-color:yellow;">eyquem</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">his</span> <span style="background-color:yellow;">responses</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">his</span> <span style="background-color:yellow;">persistence</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">defending</span> <span style="background-color:yellow;">his</span> <span style="background-color:yellow;">codes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">learned</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;"></span> </p>
<pre><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-
from cStringIO import StringIO

try:
    import xml.etree.cElementTree as ET
except ImportError:
    import xml.etree.ElementTree as ET

class reportRecognizer(object):

    def __init__(self, xml_report_path):
        self.report_type = ""

        root_tag = self.get_root_tag_from_xml_file(xml_report_path)

        if root_tag:
            self.report_type = self.rType(root_tag)


    def get_root_tag_from_xml_file(self, xml_file_path):
        result = f = None
        try:
            f = open(xml_file_path, 'rb')
            for event, elem in ET.iterparse(f, ('start', )):
                result = elem.tag
                break
        except IOError, err:
            print "Error while opening file.\n%s. %s" % (err, filepath)
        finally:
            if f: f.close()
        return result

    def rType(self, tag):
        if "arachni_report" == tag:
            return "Arachni XML Report"
        elif "nmaprun" == tag:
            return "Nmap XML Report"
        else:
            return "Unrecognized XML file, sorry."

report = reportRecognizer('report.xml')
print report.report_type
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">Are</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">serious</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">John</span> <span style="background-color:yellow;">Machin</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">show</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">correctly</span> ? </p>
<p><span style="background-color:yellow;">Since</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">well</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">went</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">:</span> </p>
<p><span style="background-color:yellow;">W3C</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">validator</span> </p>
<p><span style="background-color:yellow;">Conclusion</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">samples</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">well-formed.</span> <span style="background-color:yellow;">Hence</span> <span style="background-color:yellow;">:</span> </p>
<blockquote>
<p>« The definition of an XML document
  excludes texts which contain
  violations of well-formedness rules;
  <strong>they are simply not XML</strong>. »</p>
<p><a href="http://en.wikipedia.org/wiki/XML" rel="nofollow">http://en.wikipedia.org/wiki/XML</a></p>
<pre><code>The real evil is here.
</code></pre>
</blockquote>
<p><span style="background-color:yellow;">Did</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">mean</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">supposed</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">written</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">able</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">detect</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">root</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">tag</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">non-XML</span> <span style="background-color:yellow;">files</span> ? <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">did</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">had</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">over-requirement</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">fulfill</span> . </p>
<p>. </p>
<p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">frightens</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">little</span> <span style="background-color:yellow;">less</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">methods.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">did</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">give</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">before</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">received</span> <span style="background-color:yellow;">notifications</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">..whisp...you</span> <span style="background-color:yellow;">MUST</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">employ</span> <span style="background-color:yellow;">regexes</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">analyse</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">text...</span> <span style="background-color:yellow;">whisp</span> <span style="background-color:yellow;">whisp</span> <span style="background-color:yellow;">"</span> </p>
<pre><code>import re
from os.path import getsize

with open('I:\\uuu.txt') as f:

    L = getsize('I:\\uuu.txt')
    print 'L==',L

    f.seek( -min(600,L) , 2)
    for mat in re.finditer('^</[^>]+>',f.read(),re.MULTILINE):
        pass
    print mat.group()
</code></pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">coud</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">done</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">noisy</span> <span style="background-color:yellow;">beginning</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">XML</span> . </p>
<p><span style="background-color:yellow;">In</span> <span style="background-color:yellow;">fact</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">prefer</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">given</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">John</span> <span style="background-color:yellow;">Machin</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">iterparse</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">ElementTree</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">!</span> </p>
<p>. </p>
<p><span style="background-color:yellow;">EDIT</span> </p>
<p><span style="background-color:yellow;">After</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wonder</span> <span style="background-color:yellow;">why</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">enough...</span> . </p>
<pre><code>import re

with open('I:\\uuu.txt') as f:
    print re.search('^<(?![?!])[^>]+>',f.read(),re.MULTILINE).group()
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">were</span> <span style="background-color:yellow;">looking</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">John</span> <span style="background-color:yellow;">Machin</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">sequel</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">our</span> <span style="background-color:yellow;">serial</span> . <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">verified</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">brain</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">its</span> <span style="background-color:yellow;">correct</span> <span style="background-color:yellow;">place</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">continued</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">problem</span> . </p>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">extended</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">demonstration</span> <span style="background-color:yellow;">code</span> . <span style="background-color:yellow;">Now</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">several</span> <span style="background-color:yellow;">exemplifying</span> <span style="background-color:yellow;">texts</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">clear</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">sufficient</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">UNDERSTAND</span> <span style="background-color:yellow;">why.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">interested</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">underneath</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">processes</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">understand</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">concrete</span> <span style="background-color:yellow;">reasons</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">affirmations</span> . </p>
<p><span style="background-color:yellow;">Then</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">studied</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">ever</span> <span style="background-color:yellow;">did</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">specifications</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">performed</span> <span style="background-color:yellow;">tests</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">W3c</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">validator</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">increase</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">understanding</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">details</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">structure</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">text.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">rather</span> <span style="background-color:yellow;">severe</span> <span style="background-color:yellow;">occupation</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">interesting</span> <span style="background-color:yellow;">though.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">saw</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">mix</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">strict</span> <span style="background-color:yellow;">rules</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">debonair</span> <span style="background-color:yellow;">liberties</span> . </p>
<p><span style="background-color:yellow;">From</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tricks</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">exemples</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">tear</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">codes</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">pieces</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">conclude</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">require</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">divided</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">lines.</span> <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">fact</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">W3c</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">validator</span> <span style="background-color:yellow;">showed</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">r</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">t</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">many</span> <span style="background-color:yellow;">positions</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">provided</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">break</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">rule</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">structure</span> . </p>
<p><span style="background-color:yellow;">For</span> <span style="background-color:yellow;">exemple</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">authorized</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">restriction</span> <span style="background-color:yellow;">between</span> <span style="background-color:yellow;">tags</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">consequence</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">element</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">occupy</span> <span style="background-color:yellow;">several</span> <span style="background-color:yellow;">lines.</span> <span style="background-color:yellow;">Also</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">tags</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">splitted</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">several</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">among</span> <span style="background-color:yellow;">several</span> <span style="background-color:yellow;">tabulations</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">t</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">provided</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">occur</span> <span style="background-color:yellow;">after</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">name</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">tag.</span> <span style="background-color:yellow;">There</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">nor</span> <span style="background-color:yellow;">requirement</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">indented</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">always</span> <span style="background-color:yellow;">saw</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">understand</span> <span style="background-color:yellow;">now</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">personal</span> <span style="background-color:yellow;">convenience</span> <span style="background-color:yellow;">choosen</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">ease</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">reading</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">logical</span> <span style="background-color:yellow;">comprehension</span> . </p>
<p><span style="background-color:yellow;">Well</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">better</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">John</span> <span style="background-color:yellow;">Machin.</span> <span style="background-color:yellow;">Thanks</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">now</span> <span style="background-color:yellow;">alerted</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">complexity</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">better</span> <span style="background-color:yellow;">understand</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">reasons</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">parsing</span> <span style="background-color:yellow;">unrealistic</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">means</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">specialized</span> <span style="background-color:yellow;">parsers.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">incidentally</span> <span style="background-color:yellow;">wonder</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">common</span> <span style="background-color:yellow;">coders</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">aware</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">awkardness</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">possibility</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">present</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">text</span> . </p>
<p>. </p>
<p><span style="background-color:yellow;">Anyway</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">been</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">conceptual</span> <span style="background-color:yellow;">boiling</span> <span style="background-color:yellow;">pot</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">now</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">continued</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">search</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">whac_moles</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">John</span> <span style="background-color:yellow;">Machin</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">instructive</span> <span style="background-color:yellow;">play</span> . </p>
<p><span style="background-color:yellow;">String</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">game</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">polished</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">regex</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">say</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">analyzing</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">ca</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">done</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">regex.</span> <span style="background-color:yellow;">Now</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">better</span> <span style="background-color:yellow;">why</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">agree.</span> <span style="background-color:yellow;">But</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">pretend</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">parse</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">wo</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">extract</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">part</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">search</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">little</span> <span style="background-color:yellow;">chunk</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">text.</span> <span style="background-color:yellow;">For</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">problem</span> <span style="background-color:yellow;">asked</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">OP</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">consider</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">non</span> <span style="background-color:yellow;">heretical</span> . </p>
<p>. </p>
<p><span style="background-color:yellow;">From</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">beginning</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">searching</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">end-tag</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">root</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">easy</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">natural</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">end-tag</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">attributes</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">less</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">noise</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">around</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">start-tag</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">root</span> . </p>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">now</span> <span style="background-color:yellow;">:</span> </p>
<blockquote><span style="background-color:yellow;">~</span> <span style="background-color:yellow;">~</span> <span style="background-color:yellow;">open</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">~</span> <span style="background-color:yellow;">~</span> <span style="background-color:yellow;">move</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">pointer</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">position</span> <span style="background-color:yellow;">-200</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">end</span> <span style="background-color:yellow;">~</span> <span style="background-color:yellow;">~</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">200</span> <span style="background-color:yellow;">last</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">~</span> <span style="background-color:yellow;">~</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">strategies</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">either</span> <span style="background-color:yellow;">remove</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">comments</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">searching</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tag</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">taking</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">r</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">t</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">account</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">remove</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">comments</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">r</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">t</span> <span style="background-color:yellow;">before</span> <span style="background-color:yellow;">searching</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tag</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">simpler</span> <span style="background-color:yellow;">regex</span> </blockquote>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">bigger</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">speeder</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">algorithm</span> <span style="background-color:yellow;">compared</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">parse</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">iterparse.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wrote</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">examined</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">results</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">codes.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">strategy</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">one</span> . </p>
<pre><code># coding: ascii
import xml.etree.cElementTree as et
# import xml.etree.ElementTree as et
# import lxml.etree as et
from cStringIO import StringIO
import re,urllib

xml5 = """\
<?xml version="1.0" ?> 
<!--  this is a comment --> 
<root\t
\r\t\r \r
><foo

>bar</foo\t \r></root
>
"""

xml6 = """\
<?xml version="1.0" ?> 
<!--  this is a comment --> 
<root
><foo
>bar</foo\n\t   \t></root \t
\r>
<!--  \r   \t
That's all, folks!

\t-->
"""

xml7 = '''<?xml version="1.0" ?>
<!-- <mole1> -->  
<root><foo

\t\t\r\r\t/></root  \t
>  
<!-- </mole2>\t \r
 \r-->
<!---->
'''

xml8 = '''<?xml version="1.0" ?><!-- \r<mole1> --><root>  \t\t<foo \t\r\r/></root>\t<!-- </mole2> -->'''


sock = urllib.urlopen('http://www.cafeconleche.org/books/bible/examples/18/18-4.xsl')
xml9 = sock.read()
sock.close()


def rp(x):
    return  '\\r' if x.group()=='\r' else '\\t'

for xml_text in (xml5, xml6, xml7, xml8, xml9):

    print '\\n\n'.join(re.sub('\r|\t',rp,xml_text).split('\n'))
    print '-----------------------------'

    xml_text_noc = re.sub('<!--.*?-->|[\n\r\t]','', xml_text,flags=re.DOTALL)
    RE11 = '(?<=</)[^ >]+(?= *>)(?!.*</[^>]+>)' # with assertions   # ^
    m  = re.search(RE11, xml_text_noc,re.DOTALL)
    print "***  eyquem 11: " + repr(m.group() if m else "FAIL")

    xml_text_noc = re.sub('<!--.*?-->|[\n\r\t]','', xml_text,flags=re.DOTALL)
    RE12 = '</([^ >]+) *>(?!.*</[^>]+>)'  # with group(1)   # ^
    m  = re.search(RE12, xml_text_noc,re.DOTALL)
    print "***  eyquem 12: " + repr(m.group(1) if m else "FAIL")

    xml_text_noc = re.sub('<!--.*?-->|[\n\r\t]','', xml_text,flags=re.DOTALL)
    RE13 = '</[^ >]+ *>(?!.*</[^>]+>)' # without group(1)   # ^
    m  = re.search(RE13, xml_text_noc,re.DOTALL)
    print "***  eyquem 13: " + repr(m.group()[2:-1].rstrip() if m else "FAIL")



    xml_text_noc = re.sub('<!--.*?-->','', xml_text,flags=re.DOTALL)
    RE14 = '(?<=</)[^ \n\r\t>]+(?=[ \n\r\t]*>)(?!.*</[^>]+>)' # with assertions  # ^
    m  = re.search(RE14, xml_text_noc,re.DOTALL)
    print "***  eyquem 14: " + repr(m.group() if m else "FAIL")

    xml_text_noc = re.sub('<!--.*?-->','', xml_text,flags=re.DOTALL)
    RE15 = '</([^ \n\r\t>]+)[ \n\r\t]*>(?!.*</[^>]+>)'  # with group(1)   # <
    m  = re.search(RE15, xml_text_noc,re.DOTALL)
    print "***  eyquem 15: " + repr(m.group(1).rstrip() if m else "FAIL")

    xml_text_noc = re.sub('<!--.*?-->','', xml_text,flags=re.DOTALL)
    RE16 = '</[^ \n\r\t>]+[ \n\r\t]*>(?!.*</[^>]+>)' # without group(1)   # <
    m  = re.search(RE16, xml_text_noc,re.DOTALL)
    print "***  eyquem 16: " + repr(m.group()[2:-1].rstrip() if m else "FAIL")



    print
    filelike_obj = StringIO(xml_text)
    tree = et.parse(filelike_obj)
    print "***      parse:  " + tree.getroot().tag

    filelike_obj = StringIO(xml_text)
    for event, elem in et.iterparse(filelike_obj, ('start', 'end')):
        print "***  iterparse:  " + elem.tag
        break


    print '\n=============================================' 
</code></pre>
<p><span style="background-color:yellow;">Result</span> </p>
<pre><code><?xml version="1.0" ?> \n
<!--  this is a comment --> \n
<root\t\n
\r\t\r \r\n
><foo\n
\n
>bar</foo\t \r></root\n
>\n

-----------------------------
***  eyquem 11: 'root'
***  eyquem 12: 'root'
***  eyquem 13: 'root'
***  eyquem 14: 'root'
***  eyquem 15: 'root'
***  eyquem 16: 'root'

***      parse:  root
***  iterparse:  root

=============================================
<?xml version="1.0" ?> \n
<!--  this is a comment --> \n
<root\n
><foo\n
>bar</foo\n
\t   \t></root \t\n
\r>\n
<!--  \r   \t\n
That's all, folks!\n
\n
\t-->\n

-----------------------------
***  eyquem 11: 'root'
***  eyquem 12: 'root'
***  eyquem 13: 'root'
***  eyquem 14: 'root'
***  eyquem 15: 'root'
***  eyquem 16: 'root'

***      parse:  root
***  iterparse:  root

=============================================
<?xml version="1.0" ?>\n
<!-- <mole1> -->  \n
<root><foo\n
\n
\t\t\r\r\t/></root  \t\n
>  \n
<!-- </mole2>\t\n
-->\n
<!---->\n

-----------------------------
***  eyquem 11: 'root'
***  eyquem 12: 'root'
***  eyquem 13: 'root'
***  eyquem 14: 'root'
***  eyquem 15: 'root'
***  eyquem 16: 'root'

***      parse:  root
***  iterparse:  root

=============================================
<?xml version="1.0" ?><!-- \r<mole1> --><root>  \t\t<foo \t\r\r/></root>\t<!-- </mole2> -->
-----------------------------
***  eyquem 11: 'root'
***  eyquem 12: 'root'
***  eyquem 13: 'root'
***  eyquem 14: 'root'
***  eyquem 15: 'root'
***  eyquem 16: 'root'

***      parse:  root
***  iterparse:  root

=============================================
<?xml version="1.0"?>\r\n
<stylesheet\r\n
  xmlns="http://www.w3.org/XSL/Transform/1.0"\r\n
  xmlns:fo="http://www.w3.org/XSL/Format/1.0"\r\n
  result-ns="fo">\r\n
\r\n
  <template match="/">\r\n
    <fo:root xmlns:fo="http://www.w3.org/XSL/Format/1.0">\r\n
\r\n
      <fo:layout-master-set>\r\n
        <fo:simple-page-master page-master-name="only">\r\n
          <fo:region-body/>\r\n
        </fo:simple-page-master>\r\n
      </fo:layout-master-set>\r\n
\r\n
      <fo:page-sequence>\r\n
\r\n
       <fo:sequence-specification>\r\n
        <fo:sequence-specifier-single page-master-name="only"/>\r\n
       </fo:sequence-specification>\r\n
        \r\n
        <fo:flow>\r\n
          <apply-templates select="//ATOM"/>\r\n
        </fo:flow>\r\n
        \r\n
      </fo:page-sequence>\r\n
\r\n
    </fo:root>\r\n
  </template>\r\n
\r\n
  <template match="ATOM">\r\n
    <fo:block font-size="20pt" font-family="serif">\r\n
      <value-of select="NAME"/>\r\n
    </fo:block>\r\n
  </template>\r\n
\r\n
</stylesheet>\r\n

-----------------------------
***  eyquem 11: 'stylesheet'
***  eyquem 12: 'stylesheet'
***  eyquem 13: 'stylesheet'
***  eyquem 14: 'stylesheet'
***  eyquem 15: 'stylesheet'
***  eyquem 16: 'stylesheet'

***      parse:  {http://www.w3.org/XSL/Transform/1.0}stylesheet
***  iterparse:  {http://www.w3.org/XSL/Transform/1.0}stylesheet

=============================================
</code></pre>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">now</span> <span style="background-color:yellow;">measures</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">execution</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">times</span> <span style="background-color:yellow;">:</span> </p>
<pre><code># coding: ascii
import xml.etree.cElementTree as et
# import xml.etree.ElementTree as et
# import lxml.etree as et
from cStringIO import StringIO
import re
import urllib
from time import clock

sock = urllib.urlopen('http://www.cafeconleche.org/books/bible/examples/18/18-4.xsl')
ch = sock.read()
sock.close()

# the following lines are intended to insert additional lines
# into the XML text before its recording in a file, in order to
# obtain a real file to use, containing an XML text 
# long enough to observe easily the timing's differences

li = ch.splitlines(True)[0:6] + 30*ch.splitlines(True)[6:-2] + ch.splitlines(True)[-2:]

with open('xml_example.xml','w') as f:
    f.write(''.join(li))

print 'length of XML text in a file : ',len(''.join(li)),'\n'



# timings

P,I,A,B,C,D,E,F = [],[],[],[],[],[],[],[],


n = 50

for cnt in xrange(50):

    te = clock()
    for i in xrange (n):
        with open('xml_example.xml') as filelike_obj:
            tree = et.parse(filelike_obj)
            res_parse = tree.getroot().tag
    P.append( clock()-te)

    te = clock()
    for i in xrange (n):
        with open('xml_example.xml') as filelike_obj:
            for event, elem in et.iterparse(filelike_obj, ('start', 'end')):
                res_iterparse = elem.tag
                break
    I.append(  clock()-te)


    RE11 = '(?<=</)[^ >]+(?= *>)(?!.*</[^>]+>)' # with assertions   # ^
    te = clock()
    for i in xrange (n):
        with open('xml_example.xml') as f:
            f.seek(-200,2)
            xml_text = f.read()
            xml_text_noc = re.sub('(<!--.*?-->|[\n\r\t])','', xml_text,flags=re.DOTALL)
            m  = re.search(RE11, xml_text_noc,re.DOTALL)
            res_eyq11 = m.group() if m else "FAIL"
    A.append(  clock()-te)


    RE12 = '</([^ >]+) *>(?!.*</[^>]+>)'  # with group(1)   # ^
    te = clock()
    for i in xrange (n):
        with open('xml_example.xml') as f:
            f.seek(-200,2)
            xml_text = f.read()
            xml_text_noc = re.sub('(<!--.*?-->|[\n\r\t])','', xml_text,flags=re.DOTALL)
            m  = re.search(RE12, xml_text_noc,re.DOTALL)
            res_eyq12 = m.group(1) if m else "FAIL"
    B.append(  clock()-te)


    RE13 = '</[^ >]+ *>(?!.*</[^>]+>)' # without group(1)   # ^
    te = clock()
    for i in xrange (n):
        with open('xml_example.xml') as f:
            f.seek(-200,2)
            xml_text = f.read()
            xml_text_noc = re.sub('(<!--.*?-->|[\n\r\t])','', xml_text,flags=re.DOTALL)
            m  = re.search(RE13, xml_text_noc,re.DOTALL)
            res_eyq13 = m.group()[2:-1] if m else "FAIL"
    C.append(  clock()-te)



    RE14 = '(?<=</)[^ \n\r\t>]+(?=[ \n\r\t]*>)(?!.*</[^>]+>)' # with assertions  # ^
    te = clock()
    for i in xrange (n):
        with open('xml_example.xml') as f:
            f.seek(-200,2)
            xml_text = f.read()
            xml_text_noc = re.sub('<!--.*?-->','', xml_text,flags=re.DOTALL)
            m  = re.search(RE14, xml_text_noc,re.DOTALL)
            res_eyq14 = m.group() if m else "FAIL"
    D.append(  clock()-te)


    RE15 = '</([^ \n\r\t>]+)[ \n\r\t]*>(?!.*</[^>]+>)'  # with group(1)   # <
    te = clock()
    for i in xrange (n):
        with open('xml_example.xml') as f:
            f.seek(-200,2)
            xml_text = f.read()
            xml_text_noc = re.sub('<!--.*?-->','', xml_text,flags=re.DOTALL)
            m  = re.search(RE15, xml_text_noc,re.DOTALL)
            res_eyq15 = m.group(1) if m else "FAIL"
    E.append(  clock()-te)


    RE16 = '</[^ \n\r\t>]+[ \n\r\t]*>(?!.*</[^>]+>)' # without group(1)   # <
    te = clock()
    for i in xrange (n):
        with open('xml_example.xml') as f:
            f.seek(-200,2)
            xml_text = f.read()
            xml_text_noc = re.sub('<!--.*?-->','', xml_text,flags=re.DOTALL)
            m  = re.search(RE16, xml_text_noc,re.DOTALL)
            res_eyq16 = m.group()[2:-1].rstrip() if m else "FAIL"
    F.append(  clock()-te)


print "***      parse:  " + res_parse, '  parse'
print "***  iterparse:  " + res_iterparse, '  iterparse'
print
print "***  eyquem 11:  " + repr(res_eyq11)
print "***  eyquem 12:  " + repr(res_eyq12)
print "***  eyquem 13:  " + repr(res_eyq13)
print "***  eyquem 14:  " + repr(res_eyq14)
print "***  eyquem 15:  " + repr(res_eyq15)
print "***  eyquem 16:  " + repr(res_eyq16)

print
print str(min(P))
print str(min(I))
print
print '\n'.join(str(u) for u in map(min,(A,B,C)))
print
print '\n'.join(str(u) for u in map(min,(D,E,F)))
</code></pre>
<p><span style="background-color:yellow;">Result</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>length of XML text in a file :  22548 

***      parse:  {http://www.w3.org/XSL/Transform/1.0}stylesheet   parse
***  iterparse:  {http://www.w3.org/XSL/Transform/1.0}stylesheet   iterparse

***  eyquem 11:  'stylesheet'
***  eyquem 12:  'stylesheet'
***  eyquem 13:  'stylesheet'
***  eyquem 14:  'stylesheet'
***  eyquem 15:  'stylesheet'
***  eyquem 16:  'stylesheet'

0.220554691169
0.172240771802

0.0273236743636
0.0266525536625
0.0265308269626

0.0246300539733
0.0241203758299
0.0238024015203
</code></pre>
<p>. </p>
<p>. </p>
<p><span style="background-color:yellow;">Considering</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">unsophisticated</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">Aereal</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">care</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">end-tag</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">root</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">possible</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">r</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">t</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">instead</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">its</span> <span style="background-color:yellow;">name</span> <span style="background-color:yellow;">alone</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">So</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">best</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">opinion</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def get_root_tag_from_xml_file(xml_file_path):
    with open(xml_file_path) as f:
        try:      f.seek(-200,2)
        except:   f.seek(0,0)
        finally:  xml_text_noc = re.sub('<!--.*?-->','', f.read(), flags= re.DOTALL)
        try:
            return re.search('</[^>]+>(?!.*</[^>]+>)' , xml_text_noc, re.DOTALL).group()
        except :
            return 'FAIL'
</code></pre>
<p><span style="background-color:yellow;">Thanks</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">expertise</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">John</span> <span style="background-color:yellow;">Machin</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">reliable</span> <span style="background-color:yellow;">job</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">previous</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">addition</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">answers</span> <span style="background-color:yellow;">exactly</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">demand</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">expressed</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">parsing</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">hence</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">implicitly</span> <span style="background-color:yellow;">aimed</span> <span style="background-color:yellow;">at</span> . </p>
<p>. </p>
<p><span style="background-color:yellow;">John</span> <span style="background-color:yellow;">Machin</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">new</span> <span style="background-color:yellow;">tricky</span> <span style="background-color:yellow;">feature</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">XML</span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">invalidate</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">solution</span> ? </p>
<br />