<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-133886</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Simple</span> <span style="background-color:yellow;">regex-based</span> <span style="background-color:yellow;">lexer</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> </h2><p><span style="background-color:yellow;">Lexical</span> <span style="background-color:yellow;">analyzers</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">quite</span> <span style="background-color:yellow;">easy</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">write</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">regexes.</span> <span style="background-color:yellow;">Today</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wanted</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">write</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">general</span> <span style="background-color:yellow;">analyzer</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">came</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import re
import sys

class Token(object):
    """ A simple Token structure.
        Contains the token type, value and position. 
    """
    def __init__(self, type, val, pos):
        self.type = type
        self.val = val
        self.pos = pos

    def __str__(self):
        return '%s(%s) at %s' % (self.type, self.val, self.pos)


class LexerError(Exception):
    """ Lexer error exception.

        pos:
            Position in the input line where the error occurred.
    """
    def __init__(self, pos):
        self.pos = pos


class Lexer(object):
    """ A simple regex-based lexer/tokenizer.

        See below for an example of usage.
    """
    def __init__(self, rules, skip_whitespace=True):
        """ Create a lexer.

            rules:
                A list of rules. Each rule is a `regex, type`
                pair, where `regex` is the regular expression used
                to recognize the token and `type` is the type
                of the token to return when it's recognized.

            skip_whitespace:
                If True, whitespace (\s+) will be skipped and not
                reported by the lexer. Otherwise, you have to 
                specify your rules for whitespace, or it will be
                flagged as an error.
        """
        self.rules = []

        for regex, type in rules:
            self.rules.append((re.compile(regex), type))

        self.skip_whitespace = skip_whitespace
        self.re_ws_skip = re.compile('\S')

    def input(self, buf):
        """ Initialize the lexer with a buffer as input.
        """
        self.buf = buf
        self.pos = 0

    def token(self):
        """ Return the next token (a Token object) found in the 
            input buffer. None is returned if the end of the 
            buffer was reached. 
            In case of a lexing error (the current chunk of the
            buffer matches no rule), a LexerError is raised with
            the position of the error.
        """
        if self.pos >= len(self.buf):
            return None
        else:
            if self.skip_whitespace:
                m = self.re_ws_skip.search(self.buf[self.pos:])

                if m:
                    self.pos += m.start()
                else:
                    return None

            for token_regex, token_type in self.rules:
                m = token_regex.match(self.buf[self.pos:])

                if m:
                    value = self.buf[self.pos + m.start():self.pos + m.end()]
                    tok = Token(token_type, value, self.pos)
                    self.pos += m.end()
                    return tok

            # if we're here, no rule matched
            raise LexerError(self.pos)

    def tokens(self):
        """ Returns an iterator to the tokens found in the buffer.
        """
        while 1:
            tok = self.token()
            if tok is None: break
            yield tok


if __name__ == '__main__':
    rules = [
        ('\d+',             'NUMBER'),
        ('[a-zA-Z_]\w+',    'IDENTIFIER'),
        ('\+',              'PLUS'),
        ('\-',              'MINUS'),
        ('\*',              'MULTIPLY'),
        ('\/',              'DIVIDE'),
        ('\(',              'LP'),
        ('\)',              'RP'),
        ('=',               'EQUALS'),
    ]

    lx = Lexer(rules, skip_whitespace=True)
    lx.input('erw = _abc + 12*(R4-623902)  ')

    try:
        for tok in lx.tokens():
            print tok
    except LexerError, err:
        print 'LexerError at position', err.pos
</code></pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">fine</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">worried</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">too</span> <span style="background-color:yellow;">inefficient.</span> <span style="background-color:yellow;">Are</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">tricks</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">allow</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">write</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">efficient</span> <span style="background-color:yellow;">/</span> <span style="background-color:yellow;">elegant</span> <span style="background-color:yellow;">way</span> ? </p>
<p><span style="background-color:yellow;">Specifically</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">avoid</span> <span style="background-color:yellow;">looping</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">rules</span> <span style="background-color:yellow;">linearly</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">fits</span> ? </p>
<p><span style="background-color:yellow;">Thanks</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">advance</span> </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-6</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">merge</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">regexes</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">|</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">operator</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">let</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">library</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">discerning</span> <span style="background-color:yellow;">between</span> <span style="background-color:yellow;">tokens.</span> <span style="background-color:yellow;">Some</span> <span style="background-color:yellow;">care</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">taken</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">ensure</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">preference</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">tokens</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">avoid</span> <span style="background-color:yellow;">matching</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">keyword</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">identifier</span> <span style="background-color:yellow;"></span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">possible</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">combining</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">token</span> <span style="background-color:yellow;">regexes</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'d</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">benchmark</span> <span style="background-color:yellow;">it.</span> <span style="background-color:yellow;">Something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>x = re.compile('(?P<NUMBER>[0-9]+)|(?P<VAR>[a-z]+)')
a = x.match('9999').groupdict() # => {'VAR': None, 'NUMBER': '9999'}
if a:
    token = [a for a in a.items() if a[1] != None][0]
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">filter</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">where</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">benchmarking..</span> . </p>
<p><span style="background-color:yellow;">Update</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">tested</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">combine</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tokens</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">stated</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">write</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def find_token(lst):
    for tok in lst:
        if tok[1] != None: return tok
    raise Exception
</code></pre>
<p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">roughly</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">maybe</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">teensy</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">this.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">believe</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">speedup</span> <span style="background-color:yellow;">must</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">calls</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">match</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">loop</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">token</span> <span style="background-color:yellow;">discrimination</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">still</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">course</span> <span style="background-color:yellow;">kills</span> <span style="background-color:yellow;">it</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">re.match</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">anchored.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">give</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">position</span> <span style="background-color:yellow;">argument</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>pos = 0
end = len(text)
while pos < end:
    match = regexp.match(text, pos)
    # do something with your match
    pos = match.end()
</code></pre>
<p><span style="background-color:yellow;">Have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">look</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">pygments</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">ships</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">shitload</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">lexers</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">syntax</span> <span style="background-color:yellow;">highlighting</span> <span style="background-color:yellow;">purposes</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">different</span> <span style="background-color:yellow;">implementations</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">most</span> <span style="background-color:yellow;">based</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">regular</span> <span style="background-color:yellow;">expressions</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">exactly</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">direct</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">question</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">might</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">look</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">ANTLR</span> . <span style="background-color:yellow;">According</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">document</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">generation</span> <span style="background-color:yellow;">target</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">date</span> . </p>
<p><span style="background-color:yellow;">As</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">regexes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">ways</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">go</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">speeding</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">sticking</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">regexes.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">order</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">regexes</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">order</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">probability</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">finding</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">default</span> <span style="background-color:yellow;">text.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">figure</span> <span style="background-color:yellow;">adding</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">profiler</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">collected</span> <span style="background-color:yellow;">token</span> <span style="background-color:yellow;">counts</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">token</span> <span style="background-color:yellow;">type</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">running</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">lexer</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">body</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">work.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">bucket</span> <span style="background-color:yellow;">sort</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">regexes</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">space</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">character</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">relatively</span> <span style="background-color:yellow;">small</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">perform</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">needed</span> <span style="background-color:yellow;">regexes</span> <span style="background-color:yellow;">after</span> <span style="background-color:yellow;">performing</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">discrimination</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">character</span> . </p>
<p><span style="background-color:yellow;">However</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">going</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">go</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">route</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">try</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">ANTLR</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">easier</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">maintain</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">less</span> <span style="background-color:yellow;">likely</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">bugs</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">these</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">worth</span> <span style="background-color:yellow;">looking</span> <span style="background-color:yellow;">at..</span> . </p>
<p><span style="background-color:yellow;">python</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">pyparsing</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">pyparsing.wikispaces.com</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">allows</span> <span style="background-color:yellow;">specifying</span> <span style="background-color:yellow;">grammar</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">parse</span> <span style="background-color:yellow;">text.</span> <span style="background-color:yellow;">Douglas</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">thanks</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">post</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">ANTLR</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">heard</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">it.</span> <span style="background-color:yellow;">Also</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">PLY</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">python2</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">python3</span> <span style="background-color:yellow;">compatible</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">lex/yacc</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">written</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">ad-hoc</span> <span style="background-color:yellow;">regex-based</span> <span style="background-color:yellow;">parser</span> <span style="background-color:yellow;">myself</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">later</span> <span style="background-color:yellow;">realized</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">might</span> <span style="background-color:yellow;">benefit</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">mature</span> <span style="background-color:yellow;">parsing</span> <span style="background-color:yellow;">tool</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">learning</span> <span style="background-color:yellow;">concepts</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">context</span> <span style="background-color:yellow;">independent</span> <span style="background-color:yellow;">grammar</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">etc</span> . </p>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">advantage</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">grammar</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">parsing</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">easily</span> <span style="background-color:yellow;">modify</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">rules</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">formalize</span> <span style="background-color:yellow;">quite</span> <span style="background-color:yellow;">complex</span> <span style="background-color:yellow;">syntax</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">whatever</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">parsing</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">suggest</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">re.Scanner</span> <span style="background-color:yellow;">class</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">documented</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">standard</span> <span style="background-color:yellow;">library</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">well</span> <span style="background-color:yellow;">worth</span> <span style="background-color:yellow;">using.</span> <span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import re

scanner = re.Scanner([
    (r"-?[0-9]+\.[0-9]+([eE]-?[0-9]+)?", lambda scanner, token: float(token)),
    (r"-?[0-9]+", lambda scanner, token: int(token)),
    (r" +", lambda scanner, token: None),
])

>>> scanner.scan("0 -1 4.5 7.8e3")[0]
[0, -1, 4.5, 7800.0]
</code></pre>
<br />