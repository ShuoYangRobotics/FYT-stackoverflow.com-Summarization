<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-2255177</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Finding</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">exponent</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">x</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">bitwise</span> <span style="background-color:yellow;">operations</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">logarithm</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">base</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">]</span> </h2><p><span style="background-color:yellow;">Is</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">straightforward</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">extracting</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">exponent</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">power</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">bitwise</span> <span style="background-color:yellow;">operations</span> <span style="background-color:yellow;">only</span> ? </p>
<p><span style="background-color:yellow;">EDIT</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">Although</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">question</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">originally</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">bitwise</span> <span style="background-color:yellow;">operations</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">thread</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">good</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">wondering</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">What</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">X</span> <span style="background-color:yellow;">given</span> <span style="background-color:yellow;">Y</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">X</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> ? <span style="background-color:yellow;">"</span> </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">currently</span> <span style="background-color:yellow;">trying</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">optimize</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">routine</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Rabin-Miller</span> <span style="background-color:yellow;">primality</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">reduces</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">N</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">forms</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">s</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">d</span> . <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">s</span> <span style="background-color:yellow;">part</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>two_power_s = N & -N
</code></pre>
<p><span style="background-color:yellow;">but</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">ca</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">extract</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">s</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bitwise</span> <span style="background-color:yellow;">operation.</span> <span style="background-color:yellow;">Workarounds</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">currently</span> <span style="background-color:yellow;">testing</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">too</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">satisfaction</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">pretty</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">slow</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">:</span> </p>
<ul><span style="background-color:yellow;">using</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">logarithm</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">manipulating</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">binary</span> <span style="background-color:yellow;">representation</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">s</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">i.e.</span> <span style="background-color:yellow;">counting</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">trailing</span> <span style="background-color:yellow;">zeroes</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">looping</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">division</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">until</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">result</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">1</span> </ul>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">question</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">language</span> <span style="background-color:yellow;">agnostic</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">suppose</span> . </p>
<p><span style="background-color:yellow;">Thank</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">advance</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">time</span> . </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-7</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">"</span> <span style="background-color:yellow;">language</span> <span style="background-color:yellow;">agnostic</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">worrying</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">performance</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">pretty</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">incompatible</span> <span style="background-color:yellow;">concepts</span> . </p>
<p><span style="background-color:yellow;">Most</span> <span style="background-color:yellow;">modern</span> <span style="background-color:yellow;">processors</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">CLZ</span> <span style="background-color:yellow;">instruction</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">count</span> <span style="background-color:yellow;">leading</span> <span style="background-color:yellow;">zeros</span> <span style="background-color:yellow;">"</span> . <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">GCC</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">__builtin_clz</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">x</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">produces</span> <span style="background-color:yellow;">reasonable</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">targets</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">lack</span> <span style="background-color:yellow;">clz</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">Note</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">CLZ</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">undefined</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">zero</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">extra</span> <span style="background-color:yellow;">branch</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">catch</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">matters</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">application</span> . </p>
<p><span style="background-color:yellow;">In</span> <span style="background-color:yellow;">CELT</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">http</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">//celt-codec.org</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">branchless</span> <span style="background-color:yellow;">CLZ</span> <span style="background-color:yellow;">we</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">compliers</span> <span style="background-color:yellow;">lacking</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">CLZ</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">written</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">Timothy</span> <span style="background-color:yellow;">B.</span> <span style="background-color:yellow;">Terriberry</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>
int ilog(uint32 _v){
  int ret;
  int m;
  ret=!!_v;
  m=!!(_v&0xFFFF0000)<<4;
  _v>>=m;
  ret|=m;
  m=!!(_v&0xFF00)<<3;
  _v>>=m;
  ret|=m;
  m=!!(_v&0xF0)<<2;
  _v>>=m;
  ret|=m;
  m=!!(_v&0xC)<<1;
  _v>>=m;
  ret|=m;
  ret+=!!(_v&0x2);
  return ret;
}
</code></pre>
<p><span style="background-color:yellow;"></span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">comments</span> <span style="background-color:yellow;">indicate</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">branching</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lookup</span> <span style="background-color:yellow;">table</span> <span style="background-color:yellow;">based</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">But</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">performance</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">critical</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">probably</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">implementing</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">part</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">python</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">There</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">page</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">these</span> <span style="background-color:yellow;">types</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">tricks</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">hacks.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">written</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">C</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">many</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">too</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">performance</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">obviously</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">different</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">onwards</span> . </p>
<p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">try</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>register unsigned int r = 0; // result of log2(v) will go here
for (i = 4; i >= 0; i--) // unroll for speed...
{
  if (v & b[i])
  {
    v >>= S[i];
    r |= S[i];
  } 
}
</code></pre>
<p><span style="background-color:yellow;">That</span> <span style="background-color:yellow;">looks</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">converted</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">quite</span> <span style="background-color:yellow;">easily</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">O</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">lg</span> <span style="background-color:yellow;">s</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">arbitrary</span> <span style="background-color:yellow;">length</span> <span style="background-color:yellow;">integers</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">binsearch</span> . </p>
<pre><code>import sys
def floorlg(n):
    if n < 1:
        return -1
    low=0
    high=sys.getsizeof(n)*8 # not the best upper-bound guesstimate, but...
    while True:
        mid = (low+high)//2
        i = n >> mid
        if i == 1:
            return mid
        if i == 0:
            high = mid-1
        else:
            low = mid+1
</code></pre>
<p><span style="background-color:yellow;">For</span> <span style="background-color:yellow;">fixed</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">integers</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lookup</span> <span style="background-color:yellow;">table</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">probably</span> <span style="background-color:yellow;">best</span> <span style="background-color:yellow;">overall</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><h1><span style="background-color:yellow;">Short</span> <span style="background-color:yellow;">answer</span> </h1>
<p><span style="background-color:yellow;">As</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">concerned</span> <span style="background-color:yellow;">:</span> </p>
<ul><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">exponent</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">x</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">looking</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">whose</span> <span style="background-color:yellow;">hashes</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">powers</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">hashlookup</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">bitwise</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">called</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">unrolled_bitwise</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">"</span> . <span style="background-color:yellow;">Both</span> <span style="background-color:yellow;">previous</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">well-defined</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">extensible</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">upper</span> <span style="background-color:yellow;">limits.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">hard-coded</span> <span style="background-color:yellow;">upper</span> <span style="background-color:yellow;">limits</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">scales</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">handle</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">log_e</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">"</span> . </ul>
<h1><span style="background-color:yellow;">Preliminary</span> <span style="background-color:yellow;">notes</span> </h1>
<ol><span style="background-color:yellow;">All</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">measurements</span> <span style="background-color:yellow;">below</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">been</span> <span style="background-color:yellow;">obtained</span> <span style="background-color:yellow;">via</span> <span style="background-color:yellow;">timeit.Timer.repeat</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">testn</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">cycles</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">where</span> <span style="background-color:yellow;">testn</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">set</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">cycles</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">automatically</span> <span style="background-color:yellow;">adjusted</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">script</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">obtain</span> <span style="background-color:yellow;">times</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">range</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">note</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bug</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">auto-adjusting</span> <span style="background-color:yellow;">mechanism</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">been</span> <span style="background-color:yellow;">fixed</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">18/02/2010</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">Not</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">scale</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">why</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">did</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">functions</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">various</span> <span style="background-color:yellow;">powers</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">did</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">manage</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">proposed</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">returns</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">wrong</span> <span style="background-color:yellow;">result</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">did</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">yet</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">tiem</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">step-by-step</span> <span style="background-color:yellow;">debugging</span> <span style="background-color:yellow;">session</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">included</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">commented</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">somebody</span> <span style="background-color:yellow;">spots</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">mistake</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">inspection</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">perform</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">debug</span> <span style="background-color:yellow;">themselves</span> <span style="background-color:yellow;"></span> </ol>
<h1><span style="background-color:yellow;">Results</span> </h1>
<p><span style="background-color:yellow;">func</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">5</span> <span style="background-color:yellow;"></span> </p>
<pre><code>hashlookup:          0.13s     100%
lookup:              0.15s     109%
stringcount:         0.29s     220%
unrolled_bitwise:    0.36s     272%
log_e:               0.60s     450%
bitcounter:          0.64s     479%
log_2:               0.69s     515%
ilog:                0.81s     609%
bitwise:             1.10s     821%
olgn:                1.42s    1065%
</code></pre>
<p><span style="background-color:yellow;">func</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">31</span> <span style="background-color:yellow;"></span> </p>
<pre><code>hashlookup:          0.11s     100%
unrolled_bitwise:    0.26s     229%
log_e:               0.30s     268%
stringcount:         0.30s     270%
log_2:               0.34s     301%
ilog:                0.41s     363%
bitwise:             0.87s     778%
olgn:                1.02s     912%
bitcounter:          1.42s    1264%
</code></pre>
<p><span style="background-color:yellow;">func</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">128</span> <span style="background-color:yellow;"></span> </p>
<pre><code>hashlookup:     0.01s     100%
stringcount:    0.03s     264%
log_e:          0.04s     315%
log_2:          0.04s     383%
olgn:           0.18s    1585%
bitcounter:     1.41s   12393%
</code></pre>
<p><span style="background-color:yellow;">func</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">1024</span> <span style="background-color:yellow;"></span> </p>
<pre><code>log_e:          0.00s     100%
log_2:          0.01s     118%
stringcount:    0.02s     354%
olgn:           0.03s     707%
bitcounter:     1.73s   37695%
</code></pre>
<h1><span style="background-color:yellow;">Code</span> </h1>
<pre><code>import math, sys

def stringcount(v):
    """mac"""    
    return len(bin(v)) - 3

def log_2(v):
    """mac"""    
    return int(round(math.log(v, 2), 0)) # 2**101 generates 100.999999999

def log_e(v):
    """bp on mac"""    
    return int(round(math.log(v)/0.69314718055994529, 0))  # 0.69 == log(2)

def bitcounter(v):
    """John Y on mac"""
    r = 0
    while v > 1 :
        v >>= 1
        r += 1
    return r

def olgn(n) :
    """outis"""
    if n < 1:
        return -1
    low = 0
    high = sys.getsizeof(n)*8 # not the best upper-bound guesstimate, but...
    while True:
        mid = (low+high)//2
        i = n >> mid
        if i == 1:
            return mid
        if i == 0:
            high = mid-1
        else:
            low = mid+1

def hashlookup(v):
    """mac on brone -- limit: v < 2**131"""
#    def prepareTable(max_log2=130) :
#        hash_table = {}
#        for p in range(1, max_log2) :
#            hash_table[2**p] = p
#        return hash_table

    global hash_table
    return hash_table[v] 

def lookup(v):
    """brone -- limit: v < 2**11"""
#    def prepareTable(max_log2=10) :
#        log2s_table=[0]*((1<<max_log2)+1)
#        for i in range(max_log2+1):
#            log2s_table[1<<i]=i
#        return tuple(log2s_table)

    global log2s_table
    return log2s_table[v]

def bitwise(v):
    """Mark Byers -- limit: v < 2**32"""
    b = (0x2, 0xC, 0xF0, 0xFF00, 0xFFFF0000)
    S = (1, 2, 4, 8, 16)
    r = 0
    for i in range(4, -1, -1) :
        if (v & b[i]) :
            v >>= S[i];
            r |= S[i];
    return r

def unrolled_bitwise(v):
    """x4u on Mark Byers -- limit:   v < 2**33"""
    r = 0;
    if v > 0xffff : 
        v >>= 16
        r = 16;
    if v > 0x00ff :
        v >>=  8
        r += 8;
    if v > 0x000f :
        v >>=  4
        r += 4;
    if v > 0x0003 : 
        v >>=  2
        r += 2;
    return r + (v >> 1)

def ilog(v):
    """Gregory Maxwell - (Original code: B. Terriberry) -- limit: v < 2**32"""
    ret = 1
    m = (not not v & 0xFFFF0000) << 4;
    v >>= m;
    ret |= m;
    m = (not not v & 0xFF00) << 3;
    v >>= m;
    ret |= m;
    m = (not not v & 0xF0) << 2;
    v >>= m;
    ret |= m;
    m = (not not v & 0xC) << 1;
    v >>= m;
    ret |= m;
    ret += (not not v & 0x2);
    return ret - 1;


# following table is equal to "return hashlookup.prepareTable()" 
hash_table = {...} # numbers have been cut out to avoid cluttering the post

# following table is equal to "return lookup.prepareTable()" - cached for speed
log2s_table = (...) # numbers have been cut out to avoid cluttering the post
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">Convert</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">power</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">hexadecimal</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">e.g.</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">%</span> <span style="background-color:yellow;">x</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">formatting</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">count</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">digits</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">adjust</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">digit</span> . </p>
<p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">computes</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bitlength</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">integer</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">return</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">actually</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">e.g.</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">100</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bitlength</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">101</span> <span style="background-color:yellow;"></span> . </p>
<pre><code>def nbits(n, correction = {
        '0': 4, '1': 3, '2': 2, '3': 2,
        '4': 1, '5': 1, '6': 1, '7': 1,
        '8': 0, '9': 0, 'a': 0, 'b': 0,
        'c': 0, 'd': 0, 'e': 0, 'f': 0}):
    """Number of bits in binary representation of the positive integer n,
    or 0 if n == 0.
    """
    if n < 0:
        raise ValueError("The argument to nbits should be nonnegative.")
    hex_n = "%x" % n
    return 4*len(hex_n) - correction[hex_n[0]]
</code></pre>
<p><span style="background-color:yellow;">In</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">3.1</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">2.7</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">appears</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit_length</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">integers</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">thing</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">range</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">known.</span> <span style="background-color:yellow;">Let</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">assume</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">goes</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">1&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">20</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">interesting</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>max_log2=20
</code></pre>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">effect</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">maps</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">integer</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">its</span> <span style="background-color:yellow;">base</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">logarithm.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">trick</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>log2s_table=[0]*((1<<max_log2)+1)
for i in range(max_log2+1):
    log2s_table[1<<i]=i
</code></pre>
<p><span style="background-color:yellow;"></span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">anything</span> <span style="background-color:yellow;">useful</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">powers</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">problem</span> <span style="background-color:yellow;">statement</span> <span style="background-color:yellow;">suggests</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">handled.</span> <span style="background-color:yellow;">Would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">easy</span> <span style="background-color:yellow;">enough</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">fix</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">though.</span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">logarithm</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">easily</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">inlined</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def table(v):
    return log2s_table[v]
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">ca</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">guarantee</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wrote</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">exactly</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">timings</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">rather</span> <span style="background-color:yellow;">quicker</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">stringcount</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>stringcount: 0.43 s.
table: 0.16 s.
</code></pre>
<p><span style="background-color:yellow;">Since</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">table</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">less</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">256</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wondered</span> <span style="background-color:yellow;">whether</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">instead</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">quicker</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">maybe</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">array.array</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">bytes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">dice</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>string: 0.25 s.
arr: 0.21 s.
</code></pre>
<p><span style="background-color:yellow;">Using</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">lookup</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">another</span> <span style="background-color:yellow;">possibility</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">taking</span> <span style="background-color:yellow;">advantage</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">powers</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">checked</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>log2s_map=dict([(1<<x,x) for x in range(max_log2+1)])

def map(v):
    return log2s_map[v]
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">results</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">were</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">good</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>map: 0.20 s.
</code></pre>
<p><span style="background-color:yellow;">And</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">fun</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">hex</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">float</span> <span style="background-color:yellow;">objects</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">includes</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">its</span> <span style="background-color:yellow;">last</span> <span style="background-color:yellow;">part</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">base</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">exponent</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">number.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">slow</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">extract</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">general</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">exponent</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">ever</span> <span style="background-color:yellow;">going</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">digit</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">done</span> <span style="background-color:yellow;">straightforwardly</span> <span style="background-color:yellow;">enough</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def floathex(v):
    return ord(float(v).hex()[-1])-48
</code></pre>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">purely</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">entertainment</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">uncompetetive</span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">amazingly</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">still</span> <span style="background-color:yellow;">quicker</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bitwise</span> <span style="background-color:yellow;">approach</span> . </p>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">looks</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">go</span> . </p>
<p><span style="background-color:yellow;"></span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">approach</span> <span style="background-color:yellow;">wo</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">scale</span> <span style="background-color:yellow;">indefinitely</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">due</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">limited</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">execution</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">wo</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">depend</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">max_log2</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">input</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">notice</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">running</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">code.</span> <span style="background-color:yellow;">Regarding</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">consumption</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">remember</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">internals</span> <span style="background-color:yellow;">correctly</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">table</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">take</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">1&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">max_log2</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">4</span> <span style="background-color:yellow;">bytes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">contents</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">small</span> <span style="background-color:yellow;">integers</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">interpreter</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">intern</span> <span style="background-color:yellow;">automatically.</span> <span style="background-color:yellow;">SO</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">max_log2</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">20</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">4MB.</span> <span style="background-color:yellow;"></span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">actually</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">comment</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">performance</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;">posted</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">mac.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">post</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">proper</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">formatting</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">indenting</span> </p>
<p><span style="background-color:yellow;">mac</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">try</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">unrolled</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bitseach</span> <span style="background-color:yellow;">suggested</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">Mark</span> <span style="background-color:yellow;">Byers</span> ? <span style="background-color:yellow;">Maybe</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">access</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">slows</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">down.</span> <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">theory</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">approach</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">others</span> . </p>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">look</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">although</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">sure</span> <span style="background-color:yellow;">whether</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">formatting</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">right</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">guess</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">supposed</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> . </p>
<pre><code>def bitwise(v):
    r = 0;
    if( v > 0xffff ) : v >>= 16; r = 16;
    if( v > 0x00ff ) : v >>=  8; r += 8;
    if( v > 0x000f ) : v >>=  4; r += 4;
    if( v > 0x0003 ) : v >>=  2; r += 2;
    return r + ( v >> 1 );
</code></pre>
<p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">shares</span> <span style="background-color:yellow;">java</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">lack</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">unsingned</span> <span style="background-color:yellow;">integers</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def bitwise(v):
    r = 0;
    if( v & 0xffff0000 ) : v >>>= 16; r = 16;
    if( v > 0x00ff ) : v >>=  8; r += 8;
    if( v > 0x000f ) : v >>=  4; r += 4;
    if( v > 0x0003 ) : v >>=  2; r += 2;
    return r + ( v >> 1 );
</code></pre>
<br />