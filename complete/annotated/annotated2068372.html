<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-2068372</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Fastest</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">below</span> <span style="background-color:yellow;">N</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">python</span> </h2><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">best</span> <span style="background-color:yellow;">algorithm</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">come</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">after</span> <span style="background-color:yellow;">struggling</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">couple</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">Project</span> <span style="background-color:yellow;">Euler</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">questions</span> . </p>
<pre><code>def get_primes(n):
    numbers = set(range(n, 1, -1))
    primes = []
    while numbers:
        p = numbers.pop()
        primes.append(p)
        numbers.difference_update(set(range(p*2, n+1, p)))
    return primes

>>> timeit.Timer(stmt='get_primes.get_primes(1000000)', setup='import   get_primes').timeit(1)
1.1499958793645562
</code></pre>
<p><span style="background-color:yellow;">Can</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">made</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">faster</span> ? </p>
<hr />
<p><span style="background-color:yellow;">EDIT</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">flaw</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">Since</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">unordered</span> <span style="background-color:yellow;">set</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">guarantee</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">numbers.pop</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">remove</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">lowest</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">set.</span> <span style="background-color:yellow;">Nevertheless</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">least</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">input</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>> sum(get_primes(2000000))
142913828922L
#That's the correct sum of all numbers below 2 million
>>> 529 in get_primes(1000)
False
>>> 529 in get_primes(530)
True
</code></pre>
<hr />
<p><span style="background-color:yellow;">EDIT</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">rank</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">pure</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">external</span> <span style="background-color:yellow;">sources</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">below</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">million</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<ol><span style="background-color:yellow;">Sundaram</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">Sieve</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">myself</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">327ms</span> <span style="background-color:yellow;">Daniel</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">Sieve</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">435ms</span> <span style="background-color:yellow;">Alex</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">recipe</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">Cookbok</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">710ms</span> </ol>
<hr />
<p><span style="background-color:yellow;">EDIT</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">~</span> <span style="background-color:yellow;">unutbu</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">leading</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">race</span> . </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-17</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">Warning</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">timeit</span> <span style="background-color:yellow;">results</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">vary</span> <span style="background-color:yellow;">due</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">differences</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">hardware</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">Python</span> . </p>
<p><span style="background-color:yellow;">Below</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">script</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">compares</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">implementations</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">ambi_sieve_plain</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">rwh_primes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">rwh_primes1</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">rwh_primes2</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">sieveOfAtkin</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">sieveOfEratosthenes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">sundaram3</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">sieve_wheel_30</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">ambi_sieve</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">requires</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">primesfrom3to</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">requires</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">primesfrom2to</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">requires</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">Many</span> <span style="background-color:yellow;">thanks</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">stephan</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">bringing</span> <span style="background-color:yellow;">sieve_wheel_30</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">attention</span> . <span style="background-color:yellow;">Credit</span> <span style="background-color:yellow;">goes</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">Robert</span> <span style="background-color:yellow;">William</span> <span style="background-color:yellow;">Hanks</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">primesfrom2to</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">primesfrom3to</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">rwh_primes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">rwh_primes1</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">rwh_primes2</span> . </p>
<p><span style="background-color:yellow;">Of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">plain</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">tested</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">psyco</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">1000000</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">rwh_primes1</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">tested</span> . </p>
<pre><code>+---------------------+-------+
| Method              | ms    |
+---------------------+-------+
| rwh_primes1         | 43.0  |
| sieveOfAtkin        | 46.4  |
| rwh_primes          | 57.4  |
| sieve_wheel_30      | 63.0  |
| rwh_primes2         | 67.8  |    
| sieveOfEratosthenes | 147.0 |
| ambi_sieve_plain    | 152.0 |
| sundaram3           | 194.0 |
+---------------------+-------+
</code></pre>
<p><span style="background-color:yellow;">Of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">plain</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">tested</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">psyco</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">1000000</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">rwh_primes2</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> . </p>
<pre><code>+---------------------+-------+
| Method              | ms    |
+---------------------+-------+
| rwh_primes2         | 68.1  |
| rwh_primes1         | 93.7  |
| rwh_primes          | 94.6  |
| sieve_wheel_30      | 97.4  |
| sieveOfEratosthenes | 178.0 |
| ambi_sieve_plain    | 286.0 |
| sieveOfAtkin        | 314.0 |
| sundaram3           | 416.0 |
+---------------------+-------+
</code></pre>
<p><span style="background-color:yellow;">Of</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">tested</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">allowing</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">1000000</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">primesfrom2to</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">tested</span> . </p>
<pre><code>+---------------------+-------+
| Method              | ms    |
+---------------------+-------+
| primesfrom2to       | 15.9  |
| primesfrom3to       | 18.4  |
| ambi_sieve          | 29.3  |
+---------------------+-------+
</code></pre>
<p><span style="background-color:yellow;">Timings</span> <span style="background-color:yellow;">were</span> <span style="background-color:yellow;">measured</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">command</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>python -mtimeit -s"import primes" "primes.{method}(10000000)"
</code></pre>
<p><span style="background-color:yellow;">with</span> <span style="background-color:yellow;">{</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">}</span> <span style="background-color:yellow;">replaced</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">names</span> . </p>
<p><span style="background-color:yellow;">primes.py</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>#!/usr/bin/env python
import psyco; psyco.full()
from math import sqrt, ceil
import numpy as np

def rwh_primes(n):
    # http://stackoverflow.com/questions/2068372/fastest-way-to-list-all-primes-below-n-in-python/3035188#3035188
    """ Returns  a list of primes < n """
    sieve = [True] * n
    for i in xrange(3,int(n**0.5)+1,2):
        if sieve[i]:
            sieve[i*i::2*i]=[False]*((n-i*i-1)/(2*i)+1)
    return [2] + [i for i in xrange(3,n,2) if sieve[i]]

def rwh_primes1(n):
    # http://stackoverflow.com/questions/2068372/fastest-way-to-list-all-primes-below-n-in-python/3035188#3035188
    """ Returns  a list of primes < n """
    sieve = [True] * (n/2)
    for i in xrange(3,int(n**0.5)+1,2):
        if sieve[i/2]:
            sieve[i*i/2::i] = [False] * ((n-i*i-1)/(2*i)+1)
    return [2] + [2*i+1 for i in xrange(1,n/2) if sieve[i]]

def rwh_primes2(n):
    # http://stackoverflow.com/questions/2068372/fastest-way-to-list-all-primes-below-n-in-python/3035188#3035188
    """ Input n>=6, Returns a list of primes, 2 <= p < n """
    correction = (n%6>1)
    n = {0:n,1:n-1,2:n+4,3:n+3,4:n+2,5:n+1}[n%6]
    sieve = [True] * (n/3)
    sieve[0] = False
    for i in xrange(int(n**0.5)/3+1):
      if sieve[i]:
        k=3*i+1|1
        sieve[      ((k*k)/3)      ::2*k]=[False]*((n/6-(k*k)/6-1)/k+1)
        sieve[(k*k+4*k-2*k*(i&1))/3::2*k]=[False]*((n/6-(k*k+4*k-2*k*(i&1))/6-1)/k+1)
    return [2,3] + [3*i+1|1 for i in xrange(1,n/3-correction) if sieve[i]]

def sieve_wheel_30(N):
    # http://zerovolt.com/?p=88
    ''' Returns a list of primes <= N using wheel criterion 2*3*5 = 30

Copyright 2009 by zerovolt.com
This code is free for non-commercial purposes, in which case you can just leave this comment as a credit for my work.
If you need this code for commercial purposes, please contact me by sending an email to: info [at] zerovolt [dot] com.'''
    __smallp = ( 2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59,
    61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139,
    149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197, 199, 211, 223, 227,
    229, 233, 239, 241, 251, 257, 263, 269, 271, 277, 281, 283, 293, 307, 311,
    313, 317, 331, 337, 347, 349, 353, 359, 367, 373, 379, 383, 389, 397, 401,
    409, 419, 421, 431, 433, 439, 443, 449, 457, 461, 463, 467, 479, 487, 491,
    499, 503, 509, 521, 523, 541, 547, 557, 563, 569, 571, 577, 587, 593, 599,
    601, 607, 613, 617, 619, 631, 641, 643, 647, 653, 659, 661, 673, 677, 683,
    691, 701, 709, 719, 727, 733, 739, 743, 751, 757, 761, 769, 773, 787, 797,
    809, 811, 821, 823, 827, 829, 839, 853, 857, 859, 863, 877, 881, 883, 887,
    907, 911, 919, 929, 937, 941, 947, 953, 967, 971, 977, 983, 991, 997)

    wheel = (2, 3, 5)
    const = 30
    if N < 2:
        return []
    if N <= const:
        pos = 0
        while __smallp[pos] <= N:
            pos += 1
        return list(__smallp[:pos])
    # make the offsets list
    offsets = (7, 11, 13, 17, 19, 23, 29, 1)
    # prepare the list
    p = [2, 3, 5]
    dim = 2 + N // const
    tk1  = [True] * dim
    tk7  = [True] * dim
    tk11 = [True] * dim
    tk13 = [True] * dim
    tk17 = [True] * dim
    tk19 = [True] * dim
    tk23 = [True] * dim
    tk29 = [True] * dim
    tk1[0] = False
    # help dictionary d
    # d[a , b] = c  ==> if I want to find the smallest useful multiple of (30*pos)+a
    # on tkc, then I need the index given by the product of [(30*pos)+a][(30*pos)+b]
    # in general. If b < a, I need [(30*pos)+a][(30*(pos+1))+b]
    d = {}
    for x in offsets:
        for y in offsets:
            res = (x*y) % const
            if res in offsets:
                d[(x, res)] = y
    # another help dictionary: gives tkx calling tmptk[x]
    tmptk = {1:tk1, 7:tk7, 11:tk11, 13:tk13, 17:tk17, 19:tk19, 23:tk23, 29:tk29}
    pos, prime, lastadded, stop = 0, 0, 0, int(ceil(sqrt(N)))
    # inner functions definition
    def del_mult(tk, start, step):
        for k in xrange(start, len(tk), step):
            tk[k] = False
    # end of inner functions definition
    cpos = const * pos
    while prime < stop:
        # 30k + 7
        if tk7[pos]:
            prime = cpos + 7
            p.append(prime)
            lastadded = 7
            for off in offsets:
                tmp = d[(7, off)]
                start = (pos + prime) if off == 7 else (prime * (const * (pos + 1 if tmp < 7 else 0) + tmp) )//const
                del_mult(tmptk[off], start, prime)
        # 30k + 11
        if tk11[pos]:
            prime = cpos + 11
            p.append(prime)
            lastadded = 11
            for off in offsets:
                tmp = d[(11, off)]
                start = (pos + prime) if off == 11 else (prime * (const * (pos + 1 if tmp < 11 else 0) + tmp) )//const
                del_mult(tmptk[off], start, prime)
        # 30k + 13
        if tk13[pos]:
            prime = cpos + 13
            p.append(prime)
            lastadded = 13
            for off in offsets:
                tmp = d[(13, off)]
                start = (pos + prime) if off == 13 else (prime * (const * (pos + 1 if tmp < 13 else 0) + tmp) )//const
                del_mult(tmptk[off], start, prime)
        # 30k + 17
        if tk17[pos]:
            prime = cpos + 17
            p.append(prime)
            lastadded = 17
            for off in offsets:
                tmp = d[(17, off)]
                start = (pos + prime) if off == 17 else (prime * (const * (pos + 1 if tmp < 17 else 0) + tmp) )//const
                del_mult(tmptk[off], start, prime)
        # 30k + 19
        if tk19[pos]:
            prime = cpos + 19
            p.append(prime)
            lastadded = 19
            for off in offsets:
                tmp = d[(19, off)]
                start = (pos + prime) if off == 19 else (prime * (const * (pos + 1 if tmp < 19 else 0) + tmp) )//const
                del_mult(tmptk[off], start, prime)
        # 30k + 23
        if tk23[pos]:
            prime = cpos + 23
            p.append(prime)
            lastadded = 23
            for off in offsets:
                tmp = d[(23, off)]
                start = (pos + prime) if off == 23 else (prime * (const * (pos + 1 if tmp < 23 else 0) + tmp) )//const
                del_mult(tmptk[off], start, prime)
        # 30k + 29
        if tk29[pos]:
            prime = cpos + 29
            p.append(prime)
            lastadded = 29
            for off in offsets:
                tmp = d[(29, off)]
                start = (pos + prime) if off == 29 else (prime * (const * (pos + 1 if tmp < 29 else 0) + tmp) )//const
                del_mult(tmptk[off], start, prime)
        # now we go back to top tk1, so we need to increase pos by 1
        pos += 1
        cpos = const * pos
        # 30k + 1
        if tk1[pos]:
            prime = cpos + 1
            p.append(prime)
            lastadded = 1
            for off in offsets:
                tmp = d[(1, off)]
                start = (pos + prime) if off == 1 else (prime * (const * pos + tmp) )//const
                del_mult(tmptk[off], start, prime)
    # time to add remaining primes
    # if lastadded == 1, remove last element and start adding them from tk1
    # this way we don't need an "if" within the last while
    if lastadded == 1:
        p.pop()
    # now complete for every other possible prime
    while pos < len(tk1):
        cpos = const * pos
        if tk1[pos]: p.append(cpos + 1)
        if tk7[pos]: p.append(cpos + 7)
        if tk11[pos]: p.append(cpos + 11)
        if tk13[pos]: p.append(cpos + 13)
        if tk17[pos]: p.append(cpos + 17)
        if tk19[pos]: p.append(cpos + 19)
        if tk23[pos]: p.append(cpos + 23)
        if tk29[pos]: p.append(cpos + 29)
        pos += 1
    # remove exceeding if present
    pos = len(p) - 1
    while p[pos] > N:
        pos -= 1
    if pos < len(p) - 1:
        del p[pos+1:]
    # return p list
    return p

def sieveOfEratosthenes(n):
    """sieveOfEratosthenes(n): return the list of the primes < n."""
    # Code from: <dickinsm@gmail.com>, Nov 30 2006
    # http://groups.google.com/group/comp.lang.python/msg/f1f10ced88c68c2d
    if n <= 2:
        return []
    sieve = range(3, n, 2)
    top = len(sieve)
    for si in sieve:
        if si:
            bottom = (si*si - 3) // 2
            if bottom >= top:
                break
            sieve[bottom::si] = [0] * -((bottom - top) // si)
    return [2] + [el for el in sieve if el]

def sieveOfAtkin(end):
    """sieveOfAtkin(end): return a list of all the prime numbers <end
    using the Sieve of Atkin."""
    # Code by Steve Krenzel, <Sgk284@gmail.com>, improved
    # Code: http://krenzel.info/?p=83
    # Info: http://en.wikipedia.org/wiki/Sieve_of_Atkin
    assert end > 0
    lng = ((end-1) // 2)
    sieve = [False] * (lng + 1)

    x_max, x2, xd = int(sqrt((end-1)/4.0)), 0, 4
    for xd in xrange(4, 8*x_max + 2, 8):
        x2 += xd
        y_max = int(sqrt(end-x2))
        n, n_diff = x2 + y_max*y_max, (y_max << 1) - 1
        if not (n & 1):
            n -= n_diff
            n_diff -= 2
        for d in xrange((n_diff - 1) << 1, -1, -8):
            m = n % 12
            if m == 1 or m == 5:
                m = n >> 1
                sieve[m] = not sieve[m]
            n -= d

    x_max, x2, xd = int(sqrt((end-1) / 3.0)), 0, 3
    for xd in xrange(3, 6 * x_max + 2, 6):
        x2 += xd
        y_max = int(sqrt(end-x2))
        n, n_diff = x2 + y_max*y_max, (y_max << 1) - 1
        if not(n & 1):
            n -= n_diff
            n_diff -= 2
        for d in xrange((n_diff - 1) << 1, -1, -8):
            if n % 12 == 7:
                m = n >> 1
                sieve[m] = not sieve[m]
            n -= d

    x_max, y_min, x2, xd = int((2 + sqrt(4-8*(1-end)))/4), -1, 0, 3
    for x in xrange(1, x_max + 1):
        x2 += xd
        xd += 6
        if x2 >= end: y_min = (((int(ceil(sqrt(x2 - end))) - 1) << 1) - 2) << 1
        n, n_diff = ((x*x + x) << 1) - 1, (((x-1) << 1) - 2) << 1
        for d in xrange(n_diff, y_min, -8):
            if n % 12 == 11:
                m = n >> 1
                sieve[m] = not sieve[m]
            n += d

    primes = [2, 3]
    if end <= 3:
        return primes[:max(0,end-2)]

    for n in xrange(5 >> 1, (int(sqrt(end))+1) >> 1):
        if sieve[n]:
            primes.append((n << 1) + 1)
            aux = (n << 1) + 1
            aux *= aux
            for k in xrange(aux, end, 2 * aux):
                sieve[k >> 1] = False

    s  = int(sqrt(end)) + 1
    if s  % 2 == 0:
        s += 1
    primes.extend([i for i in xrange(s, end, 2) if sieve[i >> 1]])

    return primes

def ambi_sieve_plain(n):
    s = range(3, n, 2)
    for m in xrange(3, int(n**0.5)+1, 2): 
        if s[(m-3)/2]: 
            for t in xrange((m*m-3)/2,(n>>1)-1,m):
                s[t]=0
    return [2]+[t for t in s if t>0]

def sundaram3(max_n):
    # http://stackoverflow.com/questions/2068372/fastest-way-to-list-all-primes-below-n-in-python/2073279#2073279
    numbers = range(3, max_n+1, 2)
    half = (max_n)//2
    initial = 4

    for step in xrange(3, max_n+1, 2):
        for i in xrange(initial, half, step):
            numbers[i-1] = 0
        initial += 2*(step+1)

        if initial > half:
            return [2] + filter(None, numbers)

################################################################################
# Using Numpy:
def ambi_sieve(n):
    # http://tommih.blogspot.com/2009/04/fast-prime-number-generator.html
    s = np.arange(3, n, 2)
    for m in xrange(3, int(n ** 0.5)+1, 2): 
        if s[(m-3)/2]: 
            s[(m*m-3)/2::m]=0
    return np.r_[2, s[s>0]]

def primesfrom3to(n):
    # http://stackoverflow.com/questions/2068372/fastest-way-to-list-all-primes-below-n-in-python/3035188#3035188
    """ Returns a array of primes, p < n """
    assert n>=2
    sieve = np.ones(n/2, dtype=np.bool)
    for i in xrange(3,int(n**0.5)+1,2):
        if sieve[i/2]:
            sieve[i*i/2::i] = False
    return np.r_[2, 2*np.nonzero(sieve)[0][1::]+1]    

def primesfrom2to(n):
    # http://stackoverflow.com/questions/2068372/fastest-way-to-list-all-primes-below-n-in-python/3035188#3035188
    """ Input n>=6, Returns a array of primes, 2 <= p < n """
    sieve = np.ones(n/3 + (n%6==2), dtype=np.bool)
    sieve[0] = False
    for i in xrange(int(n**0.5)/3+1):
        if sieve[i]:
            k=3*i+1|1
            sieve[      ((k*k)/3)      ::2*k] = False
            sieve[(k*k+4*k-2*k*(i&1))/3::2*k] = False
    return np.r_[2,3,((3*np.nonzero(sieve)[0]+1)|1)]

if __name__=='__main__':
    import itertools
    import sys

    def test(f1,f2,num):
        print('Testing {f1} and {f2} return same results'.format(
            f1=f1.func_name,
            f2=f2.func_name))
        if not all([a==b for a,b in itertools.izip_longest(f1(num),f2(num))]):
            sys.exit("Error: %s(%s) != %s(%s)"%(f1.func_name,num,f2.func_name,num))

    n=1000000
    test(sieveOfAtkin,sieveOfEratosthenes,n)
    test(sieveOfAtkin,ambi_sieve,n)
    test(sieveOfAtkin,ambi_sieve_plain,n) 
    test(sieveOfAtkin,sundaram3,n)
    test(sieveOfAtkin,sieve_wheel_30,n)
    test(sieveOfAtkin,primesfrom3to,n)
    test(sieveOfAtkin,primesfrom2to,n)
    test(sieveOfAtkin,rwh_primes,n)
    test(sieveOfAtkin,rwh_primes1,n)         
    test(sieveOfAtkin,rwh_primes2,n)
</code></pre>
<p><span style="background-color:yellow;">Running</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">script</span> <span style="background-color:yellow;">tests</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">implementations</span> <span style="background-color:yellow;">give</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">result</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">Related</span> <span style="background-color:yellow;">question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">dealing</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">generators</span> <span style="background-color:yellow;">&amp</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">including</span> <span style="background-color:yellow;">benchmarks</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">Speed</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">bitstring/bit</span> <span style="background-color:yellow;">operations</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> ? </p>
<p><span style="background-color:yellow;">Faster</span> <span style="background-color:yellow;">&amp</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">memory-wise</span> <span style="background-color:yellow;">pure</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def primes(n):
    """ Returns  a list of primes < n """
    sieve = [True] * n
    for i in xrange(3,int(n**0.5)+1,2):
        if sieve[i]:
            sieve[i*i::2*i]=[False]*((n-i*i-1)/(2*i)+1)
    return [2] + [i for i in xrange(3,n,2) if sieve[i]]
</code></pre>
<p><span style="background-color:yellow;">or</span> <span style="background-color:yellow;">starting</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">half</span> <span style="background-color:yellow;">sieve</span> </p>
<pre><code>def primes1(n):
    """ Returns  a list of primes < n """
    sieve = [True] * (n/2)
    for i in xrange(3,int(n**0.5)+1,2):
        if sieve[i/2]:
            sieve[i*i/2::i] = [False] * ((n-i*i-1)/(2*i)+1)
    return [2] + [2*i+1 for i in xrange(1,n/2) if sieve[i]]
</code></pre>
<p><span style="background-color:yellow;">Faster</span> <span style="background-color:yellow;">&amp</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">memory-wise</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import numpy
def primesfrom3to(n):
    """ Returns a array of primes, 3 <= p < n """
    sieve = numpy.ones(n/2, dtype=numpy.bool)
    for i in xrange(3,int(n**0.5)+1,2):
        if sieve[i/2]:
            sieve[i*i/2::i] = False
    return 2*numpy.nonzero(sieve)[0][1::]+1
</code></pre>
<p><span style="background-color:yellow;">a</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">variation</span> <span style="background-color:yellow;">starting</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">third</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">sieve</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import numpy
def primesfrom2to(n):
    """ Input n>=6, Returns a array of primes, 2 <= p < n """
    sieve = numpy.ones(n/3 + (n%6==2), dtype=numpy.bool)
    for i in xrange(1,int(n**0.5)/3+1):
        if sieve[i]:
            k=3*i+1|1
            sieve[       k*k/3     ::2*k] = False
            sieve[k*(k-2*(i&1)+4)/3::2*k] = False
    return numpy.r_[2,3,((3*numpy.nonzero(sieve)[0][1:]+1)|1)]
</code></pre>
<p><span style="background-color:yellow;">A</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">hard-to-code</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">pure-python</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">above</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def primes2(n):
    """ Input n>=6, Returns a list of primes, 2 <= p < n """
    n, correction = n-n%6+6, 2-(n%6>1)
    sieve = [True] * (n/3)
    for i in xrange(1,int(n**0.5)/3+1):
      if sieve[i]:
        k=3*i+1|1
        sieve[      k*k/3      ::2*k] = [False] * ((n/6-k*k/6-1)/k+1)
        sieve[k*(k-2*(i&1)+4)/3::2*k] = [False] * ((n/6-k*(k-2*(i&1)+4)/6-1)/k+1)
    return [2,3] + [3*i+1|1 for i in xrange(1,n/3-correction) if sieve[i]]
</code></pre>
<p><span style="background-color:yellow;">Unfortunately</span> <span style="background-color:yellow;">pure-python</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">adopt</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">simpler</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">Assignment</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">calling</span> <span style="background-color:yellow;">len</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">inside</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">loop</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">False</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">len</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">sieve</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">/3</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">k</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">too</span> <span style="background-color:yellow;">slow.</span> <span style="background-color:yellow;">So</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">had</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">improvise</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">correct</span> <span style="background-color:yellow;">input</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">&amp</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">avoid</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">math</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">extreme</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">&amp</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">painful</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">math-magic</span> . <span style="background-color:yellow;">Personally</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">shame</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">widely</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">part</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">standard</span> <span style="background-color:yellow;">library</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">years</span> <span style="background-color:yellow;">after</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;">release</span> <span style="background-color:yellow;">&amp</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">compatibility</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">improvements</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">syntax</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">seem</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">completely</span> <span style="background-color:yellow;">overlooked</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">developers</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">There</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">pretty</span> <span style="background-color:yellow;">neat</span> <span style="background-color:yellow;">sample</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">Cookbook</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">proposed</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">URL</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import itertools
def erat2( ):
    D = {  }
    yield 2
    for q in itertools.islice(itertools.count(3), 0, None, 2):
        p = D.pop(q, None)
        if p is None:
            D[q*q] = q
            yield q
        else:
            x = p + q
            while x in D or not (x&1):
                x += p
            D[x] = p
</code></pre>
<p><span style="background-color:yellow;">so</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">give</span> </p>
<pre><code>get_primes_erat(n):
  return list(itertools.takewhile(lambda p: p<n, erat2()))
</code></pre>
<p><span style="background-color:yellow;">Measuring</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">shell</span> <span style="background-color:yellow;">prompt</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">prefer</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">pri.py</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">observe</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>$ python2.5 -mtimeit -s'import pri' 'pri.get_primes(1000000)'
10 loops, best of 3: 1.69 sec per loop
$ python2.5 -mtimeit -s'import pri' 'pri.get_primes_erat(1000000)'
10 loops, best of 3: 673 msec per loop
</code></pre>
<p><span style="background-color:yellow;">so</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">looks</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">Cookbook</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">twice</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">fast</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">For</span> <span style="background-color:yellow;">truly</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">sufficiently</span> <span style="background-color:yellow;">large</span> <span style="background-color:yellow;">N</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">download</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">pre-calculated</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">store</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">tuple</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>for pos,i in enumerate(primes):
    if i > N:
        print primes[:pos]
</code></pre>
<p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">N</span> <span style="background-color:yellow;">&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">-1</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">calculate</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">save</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">new</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">next</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">equally</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">fast</span> . </p>
<p><span style="background-color:yellow;">Always</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">outside</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">box</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">algorithm</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">fast</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">serious</span> <span style="background-color:yellow;">flaw</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>> sorted(get_primes(530))
[2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73,
79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139, 149, 151, 157, 163,
167, 173, 179, 181, 191, 193, 197, 199, 211, 223, 227, 229, 233, 239, 241, 251,
257, 263, 269, 271, 277, 281, 283, 293, 307, 311, 313, 317, 331, 337, 347, 349,
353, 359, 367, 373, 379, 383, 389, 397, 401, 409, 419, 421, 431, 433, 439, 443,
449, 457, 461, 463, 467, 479, 487, 491, 499, 503, 509, 521, 523, 527, 529]
>>> 17*31
527
>>> 23*23
529
</code></pre>
<p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">assume</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">numbers.pop</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">return</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">smallest</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">set</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">guaranteed</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">all.</span> <span style="background-color:yellow;">Sets</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">unordered</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">pop</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">removes</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">returns</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">arbitrary</span> <span style="background-color:yellow;">element</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">select</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">next</span> <span style="background-color:yellow;">prime</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">remaining</span> <span style="background-color:yellow;">numbers</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">Using</span> <span style="background-color:yellow;">Sundaram</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">Sieve</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">broke</span> <span style="background-color:yellow;">pure-Python</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">record</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def sundaram3(max_n):
    numbers = range(3, max_n+1, 2)
    half = (max_n)//2
    initial = 4

    for step in xrange(3, max_n+1, 2):
        for i in xrange(initial, half, step):
            numbers[i-1] = 0
        initial += 2*(step+1)

        if initial > half:
            return [2] + filter(None, numbers)
</code></pre>
<p><span style="background-color:yellow;">Comparasion</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>C:\USERS>python -m timeit -n10 -s "import get_primes" "get_primes.get_primes_erat(1000000)"
10 loops, best of 3: 710 msec per loop

C:\USERS>python -m timeit -n10 -s "import get_primes" "get_primes.daniel_sieve_2(1000000)"
10 loops, best of 3: 435 msec per loop

C:\USERS>python -m timeit -n10 -s "import get_primes" "get_primes.sundaram3(1000000)"
10 loops, best of 3: 327 msec per loop
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">A</span> <span style="background-color:yellow;">deterministic</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">Miller-Rabin</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">Primality</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">assumption</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">N</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">9,080,191</span> </p>
<pre><code>import sys
import random

def miller_rabin_pass(a, n):
    d = n - 1
    s = 0
    while d % 2 == 0:
        d >>= 1
        s += 1

    a_to_power = pow(a, d, n)
    if a_to_power == 1:
        return True
    for i in xrange(s-1):
        if a_to_power == n - 1:
            return True
        a_to_power = (a_to_power * a_to_power) % n
    return a_to_power == n - 1


def miller_rabin(n):
    for a in [2, 3, 37, 73]:
      if not miller_rabin_pass(a, n):
        return False
    return True


n = int(sys.argv[1])
primes = [2]
for p in range(3,n,2):
  if miller_rabin(p):
    primes.append(p)
print len(primes)
</code></pre>
<p>According to the article on Wikipedia (http://en.wikipedia.org/wiki/MillerRabin_primality_test) testing N < 9,080,191 for a = 2,3,37, and 73 is enough to decide whether N is composite or not.</p>
<p><span style="background-color:yellow;">And</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">adapted</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">source</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">probabilistic</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">original</span> <span style="background-color:yellow;">Miller-Rabin</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">http</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">//en.literateprograms.org/Miller-Rabin_primality_test_</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;"></span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">7</span> </b><br /><p><span style="background-color:yellow;">For</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">best.</span> <span style="background-color:yellow;">For</span> <span style="background-color:yellow;">purely</span> <span style="background-color:yellow;">academic</span> <span style="background-color:yellow;">reasons</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">posting</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">pure</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">less</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">50</span> <span style="background-color:yellow;">%</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">cookbook</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">posted</span> <span style="background-color:yellow;">above.</span> <span style="background-color:yellow;">Since</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">entire</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">enough</span> <span style="background-color:yellow;">space</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">hold</span> <span style="background-color:yellow;">everything</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">scale</span> <span style="background-color:yellow;">fairly</span> <span style="background-color:yellow;">well</span> . </p>
<pre><code>def daniel_sieve_2(maxNumber):
    """
    Given a number, returns all numbers less than or equal to
    that number which are prime.
    """
    allNumbers = range(3, maxNumber+1, 2)
    for mIndex, number in enumerate(xrange(3, maxNumber+1, 2)):
        if allNumbers[mIndex] == 0:
            continue
        # now set all multiples to 0
        for index in xrange(mIndex+number, (maxNumber-3)/2+1, number):
            allNumbers[index] = 0
    return [2] + filter(lambda n: n!=0, allNumbers)
</code></pre>
<p><span style="background-color:yellow;">And</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">results</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>>mine = timeit.Timer("daniel_sieve_2(1000000)",
...                    "from sieves import daniel_sieve_2")
>>>prev = timeit.Timer("get_primes_erat(1000000)",
...                    "from sieves import get_primes_erat")
>>>print "Mine: {0:0.4f} ms".format(min(mine.repeat(3, 1))*1000)
Mine: 428.9446 ms
>>>print "Previous Best {0:0.4f} ms".format(min(prev.repeat(3, 1))*1000)
Previous Best 621.3581 ms
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">8</span> </b><br /><p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">control</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">N</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">precompute</span> <span style="background-color:yellow;">them.</span> <span style="background-color:yellow;">Seriously.</span> <span style="background-color:yellow;">Precomputing</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">overlooked</span> <span style="background-color:yellow;">optimization</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">9</span> </b><br /><p><span style="background-color:yellow;">A</span> <span style="background-color:yellow;">slightly</span> <span style="background-color:yellow;">different</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">half</span> <span style="background-color:yellow;">sieve</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">Numpy</span> <span style="background-color:yellow;">:</span> </p>
<p><span style="background-color:yellow;">http</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">//rebrained.com/</span> ? <span style="background-color:yellow;">p</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">458</span> </p>
<pre>
import math
import numpy
def prime6(upto):
    primes=numpy.arange(3,upto+1,2)
    isprime=numpy.ones((upto-1)/2,dtype=bool)
    for factor in primes[:int(math.sqrt(upto))]:
        if isprime[(factor-2)/2]: isprime[(factor*3-2)/2:(upto-1)/2:factor]=0
    return numpy.insert(primes[isprime],0,2)
</pre>
<p><span style="background-color:yellow;">Can</span> <span style="background-color:yellow;">someone</span> <span style="background-color:yellow;">compare</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">timings</span> ? <span style="background-color:yellow;">On</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">machine</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">pretty</span> <span style="background-color:yellow;">comparable</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">Numpy</span> <span style="background-color:yellow;">half-sieve</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">10</span> </b><br /><p><span style="background-color:yellow;">What</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">want</span> ? <span style="background-color:yellow;">There</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">fast</span> <span style="background-color:yellow;">statistical</span> <span style="background-color:yellow;">algorithms</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">eg</span> <span style="background-color:yellow;">Miller-Rabin</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">their</span> <span style="background-color:yellow;">overheads</span> <span style="background-color:yellow;">mean</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">turn</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">slower</span> <span style="background-color:yellow;">unless</span> <span style="background-color:yellow;">dealing</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">big</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">^</span> <span style="background-color:yellow;">64</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">numbers.</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">11</span> </b><br /><p><span style="background-color:yellow;">In</span> <span style="background-color:yellow;">general</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">fast</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">computation</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">best</span> <span style="background-color:yellow;">choice.</span> <span style="background-color:yellow;">Today</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">complex</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">algorithm.</span> <span style="background-color:yellow;">For</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">computer</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">got</span> <span style="background-color:yellow;">2.2</span> <span style="background-color:yellow;">second</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">Mathematica</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">got</span> <span style="background-color:yellow;">0.088005</span> . </p>
<p><span style="background-color:yellow;">First</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">set</span> ? </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">12</span> </b><br /><p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">easiest</span> <span style="background-color:yellow;">optimization</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">implement</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">check</span> <span style="background-color:yellow;">whether</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">prime</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">check</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">divisible</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">square_root</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">Is</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">Project</span> <span style="background-color:yellow;">Euler</span> ? </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">13</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">normally</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">generate</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>$ python -mtimeit -s'import sieve' 'sieve.sieve(1000000)' 
10 loops, best of 3: 445 msec per loop
$ cat sieve.py
from math import sqrt

def sieve(size):
 prime=[True]*size
 rng=xrange
 limit=int(sqrt(size))

 for i in rng(3,limit+1,+2):
  if prime[i]:
   prime[i*i::+i]=[False]*len(prime[i*i::+i])

 return [2]+[i for i in rng(3,size,+2) if prime[i]]

if __name__=='__main__':
 print sieve(100)
</code></pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">ca</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">compete</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">solutions</span> <span style="background-color:yellow;">posted</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">least</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">pure</span> <span style="background-color:yellow;">python</span> . </p>
<p><span style="background-color:yellow;">Thanks</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">posting</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">question.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">learnt</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot</span> <span style="background-color:yellow;">today</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">14</span> </b><br /><p><span style="background-color:yellow;">My</span> <span style="background-color:yellow;">guess</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">ways</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">hard</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">code</span> . </p>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">why</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">write</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">slow</span> <span style="background-color:yellow;">script</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">generates</span> <span style="background-color:yellow;">another</span> <span style="background-color:yellow;">source</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">hardwired</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">import</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">source</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">run</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">actual</span> <span style="background-color:yellow;">program</span> . </p>
<p><span style="background-color:yellow;">Of</span> <span style="background-color:yellow;">course</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">upper</span> <span style="background-color:yellow;">bound</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">N</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">compile</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">thus</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">almost</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">project</span> <span style="background-color:yellow;">Euler</span> <span style="background-color:yellow;">problems</span> . </p>
<p></p>
<p><span style="background-color:yellow;">PS</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">might</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">wrong</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">iff</span> <span style="background-color:yellow;">parsing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">source</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">hard-wired</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">slower</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">computing</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">place</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">runs</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">compiled</span> <span style="background-color:yellow;">.pyc</span> <span style="background-color:yellow;">files</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">reading</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">binary</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">N</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">bloody</span> <span style="background-color:yellow;">fast</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">case</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">15</span> </b><br /><p><span style="background-color:yellow;">Sorry</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">bother</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">erat2</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">serious</span> <span style="background-color:yellow;">flaw</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">algorithm</span> . </p>
<p><span style="background-color:yellow;">While</span> <span style="background-color:yellow;">searching</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">next</span> <span style="background-color:yellow;">composite</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">we</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;">odd</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">only</span> . <span style="background-color:yellow;">q,p</span> <span style="background-color:yellow;">both</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">odd</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">q</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">p</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">tested</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">q</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">p</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">always</span> <span style="background-color:yellow;">odd.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">eliminates</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">loop</span> <span style="background-color:yellow;">condition</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">saves</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">30</span> <span style="background-color:yellow;">%</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">runtime</span> . </p>
<p><span style="background-color:yellow;">While</span> <span style="background-color:yellow;">we</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">instead</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">elegant</span> <span style="background-color:yellow;">'D.pop</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">q,None</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">'if</span> <span style="background-color:yellow;">q</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">D</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">p</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">D</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">q</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">,del</span> <span style="background-color:yellow;">D</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">q</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">twice</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">fast</span> <span style="background-color:yellow;">!</span> <span style="background-color:yellow;">At</span> <span style="background-color:yellow;">least</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">machine</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">P3-1Ghz</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">So</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">suggest</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">clever</span> <span style="background-color:yellow;">algorithm</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def erat3( ):
    from itertools import islice, count

    # q is the running integer that's checked for primeness.
    # yield 2 and no other even number thereafter
    yield 2
    D = {}
    # no need to mark D[4] as we will test odd numbers only
    for q in islice(count(3),0,None,2):
        if q in D:                  #  is composite
            p = D[q]
            del D[q]
            # q is composite. p=D[q] is the first prime that
            # divides it. Since we've reached q, we no longer
            # need it in the map, but we'll mark the next
            # multiple of its witnesses to prepare for larger
            # numbers.
            x = q + p+p        # next odd(!) multiple
            while x in D:      # skip composites
                x += p+p
            D[x] = p
        else:                  # is prime
            # q is a new prime.
            # Yield it and mark its first multiple that isn't
            # already marked in previous iterations.
            D[q*q] = q
            yield q
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">16</span> </b><br /><p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">tried</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">based</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">cookbook</span> <span style="background-color:yellow;">erat2</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import itertools as it
def erat2a( ):
    D = {  }
    yield 2
    for q in it.islice(it.count(3), 0, None, 2):
        p = D.pop(q, None)
        if p is None:
            D[q*q] = q
            yield q
        else:
            x = q + 2*p
            while x in D:
                x += 2*p
            D[x] = p
</code></pre>
<p><span style="background-color:yellow;">See</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">explanation</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">speeding-up</span> . </p>
<br />