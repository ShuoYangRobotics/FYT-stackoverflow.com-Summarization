<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-1814400</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Simple</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">convert</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dictionary</span> </h2><p><span style="background-color:yellow;">What</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">simplest</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">convert</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">keyword</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>name="John Smith", age=34, height=173.2, location="US", avatar=":,=)"
</code></pre>
<p><span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>{'name':'John Smith', 'age':34, 'height':173.2, 'location':'US', 'avatar':':,=)'}
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">'avatar</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">show</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">contain</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">'split</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">wo</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">do.</span> <span style="background-color:yellow;">Any</span> <span style="background-color:yellow;">ideas</span> ? <span style="background-color:yellow;">Thanks</span> <span style="background-color:yellow;">!</span> </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-9</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">:</span> </p>
<pre><code># get all the items
matches = re.findall(r'\w+=".+?"', s) + re.findall(r'\w+=[\d.]+',s)

# partition each match at '='
matches = [m.group().split('=', 1) for m in matches]

# use results to make a dict
d = dict(matches)
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">Edit</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">csv</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">deal</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">desired</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">quotes</span> <span style="background-color:yellow;">inside</span> <span style="background-color:yellow;">fields</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">takes</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">implement</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">functionality</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import re
quoted = re.compile(r'"[^"]*"')

class QuoteSaver(object):

  def __init__(self):
    self.saver = dict()
    self.reverser = dict()

  def preserve(self, mo):
    s = mo.group()
    if s not in self.saver:
      self.saver[s] = '"%d"' % len(self.saver)
      self.reverser[self.saver[s]] = s
    return self.saver[s]

  def expand(self, mo):
    return self.reverser[mo.group()]

x = 'name="John Smith", age=34, height=173.2, location="US", avatar=":,=)"'

qs = QuoteSaver()
y = quoted.sub(qs.preserve, x)
kvs_strings = y.split(',')
kvs_pairs = [kv.split('=') for kv in kvs_strings]
kvs_restored = [(k, quoted.sub(qs.expand, v)) for k, v in kvs_pairs]

def converter(v):
  if v.startswith('"'): return v.strip('"')
  try: return int(v)
  except ValueError: return float(v)

thedict = dict((k.strip(), converter(v)) for k, v in kvs_restored)
for k in thedict:
  print "%-8s %s" % (k, thedict[k])
print thedict
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">emitting</span> <span style="background-color:yellow;">thedict</span> <span style="background-color:yellow;">twice</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">show</span> <span style="background-color:yellow;">exactly</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">why</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">differs</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">required</span> <span style="background-color:yellow;">result</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">output</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>age      34
location US
name     John Smith
avatar   :,=)
height   173.2
{'age': 34, 'location': 'US', 'name': 'John Smith', 'avatar': ':,=)',
 'height': 173.19999999999999}
</code></pre>
<p><span style="background-color:yellow;">As</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">output</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">floating</span> <span style="background-color:yellow;">point</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">requested</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">directly</span> <span style="background-color:yellow;">emitted</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">print</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">IS</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">floating</span> <span style="background-color:yellow;">point</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">display</span> <span style="background-color:yellow;">173.2</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">such</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">!</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">print</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">applied</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">whole</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">inevitably</span> <span style="background-color:yellow;">uses</span> <span style="background-color:yellow;">repr</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">repr</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">173.2</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">form</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">given</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">usual</span> <span style="background-color:yellow;">issues</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">floating</span> <span style="background-color:yellow;">point</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">stored</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">binary</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">decimal</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">etc</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">etc</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">might</span> <span style="background-color:yellow;">define</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;">subclass</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">overrides</span> <span style="background-color:yellow;">__str__</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">specialcase</span> <span style="background-color:yellow;">floating-point</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">guess</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">indeed</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">requirement</span> . </p>
<p><span style="background-color:yellow;">But</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">hope</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">distraction</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">interfere</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">core</span> <span style="background-color:yellow;">idea</span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">long</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">doublequotes</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">properly</span> <span style="background-color:yellow;">balanced</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">doublequotes-inside-doublequotes</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">perform</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">required</span> <span style="background-color:yellow;">task</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">preserving</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">special</span> <span style="background-color:yellow;">characters</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">commas</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">equal</span> <span style="background-color:yellow;">signs</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">taken</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">their</span> <span style="background-color:yellow;">normal</span> <span style="background-color:yellow;">sense</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">inside</span> <span style="background-color:yellow;">double</span> <span style="background-color:yellow;">quotes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">double</span> <span style="background-color:yellow;">quotes</span> <span style="background-color:yellow;">start</span> <span style="background-color:yellow;">inside</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">field</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">rather</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">beginning</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">field</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">csv</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">deals</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">latter</span> <span style="background-color:yellow;">condition</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">Insert</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">few</span> <span style="background-color:yellow;">intermediate</span> <span style="background-color:yellow;">prints</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">obvious</span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">changes</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">double</span> <span style="background-color:yellow;">quoted</span> <span style="background-color:yellow;">fields</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">specially</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">form</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">0</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">separately</span> <span style="background-color:yellow;">recording</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">actual</span> <span style="background-color:yellow;">contents</span> <span style="background-color:yellow;">corresponding</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">those</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">forms</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">end</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">forms</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">changed</span> <span style="background-color:yellow;">back</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">original</span> <span style="background-color:yellow;">contents.</span> <span style="background-color:yellow;">Double-quote</span> <span style="background-color:yellow;">stripping</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">transformation</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">unquoted</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">integers</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">floats</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">finally</span> <span style="background-color:yellow;">handled</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">converter</span> <span style="background-color:yellow;">function</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">verbose</span> <span style="background-color:yellow;">approach</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">problem</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">pyparsing.</span> <span style="background-color:yellow;">Note</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">parse</span> <span style="background-color:yellow;">actions</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">automatic</span> <span style="background-color:yellow;">conversion</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">types</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">strings</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">ints</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">floats.</span> <span style="background-color:yellow;">Also</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">QuotedString</span> <span style="background-color:yellow;">class</span> <span style="background-color:yellow;">implicitly</span> <span style="background-color:yellow;">strips</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">quotation</span> <span style="background-color:yellow;">marks</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">quoted</span> <span style="background-color:yellow;">value.</span> <span style="background-color:yellow;">Finally</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">Dict</span> <span style="background-color:yellow;">class</span> <span style="background-color:yellow;">takes</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">'key</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">val</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">group</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">comma-delimited</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">assigns</span> <span style="background-color:yellow;">results</span> <span style="background-color:yellow;">names</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">tokens</span> . </p>
<pre><code>from pyparsing import *

key = Word(alphas)
EQ = Suppress('=')
real = Regex(r'[+-]?\d+\.\d+').setParseAction(lambda t:float(t[0]))
integer = Regex(r'[+-]?\d+').setParseAction(lambda t:int(t[0]))
qs = QuotedString('"')
value = real | integer | qs

dictstring = Dict(delimitedList(Group(key + EQ + value)))
</code></pre>
<p><span style="background-color:yellow;">Now</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">parse</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">original</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">storing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">results</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">dd.</span> <span style="background-color:yellow;">Pyparsing</span> <span style="background-color:yellow;">returns</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">object</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">type</span> <span style="background-color:yellow;">ParseResults</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">class</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">many</span> <span style="background-color:yellow;">dict-like</span> <span style="background-color:yellow;">features</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">support</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">keys</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">items</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">etc.</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">emit</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">true</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">calling</span> <span style="background-color:yellow;">asDict</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">Calling</span> <span style="background-color:yellow;">dump</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">shows</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tokens</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">original</span> <span style="background-color:yellow;">parsed</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">plus</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">named</span> <span style="background-color:yellow;">items.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">last</span> <span style="background-color:yellow;">two</span> <span style="background-color:yellow;">examples</span> <span style="background-color:yellow;">show</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">access</span> <span style="background-color:yellow;">named</span> <span style="background-color:yellow;">items</span> <span style="background-color:yellow;">within</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">ParseResults</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">were</span> <span style="background-color:yellow;">attributes</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">object</span> . </p>
<pre><code>text = 'name="John Smith", age=34, height=173.2, location="US", avatar=":,=)"'
dd = dictstring.parseString(text)
print dd.keys()
print dd.items()
print dd.dump()
print dd.asDict()
print dd.name
print dd.avatar
</code></pre>
<p><span style="background-color:yellow;">Prints</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>['age', 'location', 'name', 'avatar', 'height']
[('age', 34), ('location', 'US'), ('name', 'John Smith'), ('avatar', ':,=)'), ('height', 173.19999999999999)]
[['name', 'John Smith'], ['age', 34], ['height', 173.19999999999999], ['location', 'US'], ['avatar', ':,=)']]
- age: 34
- avatar: :,=)
- height: 173.2
- location: US
- name: John Smith
{'age': 34, 'height': 173.19999999999999, 'location': 'US', 'avatar': ':,=)', 'name': 'John Smith'}
John Smith
:,=)
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">produces</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">correct</span> <span style="background-color:yellow;">behavior</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">long</span> <span style="background-color:yellow;">!</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">added</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">space</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">avatar</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">show</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">deals</span> <span style="background-color:yellow;">well</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">commas</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">spaces</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">equal</span> <span style="background-color:yellow;">signs</span> <span style="background-color:yellow;">inside</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">string.</span> <span style="background-color:yellow;">Any</span> <span style="background-color:yellow;">suggestions</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">shorten</span> <span style="background-color:yellow;">it</span> ? </p>
<pre><code>import hashlib

string = 'name="John Smith", age=34, height=173.2, location="US", avatar=":, =)"'

strings = {}

def simplify(value):
    try:
        return int(value)
    except:
        return float(value)

while True:
    try:
        p1 = string.index('"')
        p2 = string.index('"',p1+1)
        substring = string[p1+1:p2]
        key = hashlib.md5(substring).hexdigest()
        strings[key] = substring
        string = string[:p1] + key + string[p2+1:]
    except:
        break

d = {}    
for pair in string.split(', '):
    key, value = pair.split('=')
    if value in strings:
        d[key] = strings[value]
    else:
        d[key] = simplify(value)

print d
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">approach</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">eval</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">considered</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">unreliable</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">its</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">example</span> . </p>
<pre><code>>>> import re
>>>
>>> s='name="John Smith", age=34, height=173.2, location="US", avatar=":,=)"'
>>>
>>> eval("{"+re.sub('(\w+)=("[^"]+"|[\d.]+)','"\\1":\\2',s)+"}")
{'age': 34, 'location': 'US', 'name': 'John Smith', 'avatar': ':,=)', 'height': 173.19999999999999}
>>>
</code></pre>
<p><span style="background-color:yellow;">Update</span> <span style="background-color:yellow;">:</span> </p>
<p><span style="background-color:yellow;">Better</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">pointed</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">Chris</span> <span style="background-color:yellow;">Lutz</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">comment</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">believe</span> <span style="background-color:yellow;">Its</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">reliable</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">single/double</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">quotes</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">dict</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">might</span> <span style="background-color:yellow;">works</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">set</span> <span style="background-color:yellow;">maxsplit</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">instance</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">work</span> . </p>
<pre><code>string = 'name="John Smith", age=34, height=173.2, location="US", avatar=":, =)"'
newDict = dict(map( lambda(z): z.split("=",1), string.split(", ") ))
</code></pre>
<p><span style="background-color:yellow;">Edit</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">comment</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">did</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">notice</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">under</span> <span style="background-color:yellow;">avatar</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">best</span> <span style="background-color:yellow;">approach</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">escape</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">wherever</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">generating</span> <span style="background-color:yellow;">data.</span> <span style="background-color:yellow;">Even</span> <span style="background-color:yellow;">better</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">JSON</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">However</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">alternative</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">regexp</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">try</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">shlex</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">produces</span> <span style="background-color:yellow;">cleaner</span> <span style="background-color:yellow;">looking</span> <span style="background-color:yellow;">code</span> . </p>
<pre><code>import shlex

string = 'name="John Smith", age=34, height=173.2, location="US", avatar=":, =)"'
lex = shlex.shlex ( string ) 
lex.whitespace += "," # Default whitespace doesn't include commas
lex.wordchars += "."  # Word char should include . to catch decimal 
words = [ x for x in iter( lex.get_token, '' ) ]
newDict = dict ( zip( words[0::3], words[2::3]) )
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">do</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">step</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">step</span> </p>
<pre><code>d={}
mystring='name="John Smith", age=34, height=173.2, location="US", avatar=":,=)"';
s = mystring.split(", ")
for item in s:
    i=item.split("=",1)
    d[i[0]]=i[-1]
print d
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">7</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">somewhat</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">robust</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">regexp</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import re

keyval_re = re.compile(r'''
   \s*                                  # Leading whitespace is ok.
   (?P<key>\w+)\s*=\s*(                 # Search for a key followed by..
       (?P<str>"[^"]*"|\'[^\']*\')|     #   a quoted string; or
       (?P<float>\d+\.\d+)|             #   a float; or
       (?P<int>\d+)                     #   an int.
   )\s*,?\s*                            # Handle comma & trailing whitespace.
   |(?P<garbage>.+)                     # Complain if we get anything else!
   ''', re.VERBOSE)

def handle_keyval(match):
    if match.group('garbage'):
        raise ValueError("Parse error: unable to parse: %r" %
                         match.group('garbage'))
    key = match.group('key')
    if match.group('str') is not None:
        return (key, match.group('str')[1:-1]) # strip quotes
    elif match.group('float') is not None:
        return (key, float(match.group('float')))
    elif match.group('int') is not None:
        return (key, int(match.group('int')))
</code></pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">automatically</span> <span style="background-color:yellow;">converts</span> <span style="background-color:yellow;">floats</span> <span style="background-color:yellow;">&amp</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">ints</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">right</span> <span style="background-color:yellow;">type</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">handles</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">double</span> <span style="background-color:yellow;">quotes</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">handles</span> <span style="background-color:yellow;">extraneous</span> <span style="background-color:yellow;">whitespace</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">various</span> <span style="background-color:yellow;">locations</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">complains</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">badly</span> <span style="background-color:yellow;">formatted</span> <span style="background-color:yellow;">string</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">supplied</span> </p>
<pre><code>>>> s='name="John Smith", age=34, height=173.2, location="US", avatar=":,=)"'
>>> print dict(handle_keyval(m) for m in keyval_re.finditer(s))
{'age': 34, 'location': 'US', 'name': 'John Smith', 'avatar': ':,=)', 'height': 173.19999999999999}
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">8</span> </b><br /><p><span style="background-color:yellow;">Always</span> <span style="background-color:yellow;">comma</span> <span style="background-color:yellow;">separated</span> ? <span style="background-color:yellow;">Use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">CSV</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">split</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">parts</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">checked</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import csv
import cStringIO

parts=csv.reader(cStringIO.StringIO(<string to parse>)).next()
</code></pre>
<br />