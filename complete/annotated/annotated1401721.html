<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-1401721</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Convert</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">objects</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">integers</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lookup</span> <span style="background-color:yellow;">table</span> </h2><p><span style="background-color:yellow;">To</span> <span style="background-color:yellow;">illustrate</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">mean</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">example</span> </p>
<pre><code>messages = [
  ('Ricky',  'Steve',  'SMS'),
  ('Steve',  'Karl',   'SMS'),
  ('Karl',   'Nora',   'Email')
]
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">convert</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">definition</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">groups</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">integers</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lookup</span> <span style="background-color:yellow;">dictionary</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">element</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">group</span> <span style="background-color:yellow;">gets</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">unique</span> <span style="background-color:yellow;">id.</span> <span style="background-color:yellow;">That</span> <span style="background-color:yellow;">id</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">map</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">element</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">lookup</span> <span style="background-color:yellow;">table</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> </p>
<pre><code>messages_int, lookup_table = create_lookup_list(
              messages, ('person', 'person', 'medium'))

print messages_int
[ (0, 1, 0),
  (1, 2, 0),
  (2, 3, 1) ]

print lookup_table
{ 'person': ['Ricky', 'Steve', 'Karl', 'Nora'],
  'medium': ['SMS', 'Email']
}
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wonder</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">elegant</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">pythonic</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">problem</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">open</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">better</span> <span style="background-color:yellow;">terminology</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">create_lookup_list</span> <span style="background-color:yellow;">etc</span> </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-7</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">defaultdict</span> <span style="background-color:yellow;">combined</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">itertools.count</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">.next</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">good</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">assign</span> <span style="background-color:yellow;">identifiers</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">unique</span> <span style="background-color:yellow;">items.</span> <span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">apply</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>from itertools import count
from collections import defaultdict

def create_lookup_list(data, domains):
    domain_keys = defaultdict(lambda:defaultdict(count().next))
    out = []
    for row in data:
        out.append(tuple(domain_keys[dom][val] for val, dom in zip(row, domains)))
    lookup_table = dict((k, sorted(d, key=d.get)) for k, d in domain_keys.items())
    return out, lookup_table
</code></pre>
<p><span style="background-color:yellow;">Edit</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">note</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">count</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">.next</span> <span style="background-color:yellow;">becomes</span> <span style="background-color:yellow;">count</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">.__next__</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">lambda</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">next</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">count</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">3</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">Mine</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">length</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">complexity</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import collections

def create_lookup_list(messages, labels):

    # Collect all the values
    lookup = collections.defaultdict(set)
    for msg in messages:
        for l, v in zip(labels, msg):
            lookup[l].add(v)

    # Make the value sets lists
    for k, v in lookup.items():
        lookup[k] = list(v)

    # Make the lookup_list
    lookup_list = []
    for msg in messages:
        lookup_list.append([lookup[l].index(v) for l, v in zip(labels, msg)])

    return lookup_list, lookup
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">In</span> <span style="background-color:yellow;">Otto</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">anyone</span> <span style="background-color:yellow;">else</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">string-&gt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">id</span> <span style="background-color:yellow;">dicts</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'d</span> <span style="background-color:yellow;">replace</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">obsessing</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">thing</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<pre><code># create the lookup table
lookup_dict = {}
for group in indices:
    lookup_dict[group] = sorted(indices[group].keys(),
            lambda e1, e2: indices[group][e1]-indices[group][e2])
</code></pre>
<p><span style="background-color:yellow;">by</span> </p>
<pre><code># k2i must map keys to consecutive ints [0,len(k2i)-1)
def inverse_indices(k2i):
    inv=[0]*len(k2i)
    for k,i in k2i.iteritems():
        inv[i]=k
    return inv

lookup_table = dict((g,inverse_indices(gi)) for g,gi in indices.iteritems())
</code></pre>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">better</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">direct</span> <span style="background-color:yellow;">assignment</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">item</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">inverse</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;">directly</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">sorting</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">own</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">doubt</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">best</span> </p>
<pre><code>def create_lookup_list(input_list, groups):
    # use a dictionary for the indices so that the index lookup 
    # is fast (not necessarily a requirement)
    indices = dict((group, {}) for group in groups) 
    output = []

    # assign indices by iterating through the list
    for row in input_list:
        newrow = []
        for group, element in zip(groups, row):
            if element in indices[group]:
                index = indices[group][element]
            else:
                index = indices[group][element] = len(indices[group])
            newrow.append(index)
        output.append(newrow)

    # create the lookup table
    lookup_dict = {}
    for group in indices:
        lookup_dict[group] = sorted(indices[group].keys(),
                lambda e1, e2: indices[group][e1]-indices[group][e2])

    return output, lookup_dict
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">simpler</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">direct</span> . </p>
<pre><code>from collections import defaultdict

def create_lookup_list( messages, schema ):
    def mapped_rows( messages ):
        for row in messages:
            newRow= []
            for col, value in zip(schema,row):
                if value not in lookups[col]:
                    lookups[col].append(value)
                code= lookups[col].index(value)
                newRow.append(code)
            yield newRow
    lookups = defaultdict(list)
    return list( mapped_rows(messages) ), dict(lookups)
</code></pre>
<p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">lookups</span> <span style="background-color:yellow;">were</span> <span style="background-color:yellow;">proper</span> <span style="background-color:yellow;">dictionaries</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">lists</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">simplified</span> <span style="background-color:yellow;">further</span> . <span style="background-color:yellow;">Make</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">lookup</span> <span style="background-color:yellow;">table</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">structure</span> </p>
<pre><code>{ 'person': {'Ricky':0, 'Steve':1, 'Karl':2, 'Nora':3},
  'medium': {'SMS':0, 'Email':1}
}
</code></pre>
<p><span style="background-color:yellow;">And</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">further</span> <span style="background-color:yellow;">reduced</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">complexity</span> . </p>
<p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">turn</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">working</span> <span style="background-color:yellow;">copy</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">lookups</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">inverse</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">follows</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>>>> lookups = { 'person': {'Ricky':0, 'Steve':1, 'Karl':2, 'Nora':3},
      'medium': {'SMS':0, 'Email':1}
    }
>>> dict( ( d, dict( (v,k) for k,v in lookups[d].items() ) ) for d in lookups )
{'person': {0: 'Ricky', 1: 'Steve', 2: 'Karl', 3: 'Nora'}, 'medium': {0: 'SMS', 1: 'Email'}}
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">better</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">different</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;"></span> </p>
<pre><code>def create_lookup_list(data, keys):
  encoded = []
  table = dict([(key, []) for key in keys])

  for record in data:
      msg_int = []
      for key, value in zip(keys, record):
          if value not in table[key]:
              table[key].append(value)
          msg_int.append(table[key].index(value))  
      encoded.append(tuple(msg_int))

  return encoded, table
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">mine</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">inner</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">lets</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">write</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">index-tuple</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">generator</span> . </p>
<pre><code>def create_lookup_list( data, format):
    table = {}
    indices = []
    def get_index( item, form ):
        row = table.setdefault( form, [] )
        try:
            return row.index( item )
        except ValueError:
            n = len( row )
            row.append( item )
            return n
    for row in data:
        indices.append( tuple( get_index( item, form ) for item, form in zip( row, format ) ))

    return table, indices
</code></pre>
<br />