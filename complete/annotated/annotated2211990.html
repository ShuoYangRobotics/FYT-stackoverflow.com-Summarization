<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-2211990</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">How</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">implement</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">efficient</span> <span style="background-color:yellow;">infinite</span> <span style="background-color:yellow;">generator</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">prime</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> ? </h2><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">homework</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">curious</span> . </p>
<p><span style="background-color:yellow;">INFINITE</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">word</span> <span style="background-color:yellow;">here</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wish</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">p</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">believe</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">built-in</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Haskell</span> . </p>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">naive</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">Just</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">Sieve</span> <span style="background-color:yellow;">"</span> . </p>
<p><span style="background-color:yellow;">First</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">many</span> <span style="background-color:yellow;">consecutive</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">consumed.</span> <span style="background-color:yellow;">Well</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">suppose</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">concoct</span> <span style="background-color:yellow;">100</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">time.</span> <span style="background-color:yellow;">Would</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">Sieve</span> <span style="background-color:yellow;">approach</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">well</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">frequency</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">prime</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">formula</span> ? </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">prefer</span> <span style="background-color:yellow;">non-concurrent</span> <span style="background-color:yellow;">approach</span> . </p>
<p><span style="background-color:yellow;">Thank</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">reading</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">writing</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">!</span> </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-8</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">still</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wrote</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">Cookbook</span> <span style="background-color:yellow;">recipe</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">many</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">authors</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">shows</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">Sieve</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">Eratosthenes</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">intrinsic</span> <span style="background-color:yellow;">limits</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">comments</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">discussion</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">believe</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">quite</span> <span style="background-color:yellow;">clear.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">recently</span> <span style="background-color:yellow;">discussed</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">Stack</span> <span style="background-color:yellow;">Overflow</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">search</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">authors</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">names</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">guess</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">somebody</span> <span style="background-color:yellow;">proposed</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">substantially</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">IMHO</span> <span style="background-color:yellow;">less</span> <span style="background-color:yellow;">clear</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;"></span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><h1>“If I have seen further…”</h1>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">erat2</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">cookbook</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">further</span> <span style="background-color:yellow;">sped</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">20-25</span> <span style="background-color:yellow;">%</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<h2><span style="background-color:yellow;">erat2a</span> </h2>
<pre><code>import itertools as it
def erat2a( ):
    D = {  }
    yield 2
    for q in it.islice(it.count(3), 0, None, 2):
        p = D.pop(q, None)
        if p is None:
            D[q*q] = q
            yield q
        else:
            # old code here:
            # x = p + q
            # while x in D or not (x&1):
            #     x += p
            # changed into:
            x = q + 2*p
            while x in D:
                x += 2*p
            D[x] = p
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">x&amp</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">check</span> <span style="background-color:yellow;">verifies</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">x</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">odd.</span> <span style="background-color:yellow;">However</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">both</span> <span style="background-color:yellow;">q</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">p</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">odd</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">adding</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">p</span> <span style="background-color:yellow;">half</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">steps</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">avoided</span> <span style="background-color:yellow;">along</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">oddity</span> . </p>
<h2><span style="background-color:yellow;">erat3</span> </h2>
<p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">mind</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">little</span> <span style="background-color:yellow;">extra</span> <span style="background-color:yellow;">fanciness</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">erat2</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">sped</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">35-40</span> <span style="background-color:yellow;">%</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">changes</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">NB</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">needs</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2.7</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">itertools.compress</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import itertools as it
def erat3( ):
    D = { 9: 3, 25: 5 }
    yield 2
    yield 3
    yield 5
    MASK= 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0,
    MODULOS= frozenset( (1, 7, 11, 13, 17, 19, 23, 29) )

    for q in it.compress(
            it.islice(it.count(7), 0, None, 2),
            it.cycle(MASK)):
        p = D.pop(q, None)
        if p is None:
            D[q*q] = q
            yield q
        else:
            x = q + 2*p
            while x in D or (x%30) not in MODULOS:
                x += 2*p
            D[x] = p
</code></pre>
<p>The <code>erat3</code> function takes advantage of the fact that all primes (except for  2, 3, 5) modulo 30 result to only eight numbers: the ones included in the <code>MODULOS</code> frozenset. Thus, after yielding the initial three primes, we start from 7 and work <em>only</em> with the candidates.<br />
The candidate filtering uses the <code>itertools.compress</code> function; the “magic” is in the <code>MASK</code> sequence; <code>MASK</code> has 15 elements (there are 15 odd numbers in every 30 numbers, as chosen by the <code>itertools.islice</code> function) with a <code>1</code> for every possible candidate, starting from 7. The cycle repeats as specified by the <code>itertools.cycle</code> function.<br />
The introduction of the candidate filtering needs another modification: the <code>or (x%30) not in MODULOS</code> check. The <code>erat2</code> algorithm processed all odd numbers; now that the <code>erat3</code> algorithm processes only r30 candidates, we need to make sure that all <code>D.keys()</code> can only be such —false— candidates.</p>
<h2><span style="background-color:yellow;">Benchmarks</span> </h2>
<h3><span style="background-color:yellow;">Results</span> </h3>
<p><span style="background-color:yellow;">On</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">Atom</span> <span style="background-color:yellow;">330</span> <span style="background-color:yellow;">Ubuntu</span> <span style="background-color:yellow;">9.10</span> <span style="background-color:yellow;">server</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">versions</span> <span style="background-color:yellow;">2.6.4</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">3.1.1</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>$ testit
up to 8192
==== python2 erat2 ====
100 loops, best of 3: 18.6 msec per loop
==== python2 erat2a ====
100 loops, best of 3: 14.5 msec per loop
==== python2 erat3 ====
Traceback (most recent call last):
…
AttributeError: 'module' object has no attribute 'compress'
==== python3 erat2 ====
100 loops, best of 3: 19.2 msec per loop
==== python3 erat2a ====
100 loops, best of 3: 14.1 msec per loop
==== python3 erat3 ====
100 loops, best of 3: 11.7 msec per loop
</code></pre>
<p><span style="background-color:yellow;">On</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">AMD</span> <span style="background-color:yellow;">Geode</span> <span style="background-color:yellow;">LX</span> <span style="background-color:yellow;">Gentoo</span> <span style="background-color:yellow;">home</span> <span style="background-color:yellow;">server</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2.6.5</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">3.1.2</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>$ testit
up to 8192
==== python2 erat2 ====
10 loops, best of 3: 104 msec per loop
==== python2 erat2a ====
10 loops, best of 3: 81 msec per loop
==== python2 erat3 ====
Traceback (most recent call last):
…
AttributeError: 'module' object has no attribute 'compress'
==== python3 erat2 ====
10 loops, best of 3: 116 msec per loop
==== python3 erat2a ====
10 loops, best of 3: 82 msec per loop
==== python3 erat3 ====
10 loops, best of 3: 66 msec per loop
</code></pre>
<h3><span style="background-color:yellow;">Benchmark</span> <span style="background-color:yellow;">code</span> </h3>
<p><span style="background-color:yellow;">A</span> <span style="background-color:yellow;">primegen.py</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">contains</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">erat2</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">erat2a</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">erat3</span> <span style="background-color:yellow;">functions.</span> <span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">follows</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">testing</span> <span style="background-color:yellow;">script</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>#!/bin/sh
max_num=${1:-8192}
echo up to $max_num
for python_version in python2 python3
do
    for function in erat2 erat2a erat3
    do
        echo "==== $python_version $function ===="
        $python_version -O -m timeit -c \
        -s  "import itertools as it, functools as ft, operator as op, primegen; cmp= ft.partial(op.ge, $max_num)" \
            "next(it.dropwhile(cmp, primegen.$function()))"
    done
done
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">originally</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">however</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">worth</span> <span style="background-color:yellow;">posting.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">original</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">http</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">//code.activestate.com/recipes/117119/</span> </p>
<pre><code>def gen_primes():
  D = {}
  q = 2  # first integer to test for primality.

  while True:
    if q not in D:
      # not marked composite, must be prime  
      yield q 

      #first multiple of q not already marked
      D[q * q] = [q] 
    else:
      for p in D[q]:
        D.setdefault(p + q, []).append(p)
      # no longer need D[q], free memory
      del D[q]

    q += 1
</code></pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">generator</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">other</span> . </p>
<pre><code>primes = gen_primes()
for p in primes:
  print p
</code></pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">takes</span> <span style="background-color:yellow;">1.62s</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">generate</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">put</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">set</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">million</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">desktop</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">Do</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">sliced</span> <span style="background-color:yellow;">sieve</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">where</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">slice</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">determined</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">available</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">maximal</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bitset</span> . </p>
<p><span style="background-color:yellow;">For</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">slice</span> <span style="background-color:yellow;">represent</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">interval</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">slice_size</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">set</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">sieve</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">prime</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">below</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">square</span> <span style="background-color:yellow;">root</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">upper</span> <span style="background-color:yellow;">bound</span> . </p>
<p><span style="background-color:yellow;">Using</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">set</span> <span style="background-color:yellow;">uses</span> <span style="background-color:yellow;">less</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">hash</span> <span style="background-color:yellow;">table</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">tree</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">structure</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">working</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">dense</span> <span style="background-color:yellow;">sets</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">numbers</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">generator</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">little</span> <span style="background-color:yellow;">truer</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">done</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Haskell</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">filtering</span> <span style="background-color:yellow;">against</span> <span style="background-color:yellow;">composites</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">known</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">adding</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">remaining</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> . </p>
<pre><code>def gen_primes():
    primes = []
    i = 2
    while True:
        prime = True
        for p in primes:
            if not (i % p):
                prime = False
                break
        if prime:
            yield i
            primes.append(i)
        i += 1
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wrote</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">article</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">infinite</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">generator</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">times</span> <span style="background-color:yellow;">ago</span> <span style="background-color:yellow;">:</span> </p>
<p><span style="background-color:yellow;">http</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">//stacktrace.it/2008/01/progetto-eulero-problema-3/</span> </p>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Italian</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">pesky</span> <span style="background-color:yellow;">translation</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">Google</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">http</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">//tinyurl.com/yzpyeom</span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">And</span> <span style="background-color:yellow;">another</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">memory-efficient</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">erat3</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import heapq

def heapprimegen():
    hp= []
    yield 2
    cn= 3
    nn, inc= 3, 6
    while 1:
        while cn < nn:
            yield cn
            heapq.heappush(hp, (3*cn, 2*cn))
            cn+= 2
        cn= nn+2
        nn, inc= heapq.heappushpop(hp, (nn+inc, inc))
</code></pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">maintains</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">heap</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">prime</span> <span style="background-color:yellow;">multiples</span> <span style="background-color:yellow;">rather</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dictionary.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">loses</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">obviously</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">7</span> </b><br /><p><span style="background-color:yellow;">Another</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import itertools
def primeseq():
    prime = [2]
    num = 0
    yield 2
    for i in itertools.count(3, 2):
        is_prime = True
        for num in prime:
            if i % num == 0:
                is_prime = False
                break
            elif num ** 2 > i: 
                break
        if is_prime:
            prime.append(i)
            yield i
</code></pre>
<br />