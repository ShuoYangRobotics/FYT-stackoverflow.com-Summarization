<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-2677713</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Regex</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">finding</span> <span style="background-color:yellow;">valid</span> <span style="background-color:yellow;">sphinx</span> <span style="background-color:yellow;">fields</span> </h2><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">trying</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">validate</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fields</span> <span style="background-color:yellow;">given</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">sphinx</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">valid</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">having</span> <span style="background-color:yellow;">difficulty</span> . </p>
<p><span style="background-color:yellow;">Imagine</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">valid</span> <span style="background-color:yellow;">fields</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">mouse</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">dog</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">puppy</span> . </p>
<p><span style="background-color:yellow;">Valid</span> <span style="background-color:yellow;">searches</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">:</span> </p>
<ul><span style="background-color:yellow;">@</span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">search</span> <span style="background-color:yellow;">terms</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">search</span> <span style="background-color:yellow;">terms</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">dog</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">search</span> <span style="background-color:yellow;">term</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">searchterm1</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">dog</span> <span style="background-color:yellow;">searchterm2</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">dog</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">searchterm1</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">mouse</span> <span style="background-color:yellow;">searchterm2</span> </ul>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">regular</span> <span style="background-color:yellow;">expression</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">terms</span> <span style="background-color:yellow;">such</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">dog</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">mouse</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">above</span> <span style="background-color:yellow;">examples</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">check</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">against</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">valid</span> <span style="background-color:yellow;">terms</span> . </p>
<p><span style="background-color:yellow;">Thus</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">query</span> <span style="background-color:yellow;">such</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">goat</span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">Would</span> <span style="background-color:yellow;">produce</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">error</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">goat</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">valid</span> <span style="background-color:yellow;">term</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">gotten</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">queries</span> <span style="background-color:yellow;">such</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;"></span> ? <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">^</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">But</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">ca</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">figure</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">rest</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">&amp</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">django</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">worth</span> . </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-6</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">To</span> <span style="background-color:yellow;">match</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">allowed</span> <span style="background-color:yellow;">fields</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">rather</span> <span style="background-color:yellow;">fearful</span> <span style="background-color:yellow;">looking</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">:</span> </p>
<pre>
@((?:cat|mouse|dog|puppy)\b|\((?:(?:cat|mouse|dog|puppy)(?:, *|(?=\))))+\))
</pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">returns</span> <span style="background-color:yellow;">these</span> <span style="background-color:yellow;">matches</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">order</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">dog</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">dog</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">dog</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">mouse</span> . </p>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">regex</span> <span style="background-color:yellow;">breaks</span> <span style="background-color:yellow;">down</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">follows</span> <span style="background-color:yellow;">:</span> </p>
<pre>
@                               # the literal character "@"
(                               # match group 1
  (?:cat|mouse|dog|puppy)       #  one of your valid search terms (not captured)
  \b                            #  a word boundary
  |                             #  or...
  \(                            #  a literal opening paren
  (?:                           #  non-capturing group
    (?:cat|mouse|dog|puppy)     #   one of your valid search terms (not captured)
    (?:                         #   non-capturing group
      , *                       #    a comma "," plus any number of spaces
      |                         #    or...
      (?=\))                    #    a position followed by a closing paren
    )                           #   end non-capture group
  )+                            #  end non-capture group, repeat
  \)                            #  a literal closing paren
)                               # end match group one.
</pre>
<p><span style="background-color:yellow;">Now</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">identify</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">invalid</span> <span style="background-color:yellow;">search</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">wrap</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">negative</span> <span style="background-color:yellow;">look-ahead</span> <span style="background-color:yellow;">:</span> </p>
<pre>
@(?!(?:cat|mouse|dog|puppy)\b|\((?:(?:cat|mouse|dog|puppy)(?:, *|(?=\))))+\))
--^^
</pre>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">identify</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">character</span> <span style="background-color:yellow;">after</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">invalid</span> <span style="background-color:yellow;">search</span> <span style="background-color:yellow;">term</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">term</span> <span style="background-color:yellow;">combination</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">attempted.</span> <span style="background-color:yellow;">Modifying</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">matches</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">invalid</span> <span style="background-color:yellow;">attempt</span> <span style="background-color:yellow;">instead</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">pointing</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">hard</span> <span style="background-color:yellow;">anymore</span> . </p>
<p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">prepare</span> <span style="background-color:yellow;"></span> ? <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">|</span> <span style="background-color:yellow;">mouse</span> <span style="background-color:yellow;">|</span> <span style="background-color:yellow;">dog</span> <span style="background-color:yellow;">|</span> <span style="background-color:yellow;">puppy</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">field</span> <span style="background-color:yellow;">dynamically</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">plug</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">static</span> <span style="background-color:yellow;">rest</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">regex.</span> <span style="background-color:yellow;">Should</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">too</span> <span style="background-color:yellow;">hard</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">either</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>@\((cat|dog|mouse|puppy)\b(,\s*(cat|dog|mouse|puppy)\b)*\)|@(cat|dog|mouse|puppy)\b
</code></pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">either</span> <span style="background-color:yellow;">match</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">parameter</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">parenthesized</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">par1</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">par2</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">containing</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">allowed</span> <span style="background-color:yellow;">words</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;"></span> . </p>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">makes</span> <span style="background-color:yellow;">sure</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">partial</span> <span style="background-color:yellow;">matches</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">accepted</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">caterpillar</span> <span style="background-color:yellow;"></span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">pyparsing</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">follows</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">similar</span> <span style="background-color:yellow;">logic</span> <span style="background-color:yellow;">path</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">posted</span> <span style="background-color:yellow;">answer.</span> <span style="background-color:yellow;">All</span> <span style="background-color:yellow;">tags</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">matched</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">checked</span> <span style="background-color:yellow;">against</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">known</span> <span style="background-color:yellow;">valid</span> <span style="background-color:yellow;">tags</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">removing</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">reported</span> <span style="background-color:yellow;">results.</span> <span style="background-color:yellow;">Only</span> <span style="background-color:yellow;">those</span> <span style="background-color:yellow;">matches</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">left</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">after</span> <span style="background-color:yellow;">removing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">valid</span> <span style="background-color:yellow;">ones</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">reported</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">matches</span> . </p>
<pre><code>from pyparsing import *

# define the pattern of a tag, setting internal results names for easy validation
AT,LPAR,RPAR = map(Suppress,"@()")
term = Word(alphas,alphanums).setResultsName("terms",listAllMatches=True)
sphxTerm = AT + ~White() + ( term | LPAR + delimitedList(term) + RPAR )

# define tags we consider to be valid
valid = set("cat mouse dog".split())

# define a parse action to filter out valid terms, and attach to the sphxTerm
def filterValid(tokens):
    tokens = [t for t in tokens.terms if t not in valid]
    if not(tokens):
        raise ParseException("",0,"")
    return tokens
sphxTerm.setParseAction(filterValid)


##### Test out the parser #####

test = """@cat search terms @ house
    @(cat) search terms 
    @(cat, dog) search term @(goat)
    @cat searchterm1 @dog searchterm2 @(cat, doggerel)
    @(cat, dog) searchterm1 @mouse searchterm2 
    @caterpillar"""

# scan for invalid terms, and print out the terms and their locations
for t,s,e in sphxTerm.scanString(test):
    print "Terms:%s Line: %d Col: %d" % (t, lineno(s, test), col(s, test))
    print line(s, test)
    print " "*(col(s,test)-1)+"^"
    print
</code></pre>
<p><span style="background-color:yellow;">With</span> <span style="background-color:yellow;">these</span> <span style="background-color:yellow;">lovely</span> <span style="background-color:yellow;">results</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>Terms:['goat'] Line: 3 Col: 29
    @(cat, dog) search term @(goat)
                            ^

Terms:['doggerel'] Line: 4 Col: 39
    @cat searchterm1 @dog searchterm2 @(cat, doggerel)
                                      ^

Terms:['caterpillar'] Line: 6 Col: 5
    @caterpillar
    ^
</code></pre>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">last</span> <span style="background-color:yellow;">snippet</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">scanning</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">give</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">invalid</span> <span style="background-color:yellow;">tags</span> <span style="background-color:yellow;">:</span> </p>
<pre><code># print out all of the found invalid terms
print list(set(sum(sphxTerm.searchString(test), ParseResults([]))))
</code></pre>
<p><span style="background-color:yellow;">Prints</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>['caterpillar', 'goat', 'doggerel']
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">match</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">fields</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">dog</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">mouse</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">puppy</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">combinations</span> <span style="background-color:yellow;">thereof</span> . </p>
<pre><code>import re
sphinx_term = "@goat some words to search"
regex = re.compile("@\(?(cat|dog|mouse|puppy)(, ?(cat|dog|mouse|puppy))*\)? ")
if regex.search(sphinx_term):
    send the query to sphinx...
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">Try</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>field_re = re.compile(r"@(?:([^()\s]+)|\([^()]+\))")
</code></pre>
<p><span style="background-color:yellow;">A</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">field</span> <span style="background-color:yellow;">name</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">captured</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">group</span> <span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">names</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">parenthesized</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">dog</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">stored</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">group</span> <span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2.</span> <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">latter</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">break</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">down</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">split</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">capture</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">names</span> <span style="background-color:yellow;">individually</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">regex</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">ended</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">different</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">none</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">above</span> <span style="background-color:yellow;">worked.</span> <span style="background-color:yellow;">First</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fields</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">cat</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>attributes = re.findall('(?:@)([^\( ]*)', query)
</code></pre>
<p><span style="background-color:yellow;">Next</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">complicated</span> <span style="background-color:yellow;">ones</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>regex0 = re.compile('''
    @               # at sign
    (?:             # start non-capturing group
        \w+             # non-whitespace, one or more
        \b              # a boundary character (i.e. no more \w)
        |               # OR
        (               # capturing group
            \(              # left paren
            [^@(),]+        # not an @(),
            (?:                 # another non-caputing group
                , *             # a comma, then some spaces
                [^@(),]+        # not @(),
            )*              # some quantity of this non-capturing group
            \)              # a right paren
        )               # end of non-capuring group
    )           # end of non-capturing group
    ''', re.VERBOSE)

# and this puts them into the attributes list.
groupedAttributes = re.findall(regex0, query)
for item in groupedAttributes:
    attributes.extend(item.strip("(").strip(")").split(", "))
</code></pre>
<p><span style="background-color:yellow;">Next</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">checked</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">attributes</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">were</span> <span style="background-color:yellow;">valid</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">added</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">uniquely</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">array</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<pre><code># check if the values are valid.
validRegex = re.compile(r'^mice$|^mouse$|^cat$|^dog$')

# if they aren't add them to a new list.
badAttrs = []
for attribute in attributes:
    if len(attribute) == 0:
        # if it's a zero length attribute, we punt
        continue
    if validRegex.search(attribute.lower()) == None:
        # if the attribute from the search isn't in the valid list
        if attribute not in badAttrs:
            # and the attribute isn't already in the list
            badAttrs.append(attribute)
</code></pre>
<p><span style="background-color:yellow;">Thanks</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">help</span> <span style="background-color:yellow;">though.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">glad</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">had</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">!</span> </p>
<br />