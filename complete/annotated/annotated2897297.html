<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-2897297</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Speed</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">bitstring/bit</span> <span style="background-color:yellow;">operations</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> ? </h2><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wrote</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">prime</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">generator</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">Sieve</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">Eratosthenes</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">3.1.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">runs</span> <span style="background-color:yellow;">correctly</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">gracefully</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">0.32</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">ideone.com</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">generate</span> <span style="background-color:yellow;">prime</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">1,000,000</span> . </p>
<pre><code># from bitstring import BitString

def prime_numbers(limit=1000000):
    '''Prime number generator. Yields the series
    2, 3, 5, 7, 11, 13, 17, 19, 23, 29 ...    
    using Sieve of Eratosthenes.
    '''
    yield 2
    sub_limit = int(limit**0.5) 
    flags = [False, False] + [True] * (limit - 2)   
#     flags = BitString(limit)
    # Step through all the odd numbers
    for i in range(3, limit, 2):       
        if flags[i] is False:
#        if flags[i] is True:
            continue
        yield i
        # Exclude further multiples of the current prime number
        if i <= sub_limit:
            for j in range(i*3, limit, i<<1):
                flags[j] = False
#                flags[j] = True
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">problem</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">run</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">try</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">generate</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">1,000,000,000</span> . </p>
<pre><code>    flags = [False, False] + [True] * (limit - 2)   
MemoryError
</code></pre>
<p><span style="background-color:yellow;">As</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">imagine</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">allocating</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">billion</span> <span style="background-color:yellow;">boolean</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">byte</span> <span style="background-color:yellow;">4</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">8</span> <span style="background-color:yellow;">bytes</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">comment</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">feasible</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">looked</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">bitstring</span> . <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">figured</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">flag</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">memory-efficient.</span> <span style="background-color:yellow;">However</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">program</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">performance</span> <span style="background-color:yellow;">dropped</span> <span style="background-color:yellow;">drastically</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">24</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">runtime</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">prime</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">1,000,000.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">probably</span> <span style="background-color:yellow;">due</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">internal</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">bitstring</span> . </p>
<p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">comment/uncomment</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">three</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">changed</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">BitString</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">snippet</span> <span style="background-color:yellow;">above</span> . </p>
<p><span style="background-color:yellow;">My</span> <span style="background-color:yellow;">question</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">program</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">bitstring</span> ? </p>
<p><span style="background-color:yellow;">Edit</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">Please</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">yourself</span> <span style="background-color:yellow;">before</span> <span style="background-color:yellow;">posting.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">ca</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">accept</span> <span style="background-color:yellow;">answers</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">run</span> <span style="background-color:yellow;">slower</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">existing</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">naturally</span> . </p>
<p><span style="background-color:yellow;">Edit</span> <span style="background-color:yellow;">again</span> <span style="background-color:yellow;">:</span> </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">compiled</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">benchmarks</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">machine</span> . </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-10</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">There</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">couple</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">small</span> <span style="background-color:yellow;">optimizations</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">version.</span> <span style="background-color:yellow;">By</span> <span style="background-color:yellow;">reversing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">roles</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">True</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">False</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">change</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">flags</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">False</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">flags</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">"</span> . <span style="background-color:yellow;">And</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">starting</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">second</span> <span style="background-color:yellow;">range</span> <span style="background-color:yellow;">statement</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">instead</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">3</span> . <span style="background-color:yellow;">Your</span> <span style="background-color:yellow;">original</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">takes</span> <span style="background-color:yellow;">0.166</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">system.</span> <span style="background-color:yellow;">With</span> <span style="background-color:yellow;">those</span> <span style="background-color:yellow;">changes</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">below</span> <span style="background-color:yellow;">takes</span> <span style="background-color:yellow;">0.156</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">system</span> . </p>
<pre><code>def prime_numbers(limit=1000000):
    '''Prime number generator. Yields the series
    2, 3, 5, 7, 11, 13, 17, 19, 23, 29 ...
    using Sieve of Eratosthenes.
    '''
    yield 2
    sub_limit = int(limit**0.5)
    flags = [True, True] + [False] * (limit - 2)
    # Step through all the odd numbers
    for i in range(3, limit, 2):
        if flags[i]:
            continue
        yield i
        # Exclude further multiples of the current prime number
        if i <= sub_limit:
            for j in range(i*i, limit, i<<1):
                flags[j] = True
</code></pre>
<p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">help</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">issue</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">though</span> . </p>
<p><span style="background-color:yellow;">Moving</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">world</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">C</span> <span style="background-color:yellow;">extensions</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">development</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">gmpy</span> . <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Disclaimer</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">maintainers.</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">development</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">called</span> <span style="background-color:yellow;">gmpy2</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">supports</span> <span style="background-color:yellow;">mutable</span> <span style="background-color:yellow;">integers</span> <span style="background-color:yellow;">called</span> <span style="background-color:yellow;">xmpz.</span> <span style="background-color:yellow;">Using</span> <span style="background-color:yellow;">gmpy2</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">running</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">0.140</span> <span style="background-color:yellow;">seconds.</span> <span style="background-color:yellow;">Running</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">limit</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">1,000,000,000</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">158</span> <span style="background-color:yellow;">seconds</span> . </p>
<pre><code>import gmpy2

def prime_numbers(limit=1000000):
    '''Prime number generator. Yields the series
    2, 3, 5, 7, 11, 13, 17, 19, 23, 29 ...
    using Sieve of Eratosthenes.
    '''
    yield 2
    sub_limit = int(limit**0.5)
    # Actual number is 2*bit_position + 1.
    oddnums = gmpy2.xmpz(1)
    current = 0
    while True:
        current += 1
        current = oddnums.bit_scan0(current)
        prime = 2 * current + 1
        if prime > limit:
            break
        yield prime
        # Exclude further multiples of the current prime number
        if prime <= sub_limit:
            for j in range(2*current*(current+1), limit>>1, prime):
                oddnums.bit_set(j)
</code></pre>
<p><span style="background-color:yellow;">Pushing</span> <span style="background-color:yellow;">optimizations</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">sacrificing</span> <span style="background-color:yellow;">clarity</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">running</span> <span style="background-color:yellow;">times</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">0.107</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">123</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import gmpy2

def prime_numbers(limit=1000000):
    '''Prime number generator. Yields the series
    2, 3, 5, 7, 11, 13, 17, 19, 23, 29 ...
    using Sieve of Eratosthenes.
    '''
    yield 2
    sub_limit = int(limit**0.5)
    # Actual number is 2*bit_position + 1.
    oddnums = gmpy2.xmpz(1)
    f_set = oddnums.bit_set
    f_scan0 = oddnums.bit_scan0
    current = 0
    while True:
        current += 1
        current = f_scan0(current)
        prime = 2 * current + 1
        if prime > limit:
            break
        yield prime
        # Exclude further multiples of the current prime number
        if prime <= sub_limit:
            list(map(f_set,range(2*current*(current+1), limit>>1, prime)))
</code></pre>
<p><span style="background-color:yellow;">Edit</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">Based</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">exercise</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">modified</span> <span style="background-color:yellow;">gmpy2</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">accept</span> <span style="background-color:yellow;">xmpz.bit_set</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">iterator</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">Using</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">run</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">less</span> <span style="background-color:yellow;">1,000,000,000</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">56</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2.7</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">74</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">3.2.</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">As</span> <span style="background-color:yellow;">noted</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">comments</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">xrange</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">range</span> . <span style="background-color:yellow;"></span> </p>
<pre><code>import gmpy2

try:
    range = xrange
except NameError:
    pass

def prime_numbers(limit=1000000):
    '''Prime number generator. Yields the series
    2, 3, 5, 7, 11, 13, 17, 19, 23, 29 ...
    using Sieve of Eratosthenes.
    '''
    yield 2
    sub_limit = int(limit**0.5)
    oddnums = gmpy2.xmpz(1)
    f_scan0 = oddnums.bit_scan0
    current = 0
    while True:
        current += 1
        current = f_scan0(current)
        prime = 2 * current + 1
        if prime > limit:
            break
        yield prime
        if prime <= sub_limit:
            oddnums.bit_set(iter(range(2*current*(current+1), limit>>1, prime)))
</code></pre>
<p><span style="background-color:yellow;">Edit</span> <span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">One</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">try</span> <span style="background-color:yellow;">!</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">modified</span> <span style="background-color:yellow;">gmpy2</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">accept</span> <span style="background-color:yellow;">xmpz.bit_set</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">slice</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">Using</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">run</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">less</span> <span style="background-color:yellow;">1,000,000,000</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">40</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">both</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2.7</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">3.2</span> . </p>
<pre><code>from __future__ import print_function
import time
import gmpy2

def prime_numbers(limit=1000000):
    '''Prime number generator. Yields the series
    2, 3, 5, 7, 11, 13, 17, 19, 23, 29 ...
    using Sieve of Eratosthenes.
    '''
    yield 2
    sub_limit = int(limit**0.5)
    flags = gmpy2.xmpz(1)
    # pre-allocate the total length
    flags.bit_set((limit>>1)+1)
    f_scan0 = flags.bit_scan0
    current = 0
    while True:
        current += 1
        current = f_scan0(current)
        prime = 2 * current + 1
        if prime > limit:
            break
        yield prime
        if prime <= sub_limit:
            flags.bit_set(slice(2*current*(current+1), limit>>1, prime))

start = time.time()
result = list(prime_numbers(1000000000))
print(time.time() - start)
</code></pre>
<p><span style="background-color:yellow;">Edit</span> <span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">updated</span> <span style="background-color:yellow;">gmpy2</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">properly</span> <span style="background-color:yellow;">support</span> <span style="background-color:yellow;">slicing</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">level</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">xmpz.</span> <span style="background-color:yellow;">No</span> <span style="background-color:yellow;">change</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">performance</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">nice</span> <span style="background-color:yellow;">API.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">done</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">little</span> <span style="background-color:yellow;">tweaking</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">got</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">down</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">37</span> <span style="background-color:yellow;">seconds</span> . </p>
<pre><code>from __future__ import print_function
import time
import gmpy2

def prime_numbers(limit=1000000):
    '''Prime number generator. Yields the series
    2, 3, 5, 7, 11, 13, 17, 19, 23, 29 ...
    using Sieve of Eratosthenes.
    '''
    sub_limit = int(limit**0.5)
    flags = gmpy2.xmpz(1)
    flags[(limit>>1)+1] = True
    f_scan0 = flags.bit_scan0
    current = 0
    prime = 2
    while prime <= sub_limit:
        yield prime
        current += 1
        current = f_scan0(current)
        prime = 2 * current + 1
        flags[2*current*(current+1):limit>>1:prime] = True
    while prime <= limit:
        yield prime
        current += 1
        current = f_scan0(current)
        prime = 2 * current + 1

start = time.time()
result = list(prime_numbers(1000000000))
print(time.time() - start)
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">OK</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">second</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">essence</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">thought</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">had</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">mention</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bitarray</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">bitstring</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">nemesis</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">ideally</span> <span style="background-color:yellow;">suited</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">C</span> <span style="background-color:yellow;">extension</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">pure</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">hope</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">supports</span> <span style="background-color:yellow;">slice</span> <span style="background-color:yellow;">assignments.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">yet</span> <span style="background-color:yellow;">available</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;">though</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">tried</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">optimise</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">rewrote</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bitstring</span> <span style="background-color:yellow;">version.</span> <span style="background-color:yellow;">On</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">machine</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">0.16</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">under</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">million</span> . </p>
<p><span style="background-color:yellow;">For</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">billion</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">runs</span> <span style="background-color:yellow;">perfectly</span> <span style="background-color:yellow;">well</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">completes</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">minutes</span> <span style="background-color:yellow;">31</span> <span style="background-color:yellow;">seconds</span> . </p>
<pre><code>import bitarray

def prime_bitarray(limit=1000000):
    yield 2
    flags = bitarray.bitarray(limit)
    flags.setall(False)
    sub_limit = int(limit**0.5)
    for i in xrange(3, limit, 2):
        if not flags[i]:
            yield i
            if i <= sub_limit:
                flags[3*i:limit:i*2] = True
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">Okay</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">near</span> <span style="background-color:yellow;">complete</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">comprehensive</span> <span style="background-color:yellow;">benchmarking</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">done</span> <span style="background-color:yellow;">tonight</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">runs</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest.</span> <span style="background-color:yellow;">Hopefully</span> <span style="background-color:yellow;">someone</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">useful.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">omitted</span> <span style="background-color:yellow;">anything</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">takes</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">30</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">complete</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">machine</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">thank</span> <span style="background-color:yellow;">everyone</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">put</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">input.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">gained</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">insight</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">efforts</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">hope</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">too</span> . </p>
<p><span style="background-color:yellow;">My</span> <span style="background-color:yellow;">machine</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">AMD</span> <span style="background-color:yellow;">ZM-86</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">2.40</span> <span style="background-color:yellow;">Ghz</span> <span style="background-color:yellow;">Dual-Core</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">4GB</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">RAM.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">HP</span> <span style="background-color:yellow;">Touchsmart</span> <span style="background-color:yellow;">Tx2</span> <span style="background-color:yellow;">laptop.</span> <span style="background-color:yellow;">Note</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">linked</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">pastebin</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">benchmarked</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">own</span> <span style="background-color:yellow;">machine</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">gmpy2</span> <span style="background-color:yellow;">benchmark</span> <span style="background-color:yellow;">once</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">able</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">build</span> <span style="background-color:yellow;">it</span> . </p>
<p><span style="background-color:yellow;">All</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">benchmarks</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">tested</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2.6</span> <span style="background-color:yellow;">x86</span> </p>
<blockquote><span style="background-color:yellow;">Returning</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">prime</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">1,000,000</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Using</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">generators</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Sebastian</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">generator</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">updated</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">121</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">Mark</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">Sieve</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">Wheel</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">154</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">Robert</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">slicing</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">159</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">My</span> <span style="background-color:yellow;">improved</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">slicing</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">205</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">Numpy</span> <span style="background-color:yellow;">generator</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">enumerate</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">249</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">Mark</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">Basic</span> <span style="background-color:yellow;">Sieve</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">317</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">casevh</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">improvement</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">original</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">343</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">My</span> <span style="background-color:yellow;">modified</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">generator</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">407</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">My</span> <span style="background-color:yellow;">original</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">question</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">409</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">Bitarray</span> <span style="background-color:yellow;">Solution</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">414</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">Pure</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">bytearray</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">1394</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">Scott</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">BitString</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">6659</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">means</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">capable</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">generating</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">1,000,000,000</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">machine</span> <span style="background-color:yellow;">setup</span> . <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">addition</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">generator</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">whole</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">once</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">RosettaCode</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">32</span> <span style="background-color:yellow;">ms</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">capable</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">generating</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">billion</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">took</span> <span style="background-color:yellow;">61.6259</span> <span style="background-color:yellow;">seconds.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">suspect</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">swapped</span> <span style="background-color:yellow;">once</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">hence</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">double</span> <span style="background-color:yellow;">time.</span> <span style="background-color:yellow;"></span> </blockquote>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">Related</span> <span style="background-color:yellow;">question</span> . <span style="background-color:yellow;">Fastest</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">below</span> <span style="background-color:yellow;">N</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">python</span> </p>
<p><span style="background-color:yellow;">Hi</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">too</span> <span style="background-color:yellow;">looking</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">generate</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">10</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">9</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">fast</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">difficult</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">problem.</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">now</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">came</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">generate</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">10</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">6</span> <span style="background-color:yellow;">&amp</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">10</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">7</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">0,171s</span> <span style="background-color:yellow;">&amp</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">1,764s</span> <span style="background-color:yellow;">respectively</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">old</span> <span style="background-color:yellow;">machine</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">slightly</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">least</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">computer</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">My</span> <span style="background-color:yellow;">improved</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">slicing</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">previous</span> <span style="background-color:yellow;">post,probably</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">n//i-i</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">below</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">instead</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">analogous</span> <span style="background-color:yellow;">len</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">flags</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">i2</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">i&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">code.</span> <span style="background-color:yellow;">please</span> <span style="background-color:yellow;">correct</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">wrong.</span> <span style="background-color:yellow;">Any</span> <span style="background-color:yellow;">suggestion</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">improvement</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">welcome</span> . </p>
<pre><code>def primes(n):
    """ Returns  a list of primes < n """
    sieve = [True] * n
    for i in xrange(3,int(n**0.5)+1,2):
        if sieve[i]:
            sieve[i*i::2*i]=[False]*((n-i*i-1)/(2*i)+1)
    return [2] + [i for i in xrange(3,n,2) if sieve[i]]
</code></pre>
<p><span style="background-color:yellow;">In</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">his</span> <span style="background-color:yellow;">codes</span> <span style="background-color:yellow;">Xavier</span> <span style="background-color:yellow;">uses</span> <span style="background-color:yellow;">flags</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">i2</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">i&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">len</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">flags</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">i2</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">i&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">computed</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">explicit</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fact</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">between</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">i..n</span> <span style="background-color:yellow;">we</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">n-i</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">//2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">multiples</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">we</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">count</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">we</span> <span style="background-color:yellow;">sum</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">len</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">sieve</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">equal</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">n-i</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">//</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">faster.</span> <span style="background-color:yellow;">A</span> <span style="background-color:yellow;">basic</span> <span style="background-color:yellow;">generator</span> <span style="background-color:yellow;">based</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">above</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def primesgen(n):
    """ Generates all primes <= n """
    sieve = [True] * n
    yield 2
    for i in xrange(3,int(n**0.5)+1,2):
        if sieve[i]:
            yield i
            sieve[i*i::2*i] = [False]*((n-i*i-1)/(2*i)+1)
    for i in xrange(i+2,n,2):
        if sieve[i]: yield i
</code></pre>
<p><span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">modification</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">write</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">slightly</span> <span style="background-color:yellow;">slower</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">above</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">start</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">sieve</span> <span style="background-color:yellow;">half</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">sieve</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">True</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">n//2</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">n.</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">sure</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">reflect</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">issue.</span> <span style="background-color:yellow;">As</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">modified</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">rosetta</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">maybe</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">starting</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">sieve</span> <span style="background-color:yellow;">half</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">size</span> . </p>
<pre><code>import numpy
def primesfrom3to(n):
    """ Returns a array of primes, 3 <= p < n """
    sieve = numpy.ones(n/2, dtype=numpy.bool)
    for i in xrange(3,int(n**0.5)+1,2):
        if sieve[i/2]: sieve[i*i/2::i] = False
    return 2*numpy.nonzero(sieve)[0][1::]+1
</code></pre>
<p><span style="background-color:yellow;">A</span> <span style="background-color:yellow;">Faster</span> <span style="background-color:yellow;">&amp</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">memory-wise</span> <span style="background-color:yellow;">generator</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import numpy
def primesgen1(n):
""" Input n>=6, Generates all primes < n """
sieve1 = numpy.ones(n/6+1, dtype=numpy.bool)
sieve5 = numpy.ones(n/6  , dtype=numpy.bool)
sieve1[0] = False
yield 2; yield 3;
for i in xrange(int(n**0.5)/6+1):
    if sieve1[i]:
        k=6*i+1; yield k;
        sieve1[ ((k*k)/6) ::k] = False
        sieve5[(k*k+4*k)/6::k] = False
    if sieve5[i]:
        k=6*i+5; yield k;
        sieve1[ ((k*k)/6) ::k] = False
        sieve5[(k*k+2*k)/6::k] = False
for i in xrange(i+1,n/6):
        if sieve1[i]: yield 6*i+1
        if sieve5[i]: yield 6*i+5
if n%6 > 1:
    if sieve1[i+1]: yield 6*(i+1)+1
</code></pre>
<p><span style="background-color:yellow;">or</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import numpy
def primesgen(n):
    """ Input n>=30, Generates all primes < n """
    size = n/30 + 1
    sieve01 = numpy.ones(size, dtype=numpy.bool)
    sieve07 = numpy.ones(size, dtype=numpy.bool)
    sieve11 = numpy.ones(size, dtype=numpy.bool)
    sieve13 = numpy.ones(size, dtype=numpy.bool)
    sieve17 = numpy.ones(size, dtype=numpy.bool)
    sieve19 = numpy.ones(size, dtype=numpy.bool)
    sieve23 = numpy.ones(size, dtype=numpy.bool)
    sieve29 = numpy.ones(size, dtype=numpy.bool)
    sieve01[0] = False
    yield 2; yield 3; yield 5;
    for i in xrange(int(n**0.5)/30+1):
        if sieve01[i]:
            k=30*i+1; yield k;
            sieve01[     (k*k)/30::k] = False
            sieve07[(k*k+ 6*k)/30::k] = False
            sieve11[(k*k+10*k)/30::k] = False
            sieve13[(k*k+12*k)/30::k] = False
            sieve17[(k*k+16*k)/30::k] = False
            sieve19[(k*k+18*k)/30::k] = False
            sieve23[(k*k+22*k)/30::k] = False
            sieve29[(k*k+28*k)/30::k] = False
        if sieve07[i]:
            k=30*i+7; yield k;
            sieve01[(k*k+ 6*k)/30::k] = False
            sieve07[(k*k+24*k)/30::k] = False
            sieve11[(k*k+16*k)/30::k] = False
            sieve13[(k*k+12*k)/30::k] = False
            sieve17[(k*k+ 4*k)/30::k] = False
            sieve19[     (k*k)/30::k] = False
            sieve23[(k*k+22*k)/30::k] = False
            sieve29[(k*k+10*k)/30::k] = False
        if sieve11[i]:
            k=30*i+11; yield k;
            sieve01[     (k*k)/30::k] = False
            sieve07[(k*k+ 6*k)/30::k] = False
            sieve11[(k*k+20*k)/30::k] = False
            sieve13[(k*k+12*k)/30::k] = False
            sieve17[(k*k+26*k)/30::k] = False
            sieve19[(k*k+18*k)/30::k] = False
            sieve23[(k*k+ 2*k)/30::k] = False
            sieve29[(k*k+ 8*k)/30::k] = False
        if sieve13[i]:
            k=30*i+13; yield k;
            sieve01[(k*k+24*k)/30::k] = False
            sieve07[(k*k+ 6*k)/30::k] = False
            sieve11[(k*k+ 4*k)/30::k] = False
            sieve13[(k*k+18*k)/30::k] = False
            sieve17[(k*k+16*k)/30::k] = False
            sieve19[     (k*k)/30::k] = False
            sieve23[(k*k+28*k)/30::k] = False
            sieve29[(k*k+10*k)/30::k] = False
        if sieve17[i]:
            k=30*i+17; yield k;
            sieve01[(k*k+ 6*k)/30::k] = False
            sieve07[(k*k+24*k)/30::k] = False
            sieve11[(k*k+26*k)/30::k] = False
            sieve13[(k*k+12*k)/30::k] = False
            sieve17[(k*k+14*k)/30::k] = False
            sieve19[     (k*k)/30::k] = False
            sieve23[(k*k+ 2*k)/30::k] = False
            sieve29[(k*k+20*k)/30::k] = False
        if sieve19[i]:
            k=30*i+19; yield k;
            sieve01[     (k*k)/30::k] = False
            sieve07[(k*k+24*k)/30::k] = False
            sieve11[(k*k+10*k)/30::k] = False
            sieve13[(k*k+18*k)/30::k] = False
            sieve17[(k*k+ 4*k)/30::k] = False
            sieve19[(k*k+12*k)/30::k] = False
            sieve23[(k*k+28*k)/30::k] = False
            sieve29[(k*k+22*k)/30::k] = False
        if sieve23[i]:
            k=30*i+23; yield k;
            sieve01[(k*k+24*k)/30::k] = False
            sieve07[(k*k+ 6*k)/30::k] = False
            sieve11[(k*k+14*k)/30::k] = False
            sieve13[(k*k+18*k)/30::k] = False
            sieve17[(k*k+26*k)/30::k] = False
            sieve19[     (k*k)/30::k] = False
            sieve23[(k*k+ 8*k)/30::k] = False
            sieve29[(k*k+20*k)/30::k] = False
        if sieve29[i]:
            k=30*i+29; yield k;
            sieve01[     (k*k)/30::k] = False
            sieve07[(k*k+24*k)/30::k] = False
            sieve11[(k*k+20*k)/30::k] = False
            sieve13[(k*k+18*k)/30::k] = False
            sieve17[(k*k+14*k)/30::k] = False
            sieve19[(k*k+12*k)/30::k] = False
            sieve23[(k*k+ 8*k)/30::k] = False
            sieve29[(k*k+ 2*k)/30::k] = False
    for i in xrange(i+1,n/30):
            if sieve01[i]: yield 30*i+1
            if sieve07[i]: yield 30*i+7
            if sieve11[i]: yield 30*i+11
            if sieve13[i]: yield 30*i+13
            if sieve17[i]: yield 30*i+17
            if sieve19[i]: yield 30*i+19
            if sieve23[i]: yield 30*i+23
            if sieve29[i]: yield 30*i+29
    i += 1
    mod30 = n%30
    if mod30 > 1:
        if sieve01[i]: yield 30*i+1
    if mod30 > 7:
        if sieve07[i]: yield 30*i+7
    if mod30 > 11:
        if sieve11[i]: yield 30*i+11
    if mod30 > 13:
        if sieve13[i]: yield 30*i+13
    if mod30 > 17:
        if sieve17[i]: yield 30*i+17
    if mod30 > 19:
        if sieve19[i]: yield 30*i+19
    if mod30 > 23:
        if sieve23[i]: yield 30*i+23
</code></pre>
<p><span style="background-color:yellow;">Ps</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">suggestions</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">anything</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">change</span> <span style="background-color:yellow;">order</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">operations</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">pre-computing</span> <span style="background-color:yellow;">anything</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">please</span> <span style="background-color:yellow;">comment</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">One</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">improvement</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">bitstring</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">'set</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">exclude</span> <span style="background-color:yellow;">multiples</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">current</span> <span style="background-color:yellow;">number</span> . </p>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">vital</span> <span style="background-color:yellow;">section</span> <span style="background-color:yellow;">becomes</span> </p>
<pre><code>for i in range(3, limit, 2):
    if flags[i]:
        yield i
        if i <= sub_limit:
            flags.set(1, range(i*3, limit, i*2))    
</code></pre>
<p><span style="background-color:yellow;">On</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">machine</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">runs</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;">times</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">original</span> . </p>
<p><span style="background-color:yellow;">My</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">thought</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bitstring</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">represent</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">odd</span> <span style="background-color:yellow;">numbers.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">find</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">unset</span> <span style="background-color:yellow;">bits</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">flags.findall</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">0</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">returns</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">generator.</span> <span style="background-color:yellow;">Not</span> <span style="background-color:yellow;">sure</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">finding</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">patterns</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">terribly</span> <span style="background-color:yellow;">easy</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">efficiently</span> <span style="background-color:yellow;"></span> . </p>
<p><span style="background-color:yellow;">[</span> <span style="background-color:yellow;">Full</span> <span style="background-color:yellow;">disclosure</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wrote</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bitstring</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">got</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">pride</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">stake</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">!</span> <span style="background-color:yellow;">]</span> </p>
<hr />
<p><span style="background-color:yellow;">As</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">comparison</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">taken</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">guts</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bitstring</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">range</span> <span style="background-color:yellow;">checking</span> <span style="background-color:yellow;">etc.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">gives</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">reasonable</span> <span style="background-color:yellow;">lower</span> <span style="background-color:yellow;">limit</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">pure</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">billion</span> <span style="background-color:yellow;">elements</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">changing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">algorithm</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">cheating</span> <span style="background-color:yellow;">!</span> <span style="background-color:yellow;"></span> </p>
<pre><code>def prime_pure(limit=1000000):
    yield 2
    flags = bytearray((limit + 7) // 8)
    sub_limit = int(limit**0.5)
    for i in xrange(3, limit, 2):
        byte, bit = divmod(i, 8)
        if not flags[byte] & (128 >> bit):
            yield i
            if i <= sub_limit:
                for j in xrange(i*3, limit, i*2):
                    byte, bit = divmod(j, 8)
                    flags[byte] |= (128 >> bit)
</code></pre>
<p><span style="background-color:yellow;">On</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">machine</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">runs</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">0.62</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">million</span> <span style="background-color:yellow;">elements</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">means</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">quarter</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bitarray</span> <span style="background-color:yellow;">answer.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">quite</span> <span style="background-color:yellow;">reasonable</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">pure</span> <span style="background-color:yellow;">Python</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wrote</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">back</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">might</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">interesting</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">compare</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">yours</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">speed.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">anything</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">space</span> <span style="background-color:yellow;">problems</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">fact</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">probably</span> <span style="background-color:yellow;">worse</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;"></span> . </p>
<pre><code>from math import sqrt

def basicSieve(n):
    """Given a positive integer n, generate the primes < n."""
    s = [1]*n
    for p in xrange(2, 1+int(sqrt(n-1))):
        if s[p]:
            a = p*p
            s[a::p] = [0] * -((a-n)//p)
    for p in xrange(2, n):
        if s[p]:
            yield p 
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">versions</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">wheel</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">complicated.</span> <span style="background-color:yellow;">Original</span> <span style="background-color:yellow;">source</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">here</span> . </p>
<p><span style="background-color:yellow;">Okay</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">wheel.</span> <span style="background-color:yellow;">wheelSieve</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">main</span> <span style="background-color:yellow;">entry</span> <span style="background-color:yellow;">point</span> . </p>
<pre><code>from math import sqrt
from bisect import bisect_left

def basicSieve(n):
    """Given a positive integer n, generate the primes < n."""
    s = [1]*n
    for p in xrange(2, 1+int(sqrt(n-1))):
        if s[p]:
            a = p*p
            s[a::p] = [0] * -((a-n)//p)
    for p in xrange(2, n):
        if s[p]:
            yield p

class Wheel(object):
    """Class representing a wheel.

    Attributes:
       primelimit -> wheel covers primes < primelimit.
       For example, given a primelimit of 6
       the wheel primes are 2, 3, and 5.
       primes -> list of primes less than primelimit
       size -> product of the primes in primes;  the modulus of the wheel
       units -> list of units modulo size
       phi -> number of units

    """
    def __init__(self, primelimit):
        self.primelimit = primelimit
        self.primes = list(basicSieve(primelimit))

        # compute the size of the wheel
        size = 1
        for p in self.primes:
            size *= p
        self.size = size

        # find the units by sieving
        units = [1] * self.size
        for p in self.primes:
            units[::p] = [0]*(self.size//p)
        self.units = [i for i in xrange(self.size) if units[i]]

        # number of units
        self.phi = len(self.units)

    def to_index(self, n):
        """Compute alpha(n), where alpha is an order preserving map
        from the set of units modulo self.size to the nonnegative integers.

        If n is not a unit, the index of the first unit greater than n
        is given."""
        return bisect_left(self.units, n % self.size) + n // self.size * self.phi

    def from_index(self, i):
        """Inverse of to_index."""

        return self.units[i % self.phi] + i // self.phi * self.size

def wheelSieveInner(n, wheel):
    """Given a positive integer n and a wheel, find the wheel indices of
    all primes that are less than n, and that are units modulo the
    wheel modulus.
    """

    # renaming to avoid the overhead of attribute lookups
    U = wheel.units
    wS = wheel.size
    # inverse of unit map
    UI = dict((u, i) for i, u in enumerate(U))
    nU = len(wheel.units)

    sqroot = 1+int(sqrt(n-1)) # ceiling of square root of n

    # corresponding index (index of next unit up)
    sqrti = bisect_left(U, sqroot % wS) + sqroot//wS*nU
    upper = bisect_left(U, n % wS) + n//wS*nU
    ind2 = bisect_left(U, 2 % wS) + 2//wS*nU

    s = [1]*upper
    for i in xrange(ind2, sqrti):
        if s[i]:
            q = i//nU
            u = U[i%nU]
            p = q*wS+u
            u2 = u*u
            aq, au = (p+u)*q+u2//wS, u2%wS
            wp = p * nU
            for v in U:
                # eliminate entries corresponding to integers
                # congruent to p*v modulo p*wS
                uvr = u*v%wS
                m = aq + (au > uvr)
                bot = (m + (q*v + u*v//wS - m) % p) * nU + UI[uvr]
                s[bot::wp] = [0]*-((bot-upper)//wp)
    return s

def wheelSieve(n, wheel=Wheel(10)):
    """Given a positive integer n, generate the list of primes <= n."""
    n += 1
    wS = wheel.size
    U = wheel.units
    nU = len(wheel.units)
    s = wheelSieveInner(n, wheel)
    return (wheel.primes[:bisect_left(wheel.primes, n)] +
            [p//nU*wS + U[p%nU] for p in xrange(bisect_left(U, 2 % wS)
             + 2//wS*nU, len(s)) if s[p]])
</code></pre>
<p><span style="background-color:yellow;">As</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">wheel</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">well</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">apart</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">odd</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">most</span> <span style="background-color:yellow;">sieves</span> <span style="background-color:yellow;">miss</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">numbers.</span> <span style="background-color:yellow;">Similarly</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">go</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">further</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">notice</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">except</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">congruent</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">5</span> <span style="background-color:yellow;">modulo</span> <span style="background-color:yellow;">6</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">away</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">storing</span> <span style="background-color:yellow;">entries</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">those</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">sieve.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">next</span> <span style="background-color:yellow;">step</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">note</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">except</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">5</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">congruent</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">7</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">11</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">13</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">17</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">19</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">23</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">29</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">modulo</span> <span style="background-color:yellow;">30</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">30</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">3</span> <span style="background-color:yellow;">*</span> <span style="background-color:yellow;">5</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">on</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">integer</span> <span style="background-color:yellow;">types</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">arbitrary</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">clever</span> <span style="background-color:yellow;">bitstring</span> <span style="background-color:yellow;">library</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">represent</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">set</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">bits</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">number</span> . </p>
<p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">handles</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">limit</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">1,000,000</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">ease</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">handle</span> <span style="background-color:yellow;">10,000,000</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">complaining</span> <span style="background-color:yellow;">too</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def multiples_of(n, step, limit):
    bits = 1 << n
    old_bits = bits
    max = 1 << limit
    while old_bits < max:
        old_bits = bits
        bits += bits << step
        step *= 2
    return old_bits

def prime_numbers(limit=10000000):
    '''Prime number generator. Yields the series                                                                        
    2, 3, 5, 7, 11, 13, 17, 19, 23, 29 ...                                                                              
    using Sieve of Eratosthenes.                                                                                        
    '''
    yield 2
    sub_limit = int(limit**0.5)
    flags = ((1 << (limit - 2)) - 1) << 2
    # Step through all the odd numbers                                                                                  
    for i in xrange(3, limit, 2):
        if not (flags & (1 << i)):
            continue
        yield i
        # Exclude further multiples of the current prime number                                                         
        if i <= sub_limit:
            flags &= ~multiples_of(i * 3, i << 1, limit)
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">multiples_of</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">avoids</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">cost</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">setting</span> <span style="background-color:yellow;">every</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">multiple</span> <span style="background-color:yellow;">individually.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">sets</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">initial</span> <span style="background-color:yellow;">bit</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">shifts</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">initial</span> <span style="background-color:yellow;">step</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">&lt</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">1</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">adds</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">result</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">itself.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">doubles</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">step</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">next</span> <span style="background-color:yellow;">shift</span> <span style="background-color:yellow;">copies</span> <span style="background-color:yellow;">both</span> <span style="background-color:yellow;">bits</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">until</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">reaches</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">limit.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">sets</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">multiples</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">limit</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">O</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">log</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">limit</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">time</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">7</span> </b><br /><p><span style="background-color:yellow;">One</span> <span style="background-color:yellow;">option</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">look</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">compiling</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">C/C</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">direct</span> <span style="background-color:yellow;">access</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bit-twiddling</span> <span style="background-color:yellow;">features.</span> <span style="background-color:yellow;">AFAIK</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">write</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">nature</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">return</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">results</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">completion</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">calculations</span> <span style="background-color:yellow;">performed</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">C/C</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">+</span> . <span style="background-color:yellow;">Now</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">typing</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">look</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">numpy</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">store</span> <span style="background-color:yellow;">arrays</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">native</span> <span style="background-color:yellow;">C</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">speed.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bitstring</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">though</span> <span style="background-color:yellow;">!</span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">8</span> </b><br /><p><span style="background-color:yellow;">Another</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">stupid</span> <span style="background-color:yellow;">option</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">help</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">large</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">available</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">fast.</span> <span style="background-color:yellow;">Say</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">tool</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">project</span> <span style="background-color:yellow;">Euler</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">problems</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">problem</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">optimizing</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">mind</span> <span style="background-color:yellow;">game</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">irrelevant</span> <span style="background-color:yellow;"></span> . </p>
<p><span style="background-color:yellow;">Use</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">slow</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">generate</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">save</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">source</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">says</span> <span style="background-color:yellow;">primes.py</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">contain</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>primes = [ a list of a million primes numbers here ]
</code></pre>
<p><span style="background-color:yellow;">Now</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">import</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">minimal</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">footprint</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">speed</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">disk</span> <span style="background-color:yellow;">IO.</span> <span style="background-color:yellow;">Complexity</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">primes</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;"></span> </p>
<p><span style="background-color:yellow;">Even</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">poorly</span> <span style="background-color:yellow;">optimized</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">generate</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">done</span> <span style="background-color:yellow;">once</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">matter</span> <span style="background-color:yellow;">much</span> . </p>
<p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">probably</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">pickle/unpickle</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">idea..</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">9</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">segmented</span> <span style="background-color:yellow;">Sieve</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">Eratosthenes.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">segment</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">reused</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">next</span> <span style="background-color:yellow;">segment</span> . </p>
<br />