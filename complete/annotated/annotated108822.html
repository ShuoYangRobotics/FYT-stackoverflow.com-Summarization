<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-108822</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Delete</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">kind</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Google</span> <span style="background-color:yellow;">App</span> <span style="background-color:yellow;">Engine</span> </h2><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">wipe</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">specific</span> <span style="background-color:yellow;">kind</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Google</span> <span style="background-color:yellow;">App</span> <span style="background-color:yellow;">Engine.</span> <span style="background-color:yellow;">What</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">best</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">this</span> ? <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wrote</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">script</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">hack</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">timeout</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">after</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">few</span> <span style="background-color:yellow;">hundred</span> <span style="background-color:yellow;">records</span> . </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-16</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">currently</span> <span style="background-color:yellow;">deleting</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">entities</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">their</span> <span style="background-color:yellow;">key</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">faster</span> . </p>
<pre><code>from google.appengine.ext import db

class bulkdelete(webapp.RequestHandler):
    def get(self):
        self.response.headers['Content-Type'] = 'text/plain'
        try:
            while True:
                q = db.GqlQuery("SELECT __key__ FROM MyModel")
                assert q.count()
                db.delete(q.fetch(200))
                time.sleep(0.5)
        except Exception, e:
            self.response.out.write(repr(e)+'\n')
            pass
</code></pre>
<p><span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">terminal</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">run</span> <span style="background-color:yellow;">curl</span> <span style="background-color:yellow;">-N</span> <span style="background-color:yellow;">http</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">//..</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">were</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">paranoid</span> <span style="background-color:yellow;">person</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">say</span> <span style="background-color:yellow;">Google</span> <span style="background-color:yellow;">App</span> <span style="background-color:yellow;">Engine</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">GAE</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">made</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">easy</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">us</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">remove</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">we</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">going</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">skip</span> <span style="background-color:yellow;">discussion</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">index</span> <span style="background-color:yellow;">sizes</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">translate</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">6</span> <span style="background-color:yellow;">GB</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">35</span> <span style="background-color:yellow;">GB</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">storage</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">billed</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">That</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">another</span> <span style="background-color:yellow;">story</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">they</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">ways</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">around</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">limit</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">properties</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">create</span> <span style="background-color:yellow;">index</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">automatically</span> <span style="background-color:yellow;">generated</span> <span style="background-color:yellow;">indexes</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">et</span> <span style="background-color:yellow;">cetera</span> . </p>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">reason</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">decided</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">write</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">post</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">nuke</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">Kinds</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">sandbox.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">finally</span> <span style="background-color:yellow;">came</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>package com.intillium.formshnuker;

import java.io.IOException;
import java.util.ArrayList;

import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.google.appengine.api.datastore.Key;
import com.google.appengine.api.datastore.Query;
import com.google.appengine.api.datastore.Entity;
import com.google.appengine.api.datastore.FetchOptions;
import com.google.appengine.api.datastore.DatastoreService;
import com.google.appengine.api.datastore.DatastoreServiceFactory;

import com.google.appengine.api.labs.taskqueue.QueueFactory;
import com.google.appengine.api.labs.taskqueue.TaskOptions.Method;

import static com.google.appengine.api.labs.taskqueue.TaskOptions.Builder.url;

@SuppressWarnings("serial")
public class FormsnukerServlet extends HttpServlet {

 public void doGet(final HttpServletRequest request, final HttpServletResponse response) throws IOException {

  response.setContentType("text/plain");

  final String kind = request.getParameter("kind");
  final String passcode = request.getParameter("passcode");

  if (kind == null) {
   throw new NullPointerException();
  }

  if (passcode == null) {
   throw new NullPointerException();
  }

  if (!passcode.equals("LONGSECRETCODE")) {
   response.getWriter().println("BAD PASSCODE!");
   return;
  }

  System.err.println("*** deleting entities form " + kind);

  final long start = System.currentTimeMillis();

  int deleted_count = 0;
  boolean is_finished = false;

  final DatastoreService dss = DatastoreServiceFactory.getDatastoreService();

  while (System.currentTimeMillis() - start < 16384) {

   final Query query = new Query(kind);

   query.setKeysOnly();

   final ArrayList<Key> keys = new ArrayList<Key>();

   for (final Entity entity: dss.prepare(query).asIterable(FetchOptions.Builder.withLimit(128))) {
    keys.add(entity.getKey());
   }

   keys.trimToSize();

   if (keys.size() == 0) {
    is_finished = true;
    break;
   }

   while (System.currentTimeMillis() - start < 16384) {

    try {

     dss.delete(keys);

     deleted_count += keys.size();

     break;

    } catch (Throwable ignore) {

     continue;

    }

   }

  }

  System.err.println("*** deleted " + deleted_count + " entities form " + kind);

  if (is_finished) {

   System.err.println("*** deletion job for " + kind + " is completed.");

  } else {

   final int taskcount;

   final String tcs = request.getParameter("taskcount");

   if (tcs == null) {
    taskcount = 0;
   } else {
    taskcount = Integer.parseInt(tcs) + 1;
   }

   QueueFactory.getDefaultQueue().add(
    url("/formsnuker?kind=" + kind + "&passcode=LONGSECRETCODE&taskcount=" + taskcount).method(Method.GET));

   System.err.println("*** deletion task # " + taskcount + " for " + kind + " is queued.");

  }

  response.getWriter().println("OK");

 }

}
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">6</span> <span style="background-color:yellow;">million</span> <span style="background-color:yellow;">records.</span> <span style="background-color:yellow;">That</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">idea</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">cost</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">records</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">maybe</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">economical</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">Another</span> <span style="background-color:yellow;">alternative</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">request</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">deletion</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">entire</span> <span style="background-color:yellow;">application</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">sandbox</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">But</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">realistic</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">most</span> <span style="background-color:yellow;">cases</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">decided</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">go</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">smaller</span> <span style="background-color:yellow;">groups</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">records</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">easy</span> <span style="background-color:yellow;">query</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">go</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">500</span> <span style="background-color:yellow;">entities</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">started</span> <span style="background-color:yellow;">receiving</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">high</span> <span style="background-color:yellow;">rates</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">failure</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">re</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;"></span> . </p>
<p><span style="background-color:yellow;">My</span> <span style="background-color:yellow;">request</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">GAE</span> <span style="background-color:yellow;">team</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">please</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">feature</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">entities</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">kind</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">single</span> <span style="background-color:yellow;">transaction</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">Try</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">App</span> <span style="background-color:yellow;">Engine</span> <span style="background-color:yellow;">Console</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">dont</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">deploy</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">special</span> <span style="background-color:yellow;">code</span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">tried</span> <span style="background-color:yellow;">db.delete</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">results</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">App</span> <span style="background-color:yellow;">Engine</span> <span style="background-color:yellow;">Console</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">none</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">working</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">me.</span> <span style="background-color:yellow;">Manually</span> <span style="background-color:yellow;">removing</span> <span style="background-color:yellow;">entries</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">Data</span> <span style="background-color:yellow;">Viewer</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">increased</span> <span style="background-color:yellow;">limit</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">200</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">did</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">either</span> <span style="background-color:yellow;">since</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">uploaded</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">10000</span> <span style="background-color:yellow;">entries.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">ended</span> <span style="background-color:yellow;">writing</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">script</span> </p>
<pre><code>from google.appengine.ext import db
from google.appengine.ext import webapp
from google.appengine.ext.webapp.util import run_wsgi_app
import wsgiref.handlers
from mainPage import YourData #replace this with your data
class CleanTable(webapp.RequestHandler):
    def get(self, param):
        txt = self.request.get('table')
        q = db.GqlQuery("SELECT * FROM "+txt)
        results = q.fetch(10)
        self.response.headers['Content-Type'] = 'text/plain'
        #replace yourapp and YouData your app info below.
        self.response.out.write("""
          <html>
          <meta HTTP-EQUIV="REFRESH" content="5; url=http://yourapp.appspot.com/cleanTable?table=YourData">
            <body>""")

        try:
            for i in range(10):
                db.delete(results)
                results = q.fetch(10, len(results))
                self.response.out.write("<p>10 removed</p>")
                self.response.out.write("""
                </body>
              </html>""")

        except Exception, ints:
            self.response.out.write(str(inst))

def main():
  application = webapp.WSGIApplication([
    ('/cleanTable(.*)', CleanTable),
  ])

  wsgiref.handlers.CGIHandler().run(application)
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">trick</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">include</span> <span style="background-color:yellow;">redirect</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">html</span> <span style="background-color:yellow;">instead</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">self.redirect.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">ready</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">wait</span> <span style="background-color:yellow;">overnight</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">rid</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">table.</span> <span style="background-color:yellow;">Hopefully</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">GAE</span> <span style="background-color:yellow;">team</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">easier</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">drop</span> <span style="background-color:yellow;">tables</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">future</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">efficient</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">handle</span> <span style="background-color:yellow;">bulk</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">Datastore</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">new</span> <span style="background-color:yellow;">mapper</span> <span style="background-color:yellow;">API</span> <span style="background-color:yellow;">announced</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">latest</span> <span style="background-color:yellow;">Google</span> <span style="background-color:yellow;">I/O</span> . </p>
<p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">language</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">choice</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">register</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">mapper</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">mapreduce.yaml</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">define</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>from mapreduce import operation as op
def process(entity):
 yield op.db.Delete(entity)
</code></pre>
<p><span style="background-color:yellow;">On</span> <span style="background-color:yellow;">Java</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">look</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">article</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">suggests</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>@Override
public void map(Key key, Entity value, Context context) {
    log.info("Adding key to deletion pool: " + key);
    DatastoreMutationPool mutationPool = this.getAppEngineContext(context)
            .getMutationPool();
    mutationPool.delete(value.getKey());
}
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">Presumably</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">hack</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>q = db.GqlQuery("SELECT * FROM Message WHERE create_date < :1", earliest_date)
results = q.fetch(1000)

while results:
    db.delete(results)
    results = fetch(1000, len(results))
</code></pre>
<p><span style="background-color:yellow;">As</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">say</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">sufficient</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">going</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">hit</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">request</span> <span style="background-color:yellow;">timeout</span> <span style="background-color:yellow;">before</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">gets</span> <span style="background-color:yellow;">through</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">records.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">'d</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">re-invoke</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">request</span> <span style="background-color:yellow;">multiple</span> <span style="background-color:yellow;">times</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">outside</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">ensure</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">erased</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">easy</span> <span style="background-color:yellow;">enough</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">hardly</span> <span style="background-color:yellow;">ideal</span> . </p>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">admin</span> <span style="background-color:yellow;">console</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">seem</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">offer</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">help</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">own</span> <span style="background-color:yellow;">experience</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">allow</span> <span style="background-color:yellow;">entities</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">given</span> <span style="background-color:yellow;">type</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">listed</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">deleted</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">page-by-page</span> <span style="background-color:yellow;">basis</span> . </p>
<p><span style="background-color:yellow;">When</span> <span style="background-color:yellow;">testing</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">had</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">purge</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">database</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">startup</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">rid</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">existing</span> <span style="background-color:yellow;">data</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">infer</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">Google</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">operates</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">principle</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">disk</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">cheap</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">typically</span> <span style="background-color:yellow;">orphaned</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">indexes</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">redundant</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">replaced</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">rather</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">deleted.</span> <span style="background-color:yellow;">Given</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">fixed</span> <span style="background-color:yellow;">amount</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">available</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">app</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">moment</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">0.5</span> <span style="background-color:yellow;">GB</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">help</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">non-Google</span> <span style="background-color:yellow;">App</span> <span style="background-color:yellow;">Engine</span> <span style="background-color:yellow;">users</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">Unfortunately</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">easily</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">bulk</span> <span style="background-color:yellow;">delete.</span> <span style="background-color:yellow;">Your</span> <span style="background-color:yellow;">best</span> <span style="background-color:yellow;">bet</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">write</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">script</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">deletes</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">reasonable</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">entries</span> <span style="background-color:yellow;">per</span> <span style="background-color:yellow;">invocation</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">call</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">repeatedly</span> <span style="background-color:yellow;">-</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">example</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">having</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">script</span> <span style="background-color:yellow;">return</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">302</span> <span style="background-color:yellow;">redirect</span> <span style="background-color:yellow;">whenever</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">fetching</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">wget</span> <span style="background-color:yellow;">--max-redirect</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">10000</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">large</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;"></span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">7</span> </b><br /><p><span style="background-color:yellow;">One</span> <span style="background-color:yellow;">tip.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">suggest</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">remote_api</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">these</span> <span style="background-color:yellow;">types</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">uses</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">bulk</span> <span style="background-color:yellow;">deleting</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">modifying</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">etc.</span> <span style="background-color:yellow;"></span> . <span style="background-color:yellow;">But</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">remote</span> <span style="background-color:yellow;">api</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">batch</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">limited</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">few</span> <span style="background-color:yellow;">hundred</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">time</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">8</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">now</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">Datastore</span> <span style="background-color:yellow;">Admin</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">http</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">//code.google.com/appengine/docs/adminconsole/datastoreadmin.html</span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">9</span> </b><br /><p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">official</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">Google</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">chunks</span> <span style="background-color:yellow;">spread</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">multiple</span> <span style="background-color:yellow;">requests.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">AJAX</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">meta</span> <span style="background-color:yellow;">refresh</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">request</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">URL</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">script</span> <span style="background-color:yellow;">until</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">entities</span> <span style="background-color:yellow;">left</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">10</span> </b><br /><p><span style="background-color:yellow;">With</span> <span style="background-color:yellow;">django</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">setup</span> <span style="background-color:yellow;">url</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>url(r'^Model/bdelete/$', v.bulk_delete_models, {'model':'ModelKind'}),
</code></pre>
<p><span style="background-color:yellow;">Setup</span> <span style="background-color:yellow;">view</span> </p>
<pre><code>def bulk_delete_models(request, model):
    import time
    limit = request.GET['limit'] or 200
    start = time.clock()
    set = db.GqlQuery("SELECT __key__ FROM %s" % model).fetch(int(limit))
    count = len(set)
    db.delete(set)
    return HttpResponse("Deleted %s %s in %s" % (count,model,(time.clock() - start)))
</code></pre>
<p><span style="background-color:yellow;">Then</span> <span style="background-color:yellow;">run</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">powershell</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>$client = new-object System.Net.WebClient
$client.DownloadString("http://your-app.com/Model/bdelete/?limit=400")
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">11</span> </b><br /><p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">Java/JPA</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>    em = EntityManagerFactoryUtils.getTransactionalEntityManager(entityManagerFactory)
    Query q = em.createQuery("delete from Table t");
    int number = q.executeUpdate();
</code></pre>
<p><span style="background-color:yellow;">Java/JDO</span> <span style="background-color:yellow;">info</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">http</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">//code.google.com/appengine/docs/java/datastore/queriesandindexes.html</span> <span style="background-color:yellow;">#</span> <span style="background-color:yellow;">Delete_By_Query</span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">12</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">task</span> <span style="background-color:yellow;">queues</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">chunks</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">say</span> <span style="background-color:yellow;">100</span> <span style="background-color:yellow;">objects</span> . <span style="background-color:yellow;">Deleting</span> <span style="background-color:yellow;">objects</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">GAE</span> <span style="background-color:yellow;">shows</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">limited</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">Admin</span> <span style="background-color:yellow;">capabilities</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">GAE.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">batches</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">1000</span> <span style="background-color:yellow;">entities</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">less.</span> <span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bulkloader</span> <span style="background-color:yellow;">tool</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">csv</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">documentation</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">cover</span> <span style="background-color:yellow;">java</span> . <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">am</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">GAE</span> <span style="background-color:yellow;">Java</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">strategy</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">deletions</span> <span style="background-color:yellow;">involves</span> <span style="background-color:yellow;">having</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">servlets</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">actually</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">another</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">load</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">task</span> <span style="background-color:yellow;">queues.</span> <span style="background-color:yellow;">When</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">run</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">queue</span> <span style="background-color:yellow;">loading</span> <span style="background-color:yellow;">servlet</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">loads</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">queues</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">GAE</span> <span style="background-color:yellow;">goes</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">executing</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">tasks</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">queue</span> . </p>
<p><span style="background-color:yellow;">How</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">Create</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">servlet</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">deletes</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">small</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">objects</span> . <span style="background-color:yellow;">Add</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">servlet</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">task</span> <span style="background-color:yellow;">queues</span> . <span style="background-color:yellow;">Go</span> <span style="background-color:yellow;">home</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">something</span> <span style="background-color:yellow;">else</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Check</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">datastore</span> <span style="background-color:yellow;">every</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">often</span> <span style="background-color:yellow;">..</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">datastore</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">5000</span> <span style="background-color:yellow;">objects</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">purge</span> <span style="background-color:yellow;">every</span> <span style="background-color:yellow;">week</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">takes</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">6</span> <span style="background-color:yellow;">hours</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">clean</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">i</span> <span style="background-color:yellow;">run</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">task</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">Friday</span> <span style="background-color:yellow;">night</span> . <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">technique</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">bulk</span> <span style="background-color:yellow;">load</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">happens</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">5000</span> <span style="background-color:yellow;">objects</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dozen</span> <span style="background-color:yellow;">properties</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">13</span> </b><br /><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">worked</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>class ClearHandler(webapp.RequestHandler):  
    def get(self):  
        self.response.headers['Content-Type'] = 'text/plain'  
        q = db.GqlQuery("SELECT * FROM SomeModel")  
        self.response.out.write("deleting...")  
        db.delete(q)
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">14</span> </b><br /><p><span style="background-color:yellow;">Thank</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">guys</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">got</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">need.</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">D</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">useful</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">lots</span> <span style="background-color:yellow;">db</span> <span style="background-color:yellow;">models</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">dispatch</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">terminal.</span> <span style="background-color:yellow;">And</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">manage</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">list</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">DB_MODEL_LIST</span> <span style="background-color:yellow;">yourself</span> . <span style="background-color:yellow;">Delete</span> <span style="background-color:yellow;">DB_1</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>python bulkdel.py 10 DB_1
</code></pre>
<p><span style="background-color:yellow;">Delete</span> <span style="background-color:yellow;">All</span> <span style="background-color:yellow;">DB</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>python bulkdel.py 11
</code></pre>
<p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bulkdel.py</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import sys, os

URL = 'http://localhost:8080'
DB_MODEL_LIST = ['DB_1', 'DB_2', 'DB_3']

# Delete Model
if sys.argv[1] == '10' :
    command = 'curl %s/clear_db?model=%s' % ( URL, sys.argv[2] )
    os.system( command )

# Delete All DB Models
if sys.argv[1] == '11' :
    for model in DB_MODEL_LIST :
        command = 'curl %s/clear_db?model=%s' % ( URL, model )
        os.system( command )
</code></pre>
<p><span style="background-color:yellow;">And</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">modified</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">alexandre</span> <span style="background-color:yellow;">fiori</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">code</span> . </p>
<pre><code>from google.appengine.ext import db
class DBDelete( webapp.RequestHandler ):
    def get( self ):
        self.response.headers['Content-Type'] = 'text/plain'
        db_model = self.request.get('model')
        sql = 'SELECT __key__ FROM %s' % db_model

        try:
            while True:
                q = db.GqlQuery( sql )
                assert q.count()
                db.delete( q.fetch(200) )
                time.sleep(0.5)
        except Exception, e:
            self.response.out.write( repr(e)+'\n' )
            pass
</code></pre>
<p><span style="background-color:yellow;">And</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">course</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">should</span> <span style="background-color:yellow;">map</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">link</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">model</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">main.py</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">GAE</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">In</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">guys</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">detail</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">part</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">main.py</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>from google.appengine.ext import webapp
import utility # DBDelete was defined in utility.py
application = webapp.WSGIApplication([('/clear_db',utility.DBDelete ),('/',views.MainPage )],debug = True)
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">15</span> </b><br /><p><span style="background-color:yellow;">Yes</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">Go</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">Datastore</span> <span style="background-color:yellow;">Admin</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">select</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">Entitiy</span> <span style="background-color:yellow;">type</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">delete</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">click</span> <span style="background-color:yellow;">Delete</span> . <span style="background-color:yellow;">Mapreduce</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">take</span> <span style="background-color:yellow;">care</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">deleting</span> <span style="background-color:yellow;">!</span> </p>
<br />