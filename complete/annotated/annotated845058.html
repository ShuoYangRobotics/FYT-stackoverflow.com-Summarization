<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-845058</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">How</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">count</span> <span style="background-color:yellow;">cheaply</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> ? </h2><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">count</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">large</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">hundreds</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">thousands</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">python.</span> <span style="background-color:yellow;">What</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">most</span> <span style="background-color:yellow;">efficient</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">both</span> <span style="background-color:yellow;">memory-</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">time-wise</span> ? </p>
<p><span style="background-color:yellow;">At</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">moment</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def file_len(fname):
    with open(fname) as f:
        for i, l in enumerate(f):
            pass
    return i + 1
</code></pre>
<p><span style="background-color:yellow;">is</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">possible</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">better</span> ? </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-17</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">believe</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">mapped</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">solution.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">tried</span> <span style="background-color:yellow;">four</span> <span style="background-color:yellow;">functions</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">posted</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">OP</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">opcount</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">simple</span> <span style="background-color:yellow;">iteration</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">simplecount</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">readline</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">memory-mapped</span> <span style="background-color:yellow;">filed</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">mmap</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">mapcount</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">buffer</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">offered</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">Mykola</span> <span style="background-color:yellow;">Kharechko</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">bufcount</span> <span style="background-color:yellow;"></span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">ran</span> <span style="background-color:yellow;">each</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">five</span> <span style="background-color:yellow;">times</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">calculated</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">average</span> <span style="background-color:yellow;">run-time</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">1.2</span> <span style="background-color:yellow;">million-line</span> <span style="background-color:yellow;">text</span> <span style="background-color:yellow;">file</span> . </p>
<p><span style="background-color:yellow;">Windows</span> <span style="background-color:yellow;">XP</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2.5</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">2GB</span> <span style="background-color:yellow;">RAM</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">GHz</span> <span style="background-color:yellow;">AMD</span> <span style="background-color:yellow;">processor</span> </p>
<p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">results</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>mapcount : 0.465599966049
simplecount : 0.756399965286
bufcount : 0.546800041199
opcount : 0.718600034714
</code></pre>
<p><span style="background-color:yellow;">Edit</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">numbers</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">2.6</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>mapcount : 0.471799945831
simplecount : 0.634400033951
bufcount : 0.468800067902
opcount : 0.602999973297
</code></pre>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">buffer</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">strategy</span> <span style="background-color:yellow;">seems</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">Windows/Python</span> <span style="background-color:yellow;">2.6</span> </p>
<p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>from __future__ import with_statement
import time
import mmap
import random
from collections import defaultdict

def mapcount(filename):
    f = open(filename, "r+")
    buf = mmap.mmap(f.fileno(), 0)
    lines = 0
    readline = buf.readline
    while readline():
        lines += 1
    return lines

def simplecount(filename):
    lines = 0
    for line in open(filename):
        lines += 1
    return lines

def bufcount(filename):
    f = open(filename)                  
    lines = 0
    buf_size = 1024 * 1024
    read_f = f.read # loop optimization

    buf = read_f(buf_size)
    while buf:
        lines += buf.count('\n')
        buf = read_f(buf_size)

    return lines

def opcount(fname):
    with open(fname) as f:
        for i, l in enumerate(f):
            pass
    return i + 1


counts = defaultdict(list)

for i in range(5):
    for func in [mapcount, simplecount, bufcount, opcount]:
        start_time = time.time()
        assert func("big_file.txt") == 1209138
        counts[func].append(time.time() - start_time)

for key, vals in counts.items():
    print key.__name__, ":", sum(vals) / float(len(vals))
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">ca</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">better</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">that</span> . </p>
<p><span style="background-color:yellow;">After</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">entire</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">figure</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">many</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">return</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">result</span> . </p>
<p><span style="background-color:yellow;">Do</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">better</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">reading</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">entire</span> <span style="background-color:yellow;">file</span> ? <span style="background-color:yellow;">Not</span> <span style="background-color:yellow;">sure...</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">best</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">always</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">I/O-bound</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">best</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">sure</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">unnecessary</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">looks</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">covered</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">One</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">probably</span> <span style="background-color:yellow;">pretty</span> <span style="background-color:yellow;">fast</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>num_lines = sum(1 for line in open('myfile.txt'))
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">execute</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">subprocess</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">run</span> <span style="background-color:yellow;">wc</span> <span style="background-color:yellow;">-l</span> <span style="background-color:yellow;">filename</span> </p>
<pre><code>import subprocess

def file_len(fname):
    p = subprocess.Popen(['wc', '-l', fname], stdout=subprocess.PIPE, 
                                              stderr=subprocess.PIPE)
    result, err = p.communicate()
    if p.returncode != 0:
        raise IOError(err)
    return int(result.strip().split()[0])
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><pre><code>def file_len(full_path):
  """ Count number of lines in a file."""
  f = open(full_path)
  nr_of_lines = sum(1 for line in f)
  f.close()
  return nr_of_lines
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">As</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">variant</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fastest</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>#!/usr/bin/env python

def main():
    f = open('filename')                  
    lines = 0
    buf_size = 1024 * 1024
    read_f = f.read # loop optimization

    buf = read_f(buf_size)
    while buf:
        lines += buf.count('\n')
        buf = read_f(buf_size)

    print lines

if __name__ == '__main__':
    main()
</code></pre>
<p><span style="background-color:yellow;">reasons</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">buffering</span> <span style="background-color:yellow;">faster</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">reading</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">string.count</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">fast</span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">Just</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">complete</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">above</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">tried</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">variant</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">fileinput</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import fileinput as fi   
def filecount(fname):
        for line in fi.input(fname):
            pass
        return fi.lineno()
</code></pre>
<p><span style="background-color:yellow;">And</span> <span style="background-color:yellow;">passed</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">60mil</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">above</span> <span style="background-color:yellow;">stated</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>mapcount : 6.1331050396
simplecount : 4.588793993
opcount : 4.42918205261
filecount : 43.2780818939
bufcount : 0.170812129974
</code></pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">little</span> <span style="background-color:yellow;">surprise</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">fileinput</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">bad</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">scales</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;">worse</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">other</span> <span style="background-color:yellow;">methods..</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">7</span> </b><br /><p><span style="background-color:yellow;">What</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">this</span> </p>
<pre><code>def file_len(fname):
  counts = itertools.count()
  with open(fname) as f: 
    for _ in f: counts.next()
  return counts.next()
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">8</span> </b><br /><p><span style="background-color:yellow;">Here</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">mpi</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">pypar</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">distribute</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">counting</span> <span style="background-color:yellow;">across</span> <span style="background-color:yellow;">machines/cores.</span> <span style="background-color:yellow;">My</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;">improves</span> <span style="background-color:yellow;">counting</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">20mil</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">26</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">7</span> <span style="background-color:yellow;">seconds</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">8</span> <span style="background-color:yellow;">core</span> <span style="background-color:yellow;">windows</span> <span style="background-color:yellow;">64</span> <span style="background-color:yellow;">server</span> . </p>
<pre><code>import pypar, os, logging, sys

def getFileLineCount( file1 ):
    m1 = open(file1, "r")

    #work out file size
    #divide up to farm out line counting

    fSize = os.stat(file1).st_size 
    chunk = (fSize / pypar.size()) + 1

    lines = 0

    #first get max width of each field and the names
    seekStart = chunk * (pypar.rank())
    seekEnd = chunk * (pypar.rank()+1)
    if seekEnd > fSize:
        seekEnd = fSize

    #find where to start
    if pypar.rank() > 0:
        m1.seek( seekStart )
        #read next line
        l1 = m1.readline()
        seekStart = m1.tell()

    #tell previous rank my seek start to make their seek end
    if pypar.rank() > 0:
        pypar.send( seekStart, pypar.rank()-1 )
    if pypar.rank() < pypar.size()-1:
        seekEnd = pypar.receive( pypar.rank()+1 )

    m1.seek( seekStart )    
    l1 = m1.readline()
    while len(l1) > 0:
        lines += 1
        l1 = m1.readline()
        if m1.tell() > seekEnd or len(l1) == 0:
            break

    if pypar.rank() == 0:
        for p in range(1,pypar.size()):
            lines += pypar.receive( p )

        for p in range(1,pypar.size()):
            pypar.send( lines, p )
    else:
        pypar.send( lines,0 )
        lines = pypar.receive(0)

    m1.close()
    return lines
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">9</span> </b><br /><p><span style="background-color:yellow;">Why</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">100</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">last</span> <span style="background-color:yellow;">100</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">estimate</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">average</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">length</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">divide</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">total</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">through</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">numbers</span> ? <span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">exact</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">work</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">10</span> </b><br /><p><span style="background-color:yellow;">what</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">this</span> ? </p>
<pre><code>import sys
sys.stdin=open('fname','r')
data=sys.stdin.readlines()
print "counted",len(data),"lines"
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">11</span> </b><br /><p><span style="background-color:yellow;">Why</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">work</span> ? </p>
<pre><code>import sys

# input comes from STDIN
file = sys.stdin
data = file.readlines()

# get total number of lines in file
lines = len(data)

print lines
</code></pre>
<p><span style="background-color:yellow;">In</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">len</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">uses</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">input</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">means</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">determining</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">length</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">12</span> </b><br /><p><span style="background-color:yellow;">count</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">max</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">enumerate</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">open</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">filename</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">[</span> <span style="background-color:yellow;">0</span> <span style="background-color:yellow;">]</span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">13</span> </b><br /><p><span style="background-color:yellow;">How</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">this</span> ? </p>
<pre><code>import fileinput
import sys

counter=0
for line in fileinput.input([sys.argv[1]]):
    counter+=1

fileinput.close()
print counter
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">14</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">modified</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">buffer</span> <span style="background-color:yellow;">case</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def CountLines(filename):
    f = open(filename)
    try:
        lines = 1
        buf_size = 1024 * 1024
        read_f = f.read # loop optimization
        buf = read_f(buf_size)

        # Empty file
        if not buf:
            return 0

        while buf:
            lines += buf.count('\n')
            buf = read_f(buf_size)

        return lines
    finally:
        f.close()
</code></pre>
<p><span style="background-color:yellow;">Now</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">empty</span> <span style="background-color:yellow;">files</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">last</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">counted</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">15</span> </b><br /><p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">approximation</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">appropriate</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">PERL</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">posted</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">python</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">well</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">16</span> </b><br /><p><span style="background-color:yellow;">the</span> <span style="background-color:yellow;">result</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">opening</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">iterator</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">converted</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">sequence</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">length</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>with open(filename) as f:
   return len(list(f))
</code></pre>
<p><span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">concise</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">explicit</span> <span style="background-color:yellow;">loop</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">avoids</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">enumerate</span> . </p>
<br />