<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-1308607</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">assert</span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">improved</span> <span style="background-color:yellow;">introspection</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">failure</span> ? </h2><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">rather</span> <span style="background-color:yellow;">useless</span> <span style="background-color:yellow;">assertion</span> <span style="background-color:yellow;">error</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">tell</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">values</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">expression</span> <span style="background-color:yellow;">involved</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">assume</span> <span style="background-color:yellow;">constants</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">actually</span> <span style="background-color:yellow;">variable</span> <span style="background-color:yellow;">names</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<pre><code>$ python -c "assert 6-(3*2)"
[...]
AssertionError
</code></pre>
<p><span style="background-color:yellow;">Is</span> <span style="background-color:yellow;">there</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">better</span> <span style="background-color:yellow;">assert</span> <span style="background-color:yellow;">implementation</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">fancy</span> ? <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">must</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">introduce</span> <span style="background-color:yellow;">additional</span> <span style="background-color:yellow;">overhead</span> <span style="background-color:yellow;">over</span> <span style="background-color:yellow;">execution</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">except</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">assert</span> <span style="background-color:yellow;">fails</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">..</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">must</span> <span style="background-color:yellow;">turn</span> <span style="background-color:yellow;">off</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">-O</span> <span style="background-color:yellow;">flag</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">used</span> . </p>
<p><span style="background-color:yellow;">Edit</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">assert</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">second</span> <span style="background-color:yellow;">argument</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">string.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">write</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">..</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">encoded</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">expression</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">being</span> <span style="background-color:yellow;">asserted.</span> <span style="background-color:yellow;">DRY</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">Repeat</span> <span style="background-color:yellow;">Yourself</span> <span style="background-color:yellow;"></span> . </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-6</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">Install</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">sys.excepthook</span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">docs</span> . <span style="background-color:yellow;">Your</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">second</span> <span style="background-color:yellow;">argument</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">AssertionError</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">introspect</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">heart</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">contents</span> <span style="background-color:yellow;">;</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">particular</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">through</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">third</span> <span style="background-color:yellow;">argument</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">traceback</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">frame</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">exact</span> <span style="background-color:yellow;">spot</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">assert</span> <span style="background-color:yellow;">failed</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">getting</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">failing</span> <span style="background-color:yellow;">exception</span> <span style="background-color:yellow;">through</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">source</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">bytecode</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">value</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">relevant</span> <span style="background-color:yellow;">variables</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">etc.</span> <span style="background-color:yellow;">Module</span> <span style="background-color:yellow;">inspect</span> <span style="background-color:yellow;">helps</span> . </p>
<p><span style="background-color:yellow;">Doing</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">full</span> <span style="background-color:yellow;">generality</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">quite</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">piece</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">depending</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">constraints</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'re</span> <span style="background-color:yellow;">willing</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">accept</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">how</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">write</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">assert</span> <span style="background-color:yellow;">s</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">lightened</span> <span style="background-color:yellow;">substantially</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">e.g.</span> <span style="background-color:yellow;">restricting</span> <span style="background-color:yellow;">them</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">local</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">global</span> <span style="background-color:yellow;">variables</span> <span style="background-color:yellow;">makes</span> <span style="background-color:yellow;">introspection</span> <span style="background-color:yellow;">easier</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">nonlocal</span> <span style="background-color:yellow;">variables</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">closure</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">involved</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">forth</span> <span style="background-color:yellow;"></span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">You</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">attach</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">message</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">assert</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>assert 6-(3*2), "always fails"
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">message</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">also</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">built</span> <span style="background-color:yellow;">dynamically</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>assert x != 0, "x is not equal to zero (%d)" % x
</code></pre>
<p><span style="background-color:yellow;">See</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">assert</span> <span style="background-color:yellow;">statement</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">documentation</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">information</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">nose</span> <span style="background-color:yellow;">testing</span> <span style="background-color:yellow;">suite</span> <span style="background-color:yellow;">applies</span> <span style="background-color:yellow;">introspection</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">asserts</span> . </p>
<p><span style="background-color:yellow;">However</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">AFAICT</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">call</span> <span style="background-color:yellow;">their</span> <span style="background-color:yellow;">asserts</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">introspection</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import nose
def test1():
    nose.tools.assert_equal(6, 5+2)
</code></pre>
<p><span style="background-color:yellow;">results</span> <span style="background-color:yellow;">in</span> </p>
<pre>
C:\temp\py>C:\Python26\Scripts\nosetests.exe -d test.py
F
======================================================================
FAIL: test.test1
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\Python26\lib\site-packages\nose-0.11.1-py2.6.egg\nose\case.py", line
183, in runTest
    self.test(*self.arg)
  File "C:\temp\py\test.py", line 3, in test1
    nose.tools.assert_equal(6, 5+2)
AssertionError: 6 != 7
>>  raise self.failureException, \
          (None or '%r != %r' % (6, 7))
</pre>
<p><span style="background-color:yellow;">Notice</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">AssertionError</span> <span style="background-color:yellow;">there.</span> <span style="background-color:yellow;">When</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">was</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">assert</span> <span style="background-color:yellow;">6</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">=</span> <span style="background-color:yellow;">5</span> <span style="background-color:yellow;">+</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">:</span> </p>
<pre>
C:\temp\py>C:\Python26\Scripts\nosetests.exe -d test.py
F
======================================================================
FAIL: test.test1
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\Python26\lib\site-packages\nose-0.11.1-py2.6.egg\nose\case.py", line
183, in runTest
    self.test(*self.arg)
  File "C:\temp\py\test.py", line 2, in test1
    assert 6 == 5 + 2
AssertionError:
>>  assert 6 == 5 + 2

</pre>
<p><span style="background-color:yellow;">Also</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">sure</span> <span style="background-color:yellow;">offhand</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">their</span> <span style="background-color:yellow;">asserts</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">skipped</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">-O</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">quick</span> <span style="background-color:yellow;">check</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">As</span> <span style="background-color:yellow;">@</span> <span style="background-color:yellow;">Mark</span> <span style="background-color:yellow;">Rushakoff</span> <span style="background-color:yellow;">said</span> <span style="background-color:yellow;">nose</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">evaluate</span> <span style="background-color:yellow;">failed</span> <span style="background-color:yellow;">asserts.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">standard</span> <span style="background-color:yellow;">assert</span> <span style="background-color:yellow;">too</span> . </p>
<pre><code># test_error_reporting.py
def test():
    a,b,c = 6, 2, 3
    assert a - b*c
</code></pre>
<p><span style="background-color:yellow;">nosetests</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">help</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>$ nosetests --help|grep -B2 assert
  -d, --detailed-errors, --failure-detail
                        Add detail to error output by attempting to evaluate
                        failed asserts [NOSE_DETAILED_ERRORS]
</code></pre>
<p><span style="background-color:yellow;">Example</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>$ nosetests -d
F
======================================================================
FAIL: test_error_reporting.test
----------------------------------------------------------------------
Traceback (most recent call last):
  File "..snip../site-packages/nose/case.py", line 183, in runTest
    self.test(*self.arg)
  File "..snip../test_error_reporting.py", line 3, in test
    assert a - b*c
AssertionError:
    6,2,3 = 6, 2, 3
>>  assert 6 - 2*3


----------------------------------------------------------------------
Ran 1 test in 0.089s

FAILED (failures=1)
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">Add</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">message</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">assertion</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">which</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">displayed</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">assertion</span> <span style="background-color:yellow;">fails</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>$ python -c "assert 6-(3*2), '6-(3*2)'"
Traceback (most recent call last):
  File "<string>", line 1, in <module>
AssertionError: 6-(3*2)
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">only</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">provide</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">automatically</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">contain</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">assertion</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">procedure</span> <span style="background-color:yellow;">call</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">inspect</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">stack</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">source</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">line.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">additional</span> <span style="background-color:yellow;">call</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">unfortunately</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">introduce</span> <span style="background-color:yellow;">overhead</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">test</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">would</span> <span style="background-color:yellow;">not</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">disabled</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">-O</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">sounds</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">really</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">set</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">debugger</span> <span style="background-color:yellow;">breakpoint</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">before</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">assert</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">inspect</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">favorite</span> <span style="background-color:yellow;">debugger</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">much</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">like</span> . </p>
<br />