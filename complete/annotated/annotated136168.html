<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-136168</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Get</span> <span style="background-color:yellow;">last</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">similar</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">tail</span> </h2><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">writing</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">log</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">viewer</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">web</span> <span style="background-color:yellow;">application</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">paginate</span> <span style="background-color:yellow;">through</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">log</span> <span style="background-color:yellow;">file.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">items</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">based</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">newest</span> <span style="background-color:yellow;">item</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bottom</span> . </p>
<p><span style="background-color:yellow;">So</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">tail</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">bottom</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">supports</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">offset.</span> <span style="background-color:yellow;">What</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">came</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">looks</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def tail(f, n, offset=0):
    """Reads a n lines from f with an offset of offset lines."""
    avg_line_length = 74
    to_read = n + offset
    while 1:
        try:
            f.seek(-(avg_line_length * to_read), 2)
        except IOError:
            # woops.  apparently file is smaller than what we want
            # to step back, go to the beginning instead
            f.seek(0)
        pos = f.tell()
        lines = f.read().splitlines()
        if len(lines) >= to_read or pos == 0:
            return lines[-to_read:offset and -offset or None]
        avg_line_length *= 1.3
</code></pre>
<p><span style="background-color:yellow;">Is</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">reasonable</span> <span style="background-color:yellow;">approach</span> ? <span style="background-color:yellow;">What</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">recommended</span> <span style="background-color:yellow;">way</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">tail</span> <span style="background-color:yellow;">log</span> <span style="background-color:yellow;">files</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">offsets</span> ? </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-12</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">This</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">quicker</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">yours.</span> <span style="background-color:yellow;">Makes</span> <span style="background-color:yellow;">no</span> <span style="background-color:yellow;">assumptions</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">length.</span> <span style="background-color:yellow;">Backs</span> <span style="background-color:yellow;">through</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">block</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">till</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">right</span> <span style="background-color:yellow;">number</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">'</span> <span style="background-color:yellow;">characters</span> . </p>
<pre><code>def tail( f, window=20 ):
    BUFSIZ = 1024
    f.seek(0, 2)
    bytes = f.tell()
    size = window
    block = -1
    data = []
    while size > 0 and bytes > 0:
        if (bytes - BUFSIZ > 0):
            # Seek back one whole BUFSIZ
            f.seek(block*BUFSIZ, 2)
            # read BUFFER
            data.append(f.read(BUFSIZ))
        else:
            # file too small, start from begining
            f.seek(0,0)
            # only read what was not read
            data.append(f.read(bytes))
        linesFound = data[-1].count('\n')
        size -= linesFound
        bytes -= BUFSIZ
        block -= 1
    return '\n'.join(''.join(data).splitlines()[-window:])
</code></pre>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">tricky</span> <span style="background-color:yellow;">assumptions</span> <span style="background-color:yellow;">about</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">length</span> <span style="background-color:yellow;">when</span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">practical</span> <span style="background-color:yellow;">matter</span> <span style="background-color:yellow;">--</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">never</span> <span style="background-color:yellow;">know</span> <span style="background-color:yellow;">things</span> <span style="background-color:yellow;">like</span> <span style="background-color:yellow;">that</span> . </p>
<p><span style="background-color:yellow;">Generally</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">locate</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">last</span> <span style="background-color:yellow;">20</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">second</span> <span style="background-color:yellow;">pass</span> <span style="background-color:yellow;">through</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">loop.</span> <span style="background-color:yellow;">If</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">74</span> <span style="background-color:yellow;">character</span> <span style="background-color:yellow;">thing</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">actually</span> <span style="background-color:yellow;">accurate</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">block</span> <span style="background-color:yellow;">size</span> <span style="background-color:yellow;">2048</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">tail</span> <span style="background-color:yellow;">20</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">almost</span> <span style="background-color:yellow;">immediately</span> . </p>
<p><span style="background-color:yellow;">Also</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">burn</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">brain</span> <span style="background-color:yellow;">calories</span> <span style="background-color:yellow;">trying</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">finesse</span> <span style="background-color:yellow;">alignment</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">physical</span> <span style="background-color:yellow;">OS</span> <span style="background-color:yellow;">blocks.</span> <span style="background-color:yellow;">Using</span> <span style="background-color:yellow;">these</span> <span style="background-color:yellow;">high-level</span> <span style="background-color:yellow;">I/O</span> <span style="background-color:yellow;">packages</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">doubt</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">any</span> <span style="background-color:yellow;">performance</span> <span style="background-color:yellow;">consequence</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">trying</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">align</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">OS</span> <span style="background-color:yellow;">block</span> <span style="background-color:yellow;">boundaries.</span> <span style="background-color:yellow;">If</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">lower-level</span> <span style="background-color:yellow;">I/O</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">might</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">speedup</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">ended</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">using.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">think</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">best</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def tail(f, n, offset=None):
    """Reads a n lines from f with an offset of offset lines.  The return
    value is a tuple in the form ``(lines, has_more)`` where `has_more` is
    an indicator that is `True` if there are more lines in the file.
    """
    avg_line_length = 74
    to_read = n + (offset or 0)

    while 1:
        try:
            f.seek(-(avg_line_length * to_read), 2)
        except IOError:
            # woops.  apparently file is smaller than what we want
            # to step back, go to the beginning instead
            f.seek(0)
        pos = f.tell()
        lines = f.read().splitlines()
        if len(lines) >= to_read or pos == 0:
            return lines[-to_read:offset and -offset or None], \
                   len(lines) > to_read or pos > 0
        avg_line_length *= 1.3
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">Assumes</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">unix-like</span> <span style="background-color:yellow;">system</span> . </p>
<pre><code>import os
def tail(f, n, offset=0):
  stdin,stdout = os.popen2("tail -n "+n+offset+" "+f)
  stdin.close()
  lines = stdout.readlines(); stdout.close()
  return lines[:,-offset]
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">reading</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">whole</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">acceptable</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">deque</span> . </p>
<pre><code>from collections import deque
deque(f, maxlen=n)
</code></pre>
<p><span style="background-color:yellow;">Prior</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">2.6</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">deques</span> <span style="background-color:yellow;">did</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">maxlen</span> <span style="background-color:yellow;">option</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">easy</span> <span style="background-color:yellow;">enough</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">implement</span> . </p>
<pre><code>import itertools
def maxque(items, size):
    items = iter(items)
    q = deque(itertools.islice(items, size))
    for item in items:
    	del q[0]
    	q.append(item)
    return q
</code></pre>
<p><span style="background-color:yellow;">If</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">requirement</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">end</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">gallop</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">a.k.a</span> <span style="background-color:yellow;">exponential</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">search</span> . </p>
<pre><code>def tail(f, n):
    assert n >= 0
    pos, lines = n+1, []
    while len(lines) <= n:
    	try:
    		f.seek(-pos, 2)
    	except IOError:
    		f.seek(0)
    		break
    	finally:
    		lines = list(f)
    	pos *= 2
    return lines[-n:]
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">based</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">S.Lott</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">top</span> <span style="background-color:yellow;">voted</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Sep</span> <span style="background-color:yellow;">25</span> <span style="background-color:yellow;">'08</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">21</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">43</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">fixed</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">small</span> <span style="background-color:yellow;">files</span> . </p>
<pre><code>def tail(the_file, lines_2find=20):  
    the_file.seek(0, 2)                         #go to end of file
    bytes_in_file = the_file.tell()             
    lines_found, total_bytes_scanned = 0, 0
    while lines_2find+1 > lines_found and bytes_in_file > total_bytes_scanned: 
        byte_block = min(1024, bytes_in_file-total_bytes_scanned)
        the_file.seek(-(byte_block+total_bytes_scanned), 2)
        total_bytes_scanned += byte_block
        lines_found += the_file.read(1024).count('\n')
    the_file.seek(-total_bytes_scanned, 2)
    line_list = list(the_file.readlines())
    return line_list[-lines_2find:]

    #we read at least 21 line breaks from the bottom, block by block for speed
    #21 to ensure we don't get a half line
</code></pre>
<p><span style="background-color:yellow;">Hope</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">useful</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">For</span> <span style="background-color:yellow;">efficiency</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">large</span> <span style="background-color:yellow;">files</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">common</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">logfile</span> <span style="background-color:yellow;">situations</span> <span style="background-color:yellow;">where</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">tail</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">generally</span> <span style="background-color:yellow;">want</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">avoid</span> <span style="background-color:yellow;">reading</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">whole</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">even</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">without</span> <span style="background-color:yellow;">reading</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">whole</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">memory</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">once</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">However</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">somehow</span> <span style="background-color:yellow;">work</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">offset</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">rather</span> <span style="background-color:yellow;">than</span> <span style="background-color:yellow;">characters.</span> <span style="background-color:yellow;">One</span> <span style="background-color:yellow;">possibility</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">reading</span> <span style="background-color:yellow;">backwards</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">seek</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">char</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">char</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">very</span> <span style="background-color:yellow;">slow.</span> <span style="background-color:yellow;">Instead</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">its</span> <span style="background-color:yellow;">better</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">process</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">larger</span> <span style="background-color:yellow;">blocks</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'ve</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">utility</span> <span style="background-color:yellow;">function</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wrote</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">while</span> <span style="background-color:yellow;">ago</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">files</span> <span style="background-color:yellow;">backwards</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">used</span> <span style="background-color:yellow;">here</span> . </p>
<pre><code>import os, itertools

def rblocks(f, blocksize=4096):
    """Read file as series of blocks from end of file to start.

    The data itself is in normal order, only the order of the blocks is reversed.
    ie. "hello world" -> ["ld","wor", "lo ", "hel"]
    Note that the file must be opened in binary mode.
    """
    if 'b' not in f.mode.lower():
        raise Exception("File must be opened using binary mode.")
    size = os.stat(f.name).st_size
    fullblocks, lastblock = divmod(size, blocksize)

    # The first(end of file) block will be short, since this leaves 
    # the rest aligned on a blocksize boundary.  This may be more 
    # efficient than having the last (first in file) block be short
    f.seek(-lastblock,2)
    yield f.read(lastblock)

    for i in range(fullblocks-1,-1, -1):
        f.seek(i * blocksize)
        yield f.read(blocksize)

def tail(f, nlines):
    buf = ''
    result = []
    for block in rblocks(f):
        buf = block + buf
        lines = buf.splitlines()

        # Return all lines except the first (since may be partial)
        if lines:
            result.extend(lines[1:]) # First line may not be complete
            if(len(result) >= nlines):
                return result[-nlines:]

            buf = lines[0]

    return ([buf]+result)[-nlines:]


f=open('file_to_tail.txt','rb')
for line in tail(f, 20):
    print line
</code></pre>
<p><span style="background-color:yellow;">[</span> <span style="background-color:yellow;">Edit</span> <span style="background-color:yellow;">]</span> <span style="background-color:yellow;">Added</span> <span style="background-color:yellow;">more</span> <span style="background-color:yellow;">specific</span> <span style="background-color:yellow;">version</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">avoids</span> <span style="background-color:yellow;">need</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">reverse</span> <span style="background-color:yellow;">twice</span> <span style="background-color:yellow;"></span> </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">6</span> </b><br /><p><span style="background-color:yellow;">Based</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">Eyecue</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Jun</span> <span style="background-color:yellow;">10</span> <span style="background-color:yellow;">'10</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">21</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">28</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">class</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">head</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">tail</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">object</span> . </p>
<pre><code>class File(file):
    def head(self, lines_2find=1):
        self.seek(0)                            #Rewind file
        return [self.next() for x in xrange(lines_2find)]

    def tail(self, lines_2find=1):  
        self.seek(0, 2)                         #go to end of file
        bytes_in_file = self.tell()             
        lines_found, total_bytes_scanned = 0, 0
        while (lines_2find+1 > lines_found and
               bytes_in_file > total_bytes_scanned): 
            byte_block = min(1024, bytes_in_file-total_bytes_scanned)
            self.seek(-(byte_block+total_bytes_scanned), 2)
            total_bytes_scanned += byte_block
            lines_found += self.read(1024).count('\n')
        self.seek(-total_bytes_scanned, 2)
        line_list = list(self.readlines())
        return line_list[-lines_2find:]
</code></pre>
<p><span style="background-color:yellow;">Usage</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>f = File('path/to/file', 'r')
f.head(3)
f.tail(3)
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">7</span> </b><br /><p><span style="background-color:yellow;">Several</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">these</span> <span style="background-color:yellow;">solutions</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">issues</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">end</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">\</span> <span style="background-color:yellow;">n</span> <span style="background-color:yellow;">or</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">ensuring</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">complete</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">line</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">read</span> . </p>
<pre><code>def tail(file, n=1, bs=1024):
    f = open(file)
    f.seek(-1,2)
    l = 1-f.read(1).count('\n') # If file doesn't end in \n, count it anyway.
    B = f.tell()
    while n >= l and B > 0:
            block = min(bs, B)
            B -= block
            f.seek(B, 0)
            l += f.read(block).count('\n')
    f.seek(B, 0)
    l = min(l,n) # discard first (incomplete) line if l > n
    lines = f.readlines()[-l:]
    f.close()
    return lines
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">8</span> </b><br /><p><span style="background-color:yellow;">On</span> <span style="background-color:yellow;">second</span> <span style="background-color:yellow;">thought</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">probably</span> <span style="background-color:yellow;">just</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">fast</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">anything</span> <span style="background-color:yellow;">here</span> . </p>
<pre><code>def tail( f, window=20 ):
    lines= ['']*window
    count= 0
    for l in f:
        lines[count%window]= l
        count += 1
    print lines[count%window:], lines[:count%window]
</code></pre>
<p><span style="background-color:yellow;">It</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot</span> <span style="background-color:yellow;">simpler.</span> <span style="background-color:yellow;">And</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">does</span> <span style="background-color:yellow;">seem</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">rip</span> <span style="background-color:yellow;">along</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">good</span> <span style="background-color:yellow;">pace</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">9</span> </b><br /><p><span style="background-color:yellow;">you</span> <span style="background-color:yellow;">can</span> <span style="background-color:yellow;">go</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">end</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">f.seek</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">0</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">2</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">then</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">off</span> <span style="background-color:yellow;">lines</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">one</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">following</span> <span style="background-color:yellow;">replacement</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">readline</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </p>
<pre><code>def readline_backwards(self, f):
    backline = ''
    last = ''
    while not last == '\n':
        backline = last + backline
        if f.tell() <= 0:
            return backline
        f.seek(-1, 1)
        last = f.read(1)
        f.seek(-1, 1)
    backline = last
    last = ''
    while not last == '\n':
        backline = last + backline
        if f.tell() <= 0:
            return backline
        f.seek(-1, 1)
        last = f.read(1)
        f.seek(-1, 1)
    f.seek(1, 1)
    return backline
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">10</span> </b><br /><p><span style="background-color:yellow;">Simple</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">fast</span> <span style="background-color:yellow;">solution</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">mmap</span> <span style="background-color:yellow;">:</span> </p>
<pre><code>import mmap
import os

def tail(filename, n):
    """Returns last n lines from the filename. No exception handling"""
    size = os.path.getsize(filename)
    with open(filename, "rb") as f:
        # for Windows the mmap parameters are different
        fm = mmap.mmap(f.fileno(), 0, mmap.MAP_SHARED, mmap.PROT_READ)
        try:
            for i in xrange(size - 1, -1, -1):
                if fm[i] == '\n':
                    n -= 1
                    if n == -1:
                        break
            return fm[i + 1 if i else 0:].splitlines()
        finally:
            fm.close()
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">11</span> </b><br /><p><span style="background-color:yellow;">S.Lott</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">answer</span> <span style="background-color:yellow;">above</span> <span style="background-color:yellow;">almost</span> <span style="background-color:yellow;">works</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">but</span> <span style="background-color:yellow;">ends</span> <span style="background-color:yellow;">up</span> <span style="background-color:yellow;">giving</span> <span style="background-color:yellow;">me</span> <span style="background-color:yellow;">partial</span> <span style="background-color:yellow;">lines.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">turns</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">corrupts</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">block</span> <span style="background-color:yellow;">boundaries</span> <span style="background-color:yellow;">because</span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;">holds</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">read</span> <span style="background-color:yellow;">blocks</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">reversed</span> <span style="background-color:yellow;">order.</span> <span style="background-color:yellow;">When</span> <span style="background-color:yellow;">''.join</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">data</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">called</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">blocks</span> <span style="background-color:yellow;">are</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">wrong</span> <span style="background-color:yellow;">order.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">fixes</span> <span style="background-color:yellow;">that</span> . </p>
<pre><code>def tail(f, window=20):
    """
    Returns the last `window` lines of file `f` as a list.
    """
    BUFSIZ = 1024
    f.seek(0, 2)
    bytes = f.tell()
    size = window + 1
    block = -1
    data = []
    while size > 0 and bytes > 0:
        if bytes - BUFSIZ > 0:
            # Seek back one whole BUFSIZ
            f.seek(block * BUFSIZ, 2)
            # read BUFFER
            data.insert(0, f.read(BUFSIZ))
        else:
            # file too small, start from begining
            f.seek(0,0)
            # only read what was not read
            data.insert(0, f.read(bytes))
        linesFound = data[0].count('\n')
        size -= linesFound
        bytes -= BUFSIZ
        block -= 1
    return ''.join(data).splitlines()[-window:]
</code></pre>
<br />