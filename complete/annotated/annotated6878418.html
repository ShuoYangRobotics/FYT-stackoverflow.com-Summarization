<h3><span style="background-color:yellow;">Question</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">ID-6878418</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><h2><span style="background-color:yellow;">Putting</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">`</span> <span style="background-color:yellow;">Cookie</span> <span style="background-color:yellow;">`</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">`</span> <span style="background-color:yellow;">CookieJar</span> <span style="background-color:yellow;">`</span> </h2><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">new</span> <span style="background-color:yellow;">Python</span> <span style="background-color:yellow;">Requests</span> <span style="background-color:yellow;">library</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">make</span> <span style="background-color:yellow;">http</span> <span style="background-color:yellow;">requests.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">obtain</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">cookie</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">server</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">text.</span> <span style="background-color:yellow;">How</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">turn</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">CookieJar</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">cookie</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">it</span> ? </p>
<br /><h3><span style="background-color:yellow;">Answers</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">Total-6</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">:</span> </h3><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">0</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">confused</span> <span style="background-color:yellow;">by</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">question.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">requests</span> <span style="background-color:yellow;">library</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">put</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">cookies</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">jar</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">you</span> . </p>
<pre><code>import requests
import cookielib


URL = '...whatever...'
jar = cookielib.CookieJar()
r = requests.get(URL, cookies=jar)
r = requests.get(URL, cookies=jar)
</code></pre>
<p><span style="background-color:yellow;">The</span> <span style="background-color:yellow;">first</span> <span style="background-color:yellow;">request</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">URL</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">fill</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">jar.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">second</span> <span style="background-color:yellow;">request</span> <span style="background-color:yellow;">will</span> <span style="background-color:yellow;">send</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">cookies</span> <span style="background-color:yellow;">back</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">server.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">goes</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">standard</span> <span style="background-color:yellow;">library</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">urllib</span> <span style="background-color:yellow;">module</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">http</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">//docs.python.org/library/cookielib.html</span> <span style="background-color:yellow;"></span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">1</span> </b><br /><p><span style="background-color:yellow;">To</span> <span style="background-color:yellow;">help</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">out</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">wrote</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">entire</span> <span style="background-color:yellow;">module.</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">tried</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">my</span> <span style="background-color:yellow;">personal</span> <span style="background-color:yellow;">webpage</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">google</span> <span style="background-color:yellow;">'s</span> <span style="background-color:yellow;">cookies</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'d</span> <span style="background-color:yellow;">assume</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">works</span> . </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">got</span> <span style="background-color:yellow;">help</span> <span style="background-color:yellow;">from</span> <span style="background-color:yellow;">How</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">cookie</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">existing</span> <span style="background-color:yellow;">cookielib</span> <span style="background-color:yellow;">CookieJar</span> <span style="background-color:yellow;">instance</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">Python</span> ? </p>
<p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">lot</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">unpythonic</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">here</span> <span style="background-color:yellow;">including</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">semi-kludge</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">mileage</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">vary.</span> <span style="background-color:yellow;">Tweak</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">wish</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">especially</span> <span style="background-color:yellow;">with</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">assumed</span> <span style="background-color:yellow;">items</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">such</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">port</span> <span style="background-color:yellow;">80</span> <span style="background-color:yellow;"></span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">request</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">an</span> <span style="background-color:yellow;">argument</span> <span style="background-color:yellow;">below</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">type</span> <span style="background-color:yellow;">requests.request</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">realized</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">method</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">argument</span> <span style="background-color:yellow;">must</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">all</span> <span style="background-color:yellow;">capitals.</span> <span style="background-color:yellow;">Hope</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">help</span> <span style="background-color:yellow;">!</span> </p>
<p><span style="background-color:yellow;">Note</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">had</span> <span style="background-color:yellow;">time</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">comments</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">clarification</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">'ll</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">use</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">source</span> . </p>
<pre><code>import Cookie,cookielib,requests,datetime,time  #had this out but realized later I needed it when I continued testing

def time_to_tuple(time_string):
    wday = {'Mon':0,'Tue':1,'Wed':2,'Thu':3,'Fri':4,'Sat':5,'Sun':6}
    mon = {'Jan':1,'Feb':2,'Mar':3,'Apr':4,'May':5,'Jun':6,'Jul':7,'Aug':8,'Sep':9,'Oct':10,'Nov':11,'Dec':12}
    info = time_string.split(' ')
    info = [i.strip() for i in info if type(i)==str]
    month = None
    for i in info:
        if '-' in i:
            tmp = i.split('-')
            for m in tmp:
                try:
                    tmp2 = int(m)
                    if tmp2<31:
                        mday = tmp2
                    elif tmp2 > 2000:
                        year = tmp2
                except:
                    for key in mon:
                        if m.lower() in key.lower():
                            month = mon[key]
        elif ':' in i:
            tmp = i.split(':')
            if len(tmp)==2:
                hour = int(tmp[0])
                minute = int(tmp[1])
            if len(tmp)==3:
                hour = int(tmp[0])
                minute = int(tmp[1])
                second = int(tmp[2])
        else:
            for item in wday:
                if ((i.lower() in item.lower()) or (item.lower() in i.lower())):
                    day = wday[item]
            if month is None:
                for item in mon:
                    if ((i.lower() in item.lower()) or (item.lower() in i.lower())):
                        month = mon[item]
    return year,month,mday,hour,minute,second

def timefrom(year,month,mday,hour,minute,second):
    time_now = time.gmtime()
    datetime_now = datetime.datetime(time_now.tm_year,time_now.tm_mon,
                                     time_now.tm_mday,time_now.tm_hour,
                                     time_now.tm_min,time_now.tm_sec)
    then = datetime.datetime(year,month,mday,hour,minute,second)
    return (datetime_now-then).total_seconds()

def timeto(year,month,mday,hour,minute,second):
    return -1*timefrom(year,month,mday,hour,minute,second)



##['comment', 'domain', 'secure', 'expires', 'max-age', 'version', 'path', 'httponly']
def parse_request(request):
    headers = request.headers
    cookieinfo = headers['set-cookie'].split(';')
    name = 'Undefined'
    port=80
    port_specified=True
    c = Cookie.SmartCookie(headers['set-cookie'])
    cj = cookielib.CookieJar()
    for m in c.values():
        value = m.coded_value
        domain = m['domain']
        expires = m['expires']
        if type(expires) == str:
            tmp = time_to_tuple(expires)
            expires = timeto(tmp[0],tmp[1],tmp[2],tmp[3],tmp[4],tmp[5])
        max_age=m['max-age']
        version = m['version']
        if version == '':
            version = 0
        path = m['path']
        httponly = m['httponly']
        if httponly == '':
            if 'httponly' in headers['set-cookie'].lower():
                httponly = True
        else:
            httponly = False
        secure = m['secure']
        comment=m['comment']
        port = 80
        port_specified=False
        domain_specified=True
        domain_initial_dot = domain.startswith('.')
        path_specified=True
        discard = True
        comment_url=None
        rest={'HttpOnly':httponly}
        rfc2109=False
        ck = cookielib.Cookie(version,name,value,port,port_specified,domain,
                              domain_specified,domain_initial_dot,path,path_specified,
                              secure,expires,discard,comment,comment_url,rest,rfc2109)
        cj.set_cookie(ck)
    return cj
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">2</span> </b><br /><p><span style="background-color:yellow;">Try</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">site</span> <span style="background-color:yellow;">:</span> <span style="background-color:yellow;">Voidspace</span> <span style="background-color:yellow;">article</span> </p>
<p><span style="background-color:yellow;">Over</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">years</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">found</span> <span style="background-color:yellow;">voidspace</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">extremely</span> <span style="background-color:yellow;">useful</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">doing</span> <span style="background-color:yellow;">this</span> <span style="background-color:yellow;">kind</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">stuff.</span> <span style="background-color:yellow;">Hope</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">helped</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">although</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">quite</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">dunce.</span> <span style="background-color:yellow;">The</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">available</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">Voidspace</span> <span style="background-color:yellow;">Recipes</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">source</span> <span style="background-color:yellow;">code</span> <span style="background-color:yellow;">.py</span> <span style="background-color:yellow;">although</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">download</span> <span style="background-color:yellow;">file</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">.py-</span> <span style="background-color:yellow;">"</span> <span style="background-color:yellow;">file</span> . </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">3</span> </b><br /><p><span style="background-color:yellow;">I</span> <span style="background-color:yellow;">'m</span> <span style="background-color:yellow;">trying</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">do</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">same</span> <span style="background-color:yellow;">thing.</span> <span style="background-color:yellow;">This</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">what</span> <span style="background-color:yellow;">I</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">so</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">some</span> <span style="background-color:yellow;">reason</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">sending</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">cookies</span> <span style="background-color:yellow;">along</span> <span style="background-color:yellow;">in</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">header.</span> <span style="background-color:yellow;">It</span> <span style="background-color:yellow;">might</span> <span style="background-color:yellow;">get</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">far</span> <span style="background-color:yellow;">enough</span> <span style="background-color:yellow;">along</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">solve</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">problem</span> <span style="background-color:yellow;">though</span> . </p>
<pre><code>import requests
import cookielib
import logging

log = logging.getLogger(__name__)

def auth(auth_url, cookies):
    cj = cookielib.CookieJar()
    for x in cookies:
         if len(cookies[x]) > 0:
             ck = cookielib.Cookie(version=1, name=x, value=cookies[x], 
                    port=None, port_specified=False, domain='.example.com', 
                    domain_specified=True, 
                    domain_initial_dot=True, path='/', 
                    path_specified=True, secure=False, 
                    expires=None, discard=True, 
                    comment=None, comment_url=None, 
                    rest=None, rfc2109=True)
             log.info(ck)
             cj.set_cookie(ck)

    log.info("cookies = %s " % cj)
    response = requests.get(auth_url, cookies=cj)
    log.info("response %s \n" % response)
    log.info("response.headers %s \n" % response.headers)
    log.info("response.content %s \n" % response.content)
</code></pre>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">4</span> </b><br /><p><span style="background-color:yellow;">Well</span> <span style="background-color:yellow;">cookielib.LWPCookieJar</span> <span style="background-color:yellow;">has</span> <span style="background-color:yellow;">load</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">save</span> <span style="background-color:yellow;">methods</span> <span style="background-color:yellow;">on</span> <span style="background-color:yellow;">it.</span> <span style="background-color:yellow;">Look</span> <span style="background-color:yellow;">at</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">see</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">it</span> <span style="background-color:yellow;">matches</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">native</span> <span style="background-color:yellow;">cookie</span> <span style="background-color:yellow;">format</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">may</span> <span style="background-color:yellow;">well</span> <span style="background-color:yellow;">be</span> <span style="background-color:yellow;">able</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">load</span> <span style="background-color:yellow;">your</span> <span style="background-color:yellow;">cookie</span> <span style="background-color:yellow;">straight</span> <span style="background-color:yellow;">into</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">cookie</span> <span style="background-color:yellow;">jar</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">StringIO.</span> <span style="background-color:yellow;">Alternatively</span> <span style="background-color:yellow;">,</span> <span style="background-color:yellow;">if</span> <span style="background-color:yellow;">requests</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">using</span> <span style="background-color:yellow;">urllib2</span> <span style="background-color:yellow;">under</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">hood</span> <span style="background-color:yellow;">could</span> <span style="background-color:yellow;">n't</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">add</span> <span style="background-color:yellow;">a</span> <span style="background-color:yellow;">cookie</span> <span style="background-color:yellow;">handler</span> <span style="background-color:yellow;">to</span> <span style="background-color:yellow;">the</span> <span style="background-color:yellow;">default</span> <span style="background-color:yellow;">opener</span> ? </p>
<br /><b><span style="background-color:yellow;">#</span> <span style="background-color:yellow;">5</span> </b><br /><p><span style="background-color:yellow;">Assuming</span> <span style="background-color:yellow;">that</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">have</span> <span style="background-color:yellow;">requested</span> <span style="background-color:yellow;">for</span> <span style="background-color:yellow;">url</span> <span style="background-color:yellow;">and</span> <span style="background-color:yellow;">you</span> <span style="background-color:yellow;">got</span> <span style="background-color:yellow;">headers</span> <span style="background-color:yellow;">as</span> <span style="background-color:yellow;">response.</span> <span style="background-color:yellow;">Type</span> <span style="background-color:yellow;">type</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">url</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">string.</span> <span style="background-color:yellow;">Type</span> <span style="background-color:yellow;">type</span> <span style="background-color:yellow;">of</span> <span style="background-color:yellow;">headers</span> <span style="background-color:yellow;">is</span> <span style="background-color:yellow;">list</span> . </p>
<pre><code>import urllib2
import cookielib

class dummyResponse:
    def __init__(self,headers):
        self.headers=headers
    def info(self):
        return dummyInfo(self.headers)

class dummyInfo:
    def __init__(self,headers):
        self.headers=headers
    def getheaders(self,key):
        #Headers are in the form: 'Set-Cookie: key=val\r\n'. We want 'key=val'
        newMatches=[]
        for header in self.headers:
            if header.lower().startswith(key.lower()):
                clearHeader=header[len(key)+1:].strip()
                newMatches.append(clearHeader)
        return newMatches

req=urllib2.Request(url)
resp=dummyResponse(headers)

jar=cookielib.CookieJar()
jar.extract_cookies(resp, req)
</code></pre>
<br />