[{"text": ["Compare two images the python/linux way"], "childNum": 0, "tag": "h2", "senID": 0, "childList": []}, {"text": ["Trying to solve a problem of preventing duplicate images to be uploaded."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["I have two JPGs.", "Looking at them I can see that they are in fact identical.", "But for some reason they have different file size (one is pulled from a backup, the other is another upload) and so they have a different md5 checksum. "], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"text": ["How can I efficiently and confidently compare two images in the same sense as a human would be able to see that they are clearly identical?"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"text": ["Example: http://static.peterbe.com/a.jpg and http://static.peterbe.com/b.jpg"], "childNum": 2, "tag": "p", "senID": 4, "childList": [{"text": "http://static.peterbe.com/a.jpg", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://static.peterbe.com/a.jpg"}, {"href": "http://static.peterbe.com/b.jpg", "text": "http://static.peterbe.com/b.jpg", "childNum": 0, "tag": "a", "childList": []}]}, {"text": ["Update "], "childNum": 1, "tag": "p", "senID": 5, "childList": [{"text": "Update", "childNum": 0, "tag": "strong", "pos": 0, "childList": []}]}, {"text": ["I wrote this script:"], "childNum": 0, "tag": "p", "senID": 6, "childList": []}, {"code": "<pre>\n<code>\n import math, operator\nfrom PIL import Image\ndef compare(file1, file2):\n    image1 = Image.open(file1)\n    image2 = Image.open(file2)\n    h1 = image1.histogram()\n    h2 = image2.histogram()\n    rms = math.sqrt(reduce(operator.add,\n                           map(lambda a,b: (a-b)**2, h1, h2))/len(h1))\n    return rms\n\nif __name__=='__main__':\n    import sys\n    file1, file2 = sys.argv[1:]\n    print compare(file1, file2)\n</code>\n</pre>\n", "senID": 7}, {"text": ["Then I downloaded the two visually identical images and ran the script.", "Output:"], "childNum": 0, "tag": "p", "senID": 8, "childList": []}, {"code": "<pre>\n<code>\n 58.9830484122\n</code>\n</pre>\n", "senID": 9}, {"text": ["Can anybody tell me what a suitable cutoff should be?"], "childNum": 0, "tag": "p", "senID": 10, "childList": []}, {"text": ["Update II"], "childNum": 1, "tag": "p", "senID": 11, "childList": [{"text": "Update II", "childNum": 0, "tag": "strong", "pos": 0, "childList": []}]}, {"text": ["The difference between a.jpg and b.jpg is that the second one has been saved with PIL:"], "childNum": 0, "tag": "p", "senID": 12, "childList": []}, {"code": "<pre>\n<code>\n b=Image.open('a.jpg')\nb.save(open('b.jpg','wb'))\n</code>\n</pre>\n", "senID": 13}, {"text": ["This apparently applies some very very light quality modifications.", "I've now solved my problem by applying the same PIL save to the file being uploaded without doing anything with it and it now works!"], "childNum": 0, "tag": "p", "senID": 14, "childList": []}]