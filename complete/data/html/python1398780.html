<h3>Question (ID-1398780):</h3><h2>Downloading file using IE from python</h2><p>I'm trying to download file with Python using IE:</p>

<pre><code>from win32com.client import DispatchWithEvents

class EventHandler(object):
    def OnDownloadBegin(self):
        pass

ie = DispatchWithEvents("InternetExplorer.Application", EventHandler)

ie.Visible = 0

ie.Navigate('http://website/file.xml')
</code></pre>

<p>After this, I'm getting a window asking the user where to save the file. How can I save this file automatically from python?</p>

<p>I need to <strong>use some browser</strong>, not urllib or mechanize, because <strong>before downloading file I need to interact with some ajax functionality</strong>.</p>
<br /><h3>Answers (Total-7):</h3><b>#0</b><br /><p>This works for me as long as the IE dialogs are in the foreground and the downloaded file does not already exist in the "Save As" directory:</p>

<pre><code>import time
import threading
import win32ui, win32gui, win32com, pythoncom, win32con
from win32com.client import Dispatch

class IeThread(threading.Thread):
    def run(self):
        pythoncom.CoInitialize()
        ie = Dispatch("InternetExplorer.Application")
        ie.Visible = 0
        ie.Navigate('http://website/file.xml')

def PushButton(handle, label):
    if win32gui.GetWindowText(handle) == label:
        win32gui.SendMessage(handle, win32con.BM_CLICK, None, None)
        return True

IeThread().start()
time.sleep(3)  # wait until IE is started
wnd = win32ui.GetForegroundWindow()
if wnd.GetWindowText() == "File Download - Security Warning":
    win32gui.EnumChildWindows(wnd.GetSafeHwnd(), PushButton, "&amp;Save");
    time.sleep(1)
    wnd = win32ui.GetForegroundWindow()
if wnd.GetWindowText() == "Save As":
    win32gui.EnumChildWindows(wnd.GetSafeHwnd(), PushButton, "&amp;Save");
</code></pre>
<br /><b>#1</b><br /><p>I don't know how to say this nicely, but this sounds like about the most foolhardy software idea in recent memory.  Python is much more capable of performing AJAX calls than IE is.</p>

<p>To access the data, yes, you <em>can</em> use <code>urllib</code> and <code>urllib2</code> . If there is JSON data in the response, there's the <code>json</code> library; likewise for XML and HTML, there's <code>BeautifulSoup</code>.  </p>

<p>For one project, I had to write a Python program that would simulate a browser and sign into any of <strong>20</strong> different social networks (remember Friendster? Orkut? CyberWorld?  I do), and upload images and text into the user's account, even grasping CAPTCHAs and complex JavaScript interactions.  Pure Python makes it (comparatively) easy; as you've already seen, trying to use IE makes it impossible.</p>
<br /><b>#2</b><br /><p><a href="http://pamie.sourceforge.net/" rel="nofollow">pamie</a> perhaps</p>

<blockquote>
  <p>P.A.M.I.E. - stands for Python
  Automated Module For I.E.</p>
  
  <p>Pamie's main use is for testing web
  sites by which you automate  the
  Internet Explorer client using the
  Pamie scripting language.  PAMIE is
  not a record playback engine!</p>
  
  <p>Pamie allows you to automate I.E. by
  manipulating I.E.'s Document  Object
  Model via COM. This Free tool is for
  use by Quality Assurance  Engineers
  and Developers.</p>
</blockquote>
<br /><b>#3</b><br /><p>You don't need to use IE. You could use something like</p>

<pre><code>import urllib2
data = urllib2.urlopen("http://website/file.xml").read()
</code></pre>

<p><strong>Update:</strong> I see you've updated your question. If you need to use a browser, then clearly this answer isn't appropriate for you.</p>

<p><strong>Further update:</strong> When you click the button which is generated by JavaScript, if the URL retrieved is <em>not</em> computed by the JavaScript, and only the button is, then you can perhaps retrieve that URL via <code>urllib2</code>. On the other hand, you might also need to pass a session cookie from your authenticated session.</p>
<br /><b>#4</b><br /><p>If you can't control Internet Explorer using its COM interface, I suggest using the <a href="http://www.autoitscript.com/autoit3/" rel="nofollow">AutoIt</a> COM to control its GUI from Python.</p>
<br /><b>#5</b><br /><p>One option could also be to embed your own browser.</p>

<p>Thats e.g. possible with Qt via <a href="http://www.riverbankcomputing.co.uk/software/pyqt/intro" rel="nofollow">PyQt</a> (GPL) or <a href="http://www.pyside.org/" rel="nofollow">PySide</a> (LGPL). There you could embed the WebKit engine. You could then either display the page in a <a href="http://doc.trolltech.com/latest/qwebview.html#details" rel="nofollow">QWebView</a> and let the user navigate to your download and filter that event or use a simple <a href="http://doc.trolltech.com/latest/qwebpage.html#details" rel="nofollow">QWebPage</a> where everything could be automated and nothing has to be shown at all.</p>

<p>And <a href="http://en.wikipedia.org/wiki/Webkit" rel="nofollow">WebKit</a> should be mighty enough to do anything you want.</p>

<p>Very basic example:</p>

<pre><code>import sys

from PySide import QtCore, QtGui, QtWebKit

url = 'http://developer.qt.nokia.com/wiki/PySideDownloads/'

class TestKit(QtCore.QObject):
    def __init__(self, app):
        self.page = QtWebKit.QWebPage()
        self.page.loadFinished.connect(self.finished)
        self.page.mainFrame().load(QtCore.QUrl(url))
        self.app = app

    def finished(self, evt):
        # inspect DOM -&gt; navigate to next page or download
        print self.page.currentFrame().documentElement().toInnerXml().encode(
                'utf-8')
        # when everything is done
        self.app.quit()


if __name__ == '__main__':
    app = QtGui.QApplication(sys.argv)
    t = TestKit(app)
    sys.exit(app.exec_())
</code></pre>
<br /><b>#6</b><br /><p>I have something like that (an awful 3rd part application with lots of weird dotnet 'ajax' controls), and I use iMacros plugin for Firefox to do some automation. But I'm doing batch inserts, not downloads.</p>

<p>You can try record, edit and replay the inputs sent thru a VNC session. Look at something like <a href="http://code.google.com/p/python-vnc-viewer/" rel="nofollow">http://code.google.com/p/python-vnc-viewer/</a> for inspiration.</p>
<br />