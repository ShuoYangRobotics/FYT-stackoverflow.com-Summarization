<h3>Question (ID-283645):</h3><h2>python list in sql query as parameter</h2><p>I have a python list, say l</p>

<pre><code>l = [1,5,8]
</code></pre>

<p>I want to write a sql query to get the data for all the elements of the list, say</p>

<p>"select name from studens where id = |IN THE LIST l|"</p>

<p>How do i accomlish this?</p>
<br /><h3>Answers (Total-6):</h3><b>#0</b><br /><p>Answers so far have been templating the values into a plain SQL string. That's absolutely fine for integers, but if we wanted to do it for strings we get the escaping issue.</p>

<p>Here's a variant using a parameterised query that would work for both:</p>

<pre><code>placeholder= '?' # For SQLite. See DBAPI paramstyle.
placeholders= ', '.join(placeholder for unused in l)
query= 'SELECT name FROM students WHERE id IN (%s)' % placeholders
cursor.execute(query, l)
</code></pre>
<br /><b>#1</b><br /><p><a href="http://docs.python.org/library/stdtypes.html#str.join" rel="nofollow">string.join</a> the list values separated by commas, and use the <a href="http://docs.python.org/library/stdtypes.html#string-formatting" rel="nofollow">format operator</a> to form a query string.</p>

<pre><code>myquery = "select name from studens where id in (%s)" % ",".join(map(str,mylist))
</code></pre>

<p>(Thanks, <a href="http://stackoverflow.com/users/1199/blair-conrad">blair-conrad</a>)</p>
<br /><b>#2</b><br /><p>The SQL you want is</p>

<pre><code>select name from studens where id in (1, 5, 8)
</code></pre>

<p>If you want to construct this from the python you could use</p>

<pre><code>l = [1, 5, 8]
sql_query = 'select name from studens where id in (' + ','.join(map(str, l)) + ')'
</code></pre>

<p>The <a href="http://docs.python.org/library/functions.html#map" rel="nofollow">map</a> function will transform the list into a list of strings that can be glued together by commas using the <a href="http://docs.python.org/library/stdtypes.html#str.join" rel="nofollow">str.join</a> method.</p>

<p>Alternatively:</p>

<pre><code>l = [1, 5, 8]
sql_query = 'select name from studens where id in (' + ','.join((str(n) for n in l)) + ')'
</code></pre>

<p>if you prefer <a href="http://docs.python.org/glossary.html#term-generator-expression" rel="nofollow">generator expressions</a> to the map function.</p>

<p>UPDATE: <a href="http://stackoverflow.com/users/10661/slott">S. Lott</a> mentions in the comments that the Python SQLite bindings doing support sequences. In that case, you might want</p>

<pre><code>select name from studens where id = 1 or id = 5 or id = 8
</code></pre>

<p>Generated by </p>

<pre><code>sql_query = 'select name from studens where ' + ' or '.join(('id = ' + str(n) for n in l))
</code></pre>
<br /><b>#3</b><br /><p>Here is one way, where <code>cursor</code> is your usual cursor object:</p>

<pre><code>&gt;&gt;&gt; random_ids = [1234,123,54,56,57,58,78,91]
&gt;&gt;&gt; cursor.execute("create table test (id)")
&gt;&gt;&gt; for item in random_ids:
    cursor.execute("insert into test values (%d)" % item)
&gt;&gt;&gt; sublist = [56,57,58]
&gt;&gt;&gt; cursor.execute("select id from test where id in %s" % str(tuple(sublist)))
&gt;&gt;&gt; a = cursor.fetchall()
&gt;&gt;&gt; a
[(56,), (57,), (58,)]
</code></pre>
<br /><b>#4</b><br /><p>But what if list is too long and kinterbasdb raises this:</p>

<pre><code>ProgrammingError: (0L, 'SQL statement of 80316 bytes is too long (max 65535 allowed). Consider using bound parameters to shorten the SQL code, rather than passing large values as part of the SQL string.')
</code></pre>

<p>Any ideas except that optimizing code?</p>
<br /><b>#5</b><br /><p>I like bobince's answer:</p>

<pre><code>placeholder= '?' # For SQLite. See DBAPI paramstyle.
placeholders= ', '.join(placeholder for unused in l)
query= 'SELECT name FROM students WHERE id IN (%s)' % placeholders
cursor.execute(query, l)
</code></pre>

<p>But I noticed this:</p>

<pre><code>placeholders= ', '.join(placeholder for unused in l)
</code></pre>

<p>Can be replaced with:</p>

<pre><code>placeholders= ', '.join(placeholder*len(l))
</code></pre>

<p>I find this more direct if less clever and less general. Here <code>l</code> is required to have a length (i.e. refer to an object that defines a <code>__len__</code> method), which shouldn't be a problem. But placeholder must also be a single character. To support a multi-character placeholder use:</p>

<pre><code>placeholders= ', '.join([placeholder]*len(l))
</code></pre>
<br />