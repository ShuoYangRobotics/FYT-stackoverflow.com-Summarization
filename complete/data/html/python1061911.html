<h3>Question (ID-1061911):</h3><h2>Django with system timezone setting vs user's individual timezones</h2><p>How well does Django handle the case of different timezones for each user?  Ideally I would like to run the server in the UTC timezone (eg, in settings.py set TIME_ZONE="UTC") so all datetimes were stored in the database as UTC.  Stuff like <a href="http://stackoverflow.com/questions/689831/changing-timezone-on-an-existing-django-project">this</a> scares me which is why I prefer UTC everywhere.</p>

<p>But how hard will it be to store a timezone for each user and still use the standard django datetime formatting and modelform wrappers.  Do I anticipate having to write date handling code everywhere to convert dates into the user's timezone and back to UTC again?</p>

<p>I am still going through the django tutorial but I know how much of a pain it can be to deal with user timezones in some other frameworks that assume system timezone everywhere so I thought I'd ask now.</p>

<p>My research at the moment consisted of searching the django documentation and only finding <a href="http://docs.djangoproject.com/en/dev/ref/settings/#time-zone" rel="nofollow">one reference</a> to timezones.</p>

<hr>

<p>Additional: </p>

<ul>
<li>There are a <a href="http://code.djangoproject.com/ticket/2626" rel="nofollow">few bugs submitted</a> concerning Django and timezone handling.</li>
<li>Babel has <a href="http://svn.edgewall.org/repos/babel/contrib/django/" rel="nofollow">some contrib code for django</a> that seems to deal with timezone formatting in locales.</li>
</ul>
<br /><h3>Answers (Total-6):</h3><b>#0</b><br /><p>I'm going to be working on this problem myself for my application. My first approach to this problem would be to go with django core developer Malcom Tredinnick's advice in <a href="http://groups.google.com/group/django-users/msg/ee174701c960ff2d">this django-user's post</a>. You'll want to store the user's timezone setting in their user profile, probably.</p>

<p>I would also highly encourage you to look into the <a href="http://pytz.sourceforge.net/">pytz module</a>, which makes working with timezones less painful. For the front end, I created a "timezone picker" based on the common timezones in pytz. I have one select box for the area, and another for the location (e.g. US/Central is rendered with two select boxes). It makes picking timezones slightly more convenient than wading through a list of 400+ choices.</p>
<br /><b>#1</b><br /><p>It's not that hard to write timezone aware code in django:</p>

<p>I've written simple django application which helps handle timezones issue in django projects: <a href="https://github.com/paluh/django-tz" rel="nofollow">https://github.com/paluh/django-tz</a>. It's based on Brosner (django-timezone) code but takes different approach to solve the problem - I think it implements something similar to yours and FernandoEscher propositions.</p>

<p>All datetime values are stored in data base in one timezone (according to TIME_ZONE setting) and conversion to appropriate value (i.e. user timezone) are done in templates and forms (there is form widget for datetimes fields which contains additional subwidget with timezone). Every datetime conversion is explicit - no magic.</p>

<p>Additionally there is per thread cache which allows you simplify these datatime conversions (implementation is based on django i18n translation machinery).</p>

<p>When you want to remember user timezone, you should add timezone field to profile model and write simple middleware (follow the example from doc).</p>
<br /><b>#2</b><br /><p>Not a Django expert here, but afaik Django has no magic, and I can't even imagine any such magic that would work. </p>

<p>For example: you don't always want to save times in UTC. In a calendar application, for example, you want to save the datetime in the local time that the calendar event happens. Which can be different both from the servers and the users time zone. So having code that automatically converts every selected datetime to the servers time zone would be a Very Bad Thing.</p>

<p>So yes, you will have to handle this yourself. I'd recommend to store the time zone for everything, and of course run the server in UTC, and let all the datetimes generated by the application use UTC, and then convert them to the users time zone when displaying. It's not difficult, just annoying to remember. when it comes to datetimes that are inputted by the user, it's dependant on the application if you should convert to UTC or not. I would as a general recommendation not convert to UTC but save in the users time zone, with the information of which time zone that is.</p>

<p>Yes, time zones is a big problem. I've written a couple of blog posts on the annoying issue, like here: <a href="http://regebro.wordpress.com/2007/12/18/python-and-time-zones-fighting-the-beast/" rel="nofollow">http://regebro.wordpress.com/2007/12/18/python-and-time-zones-fighting-the-beast/</a></p>

<p>In the end you will have to take care of time zone issues yourself, because there is no real correct answer to most of the issues. </p>
<br /><b>#3</b><br /><p>Django doesn't handle it at all, largely because Python doesn't either. Python (Guido?) has so far decided not to support timezones since although a reality of the world are "<a href="http://docs.python.org/library/datetime.html#module-datetime" rel="nofollow">more political than rational, and there is no standard suitable for every application</a>."</p>

<p>The best solution for most is to not worry about it initially and rely on what Django provides by default in the settings.py file <code>TIME_ZONE = 'America/Los_Angeles'</code> to help later on.</p>

<p>Given your situation <a href="http://pytz.sourceforge.net/#example-usage" rel="nofollow">pytz</a> is the way to go (it's already been mentioned). You can install it with <code>easy_install</code>. I recommend converting times on the server to UTC on the fly when they are asked for by the client, and then converting these UTC times to the user's local timezone on the client (via Javascript in the browser or via the OS with iOS/Android).</p>

<p>The server code to convert times stored in the database with the <code>America/Los_Angeles</code> timezone to UTC looks like this:</p>

<pre><code>&gt;&gt;&gt; # Get a datetime from the database somehow and store into "x"
&gt;&gt;&gt; x = ...
&gt;&gt;&gt;
&gt;&gt;&gt; # Create an instance of the Los_Angeles timezone
&gt;&gt;&gt; la_tz = pytz.timezone(settings.TIME_ZONE)
&gt;&gt;&gt;
&gt;&gt;&gt; # Attach timezone information to the datetime from the database
&gt;&gt;&gt; x_localized = la_tz.localize(x)
&gt;&gt;&gt;
&gt;&gt;&gt; # Finally, convert the localized time to UTC
&gt;&gt;&gt; x_utc = x_localized.astimezone(pytz.utc)
</code></pre>

<p>If you send <code>x_utc</code> down to a web page, Javascript can convert it to the user's operating system timezone. If you send <code>x_utc</code> down to an iPhone, iOS can do the same thing, etc. I hope that helps.</p>
<br /><b>#4</b><br /><p>You could start by taking a look at the <a href="http://code.google.com/p/django-timezones/" rel="nofollow">django-timezones</a> application. It makes available a number of timezone-based model fields (and their corresponding form fields, and some decorators), which you could use to at least <em>store</em> different timezone values per user (if nothing else).    </p>
<br /><b>#5</b><br /><p>Looking at the <a href="https://github.com/brosner/django-timezones" rel="nofollow">django-timezones</a> application I found that it doesn't support MySQL DBMS, since MySQL doesn't store any timezone reference within datetimes.</p>

<p>Well, I think I manage to work around this by forking the <a href="https://github.com/brosner/django-timezones" rel="nofollow">Brosner library</a> and modifying it to work transparently within your models.</p>

<p>There, I'm doing the same thing the django translation system do, so you can get user unique timezone conversion. There you should find a Field class and some datetime utils to always get datetimes converted to the user timezone. So everytime you make a request and do a query, everything will be timezoned.</p>

<p><a href="https://github.com/FernandoEscher/django-timezones" rel="nofollow">Give it a try!</a></p>
<br />