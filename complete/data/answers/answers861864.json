[[{"text": ["Here are a couple of links to give you an idea on what you're up against:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"tag": "ul", "num": 2, "lis": [{"text": ["How can I run an untrusted Python script safely (i.e.", "Sandbox)"], "childNum": 0, "tag": "a", "senID": 1, "childList": []}, {"text": ["Capabilities for Python?"], "childNum": 0, "tag": "a", "senID": 2, "childList": []}]}, {"text": ["There is also a dead google code project at http://code.google.com/p/sandbox-python/"], "childNum": 1, "tag": "p", "senID": 3, "childList": [{"text": "http://code.google.com/p/sandbox-python/", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://code.google.com/p/sandbox-python/"}]}], [{"text": ["No there is no production ready subset of Python that is \"safe\".", "Python has had a few sand box modules which were deprecated due to deficiencies."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["Your best bet is to either create your own parser, or isolate the python process with syscall hooks and a jailed account."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["Some people might point you to PyPy, but it is slow and unfinished."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}], [{"text": ["The PyMite VM fits the bill if all you need to do is set simple variables, loops, conditionals and functions.", "PyMite is tiny, written in C, uses a static memory pool and can be embedded.", "It has an extremely limited set of builtin functions that is easy to configure.", "Similarly, the only standard libraries are partial implementations of string, dict, list and sys.", "The PyMite VM is part of the python-on-a-chip project, so it was designed to run on microcontrollers, but can run on posix-style desktop systems.", "The downside is that PyMite is not as extensively de-bugged as other Python implementations."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "PyMite VM", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://pythononachip.org"}]}], [{"text": ["The pypy project offers sandboxing features, see http://codespeak.net/pypy/dist/pypy/doc/sandbox.html ."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "http://codespeak.net/pypy/dist/pypy/doc/sandbox.html", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://codespeak.net/pypy/dist/pypy/doc/sandbox.html"}]}], [{"text": ["tinypy (tinypy.org) was made to be a small, embed-able Python subset written in the style of Lua.", "And as lua has a manner to create a sandbox, I estimate that tinypy could be hacked along the same vein.", "Since tinypy's code base is so small, it's pretty easy to learn and figure out how to change things around to fit your needs."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "tinypy.org", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://tinypy.org"}]}], [{"text": ["AFAIK, some attempts were made in standard python library, but they were not successful.", "See Restricted Execution for details."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "Restricted Execution", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://docs.python.org/library/restricted.html"}]}], [{"text": ["Your native code that's \"in the wild\" is equally vulnerable to this attack; that it is in machine code is just a speed bump, and no security."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["If you are extremely paranoid and want a higher speedbump, you could make your native app that hosts the script instance check a hash of the content.", "Then accidential changes are impossible; only deliberate changes would go to the trouble of updating the checksum.", "You could go further and check they were signed with a public key too; then only hacking your native app could let new scripts in."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["But the sandboxing?", "Don't worry about it!"], "childNum": 0, "tag": "p", "senID": 2, "childList": []}], [{"text": ["You might try IronPython on Silverlight/Moonlight, as these guys impressively seem to be doing.", "There is a lot of great information on these types of IronPython applications from the Resolver One developers here."], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "these guys", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://www.trypython.org/"}, {"text": "here", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://www.voidspace.org.uk/ironpython/silverlight/index.shtml#python-interactive-interpreter-in-a-browser"}]}], [{"text": ["I don't really know much about exactly what security capabilities you get within the Java Virtual Machine or .NET runtimes, but you might want to consider if running your python code with Jython or IronPython might allow you to get added security."], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "Jython", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://www.jython.org/Project/"}, {"href": "http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython", "text": "IronPython", "childNum": 0, "tag": "a", "childList": []}]}], [{"text": ["It's a little hard to understand what you're trying to do -- not enough details."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["Are you hosting the native app and allowing the users to write plugins?", "Consider using an OS-level solution by running the Python application as a separate runtime process inside a jail/chroot/similar, and communicating over sockets."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["Are you expecting your customers to host the native app and let \"untrusted parties\" write plugins?", "Is there a reason the solution above won't work?", "(E.g., the customer would like to deploy on weird OSs without such options...)"], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"text": ["Are you expecting the same people to host the native app and the \"untrusted script\" and want to protect them from themselves?", "In the sense of protecting them from writing \"os.remove\" and having it do what they wrote?", "Can you explain why?"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"text": ["Note that sandboxing alone is often not enough without stricter constraints (maximum CPU cycles, maximum memory, memory ownership issues...)?", "What kind of maliciousness do you want to stop?", "Note that here, too, OSs have wonderful capabilities (priorities, killing processes, ulimits) that not all sandboxing environments replicate -- and are certainly less security-tested than the things in OSs.", "(I'd trust Linux not to have breakable ulimits before I'd trust PyPy not to enable a malicious coder to take up unbounded amounts of memory, simply because Linux has been attacked in the wild more."], "childNum": 0, "tag": "p", "senID": 4, "childList": []}], [{"text": ["For some discussion on issues previously met with the rexec module:"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "rexec", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"tag": "ul", "num": 2, "lis": [{"text": ["http://mail.python.org/pipermail/python-dev/2002-December/031160.html"], "childNum": 0, "tag": "a", "senID": 1, "childList": []}, {"text": ["http://mail.python.org/pipermail/python-dev/2003-January/031848.html"], "childNum": 0, "tag": "a", "senID": 2, "childList": []}]}, {"text": ["These came from Restricted Execution HOWTO."], "childNum": 1, "tag": "p", "senID": 3, "childList": [{"text": "Restricted Execution HOWTO", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://www.amk.ca/python/howto/rexec/"}]}], [{"text": ["This sounds like what you want: Reviving Python restricted mode."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "Reviving Python restricted mode", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://lwn.net/Articles/321872/"}]}, {"text": ["The Python interpreter has a built-in \"restricted\" mode, enabled by changing the __builtins__ magic variable.", "The article Paving the Way to Securing the Python Interpreter explains the trick in more detail.", "Note that to work completely, it needs a patch to the Python intrepreter; I do not know if it has already been applied."], "childNum": 2, "tag": "p", "senID": 1, "childList": [{"text": "__builtins__", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "Paving the Way to Securing the Python Interpreter", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://tav.espians.com/paving-the-way-to-securing-the-python-interpreter.html"}]}, {"text": ["For a pure python proof-of-concept, see his previous post A Challenge To Break Python Security."], "childNum": 1, "tag": "p", "senID": 2, "childList": [{"text": "A Challenge To Break Python Security", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://tav.espians.com/a-challenge-to-break-python-security.html"}]}]]