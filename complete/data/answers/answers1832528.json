[[{"text": ["Close is always necessary when dealing with files, it is not a good idea to leave open file handles all over the place.", "They will eventually be closed when the file object is garbage collected but you do not know when that will be and in the mean time you will be wasting system resources by holding to file handles you no longer need."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "always", "childNum": 0, "tag": "strong", "pos": 0, "childList": []}]}, {"text": ["If you are using Python 2.5 and higher the close() can be called for you automatically using the with statement:"], "childNum": 2, "tag": "p", "senID": 1, "childList": [{"text": "close()", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "with", "childNum": 0, "tag": "code", "childList": []}]}, {"code": "<pre>\n<code>\n from __future__ import with_statement # Only needed in Python 2.5\nwith open(\"hello.txt\") as f:\n    for line in f:\n        print line\n</code>\n</pre>\n", "senID": 2}, {"text": ["This is has the same effect as the code you have:"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"code": "<pre>\n<code>\n f = open(\"hello.txt\")\ntry:\n    for line in f:\n        print line\nfinally:\n    f.close()\n</code>\n</pre>\n", "senID": 4}, {"text": ["The with statement is direct language support for the Resource Acquisition Is Initialization idiom commonly used in C++.", "It allows the safe use and clean up of all sorts of resources, for example it can be used to always ensure that database connections are closed or locks are always released like below."], "childNum": 2, "tag": "p", "senID": 5, "childList": [{"text": "with", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "Resource Acquisition Is Initialization", "tag": "a", "pos": -1, "childList": [], "childNum": 0, "href": "http://en.wikipedia.org/wiki/Resource%5Facquisition%5Fis%5Finitialization"}]}, {"code": "<pre>\n<code>\n mylock = threading.Lock()\nwith mylock:\n    pass # do some thread safe stuff\n</code>\n</pre>\n", "senID": 6}], [{"text": ["In actuality, the file will be closed when it is garbage collected.", "See this question for more on how that works.  "], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "this question", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://stackoverflow.com/questions/575278/how-does-python-close-files-that-have-been-gced"}]}, {"text": ["It is still recommended that you use a try/finally block or a with statement though.", "If there is an exception when using one of the file object's methods, a reference will be stored in the traceback (which is stored as a global variable) until you clear it or another exception occurs.  "], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["Thus, it's bad to rely on garbage collection to close your file for you."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"text": ["Also, if you've written to the file, you can't guarantee that the changes will be saved to the file until it is closed or flushed."], "childNum": 0, "tag": "p", "senID": 3, "childList": []}], [{"text": ["Upon exit the Python interpreter (or the kernel in the event of a crash) will close the file, but it's still a good practice to close them when you don't need them.", "For 1 or 2, or 10, files it might not be a problem, but for more it might bring the whole system down."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["Most importantly, it is a sign that the person who wrote the code actually cares about his work."], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "cares", "childNum": 0, "tag": "strong", "pos": 0, "childList": []}]}], [{"text": ["It's kind of hinted at all over the place, but to make it the most clear, yes, you need to close that file.", "In Python 2.5 (using future) and in Python 2.6, you no longer need the wordy version:"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "future", "childNum": 0, "tag": "strong", "pos": 1, "childList": []}]}, {"code": "<pre>\n<code>\n from __future__ import with_statement\nwith open(\"hello.txt\") as f:\n    for line in f:\n        print line\n</code>\n</pre>\n", "senID": 1}], [{"text": ["Strange that for all the discussion in this topic of the importance of freeing system resources, nobody has mentioned what seems to me an obviously more significant reason to close a file deterministically:  so that it can be opened again."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["There are certainly cases where it doesn't matter.", "If a file object goes out of scope or gets deleted, the underlying file will get closed.", "(When it gets closed depends on the specific implementation of Python you're using.", ")  That's generally going to be good enough - if you know exactly when the file variable is going to go out of scope, and if you know that you don't care if the file gets closed deterministically."], "childNum": 2, "tag": "p", "senID": 1, "childList": [{"text": "if", "childNum": 0, "tag": "em", "pos": 2, "childList": []}, {"text": "if", "childNum": 0, "tag": "em", "pos": 3, "childList": []}]}, {"text": ["But why should you even be troubling yourself with that kind of analysis when the with statement exists?"], "childNum": 1, "tag": "p", "senID": 2, "childList": [{"text": "with", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}], [{"text": ["You need to close handles so that memory is freed up.", "Not really needed until dealing with a lot of files at a time."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}], [{"text": ["Yes, because otherwise you might leak resources."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["From the Python docs."], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "Python docs", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://docs.python.org/tutorial/inputoutput.html#methods-of-file-objects"}]}, {"text": ["This'll happen for you when the program exits, but otherwise Python's keeping around resources it no longer needs up to that point."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}], [{"text": ["No, I don't believe the longer idiom is necessary, and here is why:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["I grepped /usr/lib/python2.6/ for the pattern 'for\\s+.", "*\\s+in\\s+open\\('\nand found many examples of "], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "'for\\s+.*\\s+in\\s+open\\('", "childNum": 0, "tag": "code", "pos": -1, "childList": []}]}, {"code": "<pre>\n<code>\n for line in open('hello.txt'):\n    print line\n</code>\n</pre>\n", "senID": 2}, {"text": ["and so far zero instances of "], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"code": "<pre>\n<code>\n f = open(\"hello.txt\")\ntry:\n    for line in f:\n        print line\nfinally:\n    f.close()\n</code>\n</pre>\n", "senID": 4}, {"text": ["See below for the list of files in the standard library that use the for ... in open idiom."], "childNum": 1, "tag": "p", "senID": 5, "childList": [{"text": "for ... in open", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"text": ["This naturally leads to the question: If the Python developers accept the shorter idiom in\nthe standard libraries, how can we be improving anything by using something\ndifferent in our own code if our code depends on standard libraries?"], "childNum": 0, "tag": "p", "senID": 6, "childList": []}, {"text": ["I think the answer is, the longer idiom does not improve anything."], "childNum": 0, "tag": "p", "senID": 7, "childList": []}, {"text": ["I also ran "], "childNum": 0, "tag": "p", "senID": 8, "childList": []}, {"code": "<pre>\n<code>\n #!/usr/bin/env python\ntry:\n    for i,line in enumerate(open('a')):\n        print line\n        raw_input()\n        if i==5:\n            break\nexcept Exception:\n    pass\n\nraw_input()\n</code>\n</pre>\n", "senID": 9}, {"text": ["and checked /proc/PID/fd for when the file descriptor was closed.", "It appears that when you break out of the for loop, the file is closed for you."], "childNum": 1, "tag": "p", "senID": 10, "childList": [{"text": "/proc/PID/fd", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"text": ["On the basis of these experiments, I do not believe the long \ntry...finally...close idiom is necessary. "], "childNum": 1, "tag": "p", "senID": 11, "childList": [{"text": "try...finally...close", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"text": ["Here is the result of the grep:"], "childNum": 0, "tag": "p", "senID": 12, "childList": []}, {"code": "<pre>\n<code>\n /usr/lib/python2.6/dist-packages/NvidiaDetector/nvidiadetector.py:89:tempList = [ x.strip() for x in open(obsolete).readlines() ]\n/usr/lib/python2.6/dist-packages/rpy_io.py:49:for line in open(file).readlines():\n/usr/lib/python2.6/dist-packages/setuptools/command/easy_install.py:1376:for line in open(self.filename,'rt'):\n/usr/lib/python2.6/dist-packages/GDebi/DscSrcPackage.py:47:for line in open(file):\n/usr/lib/python2.6/dist-packages/aptsources/distinfo.py:220:[x.strip() for x in open(value)])\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeCache.py:989:for line in open(\"/proc/mounts\"):\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeAufs.py:100:for line in open(\"/proc/mounts\"):\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeAufs.py:205:for line in open(\"/proc/mounts\"):\n/usr/lib/python2.6/dist-packages/DistUpgrade/distinfo.py:220:[x.strip() for x in open(value)])\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeViewKDE.py:826:for c in open(sys.argv[2]).read():\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeConfigParser.py:45:items = [x.strip() for x in open(p)]\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeQuirks.py:684:for line in open(cpuinfo):\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeQuirks.py:692:for line in open(\"/proc/mounts\"):\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeQuirks.py:726:for line in open(\"/etc/fstab\"):\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeQuirks.py:762:for line in open(fstab):\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeQuirks.py:801:for line in open(\"/etc/fstab\"):\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeQuirks.py:874:for line in open(XORG):\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeQuirks.py:939:for line in open(os.path.join(modaliasesdir,filename)):\n/usr/lib/python2.6/dist-packages/DistUpgrade/DistUpgradeController.py:1307:for line in open(template):\n/usr/lib/python2.6/dist-packages/DistUpgrade/xorg_fix_proprietary.py:23:for raw in open(xorg_source):\n/usr/lib/python2.6/dist-packages/DistUpgrade/xorg_fix_proprietary.py:58:for line in open(xorg):\n/usr/lib/python2.6/dist-packages/DistUpgrade/xorg_fix_proprietary.py:82:for line in open(xorg):\n/usr/lib/python2.6/dist-packages/jockey/oslib.py:377:for line in open(self.apt_jockey_source):\n/usr/lib/python2.6/dist-packages/jockey/oslib.py:393:for line in open(f):\n/usr/lib/python2.6/dist-packages/jockey/backend.py:651:for line in open(path):\n/usr/lib/python2.6/dist-packages/jockey/detection.py:277:for line in open(alias_file):\n/usr/lib/python2.6/dist-packages/jockey/detection.py:597:for l in open(os.path.join(path, 'uevent')):\n/usr/lib/python2.6/dist-packages/apt/cdrom.py:83:for line in open(fname):\n/usr/lib/python2.6/dist-packages/problem_report.py:1119:for line in open('/proc/mounts'):\n/usr/lib/python2.6/dist-packages/apport/packaging_impl.py:128:for line in open(f):\n/usr/lib/python2.6/dist-packages/apport/packaging_impl.py:190:for line in open(sumfile):\n/usr/lib/python2.6/dist-packages/apport/packaging_impl.py:641:for l in open('/etc/apt/sources.list'):\n/usr/lib/python2.6/dist-packages/apport/hookutils.py:190:for line in open('/proc/asound/cards'):\n/usr/lib/python2.6/dist-packages/apport/hookutils.py:290:for line in open('/var/log/syslog'):\n/usr/lib/python2.6/dist-packages/apport/hookutils.py:493:mods = [l.split()[0] for l in open(module_list)]\n/usr/lib/python2.6/dist-packages/softwareproperties/SoftwareProperties.py:597:for line in open(f):\n/usr/lib/python2.6/dist-packages/softwareproperties/gtk/SoftwarePropertiesGtk.py:883:for x in open(tmp.name):\n/usr/lib/python2.6/dist-packages/lsb_release.py:253:for line in open('/etc/lsb-release'):\n/usr/lib/python2.6/dist-packages/numpy/distutils/system_info.py:815:for d in open(ld_so_conf,'r').readlines():\n/usr/lib/python2.6/dist-packages/LanguageSelector/LocaleInfo.py:72:for line in open(languagelist_file):\n/usr/lib/python2.6/dist-packages/LanguageSelector/LocaleInfo.py:187:for line in open(environment).readlines():\n/usr/lib/python2.6/dist-packages/LanguageSelector/LocaleInfo.py:193:for line in open(environment).readlines():\n/usr/lib/python2.6/dist-packages/LanguageSelector/LanguageSelector.py:125:for line in open(fname):\n/usr/lib/python2.6/dist-packages/LanguageSelector/LanguageSelector.py:140:for line in open(fname):\n/usr/lib/python2.6/dist-packages/LanguageSelector/LanguageSelector.py:171:for line in open(fname):\n/usr/lib/python2.6/dist-packages/LanguageSelector/LanguageSelector.py:210:for line in open(fname):\n/usr/lib/python2.6/dist-packages/LanguageSelector/macros.py:16:for l in open(file):\n/usr/lib/python2.6/dist-packages/LanguageSelector/macros.py:37:for l in open(self.LANGCODE_TO_LOCALE):\n/usr/lib/python2.6/dist-packages/LanguageSelector/LangCache.py:94:for l in open(self.BLACKLIST):\n/usr/lib/python2.6/dist-packages/LanguageSelector/LangCache.py:99:for l in open(self.LANGCODE_TO_LOCALE):\n/usr/lib/python2.6/dist-packages/LanguageSelector/LangCache.py:111:for l in open(self.PACKAGE_DEPENDS):\n/usr/lib/python2.6/dist-packages/LanguageSelector/ImSwitch.py:78:for l in open(self.blacklist_file):\n</code>\n</pre>\n", "senID": 13}]]