[[{"text": ["You may want to consider a closure."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n from django.forms import ModelForm\nfrom django.views.generic.create_update import create_object, update_object\n\ndef make_foo_form(request):\n    class FooForm(ModelForm):\n        class Meta:\n            model = Foo\n            fields = ['foo', 'bar']\n\n        def save(self, commit=True):\n            f = super(FooForm, self).save(commit=False)\n            if not f.pk: f.user = request.user\n            if commit: f.save()\n            return f\n\n    return FooForm\n\ndef create_foo(request):\n    FooForm = make_foo_form(request)\n    return create_object(form_class=FooForm)\n</code>\n</pre>\n", "senID": 1}, {"text": ["There is some inefficiency here, since you need to create the ModelForm object on each request, but it does allow you to inject functionality into the generic view."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"text": ["You need to decide whether the added complexity for the form creation is worth maintaining simplicity on the view side."], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"text": ["A benefit here, though, is that this also works with the update case with practically no extra effort:"], "childNum": 0, "tag": "p", "senID": 4, "childList": []}, {"code": "<pre>\n<code>\n def update_foo(request, object_id):\n    FooForm = make_foo_form(request)\n    return update_object(form_class=FooForm, object_id=object_id)\n</code>\n</pre>\n", "senID": 5}, {"text": ["Obviously, you can use this approach for more complex cases as well."], "childNum": 0, "tag": "p", "senID": 6, "childList": []}], [{"text": ["In many ways, all the solutions to this will be more trouble than they are worth.", "This one qualifies as a hack.", "It is possible for a django update to leave you high and dry if they change the way create_update is implemented.", "For simplicity sake, I'll assume that you are trying to set a default user, not silently force the user to be the logged in user."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["Write a context processor:"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n from django.views.generic.create_update import get_model_and_form_class\ndef form_user_default(request):\n    if request.method == 'GET':\n        model, custom_form = get_model_and_form_class(Post,None)\n        custom_form.author = request.user\n        return {'form':custom_form}\n    else: return {}\n</code>\n</pre>\n", "senID": 2}, {"text": ["What this will do is override the form object that create_update passes to the template.", "What it's technically doing is re-creating the form after the default view has done it.  "], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"text": ["Then in your url conf:"], "childNum": 0, "tag": "p", "senID": 4, "childList": []}, {"code": "<pre>\n<code>\n url(r'pattern_to_match', 'django.views.generic.create_update.create_object', kwargs={'context_processors':form_user_default})\n</code>\n</pre>\n", "senID": 5}, {"text": ["Again, I had to delve into the source code to figure out how to do this.", "It might really be best to try writing your own view (but incorporate as many Django custom objects as possible).", "There's no \"simple default\" way to do this, because in the django paradigm forms are more closely tied to the model layer than to views, and only views have knowledge of the request object."], "childNum": 0, "tag": "p", "senID": 6, "childList": []}], [{"text": ["If a user is authenticated, their user object is the request.user object."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "request.user", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"text": ["I'm not familiar with create_object...", "I'm still a beginner to django and have only just started my first real project with it."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["Note that you should check to make sure a user is logged in before using this.", "This can be done with request.user.is_authenticated()."], "childNum": 1, "tag": "p", "senID": 2, "childList": [{"text": "request.user.is_authenticated()", "childNum": 0, "tag": "code", "pos": 1, "childList": []}]}], [{"text": ["There is no good way to hook into the saving of an object when using the current Django generic views.", "Once they are rewritten as classes, you'll be able to subclass the view and hook in at the proper place without having to rewrite the whole view."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "rewritten as classes", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://code.djangoproject.com/ticket/6735"}]}, {"text": ["I already use my own class-based generic views for this reason."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}], [{"text": ["I would suggest to make a wrapper for the create_object, as this author suggest\nhttp://www.b-list.org/weblog/2006/nov/16/django-tips-get-most-out-generic-views/\nin the view you'll have access to the user info.", "Afterwards, you will need to use the extra_context to pass the user to the template.", "Finally at the template you can add a hidden field with the user info.", "I haven't tried it, but I have been thinking of it for quite some time.", "Hope this solution suits you!", ";) cheers!"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "http://www.b-list.org/weblog/2006/nov/16/django-tips-get-most-out-generic-views/", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://www.b-list.org/weblog/2006/nov/16/django-tips-get-most-out-generic-views/"}]}], [{"text": ["I have exact the same requirement, this snippets solved this problem nicely: "], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["http://www.djangosnippets.org/snippets/99/"], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "http://www.djangosnippets.org/snippets/99/", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://www.djangosnippets.org/snippets/99/"}]}]]