[[{"text": ["Unfortunately MySQL doesn't allow you an easy way to avoid this.", "A common method is basically to write a script that checks all running processes every X seconds (based on what you think is \"long\") and kill ones it sees are running too long.", "You can at least get some basic diagnostics, however, by setting log_slow_queries in MySQL which will write all queries that take longer than 10 seconds into a log.", "If that's too long for what you regard as \"slow\" for your purposes, you can set long_query_time to a value other than 10 to change the threshold. "], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "log_slow_queries", "childNum": 0, "tag": "code", "pos": 2, "childList": []}, {"text": "long_query_time", "childNum": 0, "tag": "code", "pos": 3, "childList": []}]}], [{"text": ["It seems that the only reliable way to abort a query is the kill command.", "A less drastic measure is to close the connection (and reopen a new one); this will terminate queries as soon as they try to send some output to the client."], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "kill command", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://dev.mysql.com/doc/refman/5.0/en/kill.html"}, {"text": "send some output", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://www.faqts.com/knowledge%5Fbase/view.phtml/aid/2751"}]}], [{"text": ["Do you know what the queries are?", "Maybe you could optimise the SQL or put some indexes on your tables?"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}], [{"text": ["I'm doing a Django DB-replication app and have the same predicament, queries across a WAN can sometimes just seem to hang if the network latency increases. "], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["From http://code.activestate.com/recipes/576780/"], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "http://code.activestate.com/recipes/576780/", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://code.activestate.com/recipes/576780/"}]}, {"text": ["Recipe 576780: Timeout for (nearly) any callable "], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"text": ["Create a time limited version of any callable."], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"code": "<pre>\n<code>\n For example, to limit function f to t seconds,\n   first create a time limited version of f.\n\n     from timelimited import *\n\n     f_t = TimeLimited(f, t)\n\n  Then, instead of invoking f(...), use f_t like\n\n     try:\n         r = f_t(...)\n     except TimeLimitExpired:\n         r = ...  # timed out\n</code>\n</pre>\n", "senID": 4}, {"text": ["Use it the following way for example:"], "childNum": 0, "tag": "p", "senID": 5, "childList": []}, {"code": "<pre>\n<code>\n def _run_timed_query(cursor, log_msg, timeout, query_string, *query_args):\n    \"\"\"Run a timed query, do error handling and logging\"\"\"\n    import sys\n    import traceback\n    from timelimited import *\n\n    try:\n        return TimeLimited(cursor.execute, timeout)(query_string, *query_args)\n    except TimeLimitExpired:\n        logger_ec.error('%s; Timeout error.' % log_msg)\n        raise TimeLimitExpired\n    except:\n        (exc_type, exc_info, tb) = sys.exc_info()\n        logger_ec.error('%s; %s.' % (log_msg, traceback.format_exception(exc_type, exc_info, None)[0]))\n        raise exc_type\n</code>\n</pre>\n", "senID": 6}], [{"text": ["Use InnoDB Tables, they do row-locking instead of table-locking."], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "row-locking", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://dev.mysql.com/doc/refman/5.1/en/innodb-lock-modes.html"}, {"href": "http://dev.mysql.com/doc/refman/5.1/en/table-locking.html", "text": "table-locking", "childNum": 0, "tag": "a", "childList": []}]}], [{"text": ["You shouldn't write queries like that, at least not to run against your live database.", "Mysql has a \"slow queries\" pararameter which you can use to identify the queries that are killing you.", "Most of the time, these slow queries are either buggy or can be speeded up by defining a new index or two."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}]]