[[{"text": ["Why not use a JavaScript parser?", "There are lots, including a Python API for ANTLR and a Python wrapper around SpiderMonkey."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}], [{"text": ["JavaScript is tricky to parse; you need a full JavaScript parser.", "The DMS Software Reengineering Toolkit can parse full JavaScript and build a corresponding AST.", "AST operators can then be used to walk over the tree to \"split it\".", "Even easier, however, is to apply source-to-source transformations that look for one surface syntax (JavaScript) pattern, and replace it by another.", "You can use such transformations to insert the instrumentation into the code, rather than splitting the code to make holds in which to do the insertions.", "After the transformations are complete, DMS can regenerate valid JavaScript code (complete with the orignal comments if unaffected)."], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "DMS Software Reengineering Toolkit", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html"}, {"text": "AST", "tag": "a", "pos": 2, "childList": [], "childNum": 0, "href": "http://en.wikipedia.org/wiki/Abstract_syntax_tree"}]}], [{"text": ["Why not use an existing JavaScript interpreter like Rhino (Java) or python-spidermonkey (not sure whether this one is still alive)?", "It will parse the JS and then you can examine the resulting parse tree.", "I'm not sure how easy it will be to recreate the original code but that mostly depends on how readable the instrumented code must be.", "If no one ever looks at it, just generate a really compact form."], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "Rhino", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://www.mozilla.org/rhino/"}, {"text": "python-spidermonkey", "tag": "a", "pos": -1, "childList": [], "childNum": 0, "href": "http://pypi.python.org/pypi/python-spidermonkey"}]}, {"text": ["pyjamas might also be of interest; this is a Python to JavaScript transpiler. "], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "pyjamas", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://pyjamas.sourceforge.net/"}]}, {"text": ["[EDIT] While this doesn't solve your problem at first glance, you might use it for a different approach: Instead of instrumenting JavaScript, write your code in Python instead (which can be easily instrumented; all the tools are already there) and then convert the result to JavaScript."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"text": ["Lastly, if you want to solve your problem in Python but can't find a parser: Use a Java engine to add comments to the code which you can then search for in Python to instrument the code."], "childNum": 0, "tag": "p", "senID": 3, "childList": []}], [{"text": ["Why not try a javascript beautifier?"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["For example http://jsbeautifier.org/"], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "http://jsbeautifier.org/", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://jsbeautifier.org/"}]}, {"text": ["Or see http://stackoverflow.com/questions/18985/javascript-beautifier"], "childNum": 1, "tag": "p", "senID": 2, "childList": [{"text": "http://stackoverflow.com/questions/18985/javascript-beautifier", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://stackoverflow.com/questions/18985/javascript-beautifier"}]}], [{"text": ["Well, I would try jQuery AOP"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}], [{"text": ["Forget my parser.", "https://bitbucket.org/mvantellingen/pyjsparser is great and complete parser.", "I've fixed a couple of it's bugs here: https://bitbucket.org/nullie/pyjsparser"], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "https://bitbucket.org/mvantellingen/pyjsparser", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "https://bitbucket.org/mvantellingen/pyjsparser"}, {"text": "https://bitbucket.org/nullie/pyjsparser", "tag": "a", "pos": 2, "childList": [], "childNum": 0, "href": "https://bitbucket.org/nullie/pyjsparser"}]}]]