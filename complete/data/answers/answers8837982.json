[[{"text": ["You can't write to the file and \"insert\".", "Best approach would be to read your file and write out the contents with modifications to a new file and then rename as necessary."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}], [{"text": ["I see two problems here:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["This doesn't work too well.", "It would be better to read from one file and write to another one (this way, you also won't lose data if something goes wrong in your program).", "Example:"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n input_file = open('infile.txt', 'r')\noutput_file = open('outfile.txt', 'w')\nfor line in input_file:\n    line += \"transformed\"\n    output_file.write(line)\n</code>\n</pre>\n", "senID": 2}, {"text": ["You have a syntactic error in your code snippet, the line"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"code": "<pre>\n<code>\n try a.split(' ')[0] in flags.iterkeys():\n</code>\n</pre>\n", "senID": 4}, {"text": ["is not valid (and Python should complain about that!", "). "], "childNum": 0, "tag": "p", "senID": 5, "childList": []}, {"text": ["Some other things to note:"], "childNum": 0, "tag": "p", "senID": 6, "childList": []}, {"tag": "ul", "num": 2, "lis": [{"text": ["in flags.iterkeys()"], "childNum": 0, "tag": "code", "senID": 7, "childList": []}, {"text": "Also, you can just use ", "tag": "none", "senID": 8}]}, {"code": "<pre>\n<code>\n input_file = open('infile.txt', 'r')\noutput_file = open('outfile.txt', 'w')\nflags = { ... }\n\nfor line in input_file:\n    parts = line.strip().split()\n    if parts[0] in flags:\n        line = line + ' ' + flags[parts[0]]\n    output_file.write(line + \"\\n\")\n</code>\n</pre>\n", "senID": 9}, {"text": ["If you know how to use a shell, you could make your life easier if you just use STDIN/STDOUT for data in- and output.", "You save yourself the file handling then and leave the user more flexibility in how he can use your script."], "childNum": 0, "tag": "p", "senID": 10, "childList": []}], [{"text": ["I'd like use stdin/stdout redirection:"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "stdin/stdout", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n #!/usr/bin/env python3\nimport sys\n\nflags = {'1oMZgkoaz3o': 'flag1', 'tJuLnRrAcs0': 'flag2'}\n\nfor line in sys.stdin:\n    line = line.rstrip()\n    k = line.split()[0]\n    if k in flags:\n        print(line, flags[k])\n    else:\n        print(line)\n</code>\n</pre>\n", "senID": 1}, {"code": "<pre>\n<code>\n $ python3 script.py &lt;input.txt &gt;output.txt\n$ cat output.txt\n1oMZgkoaz3o 2011-12-29T01:23:00.000Z 9 503 ApolloIsMyCoPilot flag1\nnUW1TomCSQg 2011-12-29T01:23:15.000Z 9 348 grea7stuff\ntJuLnRrAcs0 2011-12-29T01:26:20.000Z 9 123 AdelGaming flag2\ntyi5g0mnPIs 2011-12-29T01:28:07.000Z 9 703 PreferredGaming\n</code>\n</pre>\n", "senID": 2}], [{"text": ["Modifying a file in-place is possible using the fileinput module:"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "fileinput", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n from fileinput import FileInput\n\nf = FileInput(the_filename, inplace=True)\nfor line in f:\n    line = modify_line() # do whatever modifications you need to do\n    print line # this writes the line to the file\nf.close()\n</code>\n</pre>\n", "senID": 1}], [{"text": ["Firstly, let's clean up the script a bit:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n for line in f.readlines():\n    line = line.strip()\n    parts = line.split()\n    if parts[0] in flags:\n        f.write(line + flags[parts[0]] + \"\\n\");\n    else:\n        f.write(line + \"\\n\");\n</code>\n</pre>\n", "senID": 1}, {"text": ["It's been a while since I last mucked around with reading and writing in the same file, so I might be a bit off."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}], [{"text": ["The root of your problem is that you're trying to read and write to the same file object.", "You need to create a new file instead."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["However, there are a few other things that you should consider cleaning up first..."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["First off, you can simplify things by just iterating over the file object directly instead of using a while loop.", "E.g."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"code": "<pre>\n<code>\n flags = {'1oMZgkoaz3o': 'flag1', 'tJuLnRrAcs0': 'flag2'}\n\n# The \"with\" statement automatically closes the file when we're done with it\nwith open('test.txt', 'r') as infile:\n    # If we just iterate over the open file, we're iterating over the lines in it\n    for line in infile:\n        line = line.strip().split()\n        key = line[0]\n        # I'm using \"flags.get\" with a default arugment here. If \"key\" isn't in\n        # \"flags\", then an empty string will be returned.\n        line.append(flags.get(key, ''))\n        print ' '.join(line)\n</code>\n</pre>\n", "senID": 3}, {"text": ["In this example, we're just printing the output we want.", "If the file is small, then we could easily do something like this"], "childNum": 0, "tag": "p", "senID": 4, "childList": []}, {"code": "<pre>\n<code>\n flags = {'1oMZgkoaz3o': 'flag1', 'tJuLnRrAcs0': 'flag2'}\n\nwith open('test.txt', 'r') as infile:\n    # Load the entire contents of the file into memory...\n    lines = infile.readlines()\nwith open('test.txt', 'w') as outfile:\n    for line in lines:\n        print line\n        line = line.strip().split()\n        line.append(flags.get(line[0], ''))\n        outfile.write(' '.join(line) + '\\n')\n</code>\n</pre>\n", "senID": 5}, {"text": ["However, if it's a large file, we may not want to read an entire copy into memory. "], "childNum": 0, "tag": "p", "senID": 6, "childList": []}, {"text": ["In that case, we'd want to do iterate over the original file and write to a different file.", "Then we'd need to rename the new file to the original file's name."], "childNum": 0, "tag": "p", "senID": 7, "childList": []}, {"text": ["If we want to be very careful, we'd do something like the following:"], "childNum": 0, "tag": "p", "senID": 8, "childList": []}, {"code": "<pre>\n<code>\n import os \n\nflags = {'1oMZgkoaz3o': 'flag1', 'tJuLnRrAcs0': 'flag2'}\n\ninfile = open('test.txt', 'r')\noutfile = open('test2.txt', 'w')\n\ntry:\n    # Try to do this...\n    for line in infile:\n        line = line.strip().split()\n        line.append(flags.get(line[0], ''))\n        outfile.write(' '.join(line) + '\\n')\nfinally:\n    # Do this no matter what...\n    infile.close()\n    outfile.close()\n\n# If nothing goes wrong, do this...\nos.remove('test.txt')\nos.rename('test2.txt', 'test.txt')\n</code>\n</pre>\n", "senID": 9}, {"text": ["The try:... finally:... part is essentially manually doing what a with statement does for a file object.", "It's arguably a bit cleaner than nesting two with statements in this particular case, but I'm mostly using it to show the alternate (older) syntax for doing this.", "Ideally, you'd probably write that piece of code similar to this:"], "childNum": 2, "tag": "p", "senID": 10, "childList": [{"text": "try:... finally:...", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "with", "childNum": 0, "tag": "code", "pos": 1, "childList": []}]}, {"code": "<pre>\n<code>\n import os \n\ndef main():\n    flags = {'1oMZgkoaz3o': 'flag1', 'tJuLnRrAcs0': 'flag2'}\n    with open('test.txt', 'r') as infile:\n        with open('test2.txt', 'w') as outfile:\n            append_flags(infile, outfile, flags)\n    os.remove('test.txt')\n    os.rename('test2.txt', 'test.txt')\n\ndef append_flags(infile, outfile, flags):\n    for line in infile:\n        line = line.strip().split()\n        line.append(flags.get(line[0], ''))\n        outfile.write(' '.join(line) + '\\n')\n\nmain()\n</code>\n</pre>\n", "senID": 11}, {"text": ["However, we're clearly getting more complex the further we go with this.   "], "childNum": 0, "tag": "p", "senID": 12, "childList": []}, {"text": ["In your case, the second example (reading the entire file into memory and then writing over the original file) is probably what you want.  "], "childNum": 0, "tag": "p", "senID": 13, "childList": []}]]