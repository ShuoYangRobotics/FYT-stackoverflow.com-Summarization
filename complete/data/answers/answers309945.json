[[{"text": ["Ok, so I was curious and went and looked at the source of psycopg2.", "Turns out I didn't have to go further than the examples folder :)"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["And yes, this is psycopg2-specific.", "Basically, if you just want to quote a string you'd do this:"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n from psycopg2.extensions import adapt\n\nprint adapt(\"Hello World'; DROP DATABASE World;\")\n</code>\n</pre>\n", "senID": 2}, {"text": ["But what you probably want to do is to write and register your own adapter;"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"text": ["In the examples folder of psycopg2 you find the file 'myfirstrecipe.py' there is an example of how to cast and quote a specific type in a special way."], "childNum": 1, "tag": "p", "senID": 4, "childList": [{"text": "'myfirstrecipe.py'", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://initd.org/svn/psycopg/psycopg2/trunk/examples/myfirstrecipe.py"}]}, {"text": ["If you have objects for the stuff you want to do, you can just create an adapter that conforms to the 'IPsycopgSQLQuote' protocol (see pydocs for the myfirstrecipe.py-example...actually that's the only reference I can find to that name) that quotes your object and then registering it like so:"], "childNum": 0, "tag": "p", "senID": 5, "childList": []}, {"code": "<pre>\n<code>\n from psycopg2.extensions import register_adapter\n\nregister_adapter(mytype, myadapter)\n</code>\n</pre>\n", "senID": 6}, {"text": ["Also, the other examples are interesting; esp.", "'dialtone.py' and 'simple.py'."], "childNum": 2, "tag": "p", "senID": 7, "childList": [{"text": "'dialtone.py'", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://initd.org/svn/psycopg/psycopg2/trunk/examples/dialtone.py"}, {"href": "http://initd.org/svn/psycopg/psycopg2/trunk/examples/simple.py", "text": "'simple.py'", "childNum": 0, "tag": "a", "childList": []}]}], [{"text": ["You should try to avoid doing your own quoting.", "Not only will it be DB-specific as people have pointed out, but flaws in quoting are the source of SQL injection bugs."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["If you don't want to pass around queries and values separately, then pass around a list of the parameters:"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n def make_my_query():\n    # ...\n    return sql, (value1, value2)\n\ndef do_it():\n    query = make_my_query()\n    cursor.execute(*query)\n</code>\n</pre>\n", "senID": 2}, {"text": ["(I probably have the syntax of cursor.execute wrong) The point here is that just because cursor.execute takes a number of arguments, that doesn't mean you have to handle them all separately.", "You can deal with them as one list."], "childNum": 0, "tag": "p", "senID": 3, "childList": []}], [{"text": ["This is going to be DB dependent.", "In the case of MySQLdb, for example, the connection class has a literal method that will convert the value to the correct escaped representation for passing to MySQL (that's what cursor.execute uses)."], "childNum": 3, "tag": "p", "senID": 0, "childList": [{"text": "connection", "childNum": 0, "tag": "code", "pos": 1, "childList": []}, {"text": "literal", "childNum": 0, "tag": "code", "childList": []}, {"text": "cursor.execute", "childNum": 0, "tag": "code", "childList": []}]}, {"text": ["I imagine Postgres has something similar, but I don't think there is a function to escape values as part of the DB API 2.0 spec."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}], [{"text": ["This'll be database dependent (iirc, mysql allows \\ as an escape character, while something like oracle expects quotes to be doubled: 'my '' quoted string')."], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "\\", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "'my '' quoted string'", "childNum": 0, "tag": "code", "childList": []}]}, {"text": ["Someone correct me if i'm wrong, but the double-quoting method is the standard method."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["It may be worth looking at what other db abstraction libraries do (sqlalchemy, cx_Oracle, sqlite, etc)."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"text": ["I've got to ask - why do you want to inline the values instead of bind them?"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}], [{"text": ["If you use django you might want to use the quoting function which is automatically adapted to the currently configured DBMS :"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n from django.db import backend\nmy_quoted_variable = backend.DatabaseOperations().quote_name(myvar)\n</code>\n</pre>\n", "senID": 1}], [{"text": ["I don't think you give any sufficient reasoning behind your avoidance to do this The Right Way.", "Please, use the APi as it is designed and don't try so hard to make your code less readable for the next guy and more fragile."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}]]