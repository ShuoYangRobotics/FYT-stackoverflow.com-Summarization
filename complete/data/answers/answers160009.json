[[{"text": ["Model itself doesn't know anything about current user but you can give this user in a view to the form which operates models objects (and in form reset choices for necessary field). "], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "choices", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"text": ["If you need this on admin site - you can try raw_id_admin along with django-granular-permissions (http://code.google.com/p/django-granular-permissions/ but I couldn't rapidly get it working on my django but it seems to be fresh enough for 1.0 so...). "], "childNum": 3, "tag": "p", "senID": 1, "childList": [{"text": "raw_id_admin", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "django-granular-permissions", "childNum": 0, "tag": "code", "childList": []}, {"href": "http://code.google.com/p/django-granular-permissions/", "text": "http://code.google.com/p/django-granular-permissions/", "childNum": 0, "tag": "a", "childList": []}]}, {"text": ["At last, if you heavily need a selectbox in admin - then you'll need to hack django.contrib.admin itself."], "childNum": 1, "tag": "p", "senID": 2, "childList": [{"text": "django.contrib.admin", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}], [{"text": ["Here is the CookBook Threadlocals And User"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "CookBook Threadlocals And User", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://code.djangoproject.com/wiki/CookBookThreadlocalsAndUser"}]}], [{"text": ["I'm not sure that I fully understand exactly what you want to do, but I think that there's a good chance that you'll get at least part the way there using a custom Manager.", "In particular, don't try to define your models with restrictions to the current user, but create a manager that only returns objects that match the current user."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "custom Manager", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://www.djangoproject.com/documentation/models/custom_managers/"}]}], [{"text": ["Use threadlocals if you want to get current user that edits this model.", "Threadlocals middleware puts current user into process-wide variable.", "Take this middleware"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "current", "childNum": 0, "tag": "strong", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n from threading import local\n\n_thread_locals = local()\ndef get_current_user():\n    return getattr(getattr(_thread_locals, 'user', None),'id',None)\n\nclass ThreadLocals(object):\n    \"\"\"Middleware that gets various objects from the\n    request object and saves them in thread local storage.\"\"\"\n    def process_request(self, request):\n        _thread_locals.user = getattr(request, 'user', None)\n</code>\n</pre>\n", "senID": 1}, {"text": ["Check the documentation on how to use middleware classes.", "Then anywhere in code you can call"], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"code": "<pre>\n<code>\n user = threadlocals.get_current_user\n</code>\n</pre>\n", "senID": 3}], [{"text": ["Hmmm, I don't fully understand your question.", "But if you can't do it when you declare the model maybe you can achieve the same thing with overriding methods of the class of objects where you \"send\" the user object, maybe start with the constructor."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}], [{"text": ["This limiting of choices to current user is a kind of validation that needs to happen dynamically in the request cycle, not in the static Model definition."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["In other words: at the point where you are creating an instance of this model you will be in a View and at that point you will have access to the current user and can limit the choices."], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "instance", "childNum": 0, "tag": "em", "pos": 0, "childList": []}]}, {"text": ["Then you just need a custom ModelForm to pass in the request.user to, see the example here:\nhttp://collingrady.wordpress.com/2008/07/24/useful-form-tricks-in-django/"], "childNum": 1, "tag": "p", "senID": 2, "childList": [{"text": "http://collingrady.wordpress.com/2008/07/24/useful-form-tricks-in-django/", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://collingrady.wordpress.com/2008/07/24/useful-form-tricks-in-django/"}]}], [{"text": ["But what about the fields you define with list_filter?", "They only respect limit_choices_to.", "So if you want to limit the choices of Django Admin filters you have to use limit_choices_to and some Middleware to filter them based on the current user.", "Or is there an easier way to achieve that?"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}]]