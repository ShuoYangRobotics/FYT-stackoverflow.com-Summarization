[[{"text": ["How about subclassing json.JSONEncoder?"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "json.JSONEncoder", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n class DecimalEncoder(json.JSONEncoder):\n    def _iterencode(self, o, markers=None):\n        if isinstance(o, decimal.Decimal):\n            # wanted a simple yield str(o) in the next line,\n            # but that would mean a yield on the line with super(...),\n            # which wouldn't work (see my comment below), so...\n            return (str(o) for o in [o])\n        return super(DecimalEncoder, self)._iterencode(o, markers)\n</code>\n</pre>\n", "senID": 1}, {"text": ["Then use it like so:"], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"code": "<pre>\n<code>\n json.dumps({'x': decimal.Decimal('5.5')}, cls=DecimalEncoder)\n</code>\n</pre>\n", "senID": 3}], [{"text": ["Simplejson 2.1 and higher has native support for Decimal type:"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "Simplejson 2.1", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://code.google.com/p/simplejson/"}]}, {"code": "<pre>\n<code>\n &gt;&gt;&gt; json.dumps(Decimal('3.9'), use_decimal=True)\n'3.9'\n</code>\n</pre>\n", "senID": 1}, {"text": ["Hopefully, this feature will be included in standard library."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}], [{"text": ["I would like to let everyone know that I tried Micha\u0142 Marczyk's answer on my web server that was running Python 2.6.5 and it worked fine.", "However, I upgraded to Python 2.7 and it stopped working.", "I tried to think of some sort of way to encode Decimal objects and this is what I came up with:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n class DecimalEncoder(json.JSONEncoder):\n    def default(self, o):\n        if isinstance(o, decimal.Decimal):\n            return float(o)\n        return super(DecimalEncoder, self).default(o)\n</code>\n</pre>\n", "senID": 1}, {"text": ["This should hopefully help anyone who is having problems with Python 2.7.", "I tested it and it seems to work fine.", "If anyone notices any bugs in my solution or comes up with a better way, please let me know."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}], [{"text": ["3.9 can not be exactly represented in IEEE floats, it will always come as 3.8999999999999999, e.g.", "try  print repr(3.9), read more at\nhttp://en.wikipedia.org/wiki/Floating_point\nhttp://docs.sun.com/source/806-3568/ncg_goldberg.html "], "childNum": 4, "tag": "p", "senID": 0, "childList": [{"text": "", "childNum": 0, "tag": "br", "pos": 0, "childList": []}, {"text": "http://en.wikipedia.org/wiki/Floating_point", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://en.wikipedia.org/wiki/Floating_point"}, {"text": "", "childNum": 0, "tag": "br", "childList": []}, {"href": "http://docs.sun.com/source/806-3568/ncg_goldberg.html", "text": "http://docs.sun.com/source/806-3568/ncg_goldberg.html", "childNum": 0, "tag": "a", "childList": []}]}, {"text": ["So if you don't want float, only option you have to send it as string, and to allow automatic dumping of decimal objects do something like this"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n import decimal\nfrom django.utils import simplejson\n\ndef json_encode_decimal(obj):\n    if isinstance(obj, decimal.Decimal):\n        return str(obj)\n    raise TypeError(repr(obj) + \" is not JSON serializable\")\n\nd = decimal.Decimal('3.5')\nprint simplejson.dumps([d], default=json_encode_decimal)\n</code>\n</pre>\n", "senID": 2}], [{"text": ["this can be done by adding "], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n elif isinstance(o, decimal.Decimal):\n        yield str(o)\n</code>\n</pre>\n", "senID": 1}, {"text": ["in \\Lib\\json\\encoder.py:JSONEncoder._iterencode, but I was hoping for a better solution"], "childNum": 1, "tag": "p", "senID": 2, "childList": [{"text": "\\Lib\\json\\encoder.py:JSONEncoder._iterencode", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}], [{"text": ["Here is my solution:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n import json\ndef decimal_dumps(d):\n    def fix_dict(d):\n        fixed = {}\n        for k,v in d.iteritems():\n            if isinstance(v, decimal.Decimal):\n                # convert decimal to string\n                fixed.update({k: str(v)})\n            elif isinstance(v, dict):\n                # recurse\n                fixed.update({k: fix_dict(v)})\n            else:\n                # no conversion needed, replace\n                fixed.update({k: v})\n        return fixed\n    return json.dumps(fixed)\n</code>\n</pre>\n", "senID": 1}, {"text": ["So instead of json.dumps(d) you just do decimal_dumps(d)"], "childNum": 2, "tag": "p", "senID": 2, "childList": [{"text": "json.dumps(d)", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "decimal_dumps(d)", "childNum": 0, "tag": "code", "childList": []}]}], [{"text": ["I tried switching from simplejson to builtin json for GAE 2.7, and had issues with the decimal.", "If default returned str(o) there were quotes (because _iterencode calls _iterencode on the results of default), and float(o) would remove trailing 0."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["If default returns an object of a class that inherits from float (or anything that calls repr without additional formatting) and has a custom __repr__ method, it seems to work like I want it to."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n import json\nfrom decimal import Decimal\n\nclass fakefloat(float):\n    def __init__(self, value):\n        self._value = value\n    def __repr__(self):\n        return str(self._value)\n\ndef defaultencode(o):\n    if isinstance(o, Decimal):\n        # Subclass float with custom repr?\n        return fakefloat(o)\n    raise TypeError(repr(o) + \" is not JSON serializable\")\n\njson.dumps([10.20, \"10.20\", Decimal('10.20')], default=defaultencode)\n'[10.2, \"10.20\", 10.20]'\n</code>\n</pre>\n", "senID": 2}]]