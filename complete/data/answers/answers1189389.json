[[{"text": ["The ping program is installed setuid root.", "This allows any user to use the program, and still be able to open a raw socket."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["After it opens the raw socket, it typically drops root privs."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["You generally need a raw socket to do ICMP correctly, and raw sockets are usually restricted.", "So it's not really python's fault at all."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"text": ["Regarding the bit about ICMP above, apparently many implementations don't really support those combinations of flags well.", "So it is likely that most implmentations just use the way they \"know\" works on most / all architectures."], "childNum": 0, "tag": "p", "senID": 3, "childList": []}], [{"text": ["Here's how /sbin/ping \"somehow manages\" (on most Unix-y systems):"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n $ ls -l /sbin/ping\n-r-sr-xr-x  1 root  wheel  68448 Jan 26 10:00 /sbin/ping\n</code>\n</pre>\n", "senID": 1}, {"text": ["See?", "It's owned by root and has that crucial s bit in the permission -- setuserid.", "So, no matter what user is running it, ping runs as root."], "childNum": 3, "tag": "p", "senID": 2, "childList": [{"text": "root", "childNum": 0, "tag": "code", "pos": 1, "childList": []}, {"text": "s", "childNum": 0, "tag": "code", "pos": 2, "childList": []}, {"text": "runs as root", "childNum": 0, "tag": "strong", "childList": []}]}, {"text": ["If you're using a BSD Kernel with the new \"non-privileged ICMP sockets\" it would be interesting to see what's needed to use that functionality to ping from Python (but that won't help any user that's on a less advanced kernel, of course)."], "childNum": 0, "tag": "p", "senID": 3, "childList": []}], [{"text": ["I'm not sure if it is OK to post something in a question that seems it has already been answered a while ago."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["I have been searching for the same implementation and found a way to do ICMP via Python with non-root privileges."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["python-ping uses the same 'need-root' way to do a ping, but came across a bug report where a user suggested changing SOCK_RAW to SOCK_DGRAM when calling sock :"], "childNum": 4, "tag": "p", "senID": 2, "childList": [{"text": "python-ping", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "SOCK_RAW", "childNum": 0, "tag": "code", "childList": []}, {"text": "SOCK_DGRAM", "childNum": 0, "tag": "code", "childList": []}, {"text": "sock", "childNum": 0, "tag": "code", "childList": []}]}, {"text": ["http://hg.io/delroth/python-ping/issue/1/icmp-without-root-privilege"], "childNum": 1, "tag": "p", "senID": 3, "childList": [{"text": "http://hg.io/delroth/python-ping/issue/1/icmp-without-root-privilege", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://hg.io/delroth/python-ping/issue/1/icmp-without-root-privilege"}]}, {"text": ["The dev explains this will be a \"WONT-FIX\" situation because it is a UDP ping rather. "], "childNum": 0, "tag": "p", "senID": 4, "childList": []}, {"text": ["Since I really do not care if ICMP is going out via UDP, I went ahead and got the code and made the proposed changed."], "childNum": 0, "tag": "p", "senID": 5, "childList": []}, {"text": ["I am now able to do a ping without calling subprocess or needing root!"], "childNum": 0, "tag": "p", "senID": 6, "childList": []}, {"text": ["Again, not sure if posting here after such a long time is OK, but thought this was a better thing!"], "childNum": 0, "tag": "p", "senID": 7, "childList": []}], [{"text": ["I was also looking for an implementation of ping without using subprocess or needing root to ping.", "My solution needed to be cross-platform, namely Windows and Linux."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["Changing the socket on Windows to SOCK_DGRAM results in a \"protocol not supported 100043\" exception.", "So it looks like Windows correctly checks to see if icmp is being sent out on TCP rather than UDP.", "However, windows does not care if it is running as \"root\" since that is a Linux concept.  "], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n if os.name == 'nt':\n    #no root on windows\n    my_socket = socket.socket(socket.AF_INET, socket.SOCK_RAW, icmp)\nelse:\n    #changed to UDP socket...gets around ROOT priv issue\n    my_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM, icmp)\n</code>\n</pre>\n", "senID": 2}], [{"text": ["Actually, on Windows 7 and Vista you do need to 'Run as Administrator' to do:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n my_socket = socket.socket(socket.AF_INET, socket.SOCK_RAW, icmp)\n</code>\n</pre>\n", "senID": 1}, {"text": ["and as you note, doing it over a datagram socket causes an error."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}], [{"text": ["The error I got while trying to use SOCK_RAW is\nsocket.error: [Errno 10013] An attempt was made to access a socket in a way forbidden by its access permissions"], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "", "childNum": 0, "tag": "br", "pos": 0, "childList": []}, {"text": "socket.error: [Errno 10013] An attempt was made to access a socket in a way forbidden by its access permissions", "childNum": 0, "tag": "strong", "childList": []}]}, {"text": ["To get rid of this error I tried running command prompt as an administrator and that solved the problem."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["Now since I wanted to do NON PRIVILEGED ICMP in python, I changed SOCK_RAW to SOCK_DGRAM.", "This came up with the following error:\nsocket.error: [Errno 10043] The requested protocol has not been configured into the system, or no implementation for it exists"], "childNum": 2, "tag": "p", "senID": 2, "childList": [{"text": "", "childNum": 0, "tag": "br", "pos": 0, "childList": []}, {"text": "socket.error: [Errno 10043] The requested protocol has not been configured into the system, or no implementation for it exists", "childNum": 0, "tag": "strong", "pos": 1, "childList": []}]}, {"text": ["Anyone found a way around this as yet?"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"text": ["Ammar."], "childNum": 0, "tag": "p", "senID": 4, "childList": []}], [{"text": ["I am running python under windows 7 , \nSince i am editing and \"compiling\" the code under Eclipse pydev plugin, \nMy solution was : Running the eclipse.exe as an administrator : this solved the problem,"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["This solution is similar to running the cmd as an administrator."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}]]