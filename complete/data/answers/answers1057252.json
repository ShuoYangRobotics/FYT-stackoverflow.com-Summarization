[[{"text": ["The answer by Ber - storing it in threadlocals - is a very bad idea.", "There's absolutely no reason to do it this way."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["A much better way is to override the form's __init__ method to take an extra keyword argument, request.", "This stores the request in the form, where it's required, and from where you can access it in your clean method."], "childNum": 3, "tag": "p", "senID": 1, "childList": [{"text": "__init__", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "request", "childNum": 0, "tag": "code", "pos": 1, "childList": []}, {"text": "form", "childNum": 0, "tag": "em", "childList": []}]}, {"code": "<pre>\n<code>\n class MyForm(forms.Form):\n\n    def __init__(self, *args, **kwargs):\n        self.request = kwargs.pop('request', None)\n        super(MyForm, self).__init__(*args, **kwargs)\n\n\n    def clean(self):\n        ... access the request object via self.request ...\n</code>\n</pre>\n", "senID": 2}, {"text": ["and in your view:"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"code": "<pre>\n<code>\n myform = MyForm(request.POST, request=request)\n</code>\n</pre>\n", "senID": 4}], [{"text": ["The usual aproach is to store the request object in a thread-local reference using a middleware.", "Then you can access this from anywhere in you app, including the Form.clean() method."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["Changing the signature of the Form.clean() method means you have you own, modified version of Django, which may not be what you want."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["Thank middleware count look something like this:"], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"code": "<pre>\n<code>\n import threading\n_thread_locals = threading.local()\n\ndef get_current_request():\n    return getattr(_thread_locals, 'request', None)\n\nclass ThreadLocals(object):\n    \"\"\"\n    Middleware that gets various objects from the\n    request object and saves them in thread local storage.\n    \"\"\"\n    def process_request(self, request):\n        _thread_locals.request = request\n</code>\n</pre>\n", "senID": 3}, {"text": ["Register this middleware as described in the Django docs"], "childNum": 1, "tag": "p", "senID": 4, "childList": [{"text": "Django docs", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://docs.djangoproject.com/en/dev/topics/http/middleware/"}]}], [{"text": ["UPDATED 10/25/2011: I'm now using this with a metaclass instead of method, as Django 1.3 displays some weirdness otherwise."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "UPDATED 10/25/2011", "childNum": 0, "tag": "strong", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n class MyModelAdmin(admin.ModelAdmin):\n    form = MyCustomForm\n    def get_form(self, request, obj=None, **kwargs):\n        ModelForm = super(MyModelAdmin, self).get_form(request, obj, **kwargs)\n        class ModelFormMetaClass(ModelForm):\n            def __new__(cls, *args, **kwargs):\n                kwargs['request'] = request\n                return ModelForm(*args, **kwargs)\n        return ModelFormMetaClass\n</code>\n</pre>\n", "senID": 1}, {"text": ["Then override MyCustomForm.__init__ as follows:"], "childNum": 1, "tag": "p", "senID": 2, "childList": [{"text": "MyCustomForm.__init__", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n class MyCustomForm(forms.ModelForm):\n    def __init__(self, *args, **kwargs):\n        self.request = kwargs.pop('request', None)\n        super(MyCustomForm, self).__init__(*args, **kwargs)\n</code>\n</pre>\n", "senID": 3}, {"text": ["You can then access the request object from any method of ModelForm with self.request."], "childNum": 2, "tag": "p", "senID": 4, "childList": [{"text": "ModelForm", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "self.request", "childNum": 0, "tag": "code", "childList": []}]}], [{"text": ["I ran into this particular problem when customizing the admin.", "I wanted a certain field to be validated based on the particular admin's credentials."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["Since I did not want to modify the view to pass the request as an argument to the form, the following is what I did:"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n class MyCustomForm(forms.ModelForm):\n    class Meta:\n        model = MyModel\n\n    def clean(self):\n        # make use of self.request here\n\nclass MyModelAdmin(admin.ModelAdmin):\n    form = MyCustomForm\n    def get_form(self, request, obj=None, **kwargs):\n        ModelForm = super(MyModelAdmin, self).get_form(request, obj=None, **kwargs)\n        def form_wrapper(*args, **kwargs):\n            a = ModelForm(*args, **kwargs)\n            a.request = request\n            return a\n    return form_wrapper\n</code>\n</pre>\n", "senID": 2}], [{"text": ["fresh cheese from cheesebaker@pypi: django-requestprovider"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "django-requestprovider", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://pypi.python.org/pypi?%3aaction=display&name=django-contrib-requestprovider&version=1.0.1"}]}], [{"text": ["You can't always use this method (and its probably bad practice), but if you are only using the form in one view you could scope it inside the view method itself."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n def my_view(request):\n\n    class ResetForm(forms.Form):\n        password = forms.CharField(required=True, widget=forms.PasswordInput())\n\n        def clean_password(self):\n            data = self.cleaned_data['password']\n            if not request.user.check_password(data):\n                raise forms.ValidationError(\"The password entered does not match your account password.\")\n            return data\n\n    if request.method == 'POST':\n        form = ResetForm(request.POST, request.FILES)\n        if form.is_valid():\n\n            return HttpResponseRedirect(\"/\")\n    else:\n        form = ResetForm()\n\n    return render_to_response(request, \"reset.html\")\n</code>\n</pre>\n", "senID": 1}]]