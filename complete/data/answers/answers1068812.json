[[{"text": ["Obligatory: don't useos.system - use the subprocess module:"], "childNum": 4, "tag": "p", "senID": 0, "childList": [{"text": "don't useos.system", "childNum": 1, "tag": "strong", "pos": 0, "childList": [{"text": "os.system", "tag": "code"}]}, {"text": "os.system", "childNum": 0, "tag": "code", "childList": []}, {"href": "http://docs.python.org/library/subprocess.html", "text": "subprocess", "childNum": 1, "tag": "a", "childList": [{"text": "subprocess", "tag": "code"}]}, {"text": "subprocess", "childNum": 0, "tag": "code", "childList": []}]}, {"code": "<pre>\n<code>\n import subprocess\n\ndef updateExportConfigId(m_id, source='path/file.old', \n                             destination='path/file.new'):\n    if isinstance(m_id, unicode):\n        m_id = m_id.encode('utf-8')\n    cmd= [\n          \"sed\",\n          \",$s/MANAGER_ID=[0-9]*/MANAGER_ID=%s/g\" % m_id,  \n          source,\n         ]\n    subprocess.call(cmd, stdout=open(destination, 'w'))\n</code>\n</pre>\n", "senID": 1}, {"text": ["with this code you can pass the manager id, it can have spaces, quote chars, etc.", "The file names can also be passed to the function, and can also contain spaces and some other special chars.", "That's because your shell is not unnecessarly invoked, so one less process is started on your OS, and you don't have to worry on escaping special shell characters."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"text": ["Another option: Don't launch sed.", "Use python's re module. "], "childNum": 2, "tag": "p", "senID": 3, "childList": [{"text": "re", "tag": "a", "pos": 1, "childList": [{"text": "re", "tag": "code"}], "childNum": 1, "href": "http://docs.python.org/library/re.html"}, {"text": "re", "childNum": 0, "tag": "code", "childList": []}]}, {"code": "<pre>\n<code>\n import re\ndef updateExportConfigID(m_id, source, destination):\n    if isinstance(m_id, unicode):\n        m_id = m_id.encode('utf-8')\n    for line in source:\n        new_line = re.sub(r'MANAGER_ID=\\d*', \n                          r'MANAGER_ID=' + re.escape(m_id), \n                          line)\n        destination.write(new_line)\n</code>\n</pre>\n", "senID": 4}, {"text": ["and call it like this:"], "childNum": 0, "tag": "p", "senID": 5, "childList": []}, {"code": "<pre>\n<code>\n updateExportConfigID('GRRRR', open('path/file.old'), open('path/file.new', 'w'))\n</code>\n</pre>\n", "senID": 6}, {"text": ["No new processes needed."], "childNum": 0, "tag": "p", "senID": 7, "childList": []}], [{"text": ["To help you debug it, try adding:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n print repr(cmd)\n</code>\n</pre>\n", "senID": 1}, {"text": ["It might be that some special characters slipped into the command that normal print is hiding when you copy and paste it."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}], [{"text": ["What is wrong is that there is some difference.", "Yeah, I know that's not helpful, but you need to figure out the difference."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["Try running this:"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n import os\ndef updateExportConfigId(id):\n    stringId = \"%s\" % id\n    cmd1 = \"sed '1,$s/MANAGER_ID=[0-9]*/MANAGER_ID=\" + stringId + \"/g' path/file.old &gt; path/file.new\"\n    stringId = \"GRRRRRRRRR\"\n    cmd2 = \"sed '1,$s/MANAGER_ID=[0-9]*/MANAGER_ID=\" + stringId + \"/g' path/file.old &gt; path/file.new\"\n\n    print \"cmd1:\" , cmd1\n    print \"cmd2:\" , cmd2\n    print cmd1 == cmd2\n\nupdateExportConfigId(\"GRRRRRRRRR\")\n</code>\n</pre>\n", "senID": 2}, {"text": ["The code should print:"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"code": "<pre>\n<code>\n sed '1,$s/MANAGER_ID=[0-9]*/MANAGER_ID=GRRRRRRRRR/g' path/file.old &gt; path/file.new\nsed '1,$s/MANAGER_ID=[0-9]*/MANAGER_ID=GRRRRRRRRR/g' path/file.old &gt; path/file.new\nTrue\n</code>\n</pre>\n", "senID": 4}, {"text": ["Thereby showing that they are exactly the same.", "If the last line is \"False\" then they are not the same, and you should be able to see the difference."], "childNum": 0, "tag": "p", "senID": 5, "childList": []}], [{"text": ["So from previous answers we now know that id is a Unicode string, which makes cmd1 a Unicode string, which os.system() is converting to a byte string for execution in the default encoding."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "id", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"text": ["a) I suggest using subprocess rather than os.system()"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"text": ["b) I suggest not using the name of a built-in function as a variable (id)."], "childNum": 1, "tag": "p", "senID": 2, "childList": [{"text": "id", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"text": ["c) I suggest explicitly encoding the string to a byte string before executing:"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"code": "<pre>\n<code>\n if isinstance(cmd,unicode):\n    cmd = cmd.encode(\"UTF-8\")\n</code>\n</pre>\n", "senID": 4}, {"text": ["d) For Lennart Regebro's suggestion add:"], "childNum": 0, "tag": "p", "senID": 5, "childList": []}, {"code": "<pre>\n<code>\n assert type(cmd1) == type(cmd2)\n</code>\n</pre>\n", "senID": 6}, {"text": ["after"], "childNum": 0, "tag": "p", "senID": 7, "childList": []}, {"code": "<pre>\n<code>\n print cmd1 == cmd2\n</code>\n</pre>\n", "senID": 8}], [{"text": ["Maybe some indentation problem?"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["The following works correctly:"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n import os\n\ndef updateExportConfigId(id):\n    stringId = \"%s\" % id\n    cmd= \"sed '1,$s/MANAGER_ID=[0-9]*/MANAGER_ID=\" + stringId + \"/g' test.dat &gt; test.new\"\n    print \"command is \" + cmd\n    os.system(cmd)\n\n\nupdateExportConfigId(\"adsf\")\n</code>\n</pre>\n", "senID": 2}, {"text": ["Also do not use reserved words (id) as variables."], "childNum": 1, "tag": "p", "senID": 3, "childList": [{"text": "id", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}], [{"text": ["Maybe it helps to use only raw strings."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "raw strings", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://docs.python.org/reference/lexical%5Fanalysis.html#string-literals"}]}], [{"text": ["Finally, I found a way to run the os.system(cmd)!"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["Simple trick, to \"clean\" the cmd string:"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n os.system(str(cmd))\n</code>\n</pre>\n", "senID": 2}, {"text": ["Now, I'm able to build the cmd with all arguments I need and at the end I just \"clean\" it with str() call before run it with os.system() call."], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"text": ["Thanks a lot for your answers!"], "childNum": 0, "tag": "p", "senID": 4, "childList": []}, {"text": ["swon"], "childNum": 0, "tag": "p", "senID": 5, "childList": []}]]