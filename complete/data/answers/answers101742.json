[[{"text": ["appcfg.py, the tool that uploads data to App Engine has to do exactly this to authenticate itself with the App Engine server.", "The relevant functionality is abstracted into appengine_rpc.py.", "In a nutshell, the solution is:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["You may also want to look at _Authenticate, to see how appcfg handles the various return codes from ClientLogin, and _GetOpener, to see how appcfg creates a urllib2 OpenerDirector that doesn't follow HTTP redirects.", "Or you could, in fact, just use the AbstractRpcServer and HttpRpcServer classes wholesale, since they do pretty much everything you need."], "childNum": 2, "tag": "p", "senID": 1, "childList": [{"text": "_Authenticate", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://code.google.com/p/googleappengine/source/browse/trunk/python/google/appengine/tools/appengine%5Frpc.py#253"}, {"text": "_GetOpener", "tag": "a", "pos": -1, "childList": [], "childNum": 0, "href": "http://code.google.com/p/googleappengine/source/browse/trunk/python/google/appengine/tools/appengine%5Frpc.py#397"}]}], [{"text": ["thanks to Arachnid for the answer - it worked as suggested"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["here is a simplified copy of the code, in case it is helpful to the next person to try! "], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n import os\nimport urllib\nimport urllib2\nimport cookielib\n\nusers_email_address = \"billy.bob@gmail.com\"\nusers_password      = \"billybobspassword\"\n\ntarget_authenticated_google_app_engine_uri = 'http://mylovelyapp.appspot.com/mylovelypage'\nmy_app_name = \"yay-1.0\"\n\n\n\n# we use a cookie to authenticate with Google App Engine\n#  by registering a cookie handler here, this will automatically store the \n#  cookie returned when we use urllib2 to open http://currentcost.appspot.com/_ah/login\ncookiejar = cookielib.LWPCookieJar()\nopener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cookiejar))\nurllib2.install_opener(opener)\n\n#\n# get an AuthToken from Google accounts\n#\nauth_uri = 'https://www.google.com/accounts/ClientLogin'\nauthreq_data = urllib.urlencode({ \"Email\":   users_email_address,\n                                  \"Passwd\":  users_password,\n                                  \"service\": \"ah\",\n                                  \"source\":  my_app_name,\n                                  \"accountType\": \"HOSTED_OR_GOOGLE\" })\nauth_req = urllib2.Request(auth_uri, data=authreq_data)\nauth_resp = urllib2.urlopen(auth_req)\nauth_resp_body = auth_resp.read()\n# auth response includes several fields - we're interested in \n#  the bit after Auth= \nauth_resp_dict = dict(x.split(\"=\")\n                      for x in auth_resp_body.split(\"\\n\") if x)\nauthtoken = auth_resp_dict[\"Auth\"]\n\n#\n# get a cookie\n# \n#  the call to request a cookie will also automatically redirect us to the page\n#   that we want to go to\n#  the cookie jar will automatically provide the cookie when we reach the \n#   redirected location\n\n# this is where I actually want to go to\nserv_uri = target_authenticated_google_app_engine_uri\n\nserv_args = {}\nserv_args['continue'] = serv_uri\nserv_args['auth']     = authtoken\n\nfull_serv_uri = \"http://mylovelyapp.appspot.com/_ah/login?%s\" % (urllib.urlencode(serv_args))\n\nserv_req = urllib2.Request(full_serv_uri)\nserv_resp = urllib2.urlopen(serv_req)\nserv_resp_body = serv_resp.read()\n\n# serv_resp_body should contain the contents of the \n#  target_authenticated_google_app_engine_uri page - as we will have been \n#  redirected to that page automatically \n#\n# to prove this, I'm just gonna print it out\nprint serv_resp_body\n</code>\n</pre>\n", "senID": 2}], [{"text": ["This solution is not working for me.", "Using the above code verbatim I get the Auth key from https://www.google.com/accounts/ClientLogin, and the appspot.com server responds with the the continue page, but I the server still does not see me as logged in.", "I have looked in the cookie jar and verified that the cookie is there!", "When I cut and paste the request to http://mylovelyapp.appspot.com/_ah/login into a browser I get the same results.", "Is there something I am missing?"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "http://mylovelyapp.appspot.com/_ah/login", "tag": "a", "pos": 3, "childList": [], "childNum": 0, "href": "http://mylovelyapp.appspot.com/_ah/login"}]}, {"text": ["Ok, more experimenting and I have determined that the solution works with user@gmail.com accounts, but not with hosted accounts.", "Any ideas?"], "childNum": 0, "tag": "p", "senID": 1, "childList": []}], [{"text": ["I'm not a python expert or a app engine expert.", "But did you try following the sample appl at http://code.google.com/appengine/docs/gettingstarted/usingusers.html.", "I created one at http://quizengine.appspot.com, it seemed to work fine with Google authentication and everything.", "Just a suggestion, but look in to the getting started guide.", "Take it easy if the suggestion sounds naive.", ":)\nThanks."], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "http://code.google.com/appengine/docs/gettingstarted/usingusers.html", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://code.google.com/appengine/docs/gettingstarted/usingusers.html"}, {"text": "http://quizengine.appspot.com", "tag": "a", "pos": 2, "childList": [], "childNum": 0, "href": "http://quizengine.appspot.com"}]}], [{"text": ["Im not too familiar with AppEngine, or Googles web apis, but for a brute force approach you could write a script with something like mechanize (http://wwwsearch.sourceforge.net/mechanize/) to simply walk through the login process before you begin doing the real work of the client."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "http://wwwsearch.sourceforge.net/mechanize/", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://wwwsearch.sourceforge.net/mechanize/"}]}], [{"text": ["for those who can't get ClientLogin to work, try app engine's OAuth support."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "OAuth support", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://code.google.com/appengine/docs/python/oauth/overview.html"}]}]]