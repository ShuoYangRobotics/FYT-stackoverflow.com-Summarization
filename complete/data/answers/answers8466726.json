[[{"text": ["as you can see in the docs, for exactly this reason it is possible to specify the foreign model as a string."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "the docs", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "https://docs.djangoproject.com/en/dev/ref/models/fields/#foreignkey"}]}, {"code": "<pre>\n<code>\n team = models.ForeignKey('Team')\n</code>\n</pre>\n", "senID": 1}], [{"text": ["You could use the full application label in the foreign key to the model not yet defined, and use related_name to avoid name conflict:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n class Team(models.Model):\n    captain = models.ForeignKey('myapp.Player', related_name=\"team_captain\")\n\nclass Player(models.Model):\n    team = models.ForeignKey(Team)\n</code>\n</pre>\n", "senID": 1}], [{"text": ["Here is another way to tackle this problem.", "Instead of creating a circular dependency, I created an additional table that stores the relationship between players and teams.", "So in the end it looks like this:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n class Team(Model):\n    name = CharField(max_length=50)\n\n    def get_captain(self):\n        return PlayerRole.objects.get(team=self).player\n\nclass Player(Model):\n    first_name = CharField(max_length=50)\n    last_name = CharField(max_length=50, blank=True)\n\n    def get_team(self):\n        return PlayerRole.objects.get(player=self).team\n\nPLAYER_ROLES = (\n    (\"Regular\", \"Regular\"),\n    (\"Captain\", \"Captain\")\n    )\n\nclass PlayerRole(Model):\n    player = OneToOneField(Player, primary_key=True)\n    team = ForeignKey(Team, null=True)\n    role = CharField(max_length=20, choices=PLAYER_ROLES, default=PLAYER_ROLES[0][0])\n    class Meta:\n        unique_together = (\"player\", \"team\")\n</code>\n</pre>\n", "senID": 1}, {"text": ["It might be slightly less efficient in terms of storage than the suggested workaround, but it avoids the circular dependency and keeps the DB structure clean and clear.", "Comments are welcome."], "childNum": 0, "tag": "p", "senID": 2, "childList": []}], [{"text": ["Neither of the answers here are really that great - creating circular references is never a good idea.", "Imagine if your database crashed and you had to create it from scratch - how would you create player before team is created, and vice versa?", "Look a question here: ForeignKey field with primary relationship one I asked a few days ago.", "Put a Boolean on Player that specifies the captain, and put some pre-save hooks that validate every team must have one-and-only-one captain."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "ForeignKey field with primary relationship", "tag": "a", "pos": 2, "childList": [], "childNum": 0, "href": "http://stackoverflow.com/questions/8401040/foreignkey-field-with-primary-relationship/8401082#8401082"}]}], [{"text": ["Although there is nothing wrong with having two references to the same model, perhaps there is a better way to solve this particular problem."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["Add a boolean to the Team model to identify a player + team combination as captain:"], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "Team", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n class Team(models.Model):\n  player = models.ForeignKey(Player)\n  name = models.CharField(max_length=50)\n  is_captain = models.BooleanField(default=False)\n</code>\n</pre>\n", "senID": 2}, {"text": ["To search for a team's captain:"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"text": ["Team.objects.filter(is_captain=True)"], "childNum": 1, "tag": "p", "senID": 4, "childList": [{"text": "Team.objects.filter(is_captain=True)", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"text": ["Personally I don't like this method because the search semantics don't make sense (ie, a \"team\" is not a \"captain\")."], "childNum": 1, "tag": "p", "senID": 5, "childList": [{"text": "Personally I don't like this method because the search semantics don't make sense (ie, a \"team\" is not a \"captain\").", "childNum": 0, "tag": "em", "pos": 0, "childList": []}]}, {"text": ["The other approach is to identify each player's position:"], "childNum": 0, "tag": "p", "senID": 6, "childList": []}, {"code": "<pre>\n<code>\n class Player(models.Model):\n   name = models.CharField(max_length=50)\n   position = models.IntegerField(choices=((1,'Captain'),(2,'Goal Keeper'))\n   jersey = models.IntegerField()\n\n   def is_captain(self):\n     return self.position == 1\n\nclass Team(models.Model):\n   name = models.CharField(max_length=50)\n   player = models.ForeignKey(Player)\n\n   def get_captain(self):\n      return self.player if self.player.position == 1 else None\n</code>\n</pre>\n", "senID": 7}, {"text": ["This makes a bit more sense when you search:"], "childNum": 0, "tag": "p", "senID": 8, "childList": []}, {"text": ["Player.objects.filter(position=1) (return all captains)"], "childNum": 1, "tag": "p", "senID": 9, "childList": [{"text": "Player.objects.filter(position=1)", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"text": ["Team.objects.get(pk=1).get_captain() (return the captain for this team)"], "childNum": 1, "tag": "p", "senID": 10, "childList": [{"text": "Team.objects.get(pk=1).get_captain()", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"text": ["In either case, however you have to do some pre save checks to make sure there is only one player for a particular position."], "childNum": 0, "tag": "p", "senID": 11, "childList": []}], [{"text": ["Have a Captain table that has player/team columns along with your other tables, and make captain a method of Team:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n class Team(models.Model):\n    name = models.CharField()\n    def captain(self):\n      [search Captain table]\n      return thePlayer\n\nclass Player(models.Model):\n    name = models.CharField()\n    team = models.ForeignKey(Team)\n\nclass Captain(models.Model):\n    player = models.ForeignKey(Player)\n    team = models.ForeignKey(Team)\n</code>\n</pre>\n", "senID": 1}, {"text": ["You'd have to check that you never have more than one captain in the same team though...", "But you don't have any circular references that way.", "You could also end up with a captain who isn't in the team he's flagged as captain of.", "So there's a few gotchas this way. "], "childNum": 0, "tag": "p", "senID": 2, "childList": []}]]