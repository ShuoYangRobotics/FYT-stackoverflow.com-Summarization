[[{"code": "<pre>\n<code>\n import random\nwith open('the_file','r') as source:\n    data = [ (random.random(), line) for line in source ]\ndata.sort()\nwith open('another_file','w') as target:\n    for _, line in data:\n        target.write( line )\n</code>\n</pre>\n", "senID": 0}, {"text": ["That should do it.", "3 million lines will fit into most machine's memory unless the lines are HUGE (over 512 characters)."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}], [{"text": ["Takes only a few seconds in Python:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n &gt;&gt;&gt; import random\n&gt;&gt;&gt; lines = open('3mil.txt').readlines()\n&gt;&gt;&gt; random.shuffle(lines)\n&gt;&gt;&gt; open('3mil.txt', 'w').writelines(lines)\n</code>\n</pre>\n", "senID": 1}], [{"text": ["On many systems the sort shell command takes -R to randomize its input."], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "sort", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "-R", "childNum": 0, "tag": "code", "childList": []}]}], [{"text": ["Here's another version"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["At the shell, use this."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n python decorate.py | sort | python undecorate.py\n</code>\n</pre>\n", "senID": 2}, {"text": ["decorate.py"], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"code": "<pre>\n<code>\n import sys\nimport random\nfor line in sys.stdin:\n    sys.stdout.write( \"{0}|{1}\".format( random.random(), line ) )\n</code>\n</pre>\n", "senID": 4}, {"text": ["undecorate.py"], "childNum": 0, "tag": "p", "senID": 5, "childList": []}, {"code": "<pre>\n<code>\n import sys\nfor line in sys.stdin:\n    _, _, data= line.partition(\"|\")\n    sys.stdout.write( line )\n</code>\n</pre>\n", "senID": 6}, {"text": ["Uses almost no memory.  "], "childNum": 0, "tag": "p", "senID": 7, "childList": []}], [{"text": ["This is the same as Mr. Kugelman's, but using vim's built-in python interface:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n :py import vim, random as r; cb = vim.current.buffer ; l = cb[:] ; r.shuffle(l) ; cb[:] = l\n</code>\n</pre>\n", "senID": 1}], [{"text": ["Found this page which has a solution (not sure it will work or not):\nhttp://www.skrinakcreative.com/wp/2009/05/cool-vim-random-line-shuffle-trick/"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "http://www.skrinakcreative.com/wp/2009/05/cool-vim-random-line-shuffle-trick/", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://www.skrinakcreative.com/wp/2009/05/cool-vim-random-line-shuffle-trick/"}]}], [{"text": ["If you do not want to load everything into memory and sort it there, you have to store the lines on disk while doing random sorting.", "That will be very slow."], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "not", "childNum": 0, "tag": "em", "pos": 0, "childList": []}, {"text": "have", "childNum": 0, "tag": "em", "pos": -1, "childList": []}]}, {"text": ["Here is a very simple, stupid and slow version.", "Note that this may take a surprising amount of diskspace, and it will be very slow.", "I ran it with 300.000 lines, and it takes several minutes.", "3 million lines could very well take an hour.", "So: Do it in memory.", "Really.", "It's not that big."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}, {"code": "<pre>\n<code>\n import os\nimport tempfile\nimport shutil\nimport random\ntempdir = tempfile.mkdtemp()\nprint tempdir\n\nfiles = []\n# Split the lines:\nwith open('/tmp/sorted.txt', 'rt') as infile:\n    counter = 0    \n    for line in infile:\n        outfilename = os.path.join(tempdir, '%09i.txt' % counter)\n        with open(outfilename, 'wt') as outfile:\n            outfile.write(line)\n        counter += 1\n        files.append(outfilename)\n\nwith open('/tmp/random.txt', 'wt') as outfile:\n    while files:\n        index = random.randint(0, len(files) - 1)\n        filename = files.pop(index)\n        outfile.write(open(filename, 'rt').read())\n\nshutil.rmtree(tempdir)\n</code>\n</pre>\n", "senID": 2}, {"text": ["Another version would be to store the files in an SQLite database and pull the lines randomly from that database.", "That is probably going to be faster than this."], "childNum": 0, "tag": "p", "senID": 3, "childList": []}]]