[[{"text": ["Perforce has Python wrappers around their C/C++ tools, available in binary form for Windows, and source for other platforms:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["http://www.perforce.com/perforce/loadsupp.html#api"], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "http://www.perforce.com/perforce/loadsupp.html#api", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://www.perforce.com/perforce/loadsupp.html#api"}]}, {"text": ["You will find their documentation of the scripting API to be helpful:"], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"text": ["http://www.perforce.com/perforce/doc.current/manuals/p4script/p4script.pdf"], "childNum": 1, "tag": "p", "senID": 3, "childList": [{"text": "http://www.perforce.com/perforce/doc.current/manuals/p4script/p4script.pdf", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://www.perforce.com/perforce/doc.current/manuals/p4script/p4script.pdf"}]}, {"text": ["Use of the Python API is quite similar to the command-line client:"], "childNum": 0, "tag": "p", "senID": 4, "childList": []}, {"code": "<pre>\n<code>\n PythonWin 2.5.1 (r251:54863, May  1 2007, 17:47:05) [MSC v.1310 32 bit (Intel)] on win32.\nPortions Copyright 1994-2006 Mark Hammond - see 'Help/About PythonWin' for further copyright information.\n&gt;&gt;&gt; import P4\n&gt;&gt;&gt; p4 = P4.P4()\n&gt;&gt;&gt; p4.connect() # connect to the default server, with the default clientspec\n&gt;&gt;&gt; desc = {\"Description\": \"My new changelist description\",\n...         \"Change\": \"new\"\n...         }\n&gt;&gt;&gt; p4.input = desc\n&gt;&gt;&gt; p4.run(\"changelist\", \"-i\")\n['Change 2579505 created.']\n&gt;&gt;&gt;\n</code>\n</pre>\n", "senID": 5}, {"text": ["I'll verify it from the command line:"], "childNum": 0, "tag": "p", "senID": 6, "childList": []}, {"code": "<pre>\n<code>\n P:\\&gt;p4 changelist -o 2579505\n# A Perforce Change Specification.\n#\n#  Change:      The change number. 'new' on a new changelist.\n#  Date:        The date this specification was last modified.\n#  Client:      The client on which the changelist was created.  Read-only.\n#  User:        The user who created the changelist.\n#  Status:      Either 'pending' or 'submitted'. Read-only.\n#  Description: Comments about the changelist.  Required.\n#  Jobs:        What opened jobs are to be closed by this changelist.\n#               You may delete jobs from this list.  (New changelists only.)\n#  Files:       What opened files from the default changelist are to be added\n#               to this changelist.  You may delete files from this list.\n#               (New changelists only.)\n\nChange: 2579505\n\nDate:   2008/10/08 13:57:02\n\nClient: MYCOMPUTER-DT\n\nUser:   myusername\n\nStatus: pending\n\nDescription:\n        My new changelist description\n</code>\n</pre>\n", "senID": 7}], [{"text": ["Here's what I came up with:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n import os\n\ndef CreateNewChangeList(description):\n    \"Create a new changelist and returns the changelist number as a string\"\n    p4in, p4out = os.popen2(\"p4 changelist -i\")\n    p4in.write(\"change: new\\n\")\n    p4in.write(\"description: \" + description)\n    p4in.close()\n    changelist = p4out.readline().split()[1]\n    return changelist\n\ndef OpenFileForEdit(file, changelist = \"\"):\n    \"Open a file for edit, if a changelist is passed in then open it in that list\"\n    cmd = \"p4 edit \"\n    if changelist:\n        cmd += \" -c \" + changelist + \" \"\n    ret = os.popen(cmd + file).readline().strip()\n    if not ret.endswith(\"opened for edit\"):\n        print \"Couldn't open\", file, \"for edit:\"\n        print ret\n        raise ValueError\n</code>\n</pre>\n", "senID": 1}], [{"text": ["Perforce's P4 Python module mentioned in another answer is the way to go, but if installing this module isn't an option you can use the -G flag to help parse p4.exe output:"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "Perforce's P4 Python module", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://www.perforce.com/perforce/loadsupp.html#api"}]}, {"code": "<pre>\n<code>\n p4 [ options ] command [ arg ... ]\n    options:\n            -c client -C charset -d dir -H host -G -L language\n            -p port -P pass -s -Q charset -u user -x file\n    The -G flag causes all output (and batch input for form commands\n    with -i) to be formatted as marshalled Python dictionary objects.\n</code>\n</pre>\n", "senID": 1}], [{"text": ["Building from p4python source requires downloading and extracting the p4 api recommended for that version.", "For example, if building the Windows XP x86 version of P4Python 2008.2 for activepython 2.5:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"tag": "ul", "num": 2, "lis": [{"text": "download and extract both the ", "tag": "none", "senID": 1}, {"text": "fixup the setup.cfg for p4python to\npoint to the p4api directory.", "tag": "none", "senID": 2}]}, {"text": ["To open files for edit (do a checkout), on the command line, see 'p4 help open'."], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"text": ["You can check out files without making a changelist if you add the file to the default changelist, but it's a good idea to make a changelist first."], "childNum": 0, "tag": "p", "senID": 4, "childList": []}, {"text": ["P4Python doesn't currently compile for activepython 2.6 without visual studio 2008; the provided libs are built with 2005 or 2003.", "Forcing p4python to build against mingw is nearly impossible, even with pexports of python26.dll and reimp/reassembly of the provided .lib files into .a files."], "childNum": 0, "tag": "p", "senID": 5, "childList": []}, {"text": ["In that case, you'll probably rather use subprocess, and return p4 results as marshalled python objects.", "You can write your own command wrapper that takes an arg array, constructs and runs the commands, and returns the results dictionary."], "childNum": 0, "tag": "p", "senID": 6, "childList": []}, {"text": ["You might try changing everything, testing, and on success, opening the files that are different with something equivalent to 'p4 diff -se //...'"], "childNum": 0, "tag": "p", "senID": 7, "childList": []}], [{"text": ["Remember guys to install the development package for Python for the p4api or it will complain about missing headers.", "In Ubuntu 10.10, just do a simple:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n apt-get install python2.6-dev\n</code>\n</pre>\n", "senID": 1}, {"text": ["Or"], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"code": "<pre>\n<code>\n apt-get install python3.1-dev\n</code>\n</pre>\n", "senID": 3}], [{"text": ["You may want to check out the P4Python module.", "It's available on the perforce site and it makes things very simple."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}]]