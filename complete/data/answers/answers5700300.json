[[{"text": ["Have a look at the official csv module."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "csv module", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://docs.python.org/library/csv.html#examples"}]}], [{"text": ["Here are a few minor notes on your current code:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"tag": "ul", "num": 4, "lis": [{"text": "It's a bad idea to use ", "tag": "none", "senID": 1}, {"text": "You can close the file objects automatically by using the ", "tag": "none", "senID": 2}, {"text": "Don't you want to add an extra column in the header line, called something like ", "tag": "none", "senID": 3}, {"text": "If your filenames have commas (or, less probably, newlines) in them, you'll need to make sure that the filename is quoted - just appending it won't do.", "tag": "none", "senID": 4}]}, {"text": ["That last consideration would incline me to use the csv module instead, which will deal with the quoting and unquoting for you.", "For example, you could try something like the following code:"], "childNum": 1, "tag": "p", "senID": 5, "childList": [{"text": "csv", "childNum": 0, "tag": "code", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n import glob\nimport csv\nimport sys\n\nfor filename in glob.glob(sys.argv[1]):\n    data = []\n    with open(filename) as finput:\n        for i, row in enumerate(csv.reader(finput)):\n            to_append = \"Filename\" if i == 0 else filename\n            data.append(row+[to_append])\n    with open(filename,'wb') as foutput:\n        writer = csv.writer(foutput)\n        for row in data:\n            writer.writerow(row)\n</code>\n</pre>\n", "senID": 6}, {"text": ["That may quote the data slightly differently from your input file, so you might want to play with the quoting options for csv.reader and csv.writer described in the documentation for the csv module."], "childNum": 3, "tag": "p", "senID": 7, "childList": [{"text": "csv.reader", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "csv.writer", "childNum": 0, "tag": "code", "childList": []}, {"href": "http://docs.python.org/library/csv.html", "text": "in the documentation for the csv module", "childNum": 0, "tag": "a", "childList": []}]}, {"text": ["As a further point, you might have good reasons for taking a glob as a parameter rather than just the files on the command line, but it's a bit surprising - you'll have to call your script as ./whatever.py '*.csv' rather than just ./whatever.py *.csv.", "Instead, you could just do:"], "childNum": 2, "tag": "p", "senID": 8, "childList": [{"text": "./whatever.py '*.csv'", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "./whatever.py *.csv", "childNum": 0, "tag": "code", "pos": -1, "childList": []}]}, {"code": "<pre>\n<code>\n for filename in sys.argv[1:]:\n</code>\n</pre>\n", "senID": 9}, {"text": ["... and let the shell expand your glob before the script knows anything about it."], "childNum": 0, "tag": "p", "senID": 10, "childList": []}, {"text": ["One last thing - the current approach you're taking is slightly dangerous, in that if anything fails when writing back to the same filename, you'll lose data.", "The standard way of avoiding this is to instead write to a temporary file, and, if that was successful, rename the temporary file over the original.", "So, you might rewrite the whole thing as:"], "childNum": 0, "tag": "p", "senID": 11, "childList": []}, {"code": "<pre>\n<code>\n import csv\nimport sys\nimport tempfile\nimport shutil\n\nfor filename in sys.argv[1:]:\n    tmp = tempfile.NamedTemporaryFile(delete=False)\n    with open(filename) as finput:\n        with open(tmp.name,'wb') as ftmp:\n            writer = csv.writer(ftmp)\n            for i, row in enumerate(csv.reader(finput)):\n                to_append = \"Filename\" if i == 0 else filename\n                writer.writerow(row+[to_append])\n    shutil.move(tmp.name,filename)\n</code>\n</pre>\n", "senID": 12}], [{"text": ["You can try:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n data = [file.readline().rstrip() + \",id\"]\ndata += [line.rstrip() + \",\" + filename for line in file]\n</code>\n</pre>\n", "senID": 1}], [{"text": ["Use the CSV module that comes with Python."], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "CSV module", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://docs.python.org/library/csv.html"}]}, {"code": "<pre>\n<code>\n import csv\nimport sys\n\ndef process_file(filename):\n    # Read the contents of the file into a list of lines.\n    f = open(filename, 'r')\n    contents = f.readlines()\n    f.close()\n\n    # Use a CSV reader to parse the contents.\n    reader = csv.reader(contents)\n\n    # Open the output and create a CSV writer for it.\n    f = open(filename, 'wb')\n    writer = csv.writer(f)\n\n    # Process the header.\n    header = reader.next()\n    header.append('ID')\n    writer.writerow(header)\n\n    # Process each row of the body.\n    for row in reader:\n        row.append(filename)\n        writer.writerow(row)\n\n    # Close the file and we're done.\n    f.close()\n\n# Run the function on all command-line arguments. Note that this does no\n# checking for things such as file existence or permissions.\nmap(process_file, sys.argv[1:])\n</code>\n</pre>\n", "senID": 1}, {"text": ["You can run this as follows:"], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"code": "<pre>\n<code>\n blair@blair-eeepc:~$ python csv_add_filename.py file1.csv file2.csv\n</code>\n</pre>\n", "senID": 3}], [{"text": ["You can try changing your code, but using the csv module is recommended.", "This should give you the result you want:"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "csv module", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://docs.python.org/library/csv.html"}]}, {"code": "<pre>\n<code>\n import sys\nimport glob\nimport csv\n\nfilename = glob.glob(sys.argv[1])[0]\nyourfile = csv.reader(open(filename, 'rw'))\n\ncsv_output=[]\n\nfor row in yourfile:\n    if len(csv_output) != 0:     # skip the header\n        row.append(filename)\n    csv_output.append(row)\n\nyourfile = csv.writer(open(filename,'w'),delimiter=',')\nyourfile.writerows(csv_output)\n</code>\n</pre>\n", "senID": 1}], [{"text": ["you can use fileinput to do in place editing"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n import sys\nimport glob\nimport fileinput\n\nfor filename in glob.glob(sys.argv[1]):\n    for line in fileinput.FileInput(filename,inplace=1) :\n       if fileinput.lineno()==1:\n          print line.rstrip() + \" ID\"\n       else\n          print line.rstrip() + \",\" + filename\n</code>\n</pre>\n", "senID": 1}]]