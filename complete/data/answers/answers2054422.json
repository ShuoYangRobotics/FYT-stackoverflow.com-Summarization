[[{"text": ["Just ask for their zip only, then give a (short) list of applicable cities by using a geocode database.", "That way you get nice clean 5-digit input, they save time, and you all go home happy."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["If you already have the data, look just for the zip, find a list of possible cities (there will only be one applicable state) and match for the city name after making everything lowercase."], "childNum": 0, "tag": "p", "senID": 1, "childList": []}], [{"text": ["You could use a geocoding web service or something similar.", "For example, on the Yahoo geocoding API page, it shows how you can specify the address in a number of ways:"], "childNum": 1, "tag": "p", "senID": 0, "childList": [{"text": "Yahoo geocoding API", "tag": "a", "pos": 1, "childList": [], "childNum": 0, "href": "http://developer.yahoo.com/maps/rest/V1/geocode.html"}]}, {"code": "<pre>\n<code>\n This free field lets users enter any of the following:\n    city, state\n    city, state, zip\n    zip\n    street, city, state\n    street, city, state, zip\n    street, zip\n</code>\n</pre>\n", "senID": 1}, {"text": ["and the XML results provide the parsed address, for example with this test URL specified on the page."], "childNum": 1, "tag": "p", "senID": 2, "childList": [{"text": "test URL", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://local.yahooapis.com/MapsService/V1/geocode?appid=YD-9G7bey8_JXxQP6rxl.fBFGgCdNjoDMACQA--&street=701+First+Ave&city=Sunnyvale&state=CA"}]}], [{"text": ["I would use ([^\\d]+)?(\\d{5})?", "as my regular expression, and use match so it only matches the beginning of the string.", "This way it won't fail on bad input and will make its best guess as to what was intended.", "Then you can split the first capture group on \",\"."], "childNum": 2, "tag": "p", "senID": 0, "childList": [{"text": "([^\\d]+)?(\\d{5})?", "childNum": 0, "tag": "code", "pos": 0, "childList": []}, {"text": "match", "childNum": 0, "tag": "code", "pos": 1, "childList": []}]}], [{"text": ["This code seems to do what you want:"], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"code": "<pre>\n<code>\n text = \"\"\"\nBoulder, Co\n80303\nBoulder, Colorado\nBoulder, Co 80303\n\"\"\"\n\nlines = text.splitlines()\n\nABBREV = dict(co=\"Colorado\", ca=\"California\")\nSTATES = ABBREV.values()\n\ndef parse_addr(line):\n    addr = {}\n    # normalize commas\n    parts = line.replace(\",\", \" \").split()\n    for part in parts:\n        if part.capitalize() in STATES:\n            addr[\"state\"] = part\n        elif part.lower() in ABBREV:\n            addr[\"state\"] = ABBREV[part.lower()]\n        else:\n            try:\n                zip = int(part)\n                addr[\"zip\"] = part\n            except ValueError:\n                addr[\"city\"] = part\n    return addr\n\nfor line in lines:\n    print line, parse_addr(line)\n</code>\n</pre>\n", "senID": 1}, {"text": ["Output:"], "childNum": 0, "tag": "p", "senID": 2, "childList": []}, {"code": "<pre>\n<code>\n Boulder, Co {'city': 'Boulder', 'state': 'Colorado'}\n80303 {'zip': '80303'}\nBoulder, Colorado {'city': 'Boulder', 'state': 'Colorado'}\nBoulder, Co 80303 {'city': 'Boulder', 'state': 'Colorado', 'zip': '80303'}\n</code>\n</pre>\n", "senID": 3}, {"text": ["Handling of \"South Dakota\" and other two-word states/cities left as an exercise for the reader :)"], "childNum": 0, "tag": "p", "senID": 4, "childList": []}, {"text": ["As the other posters suggested, you can get smart and use the zip code to narrow in on the city/state as well."], "childNum": 0, "tag": "p", "senID": 5, "childList": []}], [{"code": "<pre>\n<code>\n import string\nimport ngram\ncityStateParser = ngram.NGram(\n  items = (line.strip() for line in open('citystate.data')) ,\n  N=3, iconv=string.lower, qconv=string.lower,  threshold=.2\n)\n</code>\n</pre>\n", "senID": 0}, {"text": ["Example:"], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "Example", "childNum": 0, "tag": "strong", "pos": 0, "childList": []}]}, {"code": "<pre>\n<code>\n cityStateParser.search('redwood')\n[('Redwood VA', 0.5),\n('Redwood NY', 0.5),\n('Redwood MS', 0.5),\n('Redwood City CA', 0.36842105263157893),\n...\n]\n</code>\n</pre>\n", "senID": 2}, {"text": ["Notes:\nBecause these are NGrams you might get overmatch when the state is part of a ngram in the city\ni.e.", "search for \"washington\" would yield Washington IN with a bette score than \"Washington OK\"  "], "childNum": 0, "tag": "p", "senID": 3, "childList": []}, {"text": ["You might also want read Using Superimposed Coding Of N-Gram Lists For Efficient Inexact Matching (PDF Download)"], "childNum": 1, "tag": "p", "senID": 4, "childList": [{"text": "Using Superimposed Coding Of N-Gram Lists For Efficient Inexact Matching", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.21.344&rep=rep1&type=pdf"}]}], [{"text": ["Expect that some users might type a ZIP+4."], "childNum": 0, "tag": "p", "senID": 0, "childList": []}, {"text": ["The pitfalls of asking for city/state/ZIP without an address are described at http://semaphorecorp.com/cgi/zip5.html"], "childNum": 1, "tag": "p", "senID": 1, "childList": [{"text": "http://semaphorecorp.com/cgi/zip5.html", "tag": "a", "pos": 0, "childList": [], "childNum": 0, "href": "http://semaphorecorp.com/cgi/zip5.html"}]}]]